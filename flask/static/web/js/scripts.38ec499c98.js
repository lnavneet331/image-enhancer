!function (t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define([], t) : ("undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this).PIXI = t() }(function () { return function r(n, o, s) { function a(i, t) { if (!o[i]) { if (!n[i]) { var e = "function" == typeof require && require; if (!t && e) return e(i, !0); if (h) return h(i, !0); throw (t = new Error("Cannot find module '" + i + "'")).code = "MODULE_NOT_FOUND", t } e = o[i] = { exports: {} }, n[i][0].call(e.exports, function (t) { var e = n[i][1][t]; return a(e || t) }, e, e.exports, r, n, o, s) } return o[i].exports } for (var h = "function" == typeof require && require, t = 0; t < s.length; t++)a(s[t]); return a }({ 1: [function (t, l, e) { "use strict"; function i(t) { var e = 32; return (t &= -t) && e--, 65535 & t && (e -= 16), 16711935 & t && (e -= 8), 252645135 & t && (e -= 4), 858993459 & t && (e -= 2), 1431655765 & t && --e, e } e.INT_BITS = 32, e.INT_MAX = 2147483647, e.INT_MIN = -1 << 31, e.sign = function (t) { return (0 < t) - (t < 0) }, e.abs = function (t) { var e = t >> 31; return (t ^ e) - e }, e.min = function (t, e) { return e ^ (t ^ e) & -(t < e) }, e.max = function (t, e) { return t ^ (t ^ e) & -(t < e) }, e.isPow2 = function (t) { return !(t & t - 1 || !t) }, e.log2 = function (t) { var e, i = (65535 < t) << 4; return (i = (i |= e = (255 < (t >>>= i)) << 3) | (e = (15 < (t >>>= e)) << 2) | (e = (3 < (t >>>= e)) << 1)) | (t >>>= e) >> 1 }, e.log10 = function (t) { return 1e9 <= t ? 9 : 1e8 <= t ? 8 : 1e7 <= t ? 7 : 1e6 <= t ? 6 : 1e5 <= t ? 5 : 1e4 <= t ? 4 : 1e3 <= t ? 3 : 100 <= t ? 2 : 10 <= t ? 1 : 0 }, e.popCount = function (t) { return 16843009 * ((t = (858993459 & (t -= t >>> 1 & 1431655765)) + (t >>> 2 & 858993459)) + (t >>> 4) & 252645135) >>> 24 }, e.countTrailingZeros = i, e.nextPow2 = function (t) { return t += 0 === t, --t, (t = (t = (t = (t = (t |= t >>> 1) | t >>> 2) | t >>> 4) | t >>> 8) | t >>> 16) + 1 }, e.prevPow2 = function (t) { return (t = (t = (t = (t = (t |= t >>> 1) | t >>> 2) | t >>> 4) | t >>> 8) | t >>> 16) - (t >>> 1) }, e.parity = function (t) { return 27030 >>> (t = ((t = (t ^= t >>> 16) ^ t >>> 8) ^ t >>> 4) & 15) & 1 }; for (var r = new Array(256), n = r, o = 0; o < 256; ++o) { var s = o, a = o, h = 7; for (s >>>= 1; s; s >>>= 1)a = a << 1 | 1 & s, --h; n[o] = a << h & 255 } e.reverse = function (t) { return r[255 & t] << 24 | r[t >>> 8 & 255] << 16 | r[t >>> 16 & 255] << 8 | r[t >>> 24 & 255] }, e.interleave2 = function (t, e) { return (t = 1431655765 & ((t = 858993459 & ((t = 252645135 & ((t = 16711935 & ((t &= 65535) | t << 8)) | t << 4)) | t << 2)) | t << 1)) | (e = 1431655765 & ((e = 858993459 & ((e = 252645135 & ((e = 16711935 & ((e &= 65535) | e << 8)) | e << 4)) | e << 2)) | e << 1)) << 1 }, e.deinterleave2 = function (t, e) { return (t = 65535 & ((t = 16711935 & ((t = 252645135 & ((t = 858993459 & ((t = t >>> e & 1431655765) | t >>> 1)) | t >>> 2)) | t >>> 4)) | t >>> 16)) << 16 >> 16 }, e.interleave3 = function (t, e, i) { return t = 1227133513 & ((t = 3272356035 & ((t = 251719695 & ((t = 4278190335 & ((t &= 1023) | t << 16)) | t << 8)) | t << 4)) | t << 2), (t |= (e = 1227133513 & ((e = 3272356035 & ((e = 251719695 & ((e = 4278190335 & ((e &= 1023) | e << 16)) | e << 8)) | e << 4)) | e << 2)) << 1) | (i = 1227133513 & ((i = 3272356035 & ((i = 251719695 & ((i = 4278190335 & ((i &= 1023) | i << 16)) | i << 8)) | i << 4)) | i << 2)) << 2 }, e.deinterleave3 = function (t, e) { return (t = 1023 & ((t = 4278190335 & ((t = 251719695 & ((t = 3272356035 & ((t = t >>> e & 1227133513) | t >>> 2)) | t >>> 4)) | t >>> 8)) | t >>> 16)) << 22 >> 22 }, e.nextCombination = function (t) { var e = t | t - 1; return 1 + e | (~e & -~e) - 1 >>> i(t) + 1 } }, {}], 2: [function (e, i, r) { "use strict"; function t(t, e, i) { i = i || 2; var r, n, o, s, a, u = e && e.length, c = u ? e[0] * i : t.length, h = g(t, 0, c, i, !0), f = []; if (!h) return f; if (u && (h = function (t, e, i, r) { var n, o, s, a, h = []; for (n = 0, o = e.length; n < o; n++)a = e[n] * r, s = n < o - 1 ? e[n + 1] * r : t.length, (a = g(t, a, s, r, !1)) === a.next && (a.steiner = !0), h.push(function (t) { var e = t, i = t; for (; e.x < i.x && (i = e), e = e.next, e !== t;); return i }(a)); for (h.sort(v), n = 0; n < h.length; n++)!function (t, e) { (e = function (t, u) { var e, i = u, r = t.x, n = t.y, o = -1 / 0; do { if (n <= i.y && n >= i.next.y && i.next.y !== i.y) { var s = i.x + (n - i.y) * (i.next.x - i.x) / (i.next.y - i.y); if (s <= r && o < s) { if ((o = s) === r) { if (n === i.y) return i; if (n === i.next.y) return i.next } e = i.x < i.next.x ? i : i.next } } } while (i = i.next, i !== u); if (!e) return null; if (r === o) return e.prev; var a, c = e, f = e.x, h = e.y, l = 1 / 0; i = e.next; for (; i !== c;)r >= i.x && i.x >= f && r !== i.x && P(n < h ? r : o, n, f, h, n < h ? o : r, n, i.x, i.y) && ((a = Math.abs(n - i.y) / (r - i.x)) < l || a === l && i.x > e.x) && D(i, t) && (e = i, l = a), i = i.next; return e }(t, e)) && C(e = k(e, t), e.next) }(h[n], i), i = C(i, i.next); return i }(t, e, h, i)), t.length > 80 * i) { for (var l = r = t[0], d = n = t[1], p = i; p < c; p += i)(o = t[p]) < l && (l = o), (s = t[p + 1]) < d && (d = s), r < o && (r = o), n < s && (n = s); a = 0 !== (a = Math.max(r - l, n - d)) ? 1 / a : 0 } return E(h, f, i, l, d, a), f } function g(t, e, i, r, n) { var o, s; if (n === 0 < m(t, e, i, r)) for (o = e; o < i; o += r)s = a(o, t[o], t[o + 1], s); else for (o = i - r; e <= o; o -= r)s = a(o, t[o], t[o + 1], s); return s && A(s, s.next) && (R(s), s = s.next), s } function C(t, e) { if (!t) return t; e = e || t; var i, r = t; do { if (i = !1, r.steiner || !A(r, r.next) && 0 !== M(r.prev, r, r.next)) r = r.next; else { if (R(r), (r = e = r.prev) === r.next) break; i = !0 } } while (i || r !== e); return e } function E(t, e, i, r, u, n, c) { if (t) { if (!c && n) { for (var f = t, d = r, p = u, g = n, o = f; null === o.z && (o.z = O(o.x, o.y, d, p, g)), o.prevZ = o.prev, o.nextZ = o.next, (o = o.next) !== f;); o.prevZ.nextZ = null, o.prevZ = null; var v, s, a, h, l, m, y, _, b = o, x = 1; do { for (s = b, l = b = null, m = 0; s;) { for (m++, a = s, v = y = 0; v < x && (y++, a = a.nextZ); v++); for (_ = x; 0 < y || 0 < _ && a;)0 !== y && (0 === _ || !a || s.z <= a.z) ? (s = (h = s).nextZ, y--) : (a = (h = a).nextZ, _--), l ? l.nextZ = h : b = h, h.prevZ = l, l = h; s = a } } while (l.nextZ = null, x *= 2, 1 < m) } for (var T, w, S = t; t.prev !== t.next;)if (T = t.prev, w = t.next, n ? function (t, e, i, r) { var n = t.prev, o = t, s = t.next; if (0 <= M(n, o, s)) return !1; var u = (n.x < o.x ? n.x < s.x ? n : s : o.x < s.x ? o : s).x, c = (n.y < o.y ? n.y < s.y ? n : s : o.y < s.y ? o : s).y, f = (n.x > o.x ? n.x > s.x ? n : s : o.x > s.x ? o : s).x, d = (n.y > o.y ? n.y > s.y ? n : s : o.y > s.y ? o : s).y, a = O(u, c, e, i, r), p = O(f, d, e, i, r), h = t.prevZ, l = t.nextZ; for (; h && h.z >= a && l && l.z <= p;) { if (h !== t.prev && h !== t.next && P(n.x, n.y, o.x, o.y, s.x, s.y, h.x, h.y) && 0 <= M(h.prev, h, h.next)) return !1; if (h = h.prevZ, l !== t.prev && l !== t.next && P(n.x, n.y, o.x, o.y, s.x, s.y, l.x, l.y) && 0 <= M(l.prev, l, l.next)) return !1; l = l.nextZ } for (; h && h.z >= a;) { if (h !== t.prev && h !== t.next && P(n.x, n.y, o.x, o.y, s.x, s.y, h.x, h.y) && 0 <= M(h.prev, h, h.next)) return !1; h = h.prevZ } for (; l && l.z <= p;) { if (l !== t.prev && l !== t.next && P(n.x, n.y, o.x, o.y, s.x, s.y, l.x, l.y) && 0 <= M(l.prev, l, l.next)) return !1; l = l.nextZ } return !0 }(t, r, u, n) : function (t) { var e = t.prev, i = t, r = t.next; if (0 <= M(e, i, r)) return !1; var n = t.next.next; for (; n !== t.prev;) { if (P(e.x, e.y, i.x, i.y, r.x, r.y, n.x, n.y) && 0 <= M(n.prev, n, n.next)) return !1; n = n.next } return !0 }(t)) e.push(T.i / i), e.push(t.i / i), e.push(w.i / i), R(t), t = w.next, S = w.next; else if ((t = w) === S) { c ? 1 === c ? E(t = function (t, e, i) { var r = t; do { var n = r.prev, o = r.next.next } while (!A(n, o) && I(n, r, r.next, o) && D(n, o) && D(o, n) && (e.push(n.i / i), e.push(r.i / i), e.push(o.i / i), R(r), R(r.next), r = t = o), r = r.next, r !== t); return r }(t, e, i), e, i, r, u, n, 2) : 2 === c && function (t, e, i, r, n, o) { var s = t; do { for (var a, h = s.next.next; h !== s.prev;) { if (s.i !== h.i && function (t, e) { return t.next.i !== e.i && t.prev.i !== e.i && !function (t, e) { var i = t; do { if (i.i !== t.i && i.next.i !== t.i && i.i !== e.i && i.next.i !== e.i && I(i, i.next, t, e)) return !0 } while (i = i.next, i !== t); return !1 }(t, e) && D(t, e) && D(e, t) && function (t, e) { var i = t, r = !1, n = (t.x + e.x) / 2, o = (t.y + e.y) / 2; for (; i.y > o != i.next.y > o && i.next.y !== i.y && n < (i.next.x - i.x) * (o - i.y) / (i.next.y - i.y) + i.x && (r = !r), i = i.next, i !== t;); return r }(t, e) }(s, h)) return a = k(s, h), s = C(s, s.next), a = C(a, a.next), E(s, e, i, r, n, o), E(a, e, i, r, n, o); h = h.next } } while (s = s.next, s !== t) }(t, e, i, r, u, n) : E(C(t), e, i, r, u, n, 1); break } } } function v(t, e) { return t.x - e.x } function O(t, e, i, r, n) { return (t = 1431655765 & ((t = 858993459 & ((t = 252645135 & ((t = 16711935 & ((t = 32767 * (t - i) * n) | t << 8)) | t << 4)) | t << 2)) | t << 1)) | (e = 1431655765 & ((e = 858993459 & ((e = 252645135 & ((e = 16711935 & ((e = 32767 * (e - r) * n) | e << 8)) | e << 4)) | e << 2)) | e << 1)) << 1 } function P(t, e, i, r, n, o, s, a) { return 0 <= (n - s) * (e - a) - (t - s) * (o - a) && 0 <= (t - s) * (r - a) - (i - s) * (e - a) && 0 <= (i - s) * (o - a) - (n - s) * (r - a) } function M(t, e, i) { return (e.y - t.y) * (i.x - e.x) - (e.x - t.x) * (i.y - e.y) } function A(t, e) { return t.x === e.x && t.y === e.y } function I(t, e, i, r) { return A(t, e) && A(i, r) || A(t, r) && A(i, e) || 0 < M(t, e, i) != 0 < M(t, e, r) && 0 < M(i, r, t) != 0 < M(i, r, e) } function D(t, e) { return M(t.prev, t, t.next) < 0 ? 0 <= M(t, e, t.next) && 0 <= M(t, t.prev, e) : M(t, e, t.prev) < 0 || M(t, t.next, e) < 0 } function k(t, e) { var i = new s(t.i, t.x, t.y), r = new s(e.i, e.x, e.y), n = t.next, o = e.prev; return (t.next = e).prev = t, (i.next = n).prev = i, (r.next = i).prev = r, (o.next = r).prev = o, r } function a(t, e, i, r) { t = new s(t, e, i); return r ? (t.next = r.next, (t.prev = r).next.prev = t, r.next = t) : (t.prev = t).next = t, t } function R(t) { t.next.prev = t.prev, t.prev.next = t.next, t.prevZ && (t.prevZ.nextZ = t.nextZ), t.nextZ && (t.nextZ.prevZ = t.prevZ) } function s(t, e, i) { this.i = t, this.x = e, this.y = i, this.prev = null, this.next = null, this.z = null, this.prevZ = null, this.nextZ = null, this.steiner = !1 } function m(t, e, i, r) { for (var n = 0, o = e, s = i - r; o < i; o += r)n += (t[s] - t[o]) * (t[o + 1] + t[s + 1]), s = o; return n } i.exports = t, (i.exports.default = t).deviation = function (t, e, i, r) { var n = e && e.length, u = n ? e[0] * i : t.length, o = Math.abs(m(t, 0, u, i)); if (n) for (var s = 0, a = e.length; s < a; s++) { var c = e[s] * i, f = s < a - 1 ? e[s + 1] * i : t.length; o -= Math.abs(m(t, c, f, i)) } for (var h = 0, s = 0; s < r.length; s += 3) { var l = r[s] * i, d = r[s + 1] * i, p = r[s + 2] * i; h += Math.abs((t[l] - t[p]) * (t[1 + d] - t[1 + l]) - (t[l] - t[d]) * (t[1 + p] - t[1 + l])) } return 0 === o && 0 === h ? 0 : Math.abs((h - o) / o) }, t.flatten = function (t) { for (var e = t[0][0].length, i = { vertices: [], holes: [], dimensions: e }, r = 0, n = 0; n < t.length; n++) { for (var o = 0; o < t[n].length; o++)for (var s = 0; s < e; s++)i.vertices.push(t[n][o][s]); 0 < n && (r += t[n - 1].length, i.holes.push(r)) } return i } }, {}], 3: [function (t, e, i) { "use strict"; var r = Object.prototype.hasOwnProperty, d = "~"; function h() { } function n(t, e, i) { this.fn = t, this.context = e, this.once = i || !1 } function o() { this._events = new h, this._eventsCount = 0 } Object.create && (h.prototype = Object.create(null), (new h).__proto__ || (d = !1)), o.prototype.eventNames = function () { var t, e, i = []; if (0 === this._eventsCount) return i; for (e in t = this._events) r.call(t, e) && i.push(d ? e.slice(1) : e); return Object.getOwnPropertySymbols ? i.concat(Object.getOwnPropertySymbols(t)) : i }, o.prototype.listeners = function (t, e) { var t = d ? d + t : t, i = this._events[t]; if (e) return !!i; if (!i) return []; if (i.fn) return [i.fn]; for (var r = 0, n = i.length, o = new Array(n); r < n; r++)o[r] = i[r].fn; return o }, o.prototype.emit = function (t, e, i, r, l, u) { var c = d ? d + t : t; if (!this._events[c]) return !1; var n, o = this._events[c], s = arguments.length; if (o.fn) { switch (o.once && this.removeListener(t, o.fn, void 0, !0), s) { case 1: return o.fn.call(o.context), !0; case 2: return o.fn.call(o.context, e), !0; case 3: return o.fn.call(o.context, e, i), !0; case 4: return o.fn.call(o.context, e, i, r), !0; case 5: return o.fn.call(o.context, e, i, r, l), !0; case 6: return o.fn.call(o.context, e, i, r, l, u), !0 }for (h = 1, n = new Array(s - 1); h < s; h++)n[h - 1] = arguments[h]; o.fn.apply(o.context, n) } else for (var a, f = o.length, h = 0; h < f; h++)switch (o[h].once && this.removeListener(t, o[h].fn, void 0, !0), s) { case 1: o[h].fn.call(o[h].context); break; case 2: o[h].fn.call(o[h].context, e); break; case 3: o[h].fn.call(o[h].context, e, i); break; case 4: o[h].fn.call(o[h].context, e, i, r); break; default: if (!n) for (a = 1, n = new Array(s - 1); a < s; a++)n[a - 1] = arguments[a]; o[h].fn.apply(o[h].context, n) }return !0 }, o.prototype.on = function (t, e, i) { e = new n(e, i || this), i = d ? d + t : t; return this._events[i] ? this._events[i].fn ? this._events[i] = [this._events[i], e] : this._events[i].push(e) : (this._events[i] = e, this._eventsCount++), this }, o.prototype.once = function (t, e, i) { e = new n(e, i || this, !0), i = d ? d + t : t; return this._events[i] ? this._events[i].fn ? this._events[i] = [this._events[i], e] : this._events[i].push(e) : (this._events[i] = e, this._eventsCount++), this }, o.prototype.removeListener = function (t, e, i, r) { t = d ? d + t : t; if (!this._events[t]) return this; if (!e) return 0 == --this._eventsCount ? this._events = new h : delete this._events[t], this; var n = this._events[t]; if (n.fn) n.fn !== e || r && !n.once || i && n.context !== i || (0 == --this._eventsCount ? this._events = new h : delete this._events[t]); else { for (var o = 0, s = [], a = n.length; o < a; o++)(n[o].fn !== e || r && !n[o].once || i && n[o].context !== i) && s.push(n[o]); s.length ? this._events[t] = 1 === s.length ? s[0] : s : 0 == --this._eventsCount ? this._events = new h : delete this._events[t] } return this }, o.prototype.removeAllListeners = function (t) { return t ? (t = d ? d + t : t, this._events[t] && (0 == --this._eventsCount ? this._events = new h : delete this._events[t])) : (this._events = new h, this._eventsCount = 0), this }, o.prototype.off = o.prototype.removeListener, o.prototype.addListener = o.prototype.on, o.prototype.setMaxListeners = function () { return this }, o.prefixed = d, o.EventEmitter = o, void 0 !== e && (e.exports = o) }, {}], 4: [function (u, t, c) { function i(t, e) { return t.test(e) } function e(t) { var e = (t = t || navigator.userAgent).split("[FBAN"); if (void 0 !== (e = (t = void 0 !== e[1] ? e[0] : t).split("Twitter"))[1] && (t = e[0]), this.apple = { phone: i(r, t), ipod: i(n, t), tablet: !i(r, t) && i(o, t), device: i(r, t) || i(n, t) || i(o, t) }, this.amazon = { phone: i(h, t), tablet: !i(h, t) && i(l, t), device: i(h, t) || i(l, t) }, this.android = { phone: i(h, t) || i(s, t), tablet: !i(h, t) && !i(s, t) && (i(l, t) || i(a, t)), device: i(h, t) || i(l, t) || i(s, t) || i(a, t) }, this.windows = { phone: i(p, t), tablet: i(g, t), device: i(p, t) || i(g, t) }, this.other = { blackberry: i(v, t), blackberry10: i(m, t), opera: i(y, t), firefox: i(b, t), chrome: i(_, t), device: i(v, t) || i(m, t) || i(y, t) || i(b, t) || i(_, t) }, this.seven_inch = i(x, t), this.any = this.apple.device || this.android.device || this.windows.device || this.other.device || this.seven_inch, this.phone = this.apple.phone || this.android.phone || this.windows.phone, this.tablet = this.apple.tablet || this.android.tablet || this.windows.tablet, "undefined" == typeof window) return this } function f() { var t = new e; return t.Class = e, t } var d, r, n, o, s, a, h, l, p, g, v, m, y, _, b, x; d = this, r = /iPhone/i, n = /iPod/i, o = /iPad/i, s = /(?=.*\bAndroid\b)(?=.*\bMobile\b)/i, a = /Android/i, h = /(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i, l = /(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i, p = /Windows Phone/i, g = /(?=.*\bWindows\b)(?=.*\bARM\b)/i, v = /BlackBerry/i, m = /BB10/i, y = /Opera Mini/i, _ = /(CriOS|Chrome)(?=.*\bMobile\b)/i, b = /(?=.*\bFirefox\b)(?=.*\bMobile\b)/i, x = new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)", "i"), void 0 !== t && t.exports && "undefined" == typeof window ? t.exports = e : void 0 !== t && t.exports && "undefined" != typeof window ? t.exports = f() : d.isMobile = f() }, {}], 5: [function (l, t, e) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } function n(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") } i(s, [{ key: "detach", value: function () { return null !== this._owner && (this._owner.detach(this), !0) } }]); var o = s; function s(t, e, i) { void 0 === e && (e = !1), n(this, s), this._fn = t, this._once = e, this._thisArg = i, this._next = this._prev = this._owner = null } function a(t, e) { return t._head ? (t._tail._next = e)._prev = t._tail : t._head = e, (t._tail = e)._owner = t, e } i(h, [{ key: "handlers", value: function () { var t = this._head; if (!(arguments.length <= 0 || void 0 === arguments[0]) && arguments[0]) return !!t; for (var e = []; t;)e.push(t), t = t._next; return e } }, { key: "has", value: function (t) { if (!(t instanceof o)) throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object."); return t._owner === this } }, { key: "dispatch", value: function () { var t = this._head; if (!t) return !1; for (; t;)t._once && this.detach(t), t._fn.apply(t._thisArg, arguments), t = t._next; return !0 } }, { key: "add", value: function (t) { var e = arguments.length <= 1 || void 0 === arguments[1] ? null : arguments[1]; if ("function" != typeof t) throw new Error("MiniSignal#add(): First arg must be a Function."); return a(this, new o(t, !1, e)) } }, { key: "once", value: function (t) { var e = arguments.length <= 1 || void 0 === arguments[1] ? null : arguments[1]; if ("function" != typeof t) throw new Error("MiniSignal#once(): First arg must be a Function."); return a(this, new o(t, !0, e)) } }, { key: "detach", value: function (t) { if (!(t instanceof o)) throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object."); return t._owner !== this || (t._prev && (t._prev._next = t._next), t._next && (t._next._prev = t._prev), t === this._head ? (this._head = t._next, null === t._next && (this._tail = null)) : t === this._tail && (this._tail = t._prev, this._tail._next = null), t._owner = null), this } }, { key: "detachAll", value: function () { var t = this._head; if (!t) return this; for (this._head = this._tail = null; t;)t._owner = null, t = t._next; return this } }]); i = h; function h() { n(this, h), this._head = this._tail = void 0 } i.MiniSignalBinding = o, e.default = i, t.exports = e.default }, {}], 6: [function (t, e, i) { "use strict"; var h = Object.getOwnPropertySymbols, l = Object.prototype.hasOwnProperty, u = Object.prototype.propertyIsEnumerable; e.exports = function () { try { if (!Object.assign) return; var t = new String("abc"); if (t[5] = "de", "5" === Object.getOwnPropertyNames(t)[0]) return; for (var e = {}, i = 0; i < 10; i++)e["_" + String.fromCharCode(i)] = i; if ("0123456789" !== Object.getOwnPropertyNames(e).map(function (t) { return e[t] }).join("")) return; var r = {}; return "abcdefghijklmnopqrst".split("").forEach(function (t) { r[t] = t }), "abcdefghijklmnopqrst" !== Object.keys(Object.assign({}, r)).join("") ? void 0 : 1 } catch (t) { return } }() ? Object.assign : function (t, e) { for (var i, r = function (t) { if (null == t) throw new TypeError("Object.assign cannot be called with null or undefined"); return Object(t) }(t), n = 1; n < arguments.length; n++) { for (var o in i = Object(arguments[n])) l.call(i, o) && (r[o] = i[o]); if (h) for (var s = h(i), a = 0; a < s.length; a++)u.call(i, s[a]) && (r[s[a]] = i[s[a]]) } return r } }, {}], 7: [function (t, e, i) { "use strict"; e.exports = function (t, e) { for (var r = { key: ["source", "protocol", "authority", "userInfo", "user", "password", "host", "port", "relative", "path", "directory", "file", "query", "anchor"], q: { name: "queryKey", parser: /(?:^|&)([^&=]*)=?([^&]*)/g }, parser: { strict: /^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/, loose: /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/ } }, i = r.parser[(e = e || {}).strictMode ? "strict" : "loose"].exec(t), n = {}, o = 14; o--;)n[r.key[o]] = i[o] || ""; return n[r.q.name] = {}, n[r.key[12]].replace(r.q.parser, function (t, e, i) { e && (n[r.q.name][e] = i) }), n } }, {}], 8: [function (t, e, l) { !function (n) { function o(t, e) { for (var i = 0, r = t.length - 1; 0 <= r; r--) { var n = t[r]; "." === n ? t.splice(r, 1) : ".." === n ? (t.splice(r, 1), i++) : i && (t.splice(r, 1), i--) } if (e) for (; i--;)t.unshift(".."); return t } function i(t) { return e.exec(t).slice(1) } var e = /^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/; function s(t, e) { if (t.filter) return t.filter(e); for (var i = [], r = 0; r < t.length; r++)e(t[r], r, t) && i.push(t[r]); return i } l.resolve = function () { for (var t = "", e = !1, i = arguments.length - 1; -1 <= i && !e; i--) { var r = 0 <= i ? arguments[i] : n.cwd(); if ("string" != typeof r) throw new TypeError("Arguments to path.resolve must be strings"); r && (t = r + "/" + t, e = "/" === r.charAt(0)) } return (e ? "/" : "") + (t = o(s(t.split("/"), function (t) { return !!t }), !e).join("/")) || "." }, l.normalize = function (t) { var e = l.isAbsolute(t), i = "/" === r(t, -1); return (t = (t = o(s(t.split("/"), function (t) { return !!t }), !e).join("/")) || e ? t : ".") && i && (t += "/"), (e ? "/" : "") + t }, l.isAbsolute = function (t) { return "/" === t.charAt(0) }, l.join = function () { var t = Array.prototype.slice.call(arguments, 0); return l.normalize(s(t, function (t, e) { if ("string" != typeof t) throw new TypeError("Arguments to path.join must be strings"); return t }).join("/")) }, l.relative = function (t, e) { function i(t) { for (var e = 0; e < t.length && "" === t[e]; e++); for (var i = t.length - 1; 0 <= i && "" === t[i]; i--); return i < e ? [] : t.slice(e, i - e + 1) } t = l.resolve(t).substr(1), e = l.resolve(e).substr(1); for (var r = i(t.split("/")), n = i(e.split("/")), o = Math.min(r.length, n.length), s = o, a = 0; a < o; a++)if (r[a] !== n[a]) { s = a; break } for (var h = [], a = s; a < r.length; a++)h.push(".."); return (h = h.concat(n.slice(s))).join("/") }, l.sep = "/", l.delimiter = ":", l.dirname = function (t) { var t = i(t), e = t[0], t = t[1]; return e || t ? e + (t = t && t.substr(0, t.length - 1)) : "." }, l.basename = function (t, e) { t = i(t)[2]; return t = e && t.substr(-1 * e.length) === e ? t.substr(0, t.length - e.length) : t }, l.extname = function (t) { return i(t)[3] }; var r = "b" === "ab".substr(-1) ? function (t, e, i) { return t.substr(e, i) } : function (t, e, i) { return e < 0 && (e = t.length + e), t.substr(e, i) } }.call(this, t("_process")) }, { _process: 26 }], 9: [function (t, e, i) { function n(t, e, i, r) { this.gl = t, this.buffer = t.createBuffer(), this.type = e || t.ARRAY_BUFFER, this.drawType = r || t.STATIC_DRAW, this.data = o, i && this.upload(i), this._updateID = 0 } var o = new ArrayBuffer(0); n.prototype.upload = function (t, e, i) { i || this.bind(); i = this.gl; t = t || this.data, e = e || 0, this.data.byteLength >= t.byteLength ? i.bufferSubData(this.type, e, t) : i.bufferData(this.type, t, this.drawType), this.data = t }, n.prototype.bind = function () { this.gl.bindBuffer(this.type, this.buffer) }, n.createVertexBuffer = function (t, e, i) { return new n(t, t.ARRAY_BUFFER, e, i) }, n.createIndexBuffer = function (t, e, i) { return new n(t, t.ELEMENT_ARRAY_BUFFER, e, i) }, n.create = function (t, e, i, r) { return new n(t, e, i, r) }, n.prototype.destroy = function () { this.gl.deleteBuffer(this.buffer) }, e.exports = n }, {}], 10: [function (t, e, i) { function o(t, e, i) { this.gl = t, this.framebuffer = t.createFramebuffer(), this.stencil = null, this.texture = null, this.width = e || 100, this.height = i || 100 } var s = t("./GLTexture"); o.prototype.enableTexture = function (t) { var e = this.gl; this.texture = t || new s(e), this.texture.bind(), this.bind(), e.framebufferTexture2D(e.FRAMEBUFFER, e.COLOR_ATTACHMENT0, e.TEXTURE_2D, this.texture.texture, 0) }, o.prototype.enableStencil = function () { var t; this.stencil || (t = this.gl, this.stencil = t.createRenderbuffer(), t.bindRenderbuffer(t.RENDERBUFFER, this.stencil), t.framebufferRenderbuffer(t.FRAMEBUFFER, t.DEPTH_STENCIL_ATTACHMENT, t.RENDERBUFFER, this.stencil), t.renderbufferStorage(t.RENDERBUFFER, t.DEPTH_STENCIL, this.width, this.height)) }, o.prototype.clear = function (t, e, i, r) { this.bind(); var n = this.gl; n.clearColor(t, e, i, r), n.clear(n.COLOR_BUFFER_BIT | n.DEPTH_BUFFER_BIT) }, o.prototype.bind = function () { var t = this.gl; t.bindFramebuffer(t.FRAMEBUFFER, this.framebuffer) }, o.prototype.unbind = function () { var t = this.gl; t.bindFramebuffer(t.FRAMEBUFFER, null) }, o.prototype.resize = function (t, e) { var i = this.gl; this.width = t, this.height = e, this.texture && this.texture.uploadData(null, t, e), this.stencil && (i.bindRenderbuffer(i.RENDERBUFFER, this.stencil), i.renderbufferStorage(i.RENDERBUFFER, i.DEPTH_STENCIL, t, e)) }, o.prototype.destroy = function () { var t = this.gl; this.texture && this.texture.destroy(), t.deleteFramebuffer(this.framebuffer), this.gl = null, this.stencil = null, this.texture = null }, o.createRGBA = function (t, e, i, r) { var n = s.fromData(t, null, e, i), t = (n.enableNearestScaling(), n.enableWrapClamp(), new o(t, e, i)); return t.enableTexture(n), t.unbind(), t }, o.createFloat32 = function (t, e, i, r) { r = new s.fromData(t, r, e, i), r.enableNearestScaling(), r.enableWrapClamp(), t = new o(t, e, i); return t.enableTexture(r), t.unbind(), t }, e.exports = o }, { "./GLTexture": 12 }], 11: [function (t, e, i) { function r(t, e, i, r, n) { this.gl = t, r && (e = h(e, r), i = h(i, r)), this.program = o(t, e, i, n), this.attributes = s(t, this.program), this.uniformData = a(t, this.program), this.uniforms = l(t, this.uniformData) } var o = t("./shader/compileProgram"), s = t("./shader/extractAttributes"), a = t("./shader/extractUniforms"), h = t("./shader/setPrecision"), l = t("./shader/generateUniformAccessObject"); r.prototype.bind = function () { return this.gl.useProgram(this.program), this }, r.prototype.destroy = function () { this.attributes = null, this.uniformData = null, this.uniforms = null, this.gl.deleteProgram(this.program) }, e.exports = r }, { "./shader/compileProgram": 17, "./shader/extractAttributes": 19, "./shader/extractUniforms": 20, "./shader/generateUniformAccessObject": 21, "./shader/setPrecision": 25 }], 12: [function (t, e, i) { function n(t, e, i, r, n) { this.gl = t, this.texture = t.createTexture(), this.mipmap = !1, this.premultiplyAlpha = !1, this.width = e || -1, this.height = i || -1, this.format = r || t.RGBA, this.type = n || t.UNSIGNED_BYTE } var o = !(n.prototype.upload = function (t) { this.bind(); var e = this.gl, i = (e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL, this.premultiplyAlpha), t.videoWidth || t.width), r = t.videoHeight || t.height; r !== this.height || i !== this.width ? e.texImage2D(e.TEXTURE_2D, 0, this.format, this.format, this.type, t) : e.texSubImage2D(e.TEXTURE_2D, 0, 0, 0, this.format, this.type, t), this.width = i, this.height = r }); n.prototype.uploadData = function (t, e, i) { this.bind(); var r = this.gl; if (t instanceof Float32Array) { if (!o) { if (!r.getExtension("OES_texture_float")) throw new Error("floating point textures not available"); o = !0 } this.type = r.FLOAT } else this.type = this.type || r.UNSIGNED_BYTE; r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL, this.premultiplyAlpha), e !== this.width || i !== this.height ? r.texImage2D(r.TEXTURE_2D, 0, this.format, e, i, 0, this.format, this.type, t || null) : r.texSubImage2D(r.TEXTURE_2D, 0, 0, 0, e, i, this.format, this.type, t || null), this.width = e, this.height = i }, n.prototype.bind = function (t) { var e = this.gl; void 0 !== t && e.activeTexture(e.TEXTURE0 + t), e.bindTexture(e.TEXTURE_2D, this.texture) }, n.prototype.unbind = function () { var t = this.gl; t.bindTexture(t.TEXTURE_2D, null) }, n.prototype.minFilter = function (t) { var e = this.gl; this.bind(), this.mipmap ? e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, t ? e.LINEAR_MIPMAP_LINEAR : e.NEAREST_MIPMAP_NEAREST) : e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, t ? e.LINEAR : e.NEAREST) }, n.prototype.magFilter = function (t) { var e = this.gl; this.bind(), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MAG_FILTER, t ? e.LINEAR : e.NEAREST) }, n.prototype.enableMipmap = function () { var t = this.gl; this.bind(), this.mipmap = !0, t.generateMipmap(t.TEXTURE_2D) }, n.prototype.enableLinearScaling = function () { this.minFilter(!0), this.magFilter(!0) }, n.prototype.enableNearestScaling = function () { this.minFilter(!1), this.magFilter(!1) }, n.prototype.enableWrapClamp = function () { var t = this.gl; this.bind(), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.CLAMP_TO_EDGE), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.CLAMP_TO_EDGE) }, n.prototype.enableWrapRepeat = function () { var t = this.gl; this.bind(), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.REPEAT), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.REPEAT) }, n.prototype.enableWrapMirrorRepeat = function () { var t = this.gl; this.bind(), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.MIRRORED_REPEAT), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.MIRRORED_REPEAT) }, n.prototype.destroy = function () { this.gl.deleteTexture(this.texture) }, n.fromSource = function (t, e, i) { t = new n(t); return t.premultiplyAlpha = i || !1, t.upload(e), t }, n.fromData = function (t, e, i, r) { t = new n(t); return t.uploadData(e, i, r), t }, e.exports = n }, {}], 13: [function (t, e, i) { var n = t("./setVertexAttribArrays"); function r(t, e) { this.nativeVaoExtension = null, r.FORCE_NATIVE || (this.nativeVaoExtension = t.getExtension("OES_vertex_array_object") || t.getExtension("MOZ_OES_vertex_array_object") || t.getExtension("WEBKIT_OES_vertex_array_object")), this.nativeState = e, this.nativeVaoExtension && (this.nativeVao = this.nativeVaoExtension.createVertexArrayOES(), e = t.getParameter(t.MAX_VERTEX_ATTRIBS), this.nativeState = { tempAttribState: new Array(e), attribState: new Array(e) }), this.gl = t, this.attributes = [], this.indexBuffer = null, this.dirty = !1 } (e.exports = r.prototype.constructor = r).FORCE_NATIVE = !1, r.prototype.bind = function () { if (this.nativeVao) { if (this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao), this.dirty) return this.dirty = !1, this.activate(), this; this.indexBuffer && this.indexBuffer.bind() } else this.activate(); return this }, r.prototype.unbind = function () { return this.nativeVao && this.nativeVaoExtension.bindVertexArrayOES(null), this }, r.prototype.activate = function () { for (var t = this.gl, e = null, i = 0; i < this.attributes.length; i++) { var r = this.attributes[i]; e !== r.buffer && (r.buffer.bind(), e = r.buffer), t.vertexAttribPointer(r.attribute.location, r.attribute.size, r.type || t.FLOAT, r.normalized || !1, r.stride || 0, r.start || 0) } return n(t, this.attributes, this.nativeState), this.indexBuffer && this.indexBuffer.bind(), this }, r.prototype.addAttribute = function (t, e, i, r, n, o) { return this.attributes.push({ buffer: t, attribute: e, location: e.location, type: i || this.gl.FLOAT, normalized: r || !1, stride: n || 0, start: o || 0 }), this.dirty = !0, this }, r.prototype.addIndex = function (t) { return this.indexBuffer = t, this.dirty = !0, this }, r.prototype.clear = function () { return this.nativeVao && this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao), this.attributes.length = 0, this.indexBuffer = null, this }, r.prototype.draw = function (t, e, i) { var r = this.gl; return this.indexBuffer ? r.drawElements(t, e || this.indexBuffer.data.length, r.UNSIGNED_SHORT, 2 * (i || 0)) : r.drawArrays(t, i, e || this.getSize()), this }, r.prototype.destroy = function () { this.gl = null, this.indexBuffer = null, this.attributes = null, this.nativeState = null, this.nativeVao && this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao), this.nativeVaoExtension = null, this.nativeVao = null }, r.prototype.getSize = function () { var t = this.attributes[0]; return t.buffer.data.length / (t.stride / 4 || t.attribute.size) } }, { "./setVertexAttribArrays": 16 }], 14: [function (t, e, i) { e.exports = function (t, e) { t = t.getContext("webgl", e) || t.getContext("experimental-webgl", e); if (!t) throw new Error("This browser does not support webGL. Try using the canvas renderer"); return t } }, {}], 15: [function (t, e, i) { t = { createContext: t("./createContext"), setVertexAttribArrays: t("./setVertexAttribArrays"), GLBuffer: t("./GLBuffer"), GLFramebuffer: t("./GLFramebuffer"), GLShader: t("./GLShader"), GLTexture: t("./GLTexture"), VertexArrayObject: t("./VertexArrayObject"), shader: t("./shader") }; void 0 !== e && e.exports && (e.exports = t), "undefined" != typeof window && (window.PIXI = window.PIXI || {}, window.PIXI.glCore = t) }, { "./GLBuffer": 9, "./GLFramebuffer": 10, "./GLShader": 11, "./GLTexture": 12, "./VertexArrayObject": 13, "./createContext": 14, "./setVertexAttribArrays": 16, "./shader": 22 }], 16: [function (t, e, i) { e.exports = function (t, e, i) { if (i) { for (var r = i.tempAttribState, n = i.attribState, o = 0; o < r.length; o++)r[o] = !1; for (o = 0; o < e.length; o++)r[e[o].attribute.location] = !0; for (o = 0; o < n.length; o++)n[o] !== r[o] && (n[o] = r[o], i.attribState[o] ? t.enableVertexAttribArray(o) : t.disableVertexAttribArray(o)) } else for (o = 0; o < e.length; o++) { var s = e[o]; t.enableVertexAttribArray(s.attribute.location) } } }, {}], 17: [function (t, e, i) { function s(t, e, i) { return e = t.createShader(e), t.shaderSource(e, i), t.compileShader(e), t.getShaderParameter(e, t.COMPILE_STATUS) ? e : (console.log(t.getShaderInfoLog(e)), null) } e.exports = function (t, e, i, r) { var e = s(t, t.VERTEX_SHADER, e), i = s(t, t.FRAGMENT_SHADER, i), n = t.createProgram(); if (t.attachShader(n, e), t.attachShader(n, i), r) for (var o in r) t.bindAttribLocation(n, r[o], o); return t.linkProgram(n), t.getProgramParameter(n, t.LINK_STATUS) || (console.error("Pixi.js Error: Could not initialize shader."), console.error("gl.VALIDATE_STATUS", t.getProgramParameter(n, t.VALIDATE_STATUS)), console.error("gl.getError()", t.getError()), "" !== t.getProgramInfoLog(n) && console.warn("Pixi.js Warning: gl.getProgramInfoLog()", t.getProgramInfoLog(n)), t.deleteProgram(n), n = null), t.deleteShader(e), t.deleteShader(i), n } }, {}], 18: [function (t, e, i) { function r(t) { for (var e = new Array(t), i = 0; i < e.length; i++)e[i] = !1; return e } e.exports = function (t, e) { switch (t) { case "float": return 0; case "vec2": return new Float32Array(2 * e); case "vec3": return new Float32Array(3 * e); case "vec4": return new Float32Array(4 * e); case "int": case "sampler2D": return 0; case "ivec2": return new Int32Array(2 * e); case "ivec3": return new Int32Array(3 * e); case "ivec4": return new Int32Array(4 * e); case "bool": return !1; case "bvec2": return r(2 * e); case "bvec3": return r(3 * e); case "bvec4": return r(4 * e); case "mat2": return new Float32Array([1, 0, 0, 1]); case "mat3": return new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]); case "mat4": return new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]) } } }, {}], 19: [function (t, e, i) { function a(t, e, i, r) { gl.vertexAttribPointer(this.location, this.size, t || gl.FLOAT, e || !1, i || 0, r || 0) } var h = t("./mapType"), l = t("./mapSize"); e.exports = function (t, e) { for (var i = {}, r = t.getProgramParameter(e, t.ACTIVE_ATTRIBUTES), n = 0; n < r; n++) { var o = t.getActiveAttrib(e, n), s = h(t, o.type); i[o.name] = { type: s, size: l(s), location: t.getAttribLocation(e, o.name), pointer: a } } return i } }, { "./mapSize": 23, "./mapType": 24 }], 20: [function (t, e, i) { var h = t("./mapType"), l = t("./defaultValue"); e.exports = function (t, e) { for (var i = {}, r = t.getProgramParameter(e, t.ACTIVE_UNIFORMS), n = 0; n < r; n++) { var o = t.getActiveUniform(e, n), s = o.name.replace(/\[.*?\]/, ""), a = h(t, o.type); i[s] = { type: a, size: o.size, location: t.getUniformLocation(e, s), value: l(a, o.size) } } return i } }, { "./defaultValue": 18, "./mapType": 24 }], 21: [function (t, e, i) { var h = { float: function (t, e, i) { t.uniform1f(e, i) }, vec2: function (t, e, i) { t.uniform2f(e, i[0], i[1]) }, vec3: function (t, e, i) { t.uniform3f(e, i[0], i[1], i[2]) }, vec4: function (t, e, i) { t.uniform4f(e, i[0], i[1], i[2], i[3]) }, int: function (t, e, i) { t.uniform1i(e, i) }, ivec2: function (t, e, i) { t.uniform2i(e, i[0], i[1]) }, ivec3: function (t, e, i) { t.uniform3i(e, i[0], i[1], i[2]) }, ivec4: function (t, e, i) { t.uniform4i(e, i[0], i[1], i[2], i[3]) }, bool: function (t, e, i) { t.uniform1i(e, i) }, bvec2: function (t, e, i) { t.uniform2i(e, i[0], i[1]) }, bvec3: function (t, e, i) { t.uniform3i(e, i[0], i[1], i[2]) }, bvec4: function (t, e, i) { t.uniform4i(e, i[0], i[1], i[2], i[3]) }, mat2: function (t, e, i) { t.uniformMatrix2fv(e, !1, i) }, mat3: function (t, e, i) { t.uniformMatrix3fv(e, !1, i) }, mat4: function (t, e, i) { t.uniformMatrix4fv(e, !1, i) }, sampler2D: function (t, e, i) { t.uniform1i(e, i) } }, l = { float: function (t, e, i) { t.uniform1fv(e, i) }, vec2: function (t, e, i) { t.uniform2fv(e, i) }, vec3: function (t, e, i) { t.uniform3fv(e, i) }, vec4: function (t, e, i) { t.uniform4fv(e, i) }, int: function (t, e, i) { t.uniform1iv(e, i) }, ivec2: function (t, e, i) { t.uniform2iv(e, i) }, ivec3: function (t, e, i) { t.uniform3iv(e, i) }, ivec4: function (t, e, i) { t.uniform4iv(e, i) }, bool: function (t, e, i) { t.uniform1iv(e, i) }, bvec2: function (t, e, i) { t.uniform2iv(e, i) }, bvec3: function (t, e, i) { t.uniform3iv(e, i) }, bvec4: function (t, e, i) { t.uniform4iv(e, i) }, sampler2D: function (t, e, i) { t.uniform1iv(e, i) } }; e.exports = function (t, e) { for (var i = { data: {} }, r = (i.gl = t, Object.keys(e)), n = 0; n < r.length; n++) { var o = r[n], s = o.split("."), a = s[s.length - 1], s = function (t, e) { for (var i = e, r = 0; r < t.length - 1; r++) { var n = i[t[r]] || { data: {} }; i[t[r]] = n, i = n } return i }(s, i), o = e[o]; s.data[a] = o, s.gl = t, Object.defineProperty(s, a, { get: function (t) { return function () { return this.data[t].value } }(a), set: function (i, r) { return function (t) { this.data[i].value = t; var e = this.data[i].location; (1 === r.size ? h : l)[r.type](this.gl, e, t) } }(a, o) }) } return i } }, {}], 22: [function (t, e, i) { e.exports = { compileProgram: t("./compileProgram"), defaultValue: t("./defaultValue"), extractAttributes: t("./extractAttributes"), extractUniforms: t("./extractUniforms"), generateUniformAccessObject: t("./generateUniformAccessObject"), setPrecision: t("./setPrecision"), mapSize: t("./mapSize"), mapType: t("./mapType") } }, { "./compileProgram": 17, "./defaultValue": 18, "./extractAttributes": 19, "./extractUniforms": 20, "./generateUniformAccessObject": 21, "./mapSize": 23, "./mapType": 24, "./setPrecision": 25 }], 23: [function (t, e, i) { var r = { float: 1, vec2: 2, vec3: 3, vec4: 4, int: 1, ivec2: 2, ivec3: 3, ivec4: 4, bool: 1, bvec2: 2, bvec3: 3, bvec4: 4, mat2: 4, mat3: 9, mat4: 16, sampler2D: 1 }; e.exports = function (t) { return r[t] } }, {}], 24: [function (t, e, i) { var o = null, s = { FLOAT: "float", FLOAT_VEC2: "vec2", FLOAT_VEC3: "vec3", FLOAT_VEC4: "vec4", INT: "int", INT_VEC2: "ivec2", INT_VEC3: "ivec3", INT_VEC4: "ivec4", BOOL: "bool", BOOL_VEC2: "bvec2", BOOL_VEC3: "bvec3", BOOL_VEC4: "bvec4", FLOAT_MAT2: "mat2", FLOAT_MAT3: "mat3", FLOAT_MAT4: "mat4", SAMPLER_2D: "sampler2D" }; e.exports = function (t, e) { if (!o) { var i = Object.keys(s); o = {}; for (var r = 0; r < i.length; ++r) { var n = i[r]; o[t[n]] = s[n] } } return o[e] } }, {}], 25: [function (t, e, i) { e.exports = function (t, e) { var i = t.substring(0, 9); return "#ifdef GL" !== i && "precision" !== i ? "precision " + e + " float;\n" + t : t } }, {}], 26: [function (u, t, c) { var i, r, t = t.exports = {}; function n() { throw new Error("setTimeout has not been defined") } function o() { throw new Error("clearTimeout has not been defined") } try { i = "function" == typeof setTimeout ? setTimeout : n } catch (t) { i = n } try { r = "function" == typeof clearTimeout ? clearTimeout : o } catch (t) { r = o } function f(e) { if (i === setTimeout) return setTimeout(e, 0); if ((i === n || !i) && setTimeout) return (i = setTimeout)(e, 0); try { return i(e, 0) } catch (t) { try { return i.call(null, e, 0) } catch (t) { return i.call(this, e, 0) } } } var s, a = [], h = !1, l = -1; function d() { h && s && (h = !1, s.length ? a = s.concat(a) : l = -1, a.length && p()) } function p() { if (!h) { for (var t = f(d), e = (h = !0, a.length); e;) { for (s = a, a = []; ++l < e;)s && s[l].run(); l = -1, e = a.length } s = null, h = !1, function (e) { if (r === clearTimeout) return clearTimeout(e); if ((r === o || !r) && clearTimeout) return (r = clearTimeout)(e); try { r(e) } catch (t) { try { return r.call(null, e) } catch (t) { return r.call(this, e) } } }(t) } } function g(t, e) { this.fun = t, this.array = e } function e() { } t.nextTick = function (t) { var e = new Array(arguments.length - 1); if (1 < arguments.length) for (var i = 1; i < arguments.length; i++)e[i - 1] = arguments[i]; a.push(new g(t, e)), 1 !== a.length || h || f(p) }, g.prototype.run = function () { this.fun.apply(null, this.array) }, t.title = "browser", t.browser = !0, t.env = {}, t.argv = [], t.version = "", t.versions = {}, t.on = e, t.addListener = e, t.once = e, t.off = e, t.removeListener = e, t.removeAllListeners = e, t.emit = e, t.prependListener = e, t.prependOnceListener = e, t.listeners = function (t) { return [] }, t.binding = function (t) { throw new Error("process.binding is not supported") }, t.cwd = function () { return "/" }, t.chdir = function (t) { throw new Error("process.chdir is not supported") }, t.umask = function () { return 0 } }, {}], 27: [function (t, O, P) { !function (t) { var n = this, e = "object" == typeof P && P && !P.nodeType && P, o = "object" == typeof O && O && !O.nodeType && O, t = "object" == typeof t && t; t.global !== t && t.window !== t && t.self !== t || (n = t); var i, r, v = 2147483647, m = 36, y = 26, s = 38, a = 700, h = /^xn--/, l = /[^\x20-\x7E]/, u = /[\x2E\u3002\uFF0E\uFF61]/g, c = { overflow: "Overflow: input needs wider integers to process", "not-basic": "Illegal input >= 0x80 (not a basic code point)", "invalid-input": "Invalid input" }, f = m - 1, _ = Math.floor, b = String.fromCharCode; function x(t) { throw new RangeError(c[t]) } function d(t, e) { for (var i = t.length, r = []; i--;)r[i] = e(t[i]); return r } function p(t, e) { var i = t.split("@"), r = "", i = (1 < i.length && (r = i[0] + "@", t = i[1]), (t = t.replace(u, ".")).split(".")); return r + d(i, e).join(".") } function T(t) { for (var e, i, r = [], n = 0, o = t.length; n < o;)55296 <= (e = t.charCodeAt(n++)) && e <= 56319 && n < o ? 56320 == (64512 & (i = t.charCodeAt(n++))) ? r.push(((1023 & e) << 10) + (1023 & i) + 65536) : (r.push(e), n--) : r.push(e); return r } function g(t) { return d(t, function (t) { var e = ""; return 65535 < t && (e += b((t -= 65536) >>> 10 & 1023 | 55296), t = 56320 | 1023 & t), e += b(t) }).join("") } function w(t, e) { return t + 22 + 75 * (t < 26) - ((0 != e) << 5) } function S(t, e, i) { var r = 0; for (t = i ? _(t / a) : t >> 1, t += _(t / e); f * y >> 1 < t; r += m)t = _(t / f); return _(r + (f + 1) * t / (t + s)) } function C(t) { var e, i, r, u, n, o, s, a = [], c = t.length, h = 0, f = 128, d = 72, l = t.lastIndexOf("-"); for (l < 0 && (l = 0), i = 0; i < l; ++i)128 <= t.charCodeAt(i) && x("not-basic"), a.push(t.charCodeAt(i)); for (r = 0 < l ? l + 1 : 0; r < c;) { for (u = h, n = 1, o = m; c <= r && x("invalid-input"), s = t.charCodeAt(r++), (m <= (s = s - 48 < 10 ? s - 22 : s - 65 < 26 ? s - 65 : s - 97 < 26 ? s - 97 : m) || s > _((v - h) / n)) && x("overflow"), h += s * n, !(s < (s = o <= d ? 1 : d + y <= o ? y : o - d)); o += m)n > _(v / (s = m - s)) && x("overflow"), n *= s; d = S(h - u, e = a.length + 1, 0 == u), _(h / e) > v - f && x("overflow"), f += _(h / e), h %= e, a.splice(h++, 0, f) } return g(a) } function E(t) { for (var e, i, u, r, n, c, o, f, s, d, a = [], p = (t = T(t)).length, h = 128, g = 72, l = e = 0; l < p; ++l)(o = t[l]) < 128 && a.push(b(o)); for (i = u = a.length, u && a.push("-"); i < p;) { for (r = v, l = 0; l < p; ++l)h <= (o = t[l]) && o < r && (r = o); for (r - h > _((v - e) / (f = i + 1)) && x("overflow"), e += (r - h) * f, h = r, l = 0; l < p; ++l)if ((o = t[l]) < h && ++e > v && x("overflow"), o == h) { for (n = e, c = m; !(n < (s = c <= g ? 1 : g + y <= c ? y : c - g)); c += m)a.push(b(w(s + (d = n - s) % (s = m - s), 0))), n = _(d / s); a.push(b(w(n, 0))), g = S(e, f, i == u), e = 0, ++i } ++e, ++h } return a.join("") } if (i = { version: "1.4.1", ucs2: { decode: T, encode: g }, decode: C, encode: E, toASCII: function (t) { return p(t, function (t) { return l.test(t) ? "xn--" + E(t) : t }) }, toUnicode: function (t) { return p(t, function (t) { return h.test(t) ? C(t.slice(4).toLowerCase()) : t }) } }, 0, e && o) if (O.exports == e) o.exports = i; else for (r in i) i.hasOwnProperty(r) && (e[r] = i[r]); else n.punycode = i }.call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, {}], 28: [function (t, e, i) { "use strict"; e.exports = function (t, e, i, r) { i = i || "="; var n = {}; if ("string" != typeof t || 0 === t.length) return n; var u = /\+/g, e = (t = t.split(e = e || "&"), 1e3), o = (r && "number" == typeof r.maxKeys && (e = r.maxKeys), t.length); 0 < e && e < o && (o = e); for (var s = 0; s < o; ++s) { var a, h = t[s].replace(u, "%20"), l = h.indexOf(i), l = 0 <= l ? (a = h.substr(0, l), h.substr(l + 1)) : (a = h, ""), h = decodeURIComponent(a), l = decodeURIComponent(l); Object.prototype.hasOwnProperty.call(n, h) ? c(n[h]) ? n[h].push(l) : n[h] = [n[h], l] : n[h] = l } return n }; var c = Array.isArray || function (t) { return "[object Array]" === Object.prototype.toString.call(t) } }, {}], 29: [function (t, e, i) { "use strict"; function o(t) { switch (typeof t) { case "string": return t; case "boolean": return t ? "true" : "false"; case "number": return isFinite(t) ? t : ""; default: return "" } } e.exports = function (i, r, n, t) { return r = r || "&", n = n || "=", "object" == typeof (i = null === i ? void 0 : i) ? a(h(i), function (t) { var e = encodeURIComponent(o(t)) + n; return s(i[t]) ? a(i[t], function (t) { return e + encodeURIComponent(o(t)) }).join(r) : e + encodeURIComponent(o(i[t])) }).join(r) : t ? encodeURIComponent(o(t)) + n + encodeURIComponent(o(i)) : "" }; var s = Array.isArray || function (t) { return "[object Array]" === Object.prototype.toString.call(t) }; function a(t, e) { if (t.map) return t.map(e); for (var i = [], r = 0; r < t.length; r++)i.push(e(t[r], r)); return i } var h = Object.keys || function (t) { var e, i = []; for (e in t) Object.prototype.hasOwnProperty.call(t, e) && i.push(e); return i } }, {}], 30: [function (t, e, i) { "use strict"; i.decode = i.parse = t("./decode"), i.encode = i.stringify = t("./encode") }, { "./decode": 28, "./encode": 29 }], 31: [function (t, e, i) { "use strict"; e.exports = function (t, e, i) { var r = t.length; if (!(r <= e || 0 === i)) { for (var n = r - (i = r < e + i ? r - e : i), o = e; o < n; ++o)t[o] = t[o + i]; t.length = n } } }, {}], 32: [function (t, l, e) { "use strict"; e.__esModule = !0; var u = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t }, i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = a(t("mini-signals")), n = a(t("parse-uri")), s = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("./async")), c = a(t("./Resource")); function a(t) { return t && t.__esModule ? t : { default: t } } var f = /(#[\w-]+)?$/; function h() { var i = this, t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : "", e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 10, r = this, n = h; if (!(r instanceof n)) throw new TypeError("Cannot call a class as a function"); this.baseUrl = t, this.progress = 0, this.loading = !1, this.defaultQueryString = "", this._beforeMiddleware = [], this._afterMiddleware = [], this._resourcesParsing = [], this._boundLoadResource = function (t, e) { return i._loadResource(t, e) }, this._queue = s.queue(this._boundLoadResource, e), this._queue.pause(), this.resources = {}, this.onProgress = new o.default, this.onError = new o.default, this.onLoad = new o.default, this.onStart = new o.default, this.onComplete = new o.default } h.prototype.add = function (t, e, i, r) { if (Array.isArray(t)) { for (var n = 0; n < t.length; ++n)this.add(t[n]); return this } if ("object" === (void 0 === t ? "undefined" : u(t)) && (r = e || t.callback || t.onComplete, e = (i = t).url, t = t.name || t.key || t.url), "string" != typeof e && (r = i, i = e, e = t), "string" != typeof e) throw new Error("No url passed to add resource to loader."); if ("function" == typeof i && (r = i, i = null), this.loading && (!i || !i.parentResource)) throw new Error("Cannot add resources while the loader is running."); if (this.resources[t]) throw new Error('Resource named "' + t + '" already exists.'); if (e = this._prepareUrl(e), this.resources[t] = new c.default(t, e, i), "function" == typeof r && this.resources[t].onAfterMiddleware.once(r), this.loading) { for (var o = i.parentResource, s = [], a = 0; a < o.children.length; ++a)o.children[a].isComplete || s.push(o.children[a]); var h = o.progressChunk * (s.length + 1) / (s.length + 2); o.children.push(this.resources[t]), o.progressChunk = h; for (var l = 0; l < s.length; ++l)s[l].progressChunk = h; this.resources[t].progressChunk = h } return this._queue.push(this.resources[t]), this }, h.prototype.pre = function (t) { return this._beforeMiddleware.push(t), this }, h.prototype.use = function (t) { return this._afterMiddleware.push(t), this }, h.prototype.reset = function () { for (var t in this.progress = 0, this.loading = !1, this._queue.kill(), this._queue.pause(), this.resources) { t = this.resources[t]; t._onLoadBinding && t._onLoadBinding.detach(), t.isLoading && t.abort() } return this.resources = {}, this }, h.prototype.load = function (t) { if ("function" == typeof t && this.onComplete.once(t), this.loading) return this; if (this._queue.idle()) this._onStart(), this._onComplete(); else { for (var e = 100 / this._queue._tasks.length, i = 0; i < this._queue._tasks.length; ++i)this._queue._tasks[i].data.progressChunk = e; this._onStart(), this._queue.resume() } return this }, h.prototype._prepareUrl = function (t) { var e = (0, n.default)(t, { strictMode: !0 }), i = void 0; return i = e.protocol || !e.path || 0 === t.indexOf("//") ? t : this.baseUrl.length && this.baseUrl.lastIndexOf("/") !== this.baseUrl.length - 1 && "/" !== t.charAt(0) ? this.baseUrl + "/" + t : this.baseUrl + t, this.defaultQueryString && (e = f.exec(i)[0], -1 !== (i = i.substr(0, i.length - e.length)).indexOf("?") ? i += "&" + this.defaultQueryString : i += "?" + this.defaultQueryString, i += e), i }, h.prototype._loadResource = function (i, t) { var r = this; i._dequeue = t, s.eachSeries(this._beforeMiddleware, function (t, e) { t.call(r, i, function () { e(i.isComplete ? {} : null) }) }, function () { i.isComplete ? r._onLoad(i) : (i._onLoadBinding = i.onComplete.once(r._onLoad, r), i.load()) }, !0) }, h.prototype._onStart = function () { this.progress = 0, this.loading = !0, this.onStart.dispatch(this) }, h.prototype._onComplete = function () { this.progress = 100, this.loading = !1, this.onComplete.dispatch(this, this.resources) }, h.prototype._onLoad = function (i) { var r = this; i._onLoadBinding = null, this._resourcesParsing.push(i), i._dequeue(), s.eachSeries(this._afterMiddleware, function (t, e) { t.call(r, i, e) }, function () { i.onAfterMiddleware.dispatch(i), r.progress += i.progressChunk, r.onProgress.dispatch(r, i), i.error ? r.onError.dispatch(i.error, r, i) : r.onLoad.dispatch(r, i), r._resourcesParsing.splice(r._resourcesParsing.indexOf(i), 1), r._queue.idle() && 0 === r._resourcesParsing.length && r._onComplete() }, !0) }, i(h, [{ key: "concurrency", get: function () { return this._queue.concurrency }, set: function (t) { this._queue.concurrency = t } }]), e.default = h }, { "./Resource": 33, "./async": 34, "mini-signals": 5, "parse-uri": 7 }], 33: [function (t, u, e) { "use strict"; e.__esModule = !0; var i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var c = o(t("parse-uri")), n = o(t("mini-signals")); function o(t) { return t && t.__esModule ? t : { default: t } } var f = !(!window.XDomainRequest || "withCredentials" in new XMLHttpRequest), s = null; function d() { } a.setExtensionLoadType = function (t, e) { h(a._loadTypeMap, t, e) }, a.setExtensionXhrType = function (t, e) { h(a._xhrTypeMap, t, e) }, a.prototype.complete = function () { if (this.data && this.data.removeEventListener && (this.data.removeEventListener("error", this._boundOnError, !1), this.data.removeEventListener("load", this._boundComplete, !1), this.data.removeEventListener("progress", this._boundOnProgress, !1), this.data.removeEventListener("canplaythrough", this._boundComplete, !1)), this.xhr && (this.xhr.removeEventListener ? (this.xhr.removeEventListener("error", this._boundXhrOnError, !1), this.xhr.removeEventListener("abort", this._boundXhrOnAbort, !1), this.xhr.removeEventListener("progress", this._boundOnProgress, !1), this.xhr.removeEventListener("load", this._boundXhrOnLoad, !1)) : (this.xhr.onerror = null, this.xhr.ontimeout = null, this.xhr.onprogress = null, this.xhr.onload = null)), this.isComplete) throw new Error("Complete called again for an already completed resource."); this._setFlag(a.STATUS_FLAGS.COMPLETE, !0), this._setFlag(a.STATUS_FLAGS.LOADING, !1), this.onComplete.dispatch(this) }, a.prototype.abort = function (t) { if (!this.error) { if (this.error = new Error(t), this.xhr) this.xhr.abort(); else if (this.xdr) this.xdr.abort(); else if (this.data) if (this.data.src) this.data.src = a.EMPTY_GIF; else for (; this.data.firstChild;)this.data.removeChild(this.data.firstChild); this.complete() } }, a.prototype.load = function (t) { var e = this; if (!this.isLoading) if (this.isComplete) t && setTimeout(function () { return t(e) }, 1); else switch (t && this.onComplete.once(t), this._setFlag(a.STATUS_FLAGS.LOADING, !0), this.onStart.dispatch(this), !1 !== this.crossOrigin && "string" == typeof this.crossOrigin || (this.crossOrigin = this._determineCrossOrigin(this.url)), this.loadType) { case a.LOAD_TYPE.IMAGE: this.type = a.TYPE.IMAGE, this._loadElement("image"); break; case a.LOAD_TYPE.AUDIO: this.type = a.TYPE.AUDIO, this._loadSourceElement("audio"); break; case a.LOAD_TYPE.VIDEO: this.type = a.TYPE.VIDEO, this._loadSourceElement("video"); break; default: a.LOAD_TYPE.XHR; f && this.crossOrigin ? this._loadXdr() : this._loadXhr() } }, a.prototype._hasFlag = function (t) { return !!(this._flags & t) }, a.prototype._setFlag = function (t, e) { this._flags = e ? this._flags | t : this._flags & ~t }, a.prototype._loadElement = function (t) { this.metadata.loadElement ? this.data = this.metadata.loadElement : "image" === t && void 0 !== window.Image ? this.data = new Image : this.data = document.createElement(t), this.crossOrigin && (this.data.crossOrigin = this.crossOrigin), this.metadata.skipSource || (this.data.src = this.url), this.data.addEventListener("error", this._boundOnError, !1), this.data.addEventListener("load", this._boundComplete, !1), this.data.addEventListener("progress", this._boundOnProgress, !1) }, a.prototype._loadSourceElement = function (t) { if (this.metadata.loadElement ? this.data = this.metadata.loadElement : "audio" === t && void 0 !== window.Audio ? this.data = new Audio : this.data = document.createElement(t), null !== this.data) { if (!this.metadata.skipSource) if (navigator.isCocoonJS) this.data.src = Array.isArray(this.url) ? this.url[0] : this.url; else if (Array.isArray(this.url)) for (var e = this.metadata.mimeType, i = 0; i < this.url.length; ++i)this.data.appendChild(this._createSource(t, this.url[i], Array.isArray(e) ? e[i] : e)); else { var r = this.metadata.mimeType; this.data.appendChild(this._createSource(t, this.url, Array.isArray(r) ? r[0] : r)) } this.data.addEventListener("error", this._boundOnError, !1), this.data.addEventListener("load", this._boundComplete, !1), this.data.addEventListener("progress", this._boundOnProgress, !1), this.data.addEventListener("canplaythrough", this._boundComplete, !1), this.data.load() } else this.abort("Unsupported element: " + t) }, a.prototype._loadXhr = function () { "string" != typeof this.xhrType && (this.xhrType = this._determineXhrType()); var t = this.xhr = new XMLHttpRequest; t.open("GET", this.url, !0), this.xhrType === a.XHR_RESPONSE_TYPE.JSON || this.xhrType === a.XHR_RESPONSE_TYPE.DOCUMENT ? t.responseType = a.XHR_RESPONSE_TYPE.TEXT : t.responseType = this.xhrType, t.addEventListener("error", this._boundXhrOnError, !1), t.addEventListener("abort", this._boundXhrOnAbort, !1), t.addEventListener("progress", this._boundOnProgress, !1), t.addEventListener("load", this._boundXhrOnLoad, !1), t.send() }, a.prototype._loadXdr = function () { "string" != typeof this.xhrType && (this.xhrType = this._determineXhrType()); var t = this.xhr = new XDomainRequest; t.timeout = 5e3, t.onerror = this._boundXhrOnError, t.ontimeout = this._boundXdrOnTimeout, t.onprogress = this._boundOnProgress, t.onload = this._boundXhrOnLoad, t.open("GET", this.url, !0), setTimeout(function () { return t.send() }, 1) }, a.prototype._createSource = function (t, e, i) { i = i || t + "/" + this._getExtension(e); t = document.createElement("source"); return t.src = e, t.type = i, t }, a.prototype._onError = function (t) { this.abort("Failed to load element using: " + t.target.nodeName) }, a.prototype._onProgress = function (t) { t && t.lengthComputable && this.onProgress.dispatch(this, t.loaded / t.total) }, a.prototype._xhrOnError = function () { var t = this.xhr; this.abort(l(t) + " Request failed. Status: " + t.status + ', text: "' + t.statusText + '"') }, a.prototype._xhrOnAbort = function () { this.abort(l(this.xhr) + " Request was aborted by the user.") }, a.prototype._xdrOnTimeout = function () { this.abort(l(this.xhr) + " Request timed out.") }, a.prototype._xhrOnLoad = function () { var t, e, i = this.xhr, r = "", n = void 0 === i.status ? 200 : i.status; if ("" !== i.responseType && "text" !== i.responseType && void 0 !== i.responseType || (r = i.responseText), 0 === n && (0 < r.length || i.responseType === a.XHR_RESPONSE_TYPE.BUFFER) ? n = 200 : 1223 === n && (n = 204), 2 == (n / 100 | 0)) { if (this.xhrType === a.XHR_RESPONSE_TYPE.TEXT) this.data = r, this.type = a.TYPE.TEXT; else if (this.xhrType === a.XHR_RESPONSE_TYPE.JSON) try { this.data = JSON.parse(r), this.type = a.TYPE.JSON } catch (t) { return void this.abort("Error trying to parse loaded json: " + t) } else if (this.xhrType === a.XHR_RESPONSE_TYPE.DOCUMENT) try { window.DOMParser ? (t = new DOMParser, this.data = t.parseFromString(r, "text/xml")) : ((e = document.createElement("div")).innerHTML = r, this.data = e), this.type = a.TYPE.XML } catch (t) { return void this.abort("Error trying to parse loaded xml: " + t) } else this.data = i.response || r; this.complete() } else this.abort("[" + i.status + "] " + i.statusText + ": " + i.responseURL) }, a.prototype._determineCrossOrigin = function (t, e) { if (0 === t.indexOf("data:")) return ""; e = e || window.location, (s = s || document.createElement("a")).href = t; var i = !(t = (0, c.default)(s.href, { strictMode: !0 })).port && "" === e.port || t.port === e.port, r = t.protocol ? t.protocol + ":" : ""; return t.host === e.hostname && i && r === e.protocol ? "" : "anonymous" }, a.prototype._determineXhrType = function () { return a._xhrTypeMap[this.extension] || a.XHR_RESPONSE_TYPE.TEXT }, a.prototype._determineLoadType = function () { return a._loadTypeMap[this.extension] || a.LOAD_TYPE.XHR }, a.prototype._getExtension = function () { var t, e, i = this.url; return (this.isDataUrl ? (e = i.indexOf("/"), i.substring(e + 1, i.indexOf(";", e))) : (e = i.indexOf("?"), t = i.indexOf("#"), e = Math.min(-1 < e ? e : i.length, -1 < t ? t : i.length), (i = i.substring(0, e)).substring(i.lastIndexOf(".") + 1))).toLowerCase() }, a.prototype._getMimeFromXhrType = function (t) { switch (t) { case a.XHR_RESPONSE_TYPE.BUFFER: return "application/octet-binary"; case a.XHR_RESPONSE_TYPE.BLOB: return "application/blob"; case a.XHR_RESPONSE_TYPE.DOCUMENT: return "application/xml"; case a.XHR_RESPONSE_TYPE.JSON: return "application/json"; case a.XHR_RESPONSE_TYPE.DEFAULT: case a.XHR_RESPONSE_TYPE.TEXT: default: return "text/plain" } }, i(a, [{ key: "isDataUrl", get: function () { return this._hasFlag(a.STATUS_FLAGS.DATA_URL) } }, { key: "isComplete", get: function () { return this._hasFlag(a.STATUS_FLAGS.COMPLETE) } }, { key: "isLoading", get: function () { return this._hasFlag(a.STATUS_FLAGS.LOADING) } }]); t = a; function a(t, e, i) { if (!(this instanceof a)) throw new TypeError("Cannot call a class as a function"); if ("string" != typeof t || "string" != typeof e) throw new Error("Both name and url are required for constructing a resource."); i = i || {}, this._flags = 0, this._setFlag(a.STATUS_FLAGS.DATA_URL, 0 === e.indexOf("data:")), this.name = t, this.url = e, this.extension = this._getExtension(), this.data = null, this.crossOrigin = !0 === i.crossOrigin ? "anonymous" : i.crossOrigin, this.loadType = i.loadType || this._determineLoadType(), this.xhrType = i.xhrType, this.metadata = i.metadata || {}, this.error = null, this.xhr = null, this.children = [], this.type = a.TYPE.UNKNOWN, this.progressChunk = 0, this._dequeue = d, this._onLoadBinding = null, this._boundComplete = this.complete.bind(this), this._boundOnError = this._onError.bind(this), this._boundOnProgress = this._onProgress.bind(this), this._boundXhrOnError = this._xhrOnError.bind(this), this._boundXhrOnAbort = this._xhrOnAbort.bind(this), this._boundXhrOnLoad = this._xhrOnLoad.bind(this), this._boundXdrOnTimeout = this._xdrOnTimeout.bind(this), this.onStart = new n.default, this.onProgress = new n.default, this.onComplete = new n.default, this.onAfterMiddleware = new n.default } function h(t, e, i) { (e = e && 0 === e.indexOf(".") ? e.substring(1) : e) && (t[e] = i) } function l(t) { return t.toString().replace("object ", "") } (e.default = t).STATUS_FLAGS = { NONE: 0, DATA_URL: 1, COMPLETE: 2, LOADING: 4 }, t.TYPE = { UNKNOWN: 0, JSON: 1, XML: 2, IMAGE: 3, AUDIO: 4, VIDEO: 5, TEXT: 6 }, t.LOAD_TYPE = { XHR: 1, IMAGE: 2, AUDIO: 3, VIDEO: 4 }, t.XHR_RESPONSE_TYPE = { DEFAULT: "text", BUFFER: "arraybuffer", BLOB: "blob", DOCUMENT: "document", JSON: "json", TEXT: "text" }, t._loadTypeMap = { gif: t.LOAD_TYPE.IMAGE, png: t.LOAD_TYPE.IMAGE, bmp: t.LOAD_TYPE.IMAGE, jpg: t.LOAD_TYPE.IMAGE, jpeg: t.LOAD_TYPE.IMAGE, tif: t.LOAD_TYPE.IMAGE, tiff: t.LOAD_TYPE.IMAGE, webp: t.LOAD_TYPE.IMAGE, tga: t.LOAD_TYPE.IMAGE, svg: t.LOAD_TYPE.IMAGE, "svg+xml": t.LOAD_TYPE.IMAGE, mp3: t.LOAD_TYPE.AUDIO, ogg: t.LOAD_TYPE.AUDIO, wav: t.LOAD_TYPE.AUDIO, mp4: t.LOAD_TYPE.VIDEO, webm: t.LOAD_TYPE.VIDEO }, t._xhrTypeMap = { xhtml: t.XHR_RESPONSE_TYPE.DOCUMENT, html: t.XHR_RESPONSE_TYPE.DOCUMENT, htm: t.XHR_RESPONSE_TYPE.DOCUMENT, xml: t.XHR_RESPONSE_TYPE.DOCUMENT, tmx: t.XHR_RESPONSE_TYPE.DOCUMENT, svg: t.XHR_RESPONSE_TYPE.DOCUMENT, tsx: t.XHR_RESPONSE_TYPE.DOCUMENT, gif: t.XHR_RESPONSE_TYPE.BLOB, png: t.XHR_RESPONSE_TYPE.BLOB, bmp: t.XHR_RESPONSE_TYPE.BLOB, jpg: t.XHR_RESPONSE_TYPE.BLOB, jpeg: t.XHR_RESPONSE_TYPE.BLOB, tif: t.XHR_RESPONSE_TYPE.BLOB, tiff: t.XHR_RESPONSE_TYPE.BLOB, webp: t.XHR_RESPONSE_TYPE.BLOB, tga: t.XHR_RESPONSE_TYPE.BLOB, json: t.XHR_RESPONSE_TYPE.JSON, text: t.XHR_RESPONSE_TYPE.TEXT, txt: t.XHR_RESPONSE_TYPE.TEXT, ttf: t.XHR_RESPONSE_TYPE.BUFFER, otf: t.XHR_RESPONSE_TYPE.BUFFER }, t.EMPTY_GIF = "data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" }, { "mini-signals": 5, "parse-uri": 7 }], 34: [function (t, e, i) { "use strict"; function o() { } i.__esModule = !0, i.eachSeries = function (i, r, n, o) { var s = 0, a = i.length; !function t(e) { e || s === a ? n && n(e) : o ? setTimeout(function () { r(i[s++], t) }, 1) : r(i[s++], t) }() }, i.queue = function (e, t) { if (null == t) t = 1; else if (0 === t) throw new Error("Concurrency must not be zero"); var i = 0, r = { _tasks: [], concurrency: t, saturated: o, unsaturated: o, buffer: t / 4, empty: o, drain: o, error: o, started: !1, paused: !1, push: function (t, e) { n(t, !1, e) }, kill: function () { i = 0, r.drain = o, r.started = !1, r._tasks = [] }, unshift: function (t, e) { n(t, !0, e) }, process: function () { for (; !r.paused && i < r.concurrency && r._tasks.length;) { var t = r._tasks.shift(); 0 === r._tasks.length && r.empty(), (i += 1) === r.concurrency && r.saturated(), e(t.data, function (e) { return function () { if (null === e) throw new Error("Callback was already called."); var t = e; e = null, t.apply(this, arguments) } }(function (t) { return function () { --i, t.callback.apply(t, arguments), null != arguments[0] && r.error(arguments[0], t.data), i <= r.concurrency - r.buffer && r.unsaturated(), r.idle() && r.drain(), r.process() } }(t))) } }, length: function () { return r._tasks.length }, running: function () { return i }, idle: function () { return r._tasks.length + i === 0 }, pause: function () { !0 !== r.paused && (r.paused = !0) }, resume: function () { if (!1 !== r.paused) { r.paused = !1; for (var t = 1; t <= r.concurrency; t++)r.process() } } }; function n(t, e, i) { if (null != i && "function" != typeof i) throw new Error("task callback must be a function"); r.started = !0, null == t && r.idle() ? setTimeout(function () { return r.drain() }, 1) : (t = { data: t, callback: "function" == typeof i ? i : o }, e ? r._tasks.unshift(t) : r._tasks.push(t), setTimeout(function () { return r.process() }, 1)) } return r } }, {}], 35: [function (t, e, i) { "use strict"; i.__esModule = !0, i.encodeBinary = function (t) { var e = "", i = 0; for (; i < t.length;) { for (var r = [0, 0, 0], n = [0, 0, 0, 0], o = 0; o < r.length; ++o)i < t.length ? r[o] = 255 & t.charCodeAt(i++) : r[o] = 0; switch (n[0] = r[0] >> 2, n[1] = (3 & r[0]) << 4 | r[1] >> 4, n[2] = (15 & r[1]) << 2 | r[2] >> 6, n[3] = 63 & r[2], i - (t.length - 1)) { case 2: n[3] = 64, n[2] = 64; break; case 1: n[3] = 64 }for (var s = 0; s < n.length; ++s)e += a.charAt(n[s]) } return e }; var a = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=" }, {}], 36: [function (t, e, i) { "use strict"; var r = t("./Loader").default, n = t("./Resource").default, o = t("./async"), t = t("./b64"); r.Resource = n, r.async = o, r.base64 = t, e.exports = r, e.exports.default = r }, { "./Loader": 32, "./Resource": 33, "./async": 34, "./b64": 35 }], 37: [function (t, e, i) { "use strict"; i.__esModule = !0; var n = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t }; i.blobMiddlewareFactory = function () { return function (t, e) { if (t.data) { if (t.xhr && t.xhrType === o.default.XHR_RESPONSE_TYPE.BLOB) if (window.Blob && "string" != typeof t.data) { if (0 === t.data.type.indexOf("image")) { r = a.createObjectURL(t.data), t.blob = t.data, t.data = new Image, t.data.src = r, t.type = o.default.TYPE.IMAGE, t.data.onload = function () { a.revokeObjectURL(r), t.data.onload = null, e() }; var i = { v: void 0 }; if ("object" === (void 0 === i ? "undefined" : n(i))) return i.v } } else { i = t.xhr.getResponseHeader("content-type"); if (i && 0 === i.indexOf("image")) return t.data = new Image, t.data.src = "data:" + i + ";base64," + s.default.encodeBinary(t.xhr.responseText), t.type = o.default.TYPE.IMAGE, void (t.data.onload = function () { t.data.onload = null, e() }) } var r; e() } else e() } }; var o = r(t("../../Resource")), s = r(t("../../b64")); function r(t) { return t && t.__esModule ? t : { default: t } } var a = window.URL || window.webkitURL }, { "../../Resource": 33, "../../b64": 35 }], 38: [function (t, r, e) { "use strict"; var M = t("punycode"), w = t("./util"); function x() { this.protocol = null, this.slashes = null, this.auth = null, this.host = null, this.port = null, this.hostname = null, this.hash = null, this.search = null, this.query = null, this.pathname = null, this.path = null, this.href = null } e.parse = i, e.resolve = function (t, e) { return i(t, !1, !0).resolve(e) }, e.resolveObject = function (t, e) { return t ? i(t, !1, !0).resolveObject(e) : e }, e.format = function (t) { w.isString(t) && (t = i(t)); return t instanceof x ? t.format() : x.prototype.format.call(t) }, e.Url = x; var A = /^([a-z0-9.+-]+:)/i, n = /:[0-9]*$/, D = /^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/, e = ["{", "}", "|", "\\", "^", "`"].concat(["<", ">", '"', "`", " ", "\r", "\n", "\t"]), S = ["'"].concat(e), C = ["%", "/", "?", ";", "#"].concat(S), R = ["/", "?", "#"], I = /^[+a-z0-9A-Z_-]{0,63}$/, k = /^([+a-z0-9A-Z_-]{0,63})(.*)$/, L = { javascript: !0, "javascript:": !0 }, E = { javascript: !0, "javascript:": !0 }, O = { http: !0, https: !0, ftp: !0, gopher: !0, file: !0, "http:": !0, "https:": !0, "ftp:": !0, "gopher:": !0, "file:": !0 }, P = t("querystring"); function i(t, e, i) { if (t && w.isObject(t) && t instanceof x) return t; var r = new x; return r.parse(t, e, i), r } x.prototype.parse = function (t, u, e) { if (!w.isString(t)) throw new TypeError("Parameter 'url' must be a string, not " + typeof t); var i = t.indexOf("?"), i = -1 !== i && i < t.indexOf("#") ? "?" : "#", r = t.split(i); r[0] = r[0].replace(/\\/g, "/"); var n = (n = t = r.join(i)).trim(); if (!e && 1 === t.split("#").length) { r = D.exec(n); if (r) return this.path = n, this.href = n, this.pathname = r[1], r[2] ? (this.search = r[2], this.query = u ? P.parse(this.search.substr(1)) : this.search.substr(1)) : u && (this.search = "", this.query = {}), this } var c, i = A.exec(n); if (i && (c = (i = i[0]).toLowerCase(), this.protocol = c, n = n.substr(i.length)), (e || i || n.match(/^\/\/[^@\/]+@[^@\/]+/)) && (!(x = "//" === n.substr(0, 2)) || i && E[i] || (n = n.substr(2), this.slashes = !0)), !E[i] && (x || i && !O[i])) { for (var o = -1, s = 0; s < R.length; s++)-1 !== (a = n.indexOf(R[s])) && (-1 === o || a < o) && (o = a); -1 !== (t = -1 === o ? n.lastIndexOf("@") : n.lastIndexOf("@", o)) && (r = n.slice(0, t), n = n.slice(t + 1), this.auth = decodeURIComponent(r)); for (var a, o = -1, s = 0; s < C.length; s++)-1 !== (a = n.indexOf(C[s])) && (-1 === o || a < o) && (o = a); -1 === o && (o = n.length), this.host = n.slice(0, o), n = n.slice(o), this.parseHost(), this.hostname = this.hostname || ""; e = "[" === this.hostname[0] && "]" === this.hostname[this.hostname.length - 1]; if (!e) for (var f = this.hostname.split(/\./), s = 0, d = f.length; s < d; s++) { var h = f[s]; if (h && !h.match(I)) { for (var p = "", g = 0, v = h.length; g < v; g++)127 < h.charCodeAt(g) ? p += "x" : p += h[g]; if (!p.match(I)) { var m = f.slice(0, s), y = f.slice(s + 1), _ = h.match(k); _ && (m.push(_[1]), y.unshift(_[2])), y.length && (n = "/" + y.join(".") + n), this.hostname = m.join("."); break } } } 255 < this.hostname.length ? this.hostname = "" : this.hostname = this.hostname.toLowerCase(), e || (this.hostname = M.toASCII(this.hostname)); var b = this.port ? ":" + this.port : "", x = this.hostname || ""; this.host = x + b, this.href += this.host, e && (this.hostname = this.hostname.substr(1, this.hostname.length - 2), "/" !== n[0] && (n = "/" + n)) } if (!L[c]) for (s = 0, d = S.length; s < d; s++) { var T, l = S[s]; -1 !== n.indexOf(l) && ((T = encodeURIComponent(l)) === l && (T = escape(l)), n = n.split(l).join(T)) } i = n.indexOf("#"), -1 !== i && (this.hash = n.substr(i), n = n.slice(0, i)), t = n.indexOf("?"); return -1 !== t ? (this.search = n.substr(t), this.query = n.substr(t + 1), u && (this.query = P.parse(this.query)), n = n.slice(0, t)) : u && (this.search = "", this.query = {}), n && (this.pathname = n), O[c] && this.hostname && !this.pathname && (this.pathname = "/"), (this.pathname || this.search) && (b = this.pathname || "", r = this.search || "", this.path = b + r), this.href = this.format(), this }, x.prototype.format = function () { var t = this.auth || "", e = (t && (t = (t = encodeURIComponent(t)).replace(/%3A/i, ":"), t += "@"), this.protocol || ""), i = this.pathname || "", r = this.hash || "", n = !1, o = "", t = (this.host ? n = t + this.host : this.hostname && (n = t + (-1 === this.hostname.indexOf(":") ? this.hostname : "[" + this.hostname + "]"), this.port && (n += ":" + this.port)), this.query && w.isObject(this.query) && Object.keys(this.query).length && (o = P.stringify(this.query)), this.search || o && "?" + o || ""); return e && ":" !== e.substr(-1) && (e += ":"), this.slashes || (!e || O[e]) && !1 !== n ? (n = "//" + (n || ""), i && "/" !== i.charAt(0) && (i = "/" + i)) : n = n || "", r && "#" !== r.charAt(0) && (r = "#" + r), t && "?" !== t.charAt(0) && (t = "?" + t), e + n + (i = i.replace(/[?#]/g, function (t) { return encodeURIComponent(t) })) + (t = t.replace("#", "%23")) + r }, x.prototype.resolve = function (t) { return this.resolveObject(i(t, !1, !0)).format() }, x.prototype.resolveObject = function (t) { w.isString(t) && ((r = new x).parse(t, !1, !0), t = r); for (var e = new x, u = Object.keys(this), c = 0; c < u.length; c++) { var f = u[c]; e[f] = this[f] } if (e.hash = t.hash, "" === t.href) return e.href = e.format(), e; if (t.slashes && !t.protocol) { for (var d = Object.keys(t), p = 0; p < d.length; p++) { var g = d[p]; "protocol" !== g && (e[g] = t[g]) } return O[e.protocol] && e.hostname && !e.pathname && (e.path = e.pathname = "/"), e.href = e.format(), e } if (t.protocol && t.protocol !== e.protocol) { if (!O[t.protocol]) { for (var v = Object.keys(t), m = 0; m < v.length; m++) { var y = v[m]; e[y] = t[y] } return e.href = e.format(), e } if (e.protocol = t.protocol, t.host || E[t.protocol]) e.pathname = t.pathname; else { for (var i = (t.pathname || "").split("/"); i.length && !(t.host = i.shift());); t.host || (t.host = ""), t.hostname || (t.hostname = ""), "" !== i[0] && i.unshift(""), i.length < 2 && i.unshift(""), e.pathname = i.join("/") } return e.search = t.search, e.query = t.query, e.host = t.host || "", e.auth = t.auth, e.hostname = t.hostname || t.host, e.port = t.port, (e.pathname || e.search) && (r = e.pathname || "", n = e.search || "", e.path = r + n), e.slashes = e.slashes || t.slashes, e.href = e.format(), e } var r = e.pathname && "/" === e.pathname.charAt(0), n = t.host || t.pathname && "/" === t.pathname.charAt(0), r = n || r || e.host && t.pathname, _ = r, o = e.pathname && e.pathname.split("/") || [], i = t.pathname && t.pathname.split("/") || [], b = e.protocol && !O[e.protocol]; if (b && (e.hostname = "", e.port = null, e.host && ("" === o[0] ? o[0] = e.host : o.unshift(e.host)), e.host = "", t.protocol && (t.hostname = null, t.port = null, t.host && ("" === i[0] ? i[0] = t.host : i.unshift(t.host)), t.host = null), r = r && ("" === i[0] || "" === o[0])), n) e.host = (t.host || "" === t.host ? t : e).host, e.hostname = (t.hostname || "" === t.hostname ? t : e).hostname, e.search = t.search, e.query = t.query, o = i; else if (i.length) (o = o || []).pop(), o = o.concat(i), e.search = t.search, e.query = t.query; else if (!w.isNullOrUndefined(t.search)) return b && (e.hostname = e.host = o.shift(), (l = !!(e.host && 0 < e.host.indexOf("@")) && e.host.split("@")) && (e.auth = l.shift(), e.host = e.hostname = l.shift())), e.search = t.search, e.query = t.query, w.isNull(e.pathname) && w.isNull(e.search) || (e.path = (e.pathname || "") + (e.search || "")), e.href = e.format(), e; if (!o.length) return e.pathname = null, e.search ? e.path = "/" + e.search : e.path = null, e.href = e.format(), e; for (var s = o.slice(-1)[0], n = (e.host || t.host || 1 < o.length) && ("." === s || ".." === s) || "" === s, a = 0, h = o.length; 0 <= h; h--)"." === (s = o[h]) ? o.splice(h, 1) : ".." === s ? (o.splice(h, 1), a++) : a && (o.splice(h, 1), a--); if (!r && !_) for (; a--;)o.unshift(".."); !r || "" === o[0] || o[0] && "/" === o[0].charAt(0) || o.unshift(""), n && "/" !== o.join("/").substr(-1) && o.push(""); var l, _ = "" === o[0] || o[0] && "/" === o[0].charAt(0); return b && (e.hostname = e.host = !_ && o.length ? o.shift() : "", (l = !!(e.host && 0 < e.host.indexOf("@")) && e.host.split("@")) && (e.auth = l.shift(), e.host = e.hostname = l.shift())), (r = r || e.host && o.length) && !_ && o.unshift(""), o.length ? e.pathname = o.join("/") : (e.pathname = null, e.path = null), w.isNull(e.pathname) && w.isNull(e.search) || (e.path = (e.pathname || "") + (e.search || "")), e.auth = t.auth || e.auth, e.slashes = e.slashes || t.slashes, e.href = e.format(), e }, x.prototype.parseHost = function () { var t = this.host, e = n.exec(t); e && (":" !== (e = e[0]) && (this.port = e.substr(1)), t = t.substr(0, t.length - e.length)), t && (this.hostname = t) } }, { "./util": 39, punycode: 27, querystring: 30 }], 39: [function (t, e, i) { "use strict"; e.exports = { isString: function (t) { return "string" == typeof t }, isObject: function (t) { return "object" == typeof t && null !== t }, isNull: function (t) { return null === t }, isNullOrUndefined: function (t) { return null == t } } }, {}], 40: [function (t, e, i) { "use strict"; i.__esModule = !0; var h = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")), r = n(t("ismobilejs")), t = n(t("./accessibleTarget")); function n(t) { return t && t.__esModule ? t : { default: t } } h.utils.mixins.delayMixin(h.DisplayObject.prototype, t.default); o.prototype.createTouchHook = function () { var t = this, e = document.createElement("button"); e.style.width = "1px", e.style.height = "1px", e.style.position = "absolute", e.style.top = "-1000px", e.style.left = "-1000px", e.style.zIndex = 2, e.style.backgroundColor = "#FF0000", e.title = "HOOK DIV", e.addEventListener("focus", function () { t.isMobileAccessabillity = !0, t.activate(), document.body.removeChild(e) }), document.body.appendChild(e) }, o.prototype.activate = function () { this.isActive || (this.isActive = !0, window.document.addEventListener("mousemove", this._onMouseMove, !0), window.removeEventListener("keydown", this._onKeyDown, !1), this.renderer.on("postrender", this.update, this), this.renderer.view.parentNode && this.renderer.view.parentNode.appendChild(this.div)) }, o.prototype.deactivate = function () { this.isActive && !this.isMobileAccessabillity && (this.isActive = !1, window.document.removeEventListener("mousemove", this._onMouseMove), window.addEventListener("keydown", this._onKeyDown, !1), this.renderer.off("postrender", this.update), this.div.parentNode && this.div.parentNode.removeChild(this.div)) }, o.prototype.updateAccessibleObjects = function (t) { if (t.visible) { t.accessible && t.interactive && (t._accessibleActive || this.addChild(t), t.renderId = this.renderId); for (var e = t.children, i = 0; i < e.length; i++)this.updateAccessibleObjects(e[i]) } }, o.prototype.update = function () { if (this.renderer.renderingToScreen) { this.updateAccessibleObjects(this.renderer._lastObjectRendered); var t = this.renderer.view.getBoundingClientRect(), e = t.width / this.renderer.width, i = t.height / this.renderer.height; (n = this.div).style.left = t.left + "px", n.style.top = t.top + "px", n.style.width = this.renderer.width + "px", n.style.height = this.renderer.height + "px"; for (var r = 0; r < this.children.length; r++) { var n, o, s, a = this.children[r]; a.renderId !== this.renderId ? (a._accessibleActive = !1, h.utils.removeItems(this.children, r, 1), this.div.removeChild(a._accessibleDiv), this.pool.push(a._accessibleDiv), a._accessibleDiv = null, r--, 0 === this.children.length && this.deactivate()) : (n = a._accessibleDiv, o = a.hitArea, s = a.worldTransform, a.hitArea ? (n.style.left = (s.tx + o.x * s.a) * e + "px", n.style.top = (s.ty + o.y * s.d) * i + "px", n.style.width = o.width * s.a * e + "px", n.style.height = o.height * s.d * i + "px") : (o = a.getBounds(), this.capHitArea(o), n.style.left = o.x * e + "px", n.style.top = o.y * i + "px", n.style.width = o.width * e + "px", n.style.height = o.height * i + "px", n.title !== a.accessibleTitle && null !== a.accessibleTitle && (n.title = a.accessibleTitle), n.getAttribute("aria-label") !== a.accessibleHint && null !== a.accessibleHint && n.setAttribute("aria-label", a.accessibleHint))) } this.renderId++ } }, o.prototype.capHitArea = function (t) { t.x < 0 && (t.width += t.x, t.x = 0), t.y < 0 && (t.height += t.y, t.y = 0), t.x + t.width > this.renderer.width && (t.width = this.renderer.width - t.x), t.y + t.height > this.renderer.height && (t.height = this.renderer.height - t.y) }, o.prototype.addChild = function (t) { var e = this.pool.pop(); e || ((e = document.createElement("button")).style.width = "100px", e.style.height = "100px", e.style.backgroundColor = this.debug ? "rgba(255,0,0,0.5)" : "transparent", e.style.position = "absolute", e.style.zIndex = 2, e.style.borderStyle = "none", -1 < navigator.userAgent.toLowerCase().indexOf("chrome") ? e.setAttribute("aria-live", "off") : e.setAttribute("aria-live", "polite"), navigator.userAgent.match(/rv:.*Gecko\//) ? e.setAttribute("aria-relevant", "additions") : e.setAttribute("aria-relevant", "text"), e.addEventListener("click", this._onClick.bind(this)), e.addEventListener("focus", this._onFocus.bind(this)), e.addEventListener("focusout", this._onFocusOut.bind(this))), t.accessibleTitle && null !== t.accessibleTitle ? e.title = t.accessibleTitle : t.accessibleHint && null !== t.accessibleHint || (e.title = "displayObject " + t.tabIndex), t.accessibleHint && null !== t.accessibleHint && e.setAttribute("aria-label", t.accessibleHint), t._accessibleActive = !0, (t._accessibleDiv = e).displayObject = t, this.children.push(t), this.div.appendChild(t._accessibleDiv), t._accessibleDiv.tabIndex = t.tabIndex }, o.prototype._onClick = function (t) { var e = this.renderer.plugins.interaction; e.dispatchEvent(t.target.displayObject, "click", e.eventData) }, o.prototype._onFocus = function (t) { t.target.getAttribute("aria-live", "off") || t.target.setAttribute("aria-live", "assertive"); var e = this.renderer.plugins.interaction; e.dispatchEvent(t.target.displayObject, "mouseover", e.eventData) }, o.prototype._onFocusOut = function (t) { t.target.getAttribute("aria-live", "off") || t.target.setAttribute("aria-live", "polite"); var e = this.renderer.plugins.interaction; e.dispatchEvent(t.target.displayObject, "mouseout", e.eventData) }, o.prototype._onKeyDown = function (t) { 9 === t.keyCode && this.activate() }, o.prototype._onMouseMove = function (t) { 0 === t.movementX && 0 === t.movementY || this.deactivate() }, o.prototype.destroy = function () { this.div = null; for (var t = 0; t < this.children.length; t++)this.children[t].div = null; window.document.removeEventListener("mousemove", this._onMouseMove), window.removeEventListener("keydown", this._onKeyDown), this.pool = null, this.children = null, this.renderer = null }; t = o; function o(t) { if (!(this instanceof o)) throw new TypeError("Cannot call a class as a function"); !r.default.tablet && !r.default.phone || navigator.isCocoonJS || this.createTouchHook(); var e = document.createElement("div"); e.style.width = "100px", e.style.height = "100px", e.style.position = "absolute", e.style.top = "0px", e.style.left = "0px", e.style.zIndex = 2, this.div = e, this.pool = [], this.renderId = 0, this.debug = !1, this.renderer = t, this.children = [], this._onKeyDown = this._onKeyDown.bind(this), this._onMouseMove = this._onMouseMove.bind(this), this.isActive = !1, this.isMobileAccessabillity = !1, window.addEventListener("keydown", this._onKeyDown, !1) } i.default = t, h.WebGLRenderer.registerPlugin("accessibility", t), h.CanvasRenderer.registerPlugin("accessibility", t) }, { "../core": 65, "./accessibleTarget": 41, ismobilejs: 4 }], 41: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = { accessible: !1, accessibleTitle: null, accessibleHint: null, tabIndex: 0, _accessibleActive: !1, _accessibleDiv: !1 } }, {}], 42: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("./accessibleTarget"), n = (Object.defineProperty(i, "accessibleTarget", { enumerable: !0, get: function () { return o(r).default } }), t("./AccessibilityManager")); function o(t) { return t && t.__esModule ? t : { default: t } } Object.defineProperty(i, "AccessibilityManager", { enumerable: !0, get: function () { return o(n).default } }) }, { "./AccessibilityManager": 40, "./accessibleTarget": 41 }], 43: [function (t, u, e) { "use strict"; e.__esModule = !0; var i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = t("./autoDetectRenderer"), s = n(t("./display/Container")), a = t("./ticker"), h = n(t("./settings")), c = t("./const"); function n(t) { return t && t.__esModule ? t : { default: t } } function l(t, e, i, r, n) { if (!(this instanceof l)) throw new TypeError("Cannot call a class as a function"); "number" == typeof t && (t = Object.assign({ width: t, height: e || h.default.RENDER_OPTIONS.height, forceCanvas: !!r, sharedTicker: !!n }, i)), this._options = t = Object.assign({ autoStart: !0, sharedTicker: !1, forceCanvas: !1, sharedLoader: !1 }, t), this.renderer = (0, o.autoDetectRenderer)(t), this.stage = new s.default, this._ticker = null, this.ticker = t.sharedTicker ? a.shared : new a.Ticker, t.autoStart && this.start() } l.prototype.render = function () { this.renderer.render(this.stage) }, l.prototype.stop = function () { this._ticker.stop() }, l.prototype.start = function () { this._ticker.start() }, l.prototype.destroy = function (t, e) { var i; this._ticker && (i = this._ticker, this.ticker = null, i.destroy()), this.stage.destroy(e), this.stage = null, this.renderer.destroy(t), this.renderer = null, this._options = null }, i(l, [{ key: "ticker", set: function (t) { this._ticker && this._ticker.remove(this.render, this), (this._ticker = t) && t.add(this.render, this, c.UPDATE_PRIORITY.LOW) }, get: function () { return this._ticker } }, { key: "view", get: function () { return this.renderer.view } }, { key: "screen", get: function () { return this.renderer.screen } }]), e.default = l }, { "./autoDetectRenderer": 45, "./const": 46, "./display/Container": 48, "./settings": 101, "./ticker": 121 }], 44: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("pixi-gl-core"), t = t("./settings"), h = (t = t) && t.__esModule ? t : { default: t }; function l(t, e) { var i, r = (t instanceof Array ? t[0] : t.trim()).substring(0, 9); if (t instanceof Array) { if ("precision" !== r && "#ifdef GL" !== r) return (i = t.slice(0)).unshift("precision " + e + " float;"), i } else if ("precision" !== r && "#ifdef GL" !== r) return "precision " + e + " float;\n" + t; return t } t = function (s) { var t = a, e = s; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function a(t, e, i, r, n) { if (!(this instanceof a)) throw new TypeError("Cannot call a class as a function"); var o = this, t = s.call(this, t, l(e, n || h.default.PRECISION_VERTEX), l(i, n || h.default.PRECISION_FRAGMENT), void 0, r); if (!o) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? o : t } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), a }(r.GLShader); i.default = t }, { "./settings": 101, "pixi-gl-core": 15 }], 45: [function (t, e, i) { "use strict"; i.__esModule = !0, i.autoDetectRenderer = function (t, e, i, r) { var n = t && t.forceCanvas; void 0 !== r && (n = r); return new (n || !o.isWebGLSupported() ? s : a).default(t, e, i) }; var o = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("./utils")), s = r(t("./renderers/canvas/CanvasRenderer")), a = r(t("./renderers/webgl/WebGLRenderer")); function r(t) { return t && t.__esModule ? t : { default: t } } }, { "./renderers/canvas/CanvasRenderer": 77, "./renderers/webgl/WebGLRenderer": 84, "./utils": 125 }], 46: [function (t, e, i) { "use strict"; i.__esModule = !0; i.VERSION = "4.8.1", i.PI_2 = 2 * Math.PI, i.RAD_TO_DEG = 180 / Math.PI, i.DEG_TO_RAD = Math.PI / 180, i.RENDERER_TYPE = { UNKNOWN: 0, WEBGL: 1, CANVAS: 2 }, i.BLEND_MODES = { NORMAL: 0, ADD: 1, MULTIPLY: 2, SCREEN: 3, OVERLAY: 4, DARKEN: 5, LIGHTEN: 6, COLOR_DODGE: 7, COLOR_BURN: 8, HARD_LIGHT: 9, SOFT_LIGHT: 10, DIFFERENCE: 11, EXCLUSION: 12, HUE: 13, SATURATION: 14, COLOR: 15, LUMINOSITY: 16, NORMAL_NPM: 17, ADD_NPM: 18, SCREEN_NPM: 19 }, i.DRAW_MODES = { POINTS: 0, LINES: 1, LINE_LOOP: 2, LINE_STRIP: 3, TRIANGLES: 4, TRIANGLE_STRIP: 5, TRIANGLE_FAN: 6 }, i.SCALE_MODES = { LINEAR: 0, NEAREST: 1 }, i.WRAP_MODES = { CLAMP: 0, REPEAT: 1, MIRRORED_REPEAT: 2 }, i.GC_MODES = { AUTO: 0, MANUAL: 1 }, i.URL_FILE_EXTENSION = /\.(\w{3,4})(?:$|\?|#)/i, i.DATA_URI = /^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i, i.SVG_SIZE = /<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i, i.SHAPES = { POLY: 0, RECT: 1, CIRC: 2, ELIP: 3, RREC: 4 }, i.PRECISION = { LOW: "lowp", MEDIUM: "mediump", HIGH: "highp" }, i.TRANSFORM_MODE = { STATIC: 0, DYNAMIC: 1 }, i.TEXT_GRADIENT = { LINEAR_VERTICAL: 0, LINEAR_HORIZONTAL: 1 }, i.UPDATE_PRIORITY = { INTERACTION: 50, HIGH: 25, NORMAL: 0, LOW: -25, UTILITY: -50 } }, {}], 47: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("../math"); function n() { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); this.minX = 1 / 0, this.minY = 1 / 0, this.maxX = -1 / 0, this.maxY = -1 / 0, this.rect = null } n.prototype.isEmpty = function () { return this.minX > this.maxX || this.minY > this.maxY }, n.prototype.clear = function () { this.updateID++, this.minX = 1 / 0, this.minY = 1 / 0, this.maxX = -1 / 0, this.maxY = -1 / 0 }, n.prototype.getRectangle = function (t) { return this.minX > this.maxX || this.minY > this.maxY ? r.Rectangle.EMPTY : ((t = t || new r.Rectangle(0, 0, 1, 1)).x = this.minX, t.y = this.minY, t.width = this.maxX - this.minX, t.height = this.maxY - this.minY, t) }, n.prototype.addPoint = function (t) { this.minX = Math.min(this.minX, t.x), this.maxX = Math.max(this.maxX, t.x), this.minY = Math.min(this.minY, t.y), this.maxY = Math.max(this.maxY, t.y) }, n.prototype.addQuad = function (t) { var e = this.minX, i = this.minY, r = this.maxX, n = this.maxY, o = t[0], s = t[1], e = o < e ? o : e, i = s < i ? s : i, r = r < o ? o : r, n = n < s ? s : n; e = (o = t[2]) < e ? o : e, i = (s = t[3]) < i ? s : i, r = r < o ? o : r, n = n < s ? s : n, e = (o = t[4]) < e ? o : e, i = (s = t[5]) < i ? s : i, r = r < o ? o : r, n = n < s ? s : n, o = t[6], i = (s = t[7]) < i ? s : i, r = r < o ? o : r, n = n < s ? s : n, this.minX = e = o < e ? o : e, this.minY = i, this.maxX = r, this.maxY = n }, n.prototype.addFrame = function (t, e, i, r, u) { var t = t.worldTransform, c = t.a, f = t.b, d = t.c, p = t.d, g = t.tx, t = t.ty, n = c * e + d * i + g, o = f * e + p * i + t, s = n < (s = this.minX) ? n : s, a = o < (a = this.minY) ? o : a, h = (h = this.maxX) < n ? n : h, l = (l = this.maxY) < o ? o : l; s = (n = c * r + d * i + g) < s ? n : s, a = (o = f * r + p * i + t) < a ? o : a, h = h < n ? n : h, l = l < o ? o : l, s = (n = c * e + d * u + g) < s ? n : s, a = (o = f * e + p * u + t) < a ? o : a, l = l < o ? o : l, a = (o = f * r + p * u + t) < a ? o : a, h = (h = h < n ? n : h) < (n = c * r + d * u + g) ? n : h, l = l < o ? o : l, this.minX = s = n < s ? n : s, this.minY = a, this.maxX = h, this.maxY = l }, n.prototype.addVertices = function (t, e, u, c) { for (var t = t.worldTransform, f = t.a, d = t.b, p = t.c, g = t.d, v = t.tx, m = t.ty, i = this.minX, r = this.minY, n = this.maxX, o = this.maxY, s = u; s < c; s += 2)var a = e[s], h = e[s + 1], l = f * a + p * h + v, h = g * h + d * a + m, i = l < i ? l : i, r = h < r ? h : r, n = n < l ? l : n, o = o < h ? h : o; this.minX = i, this.minY = r, this.maxX = n, this.maxY = o }, n.prototype.addBounds = function (t) { var e = this.minX, i = this.minY, r = this.maxX, n = this.maxY; this.minX = t.minX < e ? t.minX : e, this.minY = t.minY < i ? t.minY : i, this.maxX = t.maxX > r ? t.maxX : r, this.maxY = t.maxY > n ? t.maxY : n }, n.prototype.addBoundsMask = function (t, e) { var i, r, n, o = (t.minX > e.minX ? t : e).minX, s = (t.minY > e.minY ? t : e).minY, a = (t.maxX < e.maxX ? t : e).maxX, t = (t.maxY < e.maxY ? t : e).maxY; o <= a && s <= t && (e = this.minX, i = this.minY, r = this.maxX, n = this.maxY, this.minX = o < e ? o : e, this.minY = s < i ? s : i, this.maxX = r < a ? a : r, this.maxY = n < t ? t : n) }, n.prototype.addBoundsArea = function (t, e) { var i, r, n, o = t.minX > e.x ? t.minX : e.x, s = t.minY > e.y ? t.minY : e.y, a = t.maxX < e.x + e.width ? t.maxX : e.x + e.width, t = t.maxY < e.y + e.height ? t.maxY : e.y + e.height; o <= a && s <= t && (e = this.minX, i = this.minY, r = this.maxX, n = this.maxY, this.minX = o < e ? o : e, this.minY = s < i ? s : i, this.maxX = r < a ? a : r, this.maxY = n < t ? t : n) }, i.default = n }, { "../math": 70 }], 48: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = t("../utils"), t = t("./DisplayObject"); t = function (n) { var t = i, e = n; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function i() { if (!(this instanceof i)) throw new TypeError("Cannot call a class as a function"); var t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, n.call(this)); return t.children = [], t } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), i.prototype.onChildrenChange = function () { }, i.prototype.addChild = function (t) { var e = arguments.length; if (1 < e) for (var i = 0; i < e; i++)this.addChild(arguments[i]); else t.parent && t.parent.removeChild(t), t.parent = this, t.transform._parentID = -1, this.children.push(t), this._boundsID++, this.onChildrenChange(this.children.length - 1), t.emit("added", this); return t }, i.prototype.addChildAt = function (t, e) { if (e < 0 || e > this.children.length) throw new Error(t + "addChildAt: The index " + e + " supplied is out of bounds " + this.children.length); return t.parent && t.parent.removeChild(t), t.parent = this, t.transform._parentID = -1, this.children.splice(e, 0, t), this._boundsID++, this.onChildrenChange(e), t.emit("added", this), t }, i.prototype.swapChildren = function (t, e) { var i, r; t !== e && (i = this.getChildIndex(t), r = this.getChildIndex(e), this.children[i] = e, this.children[r] = t, this.onChildrenChange(i < r ? i : r)) }, i.prototype.getChildIndex = function (t) { t = this.children.indexOf(t); if (-1 === t) throw new Error("The supplied DisplayObject must be a child of the caller"); return t }, i.prototype.setChildIndex = function (t, e) { if (e < 0 || e >= this.children.length) throw new Error("The index " + e + " supplied is out of bounds " + this.children.length); var i = this.getChildIndex(t); (0, o.removeItems)(this.children, i, 1), this.children.splice(e, 0, t), this.onChildrenChange(e) }, i.prototype.getChildAt = function (t) { if (t < 0 || t >= this.children.length) throw new Error("getChildAt: Index (" + t + ") does not exist."); return this.children[t] }, i.prototype.removeChild = function (t) { var e = arguments.length; if (1 < e) for (var i = 0; i < e; i++)this.removeChild(arguments[i]); else { var r = this.children.indexOf(t); if (-1 === r) return null; t.parent = null, t.transform._parentID = -1, (0, o.removeItems)(this.children, r, 1), this._boundsID++, this.onChildrenChange(r), t.emit("removed", this) } return t }, i.prototype.removeChildAt = function (t) { var e = this.getChildAt(t); return e.parent = null, e.transform._parentID = -1, (0, o.removeItems)(this.children, t, 1), this._boundsID++, this.onChildrenChange(t), e.emit("removed", this), e }, i.prototype.removeChildren = function () { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 0, e = arguments[1], e = "number" == typeof e ? e : this.children.length, i = e - t, r = void 0; if (0 < i && i <= e) { for (var r = this.children.splice(t, i), n = 0; n < r.length; ++n)r[n].parent = null, r[n].transform && (r[n].transform._parentID = -1); this._boundsID++, this.onChildrenChange(t); for (var o = 0; o < r.length; ++o)r[o].emit("removed", this); return r } if (0 == i && 0 === this.children.length) return []; throw new RangeError("removeChildren: numeric values are outside the acceptable range.") }, i.prototype.updateTransform = function () { this._boundsID++, this.transform.updateTransform(this.parent.transform), this.worldAlpha = this.alpha * this.parent.worldAlpha; for (var t = 0, e = this.children.length; t < e; ++t) { var i = this.children[t]; i.visible && i.updateTransform() } }, i.prototype.calculateBounds = function () { this._bounds.clear(), this._calculateBounds(); for (var t = 0; t < this.children.length; t++) { var e = this.children[t]; e.visible && e.renderable && (e.calculateBounds(), e._mask ? (e._mask.calculateBounds(), this._bounds.addBoundsMask(e._bounds, e._mask._bounds)) : e.filterArea ? this._bounds.addBoundsArea(e._bounds, e.filterArea) : this._bounds.addBounds(e._bounds)) } this._lastBoundsID = this._boundsID }, i.prototype._calculateBounds = function () { }, i.prototype.renderWebGL = function (t) { if (this.visible && !(this.worldAlpha <= 0) && this.renderable) if (this._mask || this._filters) this.renderAdvancedWebGL(t); else { this._renderWebGL(t); for (var e = 0, i = this.children.length; e < i; ++e)this.children[e].renderWebGL(t) } }, i.prototype.renderAdvancedWebGL = function (t) { t.flush(); var e = this._filters, i = this._mask; if (e) { this._enabledFilters || (this._enabledFilters = []); for (var r = this._enabledFilters.length = 0; r < e.length; r++)e[r].enabled && this._enabledFilters.push(e[r]); this._enabledFilters.length && t.filterManager.pushFilter(this, this._enabledFilters) } i && t.maskManager.pushMask(this, this._mask), this._renderWebGL(t); for (var n = 0, o = this.children.length; n < o; n++)this.children[n].renderWebGL(t); t.flush(), i && t.maskManager.popMask(this, this._mask), e && this._enabledFilters && this._enabledFilters.length && t.filterManager.popFilter() }, i.prototype._renderWebGL = function (t) { }, i.prototype._renderCanvas = function (t) { }, i.prototype.renderCanvas = function (t) { if (this.visible && !(this.worldAlpha <= 0) && this.renderable) { this._mask && t.maskManager.pushMask(this._mask), this._renderCanvas(t); for (var e = 0, i = this.children.length; e < i; ++e)this.children[e].renderCanvas(t); this._mask && t.maskManager.popMask(t) } }, i.prototype.destroy = function (t) { n.prototype.destroy.call(this); var e = "boolean" == typeof t ? t : t && t.children, i = this.removeChildren(0, this.children.length); if (e) for (var r = 0; r < i.length; ++r)i[r].destroy(t) }, r(i, [{ key: "width", get: function () { return this.scale.x * this.getLocalBounds().width }, set: function (t) { var e = this.getLocalBounds().width; this.scale.x = 0 !== e ? t / e : 1, this._width = t } }, { key: "height", get: function () { return this.scale.y * this.getLocalBounds().height }, set: function (t) { var e = this.getLocalBounds().height; this.scale.y = 0 !== e ? t / e : 1, this._height = t } }]), i }(((t = t) && t.__esModule ? t : { default: t }).default); (i.default = t).prototype.containerUpdateTransform = t.prototype.updateTransform }, { "../utils": 125, "./DisplayObject": 49 }], 49: [function (t, u, e) { "use strict"; e.__esModule = !0; var n = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var i = l(t("eventemitter3")), o = t("../const"), s = l(t("../settings")), a = l(t("./TransformStatic")), c = l(t("./Transform")), f = l(t("./Bounds")), h = t("../math"); function l(t) { return t && t.__esModule ? t : { default: t } } t = function (i) { var t = r, e = i; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function r() { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); var t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, i.call(this)), e = (s.default.TRANSFORM_MODE === o.TRANSFORM_MODE.STATIC ? a : c).default; return t.tempDisplayObjectParent = null, t.transform = new e, t.alpha = 1, t.visible = !0, t.renderable = !0, t.parent = null, t.worldAlpha = 1, t.filterArea = null, t._filters = null, t._enabledFilters = null, t._bounds = new f.default, t._boundsID = 0, t._lastBoundsID = -1, t._boundsRect = null, t._localBoundsRect = null, t._mask = null, t._destroyed = !1, t } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), r.prototype.updateTransform = function () { this.transform.updateTransform(this.parent.transform), this.worldAlpha = this.alpha * this.parent.worldAlpha, this._bounds.updateID++ }, r.prototype._recursivePostUpdateTransform = function () { this.parent ? (this.parent._recursivePostUpdateTransform(), this.transform.updateTransform(this.parent.transform)) : this.transform.updateTransform(this._tempDisplayObjectParent.transform) }, r.prototype.getBounds = function (t, e) { return t || (this.parent ? (this._recursivePostUpdateTransform(), this.updateTransform()) : (this.parent = this._tempDisplayObjectParent, this.updateTransform(), this.parent = null)), this._boundsID !== this._lastBoundsID && this.calculateBounds(), e || (this._boundsRect || (this._boundsRect = new h.Rectangle), e = this._boundsRect), this._bounds.getRectangle(e) }, r.prototype.getLocalBounds = function (t) { var e = this.transform, i = this.parent, t = (this.parent = null, this.transform = this._tempDisplayObjectParent.transform, t || (this._localBoundsRect || (this._localBoundsRect = new h.Rectangle), t = this._localBoundsRect), this.getBounds(!1, t)); return this.parent = i, this.transform = e, t }, r.prototype.toGlobal = function (t, e) { return 2 < arguments.length && void 0 !== arguments[2] && arguments[2] || (this._recursivePostUpdateTransform(), this.parent ? this.displayObjectUpdateTransform() : (this.parent = this._tempDisplayObjectParent, this.displayObjectUpdateTransform(), this.parent = null)), this.worldTransform.apply(t, e) }, r.prototype.toLocal = function (t, e, i, r) { return e && (t = e.toGlobal(t, i, r)), r || (this._recursivePostUpdateTransform(), this.parent ? this.displayObjectUpdateTransform() : (this.parent = this._tempDisplayObjectParent, this.displayObjectUpdateTransform(), this.parent = null)), this.worldTransform.applyInverse(t, i) }, r.prototype.renderWebGL = function (t) { }, r.prototype.renderCanvas = function (t) { }, r.prototype.setParent = function (t) { if (!t || !t.addChild) throw new Error("setParent: Argument must be a Container"); return t.addChild(this), t }, r.prototype.setTransform = function () { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 0, e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 0, i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 1, r = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : 1, n = 4 < arguments.length && void 0 !== arguments[4] ? arguments[4] : 0, o = 5 < arguments.length && void 0 !== arguments[5] ? arguments[5] : 0, s = 6 < arguments.length && void 0 !== arguments[6] ? arguments[6] : 0, a = 7 < arguments.length && void 0 !== arguments[7] ? arguments[7] : 0, h = 8 < arguments.length && void 0 !== arguments[8] ? arguments[8] : 0; return this.position.x = t, this.position.y = e, this.scale.x = i || 1, this.scale.y = r || 1, this.rotation = n, this.skew.x = o, this.skew.y = s, this.pivot.x = a, this.pivot.y = h, this }, r.prototype.destroy = function () { this.removeAllListeners(), this.parent && this.parent.removeChild(this), this.transform = null, this.parent = null, this._bounds = null, this._currentBounds = null, this._mask = null, this.filterArea = null, this.interactive = !1, this.interactiveChildren = !1, this._destroyed = !0 }, n(r, [{ key: "_tempDisplayObjectParent", get: function () { return null === this.tempDisplayObjectParent && (this.tempDisplayObjectParent = new r), this.tempDisplayObjectParent } }, { key: "x", get: function () { return this.position.x }, set: function (t) { this.transform.position.x = t } }, { key: "y", get: function () { return this.position.y }, set: function (t) { this.transform.position.y = t } }, { key: "worldTransform", get: function () { return this.transform.worldTransform } }, { key: "localTransform", get: function () { return this.transform.localTransform } }, { key: "position", get: function () { return this.transform.position }, set: function (t) { this.transform.position.copy(t) } }, { key: "scale", get: function () { return this.transform.scale }, set: function (t) { this.transform.scale.copy(t) } }, { key: "pivot", get: function () { return this.transform.pivot }, set: function (t) { this.transform.pivot.copy(t) } }, { key: "skew", get: function () { return this.transform.skew }, set: function (t) { this.transform.skew.copy(t) } }, { key: "rotation", get: function () { return this.transform.rotation }, set: function (t) { this.transform.rotation = t } }, { key: "worldVisible", get: function () { var t = this; do { if (!t.visible) return !1 } while (t = t.parent); return !0 } }, { key: "mask", get: function () { return this._mask }, set: function (t) { this._mask && (this._mask.renderable = !0, this._mask.isMask = !1), this._mask = t, this._mask && (this._mask.renderable = !1, this._mask.isMask = !0) } }, { key: "filters", get: function () { return this._filters && this._filters.slice() }, set: function (t) { this._filters = t && t.slice() } }]), r }(i.default); (e.default = t).prototype.displayObjectUpdateTransform = t.prototype.updateTransform }, { "../const": 46, "../math": 70, "../settings": 101, "./Bounds": 47, "./Transform": 50, "./TransformStatic": 52, eventemitter3: 3 }], 50: [function (t, e, i) { "use strict"; i.__esModule = !0; var n = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = t("../math"), t = t("./TransformBase"); t = function (e) { var t = r, i = e; if ("function" != typeof i && null !== i) throw new TypeError("Super expression must either be null or a function, not " + typeof i); function r() { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); var t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, e.call(this)); return t.position = new o.Point(0, 0), t.scale = new o.Point(1, 1), t.skew = new o.ObservablePoint(t.updateSkew, t, 0, 0), t.pivot = new o.Point(0, 0), t._rotation = 0, t._cx = 1, t._sx = 0, t._cy = 0, t._sy = 1, t } return t.prototype = Object.create(i && i.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), i && (Object.setPrototypeOf ? Object.setPrototypeOf(t, i) : t.__proto__ = i), r.prototype.updateSkew = function () { this._cx = Math.cos(this._rotation + this.skew._y), this._sx = Math.sin(this._rotation + this.skew._y), this._cy = -Math.sin(this._rotation - this.skew._x), this._sy = Math.cos(this._rotation - this.skew._x) }, r.prototype.updateLocalTransform = function () { var t = this.localTransform; t.a = this._cx * this.scale.x, t.b = this._sx * this.scale.x, t.c = this._cy * this.scale.y, t.d = this._sy * this.scale.y, t.tx = this.position.x - (this.pivot.x * t.a + this.pivot.y * t.c), t.ty = this.position.y - (this.pivot.x * t.b + this.pivot.y * t.d) }, r.prototype.updateTransform = function (t) { var e = this.localTransform, t = (e.a = this._cx * this.scale.x, e.b = this._sx * this.scale.x, e.c = this._cy * this.scale.y, e.d = this._sy * this.scale.y, e.tx = this.position.x - (this.pivot.x * e.a + this.pivot.y * e.c), e.ty = this.position.y - (this.pivot.x * e.b + this.pivot.y * e.d), t.worldTransform), i = this.worldTransform; i.a = e.a * t.a + e.b * t.c, i.b = e.a * t.b + e.b * t.d, i.c = e.c * t.a + e.d * t.c, i.d = e.c * t.b + e.d * t.d, i.tx = e.tx * t.a + e.ty * t.c + t.tx, i.ty = e.tx * t.b + e.ty * t.d + t.ty, this._worldID++ }, r.prototype.setFromMatrix = function (t) { t.decompose(this) }, n(r, [{ key: "rotation", get: function () { return this._rotation }, set: function (t) { this._rotation = t, this.updateSkew() } }]), r }(((t = t) && t.__esModule ? t : { default: t }).default); i.default = t }, { "../math": 70, "./TransformBase": 51 }], 51: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("../math"); n.prototype.updateLocalTransform = function () { }, n.prototype.updateTransform = function (t) { var t = t.worldTransform, e = this.worldTransform, i = this.localTransform; e.a = i.a * t.a + i.b * t.c, e.b = i.a * t.b + i.b * t.d, e.c = i.c * t.a + i.d * t.c, e.d = i.c * t.b + i.d * t.d, e.tx = i.tx * t.a + i.ty * t.c + t.tx, e.ty = i.tx * t.b + i.ty * t.d + t.ty, this._worldID++ }; t = n; function n() { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); this.worldTransform = new r.Matrix, this.localTransform = new r.Matrix, this._worldID = 0, this._parentID = 0 } (i.default = t).prototype.updateWorldTransform = t.prototype.updateTransform, t.IDENTITY = new t }, { "../math": 70 }], 52: [function (t, e, i) { "use strict"; i.__esModule = !0; var n = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = t("../math"), t = t("./TransformBase"); t = function (e) { var t = r, i = e; if ("function" != typeof i && null !== i) throw new TypeError("Super expression must either be null or a function, not " + typeof i); function r() { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); var t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, e.call(this)); return t.position = new o.ObservablePoint(t.onChange, t, 0, 0), t.scale = new o.ObservablePoint(t.onChange, t, 1, 1), t.pivot = new o.ObservablePoint(t.onChange, t, 0, 0), t.skew = new o.ObservablePoint(t.updateSkew, t, 0, 0), t._rotation = 0, t._cx = 1, t._sx = 0, t._cy = 0, t._sy = 1, t._localID = 0, t._currentLocalID = 0, t } return t.prototype = Object.create(i && i.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), i && (Object.setPrototypeOf ? Object.setPrototypeOf(t, i) : t.__proto__ = i), r.prototype.onChange = function () { this._localID++ }, r.prototype.updateSkew = function () { this._cx = Math.cos(this._rotation + this.skew._y), this._sx = Math.sin(this._rotation + this.skew._y), this._cy = -Math.sin(this._rotation - this.skew._x), this._sy = Math.cos(this._rotation - this.skew._x), this._localID++ }, r.prototype.updateLocalTransform = function () { var t = this.localTransform; this._localID !== this._currentLocalID && (t.a = this._cx * this.scale._x, t.b = this._sx * this.scale._x, t.c = this._cy * this.scale._y, t.d = this._sy * this.scale._y, t.tx = this.position._x - (this.pivot._x * t.a + this.pivot._y * t.c), t.ty = this.position._y - (this.pivot._x * t.b + this.pivot._y * t.d), this._currentLocalID = this._localID, this._parentID = -1) }, r.prototype.updateTransform = function (t) { var e, i, r = this.localTransform; this._localID !== this._currentLocalID && (r.a = this._cx * this.scale._x, r.b = this._sx * this.scale._x, r.c = this._cy * this.scale._y, r.d = this._sy * this.scale._y, r.tx = this.position._x - (this.pivot._x * r.a + this.pivot._y * r.c), r.ty = this.position._y - (this.pivot._x * r.b + this.pivot._y * r.d), this._currentLocalID = this._localID, this._parentID = -1), this._parentID !== t._worldID && (e = t.worldTransform, (i = this.worldTransform).a = r.a * e.a + r.b * e.c, i.b = r.a * e.b + r.b * e.d, i.c = r.c * e.a + r.d * e.c, i.d = r.c * e.b + r.d * e.d, i.tx = r.tx * e.a + r.ty * e.c + e.tx, i.ty = r.tx * e.b + r.ty * e.d + e.ty, this._parentID = t._worldID, this._worldID++) }, r.prototype.setFromMatrix = function (t) { t.decompose(this), this._localID++ }, n(r, [{ key: "rotation", get: function () { return this._rotation }, set: function (t) { this._rotation = t, this.updateSkew() } }]), r }(((t = t) && t.__esModule ? t : { default: t }).default); i.default = t }, { "../math": 70, "./TransformBase": 51 }], 53: [function (t, r, e) { "use strict"; e.__esModule = !0; var n = i(t("../display/Container")), c = i(t("../textures/RenderTexture")), o = i(t("../textures/Texture")), f = i(t("./GraphicsData")), d = i(t("../sprites/Sprite")), s = t("../math"), a = t("../utils"), b = t("../const"), p = i(t("../display/Bounds")), g = i(t("./utils/bezierCurveTo")), v = i(t("../renderers/canvas/CanvasRenderer")); function i(t) { return t && t.__esModule ? t : { default: t } } var h = void 0, l = new s.Matrix, u = new s.Point, m = new Float32Array(4), _ = new Float32Array(4), t = function (n) { var t = y, e = n; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function y() { var t = 0 < arguments.length && void 0 !== arguments[0] && arguments[0], e = this, i = y; if (!(e instanceof i)) throw new TypeError("Cannot call a class as a function"); e = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, n.call(this)); return e.fillAlpha = 1, e.lineWidth = 0, e.nativeLines = t, e.lineColor = 0, e.lineAlignment = .5, e.graphicsData = [], e.tint = 16777215, e._prevTint = 16777215, e.blendMode = b.BLEND_MODES.NORMAL, e.currentPath = null, e._webGL = {}, e.isMask = !1, e.boundsPadding = 0, e._localBounds = new p.default, e.dirty = 0, e.fastRectDirty = -1, e.clearDirty = 0, e.boundsDirty = -1, e.cachedSpriteDirty = !1, e._spriteRect = null, e._fastRect = !1, e } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), y.prototype.clone = function () { var t; (t = new y).renderable = this.renderable, t.fillAlpha = this.fillAlpha, t.lineWidth = this.lineWidth, t.lineColor = this.lineColor, t.lineAlignment = this.lineAlignment, t.tint = this.tint, t.blendMode = this.blendMode, t.isMask = this.isMask, t.boundsPadding = this.boundsPadding, t.dirty = 0, t.cachedSpriteDirty = this.cachedSpriteDirty; for (var e = 0; e < this.graphicsData.length; ++e)t.graphicsData.push(this.graphicsData[e].clone()); return t.currentPath = t.graphicsData[t.graphicsData.length - 1], t.updateLocalBounds(), t }, y.prototype._quadraticCurveLength = function (t, e, i, r, n, o) { var n = t - (2 * i + n), o = e - (2 * r + o), i = (i - 2) * t * 2, t = (r - 2) * e * 2, r = 4 * (n * n + o * o), e = 4 * (n * i + o * t), n = i * i + t * t, o = 2 * Math.sqrt(r + e + n), i = Math.sqrt(r), t = 2 * r * i, s = 2 * Math.sqrt(n), a = e / i; return (t * o + i * e * (o - s) + (4 * n * r - e * e) * Math.log((2 * i + a + o) / (a + s))) / (4 * t) }, y.prototype._bezierCurveLength = function (t, e, u, c, f, d, p, g) { for (var i, r, n, o, v, s, a, h, m = 0, y = t, _ = e, l = 1; l <= 10; ++l)a = y - (v = (s = (h = (o = 1 - (i = l / 10)) * o) * o) * t + 3 * h * i * u + 3 * o * (r = i * i) * f + (n = r * i) * p), h = _ - (s = s * e + 3 * h * i * c + 3 * o * r * d + n * g), y = v, _ = s, m += Math.sqrt(a * a + h * h); return m }, y.prototype._segmentsCount = function (t) { t = Math.ceil(t / y.CURVES.maxLength); return t < y.CURVES.minSegments ? t = y.CURVES.minSegments : t > y.CURVES.maxSegments && (t = y.CURVES.maxSegments), t }, y.prototype.lineStyle = function () { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 0, e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 0, i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 1, r = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : .5; return this.lineWidth = t, this.lineColor = e, this.lineAlpha = i, this.lineAlignment = r, this.currentPath && (this.currentPath.shape.points.length ? ((t = new s.Polygon(this.currentPath.shape.points.slice(-2))).closed = !1, this.drawShape(t)) : (this.currentPath.lineWidth = this.lineWidth, this.currentPath.lineColor = this.lineColor, this.currentPath.lineAlpha = this.lineAlpha, this.currentPath.lineAlignment = this.lineAlignment)), this }, y.prototype.moveTo = function (t, e) { t = new s.Polygon([t, e]); return t.closed = !1, this.drawShape(t), this }, y.prototype.lineTo = function (t, e) { return this.currentPath.shape.points.push(t, e), this.dirty++, this }, y.prototype.quadraticCurveTo = function (t, e, i, r) { this.currentPath ? 0 === this.currentPath.shape.points.length && (this.currentPath.shape.points = [0, 0]) : this.moveTo(0, 0); for (var n = this.currentPath.shape.points, o = (0 === n.length && this.moveTo(0, 0), n[n.length - 2]), s = n[n.length - 1], u = y.CURVES.adaptive ? this._segmentsCount(this._quadraticCurveLength(o, s, t, e, i, r)) : 20, a = 1; a <= u; ++a) { var h, l = a / u; n.push((h = o + (t - o) * l) + (t + (i - t) * l - h) * l, (h = s + (e - s) * l) + (e + (r - e) * l - h) * l) } return this.dirty++, this }, y.prototype.bezierCurveTo = function (t, e, i, r, n, o) { this.currentPath ? 0 === this.currentPath.shape.points.length && (this.currentPath.shape.points = [0, 0]) : this.moveTo(0, 0); var s = this.currentPath.shape.points, a = s[s.length - 2], h = s[s.length - 1], l = (s.length -= 2, y.CURVES.adaptive ? this._segmentsCount(this._bezierCurveLength(a, h, t, e, i, r, n, o)) : 20); return (0, g.default)(a, h, t, e, i, r, n, o, l, s), this.dirty++, this }, y.prototype.arcTo = function (t, e, i, r, u) { this.currentPath ? 0 === this.currentPath.shape.points.length && this.currentPath.shape.points.push(t, e) : this.moveTo(t, e); var c, f, d, n, o, s = this.currentPath.shape.points, a = s[s.length - 2], h = s[s.length - 1] - e, a = a - t, r = r - e, i = i - t, l = Math.abs(h * i - a * r); return l < 1e-8 || 0 === u ? s[s.length - 2] === t && s[s.length - 1] === e || s.push(t, e) : (s = h * h + a * a, d = r * r + i * i, o = h * r + a * i, s = (n = u * Math.sqrt(s) / l) * o / s, c = n * i + (l = u * Math.sqrt(d) / l) * a, f = n * r + l * h, d = i * (n + (o = l * o / d)), n = r * (n + o), o = Math.atan2(h * (l + s) - f, a * (l + s) - c), l = Math.atan2(n - f, d - c), this.arc(c + t, f + e, u, o, l, i * h < a * r)), this.dirty++, this }, y.prototype.arc = function (l, u, t, e, i) { var r = 5 < arguments.length && void 0 !== arguments[5] && arguments[5]; if (e === i) return this; !r && i <= e ? i += b.PI_2 : r && e <= i && (e += b.PI_2); r = i - e, i = y.CURVES.adaptive ? this._segmentsCount(Math.abs(r) * t) : 40 * Math.ceil(Math.abs(r) / b.PI_2); if (0 == r) return this; for (var n = l + Math.cos(e) * t, c = u + Math.sin(e) * t, o = this.currentPath ? this.currentPath.shape.points : null, s = (o ? o[o.length - 2] === n && o[o.length - 1] === c || o.push(n, c) : (this.moveTo(n, c), o = this.currentPath.shape.points), r / (2 * i)), f = 2 * s, d = Math.cos(s), p = Math.sin(s), g = i - 1, v = g % 1 / g, a = 0; a <= g; ++a) { var h = s + e + f * (a + v * a), m = Math.cos(h), h = -Math.sin(h); o.push((d * m + p * h) * t + l, (d * -h + p * m) * t + u) } return this.dirty++, this }, y.prototype.beginFill = function () { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 0, e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 1; return this.filling = !0, this.fillColor = t, this.fillAlpha = e, this.currentPath && this.currentPath.shape.points.length <= 2 && (this.currentPath.fill = this.filling, this.currentPath.fillColor = this.fillColor, this.currentPath.fillAlpha = this.fillAlpha), this }, y.prototype.endFill = function () { return this.filling = !1, this.fillColor = null, this.fillAlpha = 1, this }, y.prototype.drawRect = function (t, e, i, r) { return this.drawShape(new s.Rectangle(t, e, i, r)), this }, y.prototype.drawRoundedRect = function (t, e, i, r, n) { return this.drawShape(new s.RoundedRectangle(t, e, i, r, n)), this }, y.prototype.drawCircle = function (t, e, i) { return this.drawShape(new s.Circle(t, e, i)), this }, y.prototype.drawEllipse = function (t, e, i, r) { return this.drawShape(new s.Ellipse(t, e, i, r)), this }, y.prototype.drawPolygon = function (t) { var e = !0; if ((i = t) instanceof s.Polygon && (e = i.closed, i = i.points), !Array.isArray(i)) for (var i = new Array(arguments.length), r = 0; r < i.length; ++r)i[r] = arguments[r]; t = new s.Polygon(i); return t.closed = e, this.drawShape(t), this }, y.prototype.drawStar = function (t, e, l, i, r) { r = r || i / 2; for (var u = -1 * Math.PI / 2 + (5 < arguments.length && void 0 !== arguments[5] ? arguments[5] : 0), n = 2 * l, c = b.PI_2 / n, o = [], s = 0; s < n; s++) { var a = s % 2 ? r : i, h = s * c + u; o.push(t + a * Math.cos(h), e + a * Math.sin(h)) } return this.drawPolygon(o) }, y.prototype.clear = function () { return (this.lineWidth || this.filling || 0 < this.graphicsData.length) && (this.lineWidth = 0, this.lineAlignment = .5, this.filling = !1, this.boundsDirty = -1, this.dirty++, this.clearDirty++, this.graphicsData.length = 0), this.currentPath = null, this._spriteRect = null, this }, y.prototype.isFastRect = function () { return 1 === this.graphicsData.length && this.graphicsData[0].shape.type === b.SHAPES.RECT && !this.graphicsData[0].lineWidth }, y.prototype._renderWebGL = function (t) { this.dirty !== this.fastRectDirty && (this.fastRectDirty = this.dirty, this._fastRect = this.isFastRect()), this._fastRect ? this._renderSpriteRect(t) : (t.setObjectRenderer(t.plugins.graphics), t.plugins.graphics.render(this)) }, y.prototype._renderSpriteRect = function (t) { var e, i, r = this.graphicsData[0].shape, n = (this._spriteRect || (this._spriteRect = new d.default(new o.default(o.default.WHITE))), this._spriteRect); 16777215 === this.tint ? n.tint = this.graphicsData[0].fillColor : (i = _, (0, a.hex2rgb)(this.graphicsData[0].fillColor, e = m), (0, a.hex2rgb)(this.tint, i), e[0] *= i[0], e[1] *= i[1], e[2] *= i[2], n.tint = (0, a.rgb2hex)(e)), n.alpha = this.graphicsData[0].fillAlpha, n.worldAlpha = this.worldAlpha * n.alpha, n.blendMode = this.blendMode, n._texture._frame.width = r.width, n._texture._frame.height = r.height, n.transform.worldTransform = this.transform.worldTransform, n.anchor.set(-r.x / r.width, -r.y / r.height), n._onAnchorUpdate(), n._renderWebGL(t) }, y.prototype._renderCanvas = function (t) { !0 !== this.isMask && t.plugins.graphics.render(this) }, y.prototype._calculateBounds = function () { this.boundsDirty !== this.dirty && (this.boundsDirty = this.dirty, this.updateLocalBounds(), this.cachedSpriteDirty = !0); var t = this._localBounds; this._bounds.addFrame(this.transform, t.minX, t.minY, t.maxX, t.maxY) }, y.prototype.containsPoint = function (t) { this.worldTransform.applyInverse(t, u); for (var e = this.graphicsData, i = 0; i < e.length; ++i) { var r = e[i]; if (r.fill && (r.shape && r.shape.contains(u.x, u.y))) { if (r.holes) for (var n = 0; n < r.holes.length; n++)if (r.holes[n].contains(u.x, u.y)) return !1; return !0 } } return !1 }, y.prototype.updateLocalBounds = function () { var t = 1 / 0, e = -1 / 0, i = 1 / 0, r = -1 / 0; if (this.graphicsData.length) for (var n = 0, o = 0, s = 0, a = 0, u = 0; u < this.graphicsData.length; u++) { var h = this.graphicsData[u], c = h.type, f = h.lineWidth, h = h.shape; if (c === b.SHAPES.RECT || c === b.SHAPES.RREC) n = h.x - f / 2, o = h.y - f / 2, t = n < t ? n : t, e = e < n + (s = h.width + f) ? n + s : e, i = o < i ? o : i, r = r < o + (a = h.height + f) ? o + a : r; else if (c === b.SHAPES.CIRC) n = h.x, o = h.y, t = n - (s = h.radius + f / 2) < t ? n - s : t, e = e < n + s ? n + s : e, i = o - (a = h.radius + f / 2) < i ? o - a : i, r = r < o + a ? o + a : r; else if (c === b.SHAPES.ELIP) n = h.x, o = h.y, t = n - (s = h.width + f / 2) < t ? n - s : t, e = e < n + s ? n + s : e, i = o - (a = h.height + f / 2) < i ? o - a : i, r = r < o + a ? o + a : r; else for (var d, p, g, v, l, m = h.points, y = 0; y + 2 < m.length; y += 2)n = m[y], o = m[y + 1], l = m[y + 2], d = m[y + 3], p = Math.abs(l - n), g = Math.abs(d - o), a = f, (s = Math.sqrt(p * p + g * g)) < 1e-9 || (t = (l = (l + n) / 2) - (v = (a / s * g + p) / 2) < t ? l - v : t, e = e < l + v ? l + v : e, i = (l = (d + o) / 2) - (v = (a / s * p + g) / 2) < i ? l - v : i, r = r < l + v ? l + v : r) } else r = i = e = t = 0; var _ = this.boundsPadding; this._localBounds.minX = t - _, this._localBounds.maxX = e + _, this._localBounds.minY = i - _, this._localBounds.maxY = r + _ }, y.prototype.drawShape = function (t) { this.currentPath && this.currentPath.shape.points.length <= 2 && this.graphicsData.pop(), this.currentPath = null; t = new f.default(this.lineWidth, this.lineColor, this.lineAlpha, this.fillColor, this.fillAlpha, this.filling, this.nativeLines, t, this.lineAlignment); return this.graphicsData.push(t), t.type === b.SHAPES.POLY && (t.shape.closed = t.shape.closed || this.filling, this.currentPath = t), this.dirty++, t }, y.prototype.generateCanvasTexture = function (t) { var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 1, i = this.getLocalBounds(), r = c.default.create(i.width, i.height, t, e), i = (h = h || new v.default, this.transform.updateLocalTransform(), this.transform.localTransform.copy(l), l.invert(), l.tx -= i.x, l.ty -= i.y, h.render(this, r, !0, l), o.default.fromCanvas(r.baseTexture._canvasRenderTarget.canvas, t, "graphics")); return i.baseTexture.resolution = e, i.baseTexture.update(), i }, y.prototype.closePath = function () { var t = this.currentPath; return t && t.shape && t.shape.close(), this }, y.prototype.addHole = function () { var t = this.graphicsData.pop(); return this.currentPath = this.graphicsData[this.graphicsData.length - 1], this.currentPath.addHole(t.shape), this.currentPath = null, this }, y.prototype.destroy = function (t) { n.prototype.destroy.call(this, t); for (var e, i = 0; i < this.graphicsData.length; ++i)this.graphicsData[i].destroy(); for (e in this._webGL) for (var r = 0; r < this._webGL[e].data.length; ++r)this._webGL[e].data[r].destroy(); this._spriteRect && this._spriteRect.destroy(), this.graphicsData = null, this.currentPath = null, this._webGL = null, this._localBounds = null }, y }(n.default); (e.default = t)._SPRITE_TEXTURE = null, t.CURVES = { adaptive: !1, maxLength: 10, minSegments: 8, maxSegments: 2048 } }, { "../const": 46, "../display/Bounds": 47, "../display/Container": 48, "../math": 70, "../renderers/canvas/CanvasRenderer": 77, "../sprites/Sprite": 102, "../textures/RenderTexture": 113, "../textures/Texture": 115, "../utils": 125, "./GraphicsData": 54, "./utils/bezierCurveTo": 56 }], 54: [function (t, e, i) { "use strict"; function l(t, e, i, r, n, o, s, a, h) { if (!(this instanceof l)) throw new TypeError("Cannot call a class as a function"); this.lineWidth = t, this.lineAlignment = h, this.nativeLines = s, this.lineColor = e, this.lineAlpha = i, this._lineTint = e, this.fillColor = r, this.fillAlpha = n, this._fillTint = r, this.fill = o, this.holes = [], this.shape = a, this.type = a.type } i.__esModule = !0, l.prototype.clone = function () { return new l(this.lineWidth, this.lineColor, this.lineAlpha, this.fillColor, this.fillAlpha, this.fill, this.nativeLines, this.shape) }, l.prototype.addHole = function (t) { this.holes.push(t) }, l.prototype.destroy = function () { this.shape = null, this.holes = null }, i.default = l }, {}], 55: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("../../renderers/canvas/CanvasRenderer"), r = (r = r) && r.__esModule ? r : { default: r }, b = t("../../const"); n.prototype.render = function (u) { var c = this.renderer, t = c.context, e = u.worldAlpha, f = u.transform.worldTransform, d = c.resolution; this._prevTint !== this.tint && (this.dirty = !0), t.setTransform(f.a * d, f.b * d, f.c * d, f.d * d, f.tx * d, f.ty * d), u.dirty && (this.updateGraphicsTint(u), u.dirty = !1), c.setBlendMode(u.blendMode); for (var p = 0; p < u.graphicsData.length; p++) { var g, i, r, n, o, s, v, a, h = u.graphicsData[p], l = h.shape, m = h._fillTint, y = h._lineTint; if (t.lineWidth = h.lineWidth, h.type === b.SHAPES.POLY) { t.beginPath(), this.renderPolygon(l.points, l.closed, t); for (var _ = 0; _ < h.holes.length; _++)this.renderPolygon(h.holes[_].points, !0, t); h.fill && (t.globalAlpha = h.fillAlpha * e, t.fillStyle = "#" + ("00000" + (0 | m).toString(16)).substr(-6), t.fill()), h.lineWidth && (t.globalAlpha = h.lineAlpha * e, t.strokeStyle = "#" + ("00000" + (0 | y).toString(16)).substr(-6), t.stroke()) } else h.type === b.SHAPES.RECT ? (!h.fillColor && 0 !== h.fillColor || (t.globalAlpha = h.fillAlpha * e, t.fillStyle = "#" + ("00000" + (0 | m).toString(16)).substr(-6), t.fillRect(l.x, l.y, l.width, l.height)), h.lineWidth && (t.globalAlpha = h.lineAlpha * e, t.strokeStyle = "#" + ("00000" + (0 | y).toString(16)).substr(-6), t.strokeRect(l.x, l.y, l.width, l.height))) : h.type === b.SHAPES.CIRC ? (t.beginPath(), t.arc(l.x, l.y, l.radius, 0, 2 * Math.PI), t.closePath(), h.fill && (t.globalAlpha = h.fillAlpha * e, t.fillStyle = "#" + ("00000" + (0 | m).toString(16)).substr(-6), t.fill()), h.lineWidth && (t.globalAlpha = h.lineAlpha * e, t.strokeStyle = "#" + ("00000" + (0 | y).toString(16)).substr(-6), t.stroke())) : h.type === b.SHAPES.ELIP ? (o = 2 * l.width, i = 2 * l.height, g = l.x - o / 2, r = l.y - i / 2, t.beginPath(), s = o / 2 * .5522848, v = i / 2 * .5522848, n = g + o, a = r + i, o = g + o / 2, t.moveTo(g, i = r + i / 2), t.bezierCurveTo(g, i - v, o - s, r, o, r), t.bezierCurveTo(o + s, r, n, i - v, n, i), t.bezierCurveTo(n, i + v, o + s, a, o, a), t.bezierCurveTo(o - s, a, g, i + v, g, i), t.closePath(), h.fill && (t.globalAlpha = h.fillAlpha * e, t.fillStyle = "#" + ("00000" + (0 | m).toString(16)).substr(-6), t.fill()), h.lineWidth && (t.globalAlpha = h.lineAlpha * e, t.strokeStyle = "#" + ("00000" + (0 | y).toString(16)).substr(-6), t.stroke())) : h.type === b.SHAPES.RREC && (r = l.x, n = l.y, o = l.width, s = l.height, a = l.radius, a = (v = Math.min(o, s) / 2 | 0) < a ? v : a, t.beginPath(), t.moveTo(r, n + a), t.lineTo(r, n + s - a), t.quadraticCurveTo(r, n + s, r + a, n + s), t.lineTo(r + o - a, n + s), t.quadraticCurveTo(r + o, n + s, r + o, n + s - a), t.lineTo(r + o, n + a), t.quadraticCurveTo(r + o, n, r + o - a, n), t.lineTo(r + a, n), t.quadraticCurveTo(r, n, r, n + a), t.closePath(), !h.fillColor && 0 !== h.fillColor || (t.globalAlpha = h.fillAlpha * e, t.fillStyle = "#" + ("00000" + (0 | m).toString(16)).substr(-6), t.fill()), h.lineWidth && (t.globalAlpha = h.lineAlpha * e, t.strokeStyle = "#" + ("00000" + (0 | y).toString(16)).substr(-6), t.stroke())) } }, n.prototype.updateGraphicsTint = function (t) { t._prevTint = t.tint; for (var e = (t.tint >> 16 & 255) / 255, i = (t.tint >> 8 & 255) / 255, r = (255 & t.tint) / 255, n = 0; n < t.graphicsData.length; ++n) { var o = t.graphicsData[n], s = 0 | o.fillColor, a = 0 | o.lineColor; o._fillTint = ((s >> 16 & 255) / 255 * e * 255 << 16) + ((s >> 8 & 255) / 255 * i * 255 << 8) + (255 & s) / 255 * r * 255, o._lineTint = ((a >> 16 & 255) / 255 * e * 255 << 16) + ((a >> 8 & 255) / 255 * i * 255 << 8) + (255 & a) / 255 * r * 255 } }, n.prototype.renderPolygon = function (t, e, i) { i.moveTo(t[0], t[1]); for (var r = 1; r < t.length / 2; ++r)i.lineTo(t[2 * r], t[2 * r + 1]); e && i.closePath() }, n.prototype.destroy = function () { this.renderer = null }; t = n; function n(t) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); this.renderer = t } i.default = t, r.default.registerPlugin("graphics", t) }, { "../../const": 46, "../../renderers/canvas/CanvasRenderer": 77 }], 56: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t, l, u, c, f, d, p, g, v) { var e = 9 < arguments.length && void 0 !== arguments[9] ? arguments[9] : [], i = 0, r = 0, n = 0, o = 0, s = 0; e.push(t, l); for (var a = 1, h = 0; a <= v; ++a)n = (r = (i = 1 - (h = a / v)) * i) * i, s = (o = h * h) * h, e.push(n * t + 3 * r * h * u + 3 * i * o * f + s * p, n * l + 3 * r * h * c + 3 * i * o * d + s * g); return e } }, {}], 57: [function (t, a, e) { "use strict"; e.__esModule = !0; var l = t("../../utils"), u = t("../../const"), n = r(t("../../renderers/webgl/utils/ObjectRenderer")), i = r(t("../../renderers/webgl/WebGLRenderer")), o = r(t("./WebGLGraphicsData")), s = r(t("./shaders/PrimitiveShader")), c = r(t("./utils/buildPoly")), f = r(t("./utils/buildRectangle")), d = r(t("./utils/buildRoundedRectangle")), p = r(t("./utils/buildCircle")); function r(t) { return t && t.__esModule ? t : { default: t } } t = function (i) { var t = r, e = i; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); var e = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, i.call(this, t)); return e.graphicsDataPool = [], e.primitiveShader = null, e.gl = t.gl, e.CONTEXT_UID = 0, e } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), r.prototype.onContextChange = function () { this.gl = this.renderer.gl, this.CONTEXT_UID = this.renderer.CONTEXT_UID, this.primitiveShader = new s.default(this.gl) }, r.prototype.destroy = function () { n.default.prototype.destroy.call(this); for (var t = 0; t < this.graphicsDataPool.length; ++t)this.graphicsDataPool[t].destroy(); this.graphicsDataPool = null }, r.prototype.render = function (t) { var e = this.renderer, i = e.gl, r = void 0, n = t._webGL[this.CONTEXT_UID], o = (n && t.dirty === n.dirty || (this.updateGraphics(t), n = t._webGL[this.CONTEXT_UID]), this.primitiveShader); e.bindShader(o), e.state.setBlendMode(t.blendMode); for (var s = 0, a = n.data.length; s < a; s++) { var h = (r = n.data[s]).shader; e.bindShader(h), h.uniforms.translationMatrix = t.transform.worldTransform.toArray(!0), h.uniforms.tint = (0, l.hex2rgb)(t.tint), h.uniforms.alpha = t.worldAlpha, e.bindVao(r.vao), r.nativeLines ? i.drawArrays(i.LINES, 0, r.points.length / 6) : r.vao.draw(i.TRIANGLE_STRIP, r.indices.length) } }, r.prototype.updateGraphics = function (t) { var e = this.renderer.gl, i = t._webGL[this.CONTEXT_UID]; if ((i = i || (t._webGL[this.CONTEXT_UID] = { lastIndex: 0, data: [], gl: e, clearDirty: -1, dirty: -1 })).dirty = t.dirty, t.clearDirty !== i.clearDirty) { i.clearDirty = t.clearDirty; for (var r = 0; r < i.data.length; r++)this.graphicsDataPool.push(i.data[r]); i.data.length = 0, i.lastIndex = 0 } for (var n = void 0, o = void 0, s = i.lastIndex; s < t.graphicsData.length; s++) { var a = t.graphicsData[s], n = this.getWebGLData(i, 0); a.nativeLines && a.lineWidth && (o = this.getWebGLData(i, 0, !0), i.lastIndex++), a.type === u.SHAPES.POLY && (0, c.default)(a, n, o), a.type === u.SHAPES.RECT ? (0, f.default)(a, n, o) : a.type === u.SHAPES.CIRC || a.type === u.SHAPES.ELIP ? (0, p.default)(a, n, o) : a.type === u.SHAPES.RREC && (0, d.default)(a, n, o), i.lastIndex++ } this.renderer.bindVao(null); for (var h = 0; h < i.data.length; h++)(n = i.data[h]).dirty && n.upload() }, r.prototype.getWebGLData = function (t, e, i) { var r = t.data[t.data.length - 1]; return (!r || r.nativeLines !== i || 32e4 < r.points.length) && ((r = this.graphicsDataPool.pop() || new o.default(this.renderer.gl, this.primitiveShader, this.renderer.state.attribsState)).nativeLines = i, r.reset(e), t.data.push(r)), r.dirty = !0, r }, r }(n.default); e.default = t, i.default.registerPlugin("graphics", t) }, { "../../const": 46, "../../renderers/webgl/WebGLRenderer": 84, "../../renderers/webgl/utils/ObjectRenderer": 94, "../../utils": 125, "./WebGLGraphicsData": 58, "./shaders/PrimitiveShader": 59, "./utils/buildCircle": 60, "./utils/buildPoly": 62, "./utils/buildRectangle": 63, "./utils/buildRoundedRectangle": 64 }], 58: [function (t, e, i) { "use strict"; i.__esModule = !0; var t = t("pixi-gl-core"), r = (t = t) && t.__esModule ? t : { default: t }; function n(t, e, i) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); this.gl = t, this.color = [0, 0, 0], this.points = [], this.indices = [], this.buffer = r.default.GLBuffer.createVertexBuffer(t), this.indexBuffer = r.default.GLBuffer.createIndexBuffer(t), this.dirty = !0, this.nativeLines = !1, this.glPoints = null, this.glIndices = null, this.shader = e, this.vao = new r.default.VertexArrayObject(t, i).addIndex(this.indexBuffer).addAttribute(this.buffer, e.attributes.aVertexPosition, t.FLOAT, !1, 24, 0).addAttribute(this.buffer, e.attributes.aColor, t.FLOAT, !1, 24, 8) } n.prototype.reset = function () { this.points.length = 0, this.indices.length = 0 }, n.prototype.upload = function () { this.glPoints = new Float32Array(this.points), this.buffer.upload(this.glPoints), this.glIndices = new Uint16Array(this.indices), this.indexBuffer.upload(this.glIndices), this.dirty = !1 }, n.prototype.destroy = function () { this.color = null, this.points = null, this.indices = null, this.vao.destroy(), this.buffer.destroy(), this.indexBuffer.destroy(), this.gl = null, this.buffer = null, this.indexBuffer = null, this.glPoints = null, this.glIndices = null }, i.default = n }, { "pixi-gl-core": 15 }], 59: [function (t, e, i) { "use strict"; i.__esModule = !0; var t = t("../../../Shader"); t = function (i) { var t = r, e = i; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); var e = this, t = i.call(this, t, ["attribute vec2 aVertexPosition;", "attribute vec4 aColor;", "uniform mat3 translationMatrix;", "uniform mat3 projectionMatrix;", "uniform float alpha;", "uniform vec3 tint;", "varying vec4 vColor;", "void main(void){", "   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);", "   vColor = aColor * vec4(tint * alpha, alpha);", "}"].join("\n"), ["varying vec4 vColor;", "void main(void){", "   gl_FragColor = vColor;", "}"].join("\n")); if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), r }(((t = t) && t.__esModule ? t : { default: t }).default); i.default = t }, { "../../../Shader": 44 }], 60: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t, e, u) { var i = t.shape, c = i.x, f = i.y, r = void 0, n = void 0; n = t.type === b.SHAPES.CIRC ? (r = i.radius, i.radius) : (r = i.width, i.height); if (0 !== r && 0 !== n) { var d = Math.floor(30 * Math.sqrt(i.radius)) || Math.floor(15 * Math.sqrt(i.width + i.height)), o = 2 * Math.PI / d; if (t.fill) { var i = (0, x.hex2rgb)(t.fillColor), s = t.fillAlpha, p = i[0] * s, g = i[1] * s, v = i[2] * s, m = e.points, y = e.indices, a = m.length / 6; y.push(a); for (var h = 0; h < d + 1; h++)m.push(c, f, p, g, v, s), m.push(c + Math.sin(o * h) * r, f + Math.cos(o * h) * n, p, g, v, s), y.push(a++, a++); y.push(a - 1) } if (t.lineWidth) { i = t.points; t.points = []; for (var l = 0; l < d + 1; l++)t.points.push(c + Math.sin(o * -l) * r, f + Math.cos(o * -l) * n); (0, _.default)(t, e, u), t.points = i } } }; var i = t("./buildLine"), _ = (i = i) && i.__esModule ? i : { default: i }, b = t("../../../const"), x = t("../../../utils") }, { "../../../const": 46, "../../../utils": 125, "./buildLine": 61 }], 61: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (u, c, f) { if (u.nativeLines) { var d = u, p = 0, g = d.points; if (0 !== g.length) { var v = f.points, m = g.length / 2, f = (0, $.hex2rgb)(d.lineColor), y = d.lineAlpha, _ = f[0] * y, b = f[1] * y, x = f[2] * y; for (p = 1; p < m; p++) { var T = g[2 * (p - 1)], w = g[2 * (p - 1) + 1], S = g[2 * p], C = g[2 * p + 1]; v.push(T, w), v.push(_, b, x, y), v.push(S, C), v.push(_, b, x, y) } } } else { var d = u, f = c, t = d.points; if (0 !== t.length) { var u = new Q.Point(t[0], t[1]), c = new Q.Point(t[t.length - 2], t[t.length - 1]), e = (u.x === c.x && u.y === c.y && ((t = t.slice()).pop(), t.pop(), X = (c = new Q.Point(t[t.length - 2], t[t.length - 1])).x + .5 * (u.x - c.x), u = c.y + .5 * (u.y - c.y), t.unshift(X, u), t.push(X, u)), f.points), E = f.indices, O = t.length / 2, P = t.length, M = e.length / 6, i = d.lineWidth / 2, c = (0, $.hex2rgb)(d.lineColor), r = d.lineAlpha, A = c[0] * r, D = c[1] * r, R = c[2] * r, I = t[0], k = t[1], n = t[2], o = t[3], L = 0, j = 0, s = -(k - o), a = I - n, F = 0, B = 0, N = 0, U = 0, h = Math.sqrt(s * s + a * a), X = (s = s / h * i, a = a / h * i, d.lineAlignment), l = 2 * (1 - X), W = 2 * X; e.push(I - s * l, k - a * l, A, D, R, r), e.push(I + s * W, k + a * W, A, D, R, r); for (var G = 1; G < O - 1; ++G) { I = t[2 * (G - 1)], k = t[2 * (G - 1) + 1], n = t[2 * G], o = t[2 * G + 1], L = t[2 * (G + 1)], j = t[2 * (G + 1) + 1], s = -(k - o), a = I - n, h = Math.sqrt(s * s + a * a), s = s / h * i, a = a / h * i, F = -(o - j), B = n - L, h = Math.sqrt(F * F + B * B); var H = -a + k - (-a + o), Y = -s + n - (-s + I), V = (-s + I) * (-a + o) - (-s + n) * (-a + k), z = -(B = B / h * i) + j - (-B + o), q = -(F = F / h * i) + n - (-F + L), K = (-F + L) * (-B + o) - (-F + n) * (-B + j), Z = H * q - z * Y; Math.abs(Z) < .1 ? (Z += 10.1, e.push(n - s * l, o - a * l, A, D, R, r), e.push(n + s * W, o + a * W, A, D, R, r)) : 196 * i * i < ((Y = (Y * K - q * V) / Z) - n) * (Y - n) + ((q = (z * V - H * K) / Z) - o) * (q - o) ? (N = s - F, U = a - B, h = Math.sqrt(N * N + U * U), N = N / h * i, U = U / h * i, e.push(n - N * l, o - U * l), e.push(A, D, R, r), e.push(n + N * W, o + U * W), e.push(A, D, R, r), e.push(n - N * W * l, o - U * l), e.push(A, D, R, r), P++) : (e.push(n + (Y - n) * l, o + (q - o) * l), e.push(A, D, R, r), e.push(n - (Y - n) * W, o - (q - o) * W), e.push(A, D, R, r)) } I = t[2 * (O - 2)], k = t[2 * (O - 2) + 1], n = t[2 * (O - 1)], o = t[2 * (O - 1) + 1], s = -(k - o), a = I - n, h = Math.sqrt(s * s + a * a), s = s / h * i, a = a / h * i, e.push(n - s * l, o - a * l), e.push(A, D, R, r), e.push(n + s * W, o + a * W), e.push(A, D, R, r), E.push(M); for (var J = 0; J < P; ++J)E.push(M++); E.push(M - 1) } } }; var Q = t("../../../math"), $ = t("../../../utils") }, { "../../../math": 70, "../../../utils": 125 }], 62: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t, e, u) { t.points = t.shape.points.slice(); var i = t.points; if (t.fill && 6 <= i.length) { for (var c = [], f = t.holes, r = 0; r < f.length; r++) { var d = f[r]; c.push(i.length / 2), i = i.concat(d.points) } var p = e.points, n = e.indices, g = i.length / 2, v = (0, x.hex2rgb)(t.fillColor), o = t.fillAlpha, m = v[0] * o, y = v[1] * o, _ = v[2] * o, s = (0, T.default)(i, c, 2); if (!s) return; for (var a = p.length / 6, h = 0; h < s.length; h += 3)n.push(s[h] + a), n.push(s[h] + a), n.push(s[h + 1] + a), n.push(s[h + 2] + a), n.push(s[h + 2] + a); for (var l = 0; l < g; l++)p.push(i[2 * l], i[2 * l + 1], m, y, _, o) } 0 < t.lineWidth && (0, b.default)(t, e, u) }; var b = r(t("./buildLine")), x = t("../../../utils"), T = r(t("earcut")); function r(t) { return t && t.__esModule ? t : { default: t } } }, { "../../../utils": 125, "./buildLine": 61, earcut: 2 }], 63: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t, u, c) { var e = t.shape, i = e.x, r = e.y, f = e.width, e = e.height; { var n, o, s, a, d, h; t.fill && (a = (0, g.hex2rgb)(t.fillColor), n = t.fillAlpha, o = a[0] * n, s = a[1] * n, a = a[2] * n, l = u.points, d = u.indices, h = l.length / 6, l.push(i, r), l.push(o, s, a, n), l.push(i + f, r), l.push(o, s, a, n), l.push(i, r + e), l.push(o, s, a, n), l.push(i + f, r + e), l.push(o, s, a, n), d.push(h, h, 1 + h, 2 + h, 3 + h, 3 + h)) } { var l; t.lineWidth && (l = t.points, t.points = [i, r, i + f, r, i + f, r + e, i, r + e, i, r], (0, p.default)(t, u, c), t.points = l) } }; var i = t("./buildLine"), p = (i = i) && i.__esModule ? i : { default: i }, g = t("../../../utils") }, { "../../../utils": 125, "./buildLine": 61 }], 64: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t, u, c) { var e = t.shape, i = e.x, r = e.y, n = e.width, o = e.height, e = e.radius, s = []; if (s.push(i, r + e), S(i, r + o - e, i, r + o, i + e, r + o, s), S(i + n - e, r + o, i + n, r + o, i + n, r + o - e, s), S(i + n, r + e, i + n, r, i + n - e, r, s), S(i + e, r, i, r, i, r + e + 1e-10, s), t.fill) { for (var o = (0, w.hex2rgb)(t.fillColor), f = t.fillAlpha, d = o[0] * f, p = o[1] * f, g = o[2] * f, v = u.points, a = u.indices, m = v.length / 6, h = (0, x.default)(s, null, 2), l = 0, y = h.length; l < y; l += 3)a.push(h[l] + m), a.push(h[l] + m), a.push(h[l + 1] + m), a.push(h[l + 2] + m), a.push(h[l + 2] + m); for (var _ = 0, b = s.length; _ < b; _++)v.push(s[_], s[++_], d, p, g, f) } t.lineWidth && (n = t.points, t.points = s, (0, T.default)(t, u, c), t.points = n) }; var x = r(t("earcut")), T = r(t("./buildLine")), w = t("../../../utils"); function r(t) { return t && t.__esModule ? t : { default: t } } function p(t, e, i) { return t + (e - t) * i } function S(u, c, t, e, f, d, i) { for (var r, n, o, s, a, h = 6 < arguments.length && void 0 !== i ? i : [], l = 0; l <= 20; ++l)o = p(u, t, a = l / 20), r = p(c, e, a), s = p(t, f, a), n = p(e, d, a), o = p(o, s, a), s = p(r, n, a), h.push(o, s); return h } }, { "../../../utils": 125, "./buildLine": 61, earcut: 2 }], 65: [function (t, u, e) { "use strict"; e.__esModule = !0, e.autoDetectRenderer = e.Application = e.Filter = e.SpriteMaskFilter = e.Quad = e.RenderTarget = e.ObjectRenderer = e.WebGLManager = e.Shader = e.CanvasRenderTarget = e.TextureUvs = e.VideoBaseTexture = e.BaseRenderTexture = e.RenderTexture = e.BaseTexture = e.TextureMatrix = e.Texture = e.Spritesheet = e.CanvasGraphicsRenderer = e.GraphicsRenderer = e.GraphicsData = e.Graphics = e.TextMetrics = e.TextStyle = e.Text = e.SpriteRenderer = e.CanvasTinter = e.CanvasSpriteRenderer = e.Sprite = e.TransformBase = e.TransformStatic = e.Transform = e.Container = e.DisplayObject = e.Bounds = e.glCore = e.WebGLRenderer = e.CanvasRenderer = e.ticker = e.utils = e.settings = void 0; var i = t("./const"), r = (Object.keys(i).forEach(function (t) { "default" !== t && "__esModule" !== t && Object.defineProperty(e, t, { enumerable: !0, get: function () { return i[t] } }) }), t("./math")), n = (Object.keys(r).forEach(function (t) { "default" !== t && "__esModule" !== t && Object.defineProperty(e, t, { enumerable: !0, get: function () { return r[t] } }) }), t("pixi-gl-core")), o = (Object.defineProperty(e, "glCore", { enumerable: !0, get: function () { return l(n).default } }), t("./display/Bounds")), s = (Object.defineProperty(e, "Bounds", { enumerable: !0, get: function () { return l(o).default } }), t("./display/DisplayObject")), a = (Object.defineProperty(e, "DisplayObject", { enumerable: !0, get: function () { return l(s).default } }), t("./display/Container")), c = (Object.defineProperty(e, "Container", { enumerable: !0, get: function () { return l(a).default } }), t("./display/Transform")), f = (Object.defineProperty(e, "Transform", { enumerable: !0, get: function () { return l(c).default } }), t("./display/TransformStatic")), d = (Object.defineProperty(e, "TransformStatic", { enumerable: !0, get: function () { return l(f).default } }), t("./display/TransformBase")), p = (Object.defineProperty(e, "TransformBase", { enumerable: !0, get: function () { return l(d).default } }), t("./sprites/Sprite")), g = (Object.defineProperty(e, "Sprite", { enumerable: !0, get: function () { return l(p).default } }), t("./sprites/canvas/CanvasSpriteRenderer")), v = (Object.defineProperty(e, "CanvasSpriteRenderer", { enumerable: !0, get: function () { return l(g).default } }), t("./sprites/canvas/CanvasTinter")), m = (Object.defineProperty(e, "CanvasTinter", { enumerable: !0, get: function () { return l(v).default } }), t("./sprites/webgl/SpriteRenderer")), y = (Object.defineProperty(e, "SpriteRenderer", { enumerable: !0, get: function () { return l(m).default } }), t("./text/Text")), _ = (Object.defineProperty(e, "Text", { enumerable: !0, get: function () { return l(y).default } }), t("./text/TextStyle")), b = (Object.defineProperty(e, "TextStyle", { enumerable: !0, get: function () { return l(_).default } }), t("./text/TextMetrics")), x = (Object.defineProperty(e, "TextMetrics", { enumerable: !0, get: function () { return l(b).default } }), t("./graphics/Graphics")), T = (Object.defineProperty(e, "Graphics", { enumerable: !0, get: function () { return l(x).default } }), t("./graphics/GraphicsData")), w = (Object.defineProperty(e, "GraphicsData", { enumerable: !0, get: function () { return l(T).default } }), t("./graphics/webgl/GraphicsRenderer")), S = (Object.defineProperty(e, "GraphicsRenderer", { enumerable: !0, get: function () { return l(w).default } }), t("./graphics/canvas/CanvasGraphicsRenderer")), C = (Object.defineProperty(e, "CanvasGraphicsRenderer", { enumerable: !0, get: function () { return l(S).default } }), t("./textures/Spritesheet")), E = (Object.defineProperty(e, "Spritesheet", { enumerable: !0, get: function () { return l(C).default } }), t("./textures/Texture")), O = (Object.defineProperty(e, "Texture", { enumerable: !0, get: function () { return l(E).default } }), t("./textures/TextureMatrix")), P = (Object.defineProperty(e, "TextureMatrix", { enumerable: !0, get: function () { return l(O).default } }), t("./textures/BaseTexture")), M = (Object.defineProperty(e, "BaseTexture", { enumerable: !0, get: function () { return l(P).default } }), t("./textures/RenderTexture")), A = (Object.defineProperty(e, "RenderTexture", { enumerable: !0, get: function () { return l(M).default } }), t("./textures/BaseRenderTexture")), D = (Object.defineProperty(e, "BaseRenderTexture", { enumerable: !0, get: function () { return l(A).default } }), t("./textures/VideoBaseTexture")), R = (Object.defineProperty(e, "VideoBaseTexture", { enumerable: !0, get: function () { return l(D).default } }), t("./textures/TextureUvs")), I = (Object.defineProperty(e, "TextureUvs", { enumerable: !0, get: function () { return l(R).default } }), t("./renderers/canvas/utils/CanvasRenderTarget")), k = (Object.defineProperty(e, "CanvasRenderTarget", { enumerable: !0, get: function () { return l(I).default } }), t("./Shader")), L = (Object.defineProperty(e, "Shader", { enumerable: !0, get: function () { return l(k).default } }), t("./renderers/webgl/managers/WebGLManager")), j = (Object.defineProperty(e, "WebGLManager", { enumerable: !0, get: function () { return l(L).default } }), t("./renderers/webgl/utils/ObjectRenderer")), F = (Object.defineProperty(e, "ObjectRenderer", { enumerable: !0, get: function () { return l(j).default } }), t("./renderers/webgl/utils/RenderTarget")), B = (Object.defineProperty(e, "RenderTarget", { enumerable: !0, get: function () { return l(F).default } }), t("./renderers/webgl/utils/Quad")), N = (Object.defineProperty(e, "Quad", { enumerable: !0, get: function () { return l(B).default } }), t("./renderers/webgl/filters/spriteMask/SpriteMaskFilter")), U = (Object.defineProperty(e, "SpriteMaskFilter", { enumerable: !0, get: function () { return l(N).default } }), t("./renderers/webgl/filters/Filter")), X = (Object.defineProperty(e, "Filter", { enumerable: !0, get: function () { return l(U).default } }), t("./Application")), W = (Object.defineProperty(e, "Application", { enumerable: !0, get: function () { return l(X).default } }), t("./autoDetectRenderer")); Object.defineProperty(e, "autoDetectRenderer", { enumerable: !0, get: function () { return W.autoDetectRenderer } }); var G = h(t("./utils")), H = h(t("./ticker")), Y = l(t("./settings")), V = l(t("./renderers/canvas/CanvasRenderer")), t = l(t("./renderers/webgl/WebGLRenderer")); function h(t) { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } function l(t) { return t && t.__esModule ? t : { default: t } } e.settings = Y.default, e.utils = G, e.ticker = H, e.CanvasRenderer = V.default, e.WebGLRenderer = t.default }, { "./Application": 43, "./Shader": 44, "./autoDetectRenderer": 45, "./const": 46, "./display/Bounds": 47, "./display/Container": 48, "./display/DisplayObject": 49, "./display/Transform": 50, "./display/TransformBase": 51, "./display/TransformStatic": 52, "./graphics/Graphics": 53, "./graphics/GraphicsData": 54, "./graphics/canvas/CanvasGraphicsRenderer": 55, "./graphics/webgl/GraphicsRenderer": 57, "./math": 70, "./renderers/canvas/CanvasRenderer": 77, "./renderers/canvas/utils/CanvasRenderTarget": 79, "./renderers/webgl/WebGLRenderer": 84, "./renderers/webgl/filters/Filter": 86, "./renderers/webgl/filters/spriteMask/SpriteMaskFilter": 89, "./renderers/webgl/managers/WebGLManager": 93, "./renderers/webgl/utils/ObjectRenderer": 94, "./renderers/webgl/utils/Quad": 95, "./renderers/webgl/utils/RenderTarget": 96, "./settings": 101, "./sprites/Sprite": 102, "./sprites/canvas/CanvasSpriteRenderer": 103, "./sprites/canvas/CanvasTinter": 104, "./sprites/webgl/SpriteRenderer": 106, "./text/Text": 108, "./text/TextMetrics": 109, "./text/TextStyle": 110, "./textures/BaseRenderTexture": 111, "./textures/BaseTexture": 112, "./textures/RenderTexture": 113, "./textures/Spritesheet": 114, "./textures/Texture": 115, "./textures/TextureMatrix": 116, "./textures/TextureUvs": 117, "./textures/VideoBaseTexture": 118, "./ticker": 121, "./utils": 125, "pixi-gl-core": 15 }], 66: [function (t, u, c) { "use strict"; c.__esModule = !0; var t = t("./Matrix"), f = (t = t) && t.__esModule ? t : { default: t }; var e = [1, 1, 0, -1, -1, -1, 0, 1, 1, 1, 0, -1, -1, -1, 0, 1], i = [0, 1, 1, 1, 0, -1, -1, -1, 0, 1, 1, 1, 0, -1, -1, -1], r = [0, -1, -1, -1, 0, 1, 1, 1, 0, 1, 1, 1, 0, -1, -1, -1], n = [1, 1, 0, -1, -1, -1, 0, 1, -1, -1, 0, 1, 1, 1, 0, -1], d = [], p = []; function g(t) { return t < 0 ? -1 : 0 < t ? 1 : 0 } for (var o = 0; o < 16; o++) { var v = []; p.push(v); for (var s = 0; s < 16; s++)for (var m = g(e[o] * e[s] + r[o] * i[s]), y = g(i[o] * e[s] + n[o] * i[s]), _ = g(e[o] * r[s] + r[o] * n[s]), b = g(i[o] * r[s] + n[o] * n[s]), a = 0; a < 16; a++)if (e[a] === m && i[a] === y && r[a] === _ && n[a] === b) { v.push(a); break } } for (var h = 0; h < 16; h++) { var x = new f.default; x.set(e[h], i[h], r[h], n[h], 0, 0), d.push(x) } var l = { E: 0, SE: 1, S: 2, SW: 3, W: 4, NW: 5, N: 6, NE: 7, MIRROR_VERTICAL: 8, MIRROR_HORIZONTAL: 12, uX: function (t) { return e[t] }, uY: function (t) { return i[t] }, vX: function (t) { return r[t] }, vY: function (t) { return n[t] }, inv: function (t) { return 8 & t ? 15 & t : 7 & -t }, add: function (t, e) { return p[t][e] }, sub: function (t, e) { return p[t][l.inv(e)] }, rotate180: function (t) { return 4 ^ t }, isVertical: function (t) { return 2 == (3 & t) }, byDirection: function (t, e) { return 2 * Math.abs(t) <= Math.abs(e) ? 0 <= e ? l.S : l.N : 2 * Math.abs(e) <= Math.abs(t) ? 0 < t ? l.E : l.W : 0 < e ? 0 < t ? l.SE : l.SW : 0 < t ? l.NE : l.NW }, matrixAppendRotationInv: function (t, e) { var i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 0, r = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : 0, e = d[l.inv(e)]; e.tx = i, e.ty = r, t.append(e) } }; c.default = l }, { "./Matrix": 67 }], 67: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = t("./Point"), s = (o = o) && o.__esModule ? o : { default: o }, h = t("../const"); function l() { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 1, e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 0, i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 0, r = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : 1, n = 4 < arguments.length && void 0 !== arguments[4] ? arguments[4] : 0, o = 5 < arguments.length && void 0 !== arguments[5] ? arguments[5] : 0, s = this, a = l; if (!(s instanceof a)) throw new TypeError("Cannot call a class as a function"); this.a = t, this.b = e, this.c = i, this.d = r, this.tx = n, this.ty = o, this.array = null } l.prototype.fromArray = function (t) { this.a = t[0], this.b = t[1], this.c = t[3], this.d = t[4], this.tx = t[2], this.ty = t[5] }, l.prototype.set = function (t, e, i, r, n, o) { return this.a = t, this.b = e, this.c = i, this.d = r, this.tx = n, this.ty = o, this }, l.prototype.toArray = function (t, e) { this.array || (this.array = new Float32Array(9)); e = e || this.array; return t ? (e[0] = this.a, e[1] = this.b, e[2] = 0, e[3] = this.c, e[4] = this.d, e[5] = 0, e[6] = this.tx, e[7] = this.ty) : (e[0] = this.a, e[1] = this.c, e[2] = this.tx, e[3] = this.b, e[4] = this.d, e[5] = this.ty, e[6] = 0, e[7] = 0), e[8] = 1, e }, l.prototype.apply = function (t, e) { e = e || new s.default; var i = t.x, t = t.y; return e.x = this.a * i + this.c * t + this.tx, e.y = this.b * i + this.d * t + this.ty, e }, l.prototype.applyInverse = function (t, e) { e = e || new s.default; var i = 1 / (this.a * this.d + this.c * -this.b), r = t.x, t = t.y; return e.x = this.d * i * r + -this.c * i * t + (this.ty * this.c - this.tx * this.d) * i, e.y = this.a * i * t + -this.b * i * r + (-this.ty * this.a + this.tx * this.b) * i, e }, l.prototype.translate = function (t, e) { return this.tx += t, this.ty += e, this }, l.prototype.scale = function (t, e) { return this.a *= t, this.d *= e, this.c *= t, this.b *= e, this.tx *= t, this.ty *= e, this }, l.prototype.rotate = function (t) { var e = Math.cos(t), t = Math.sin(t), i = this.a, r = this.c, n = this.tx; return this.a = i * e - this.b * t, this.b = i * t + this.b * e, this.c = r * e - this.d * t, this.d = r * t + this.d * e, this.tx = n * e - this.ty * t, this.ty = n * t + this.ty * e, this }, l.prototype.append = function (t) { var e = this.a, i = this.b, r = this.c, n = this.d; return this.a = t.a * e + t.b * r, this.b = t.a * i + t.b * n, this.c = t.c * e + t.d * r, this.d = t.c * i + t.d * n, this.tx = t.tx * e + t.ty * r + this.tx, this.ty = t.tx * i + t.ty * n + this.ty, this }, l.prototype.setTransform = function (t, e, i, r, n, o, s, a, h) { return this.a = Math.cos(s + h) * n, this.b = Math.sin(s + h) * n, this.c = -Math.sin(s - a) * o, this.d = Math.cos(s - a) * o, this.tx = t - (i * this.a + r * this.c), this.ty = e - (i * this.b + r * this.d), this }, l.prototype.prepend = function (t) { var e, i, r = this.tx; return 1 === t.a && 0 === t.b && 0 === t.c && 1 === t.d || (e = this.a, i = this.c, this.a = e * t.a + this.b * t.c, this.b = e * t.b + this.b * t.d, this.c = i * t.a + this.d * t.c, this.d = i * t.b + this.d * t.d), this.tx = r * t.a + this.ty * t.c + t.tx, this.ty = r * t.b + this.ty * t.d + t.ty, this }, l.prototype.decompose = function (t) { var e = this.a, i = this.b, r = this.c, n = this.d, o = -Math.atan2(-r, n), s = Math.atan2(i, e), a = Math.abs(o + s); return a < 1e-5 || Math.abs(h.PI_2 - a) < 1e-5 ? (t.rotation = s, e < 0 && 0 <= n && (t.rotation += t.rotation <= 0 ? Math.PI : -Math.PI), t.skew.x = t.skew.y = 0) : (t.rotation = 0, t.skew.x = o, t.skew.y = s), t.scale.x = Math.sqrt(e * e + i * i), t.scale.y = Math.sqrt(r * r + n * n), t.position.x = this.tx, t.position.y = this.ty, t }, l.prototype.invert = function () { var t = this.a, e = this.b, i = this.c, r = this.d, n = this.tx, o = t * r - e * i; return this.a = r / o, this.b = -e / o, this.c = -i / o, this.d = t / o, this.tx = (i * this.ty - r * n) / o, this.ty = -(t * this.ty - e * n) / o, this }, l.prototype.identity = function () { return this.a = 1, this.b = 0, this.c = 0, this.d = 1, this.tx = 0, this.ty = 0, this }, l.prototype.clone = function () { var t = new l; return t.a = this.a, t.b = this.b, t.c = this.c, t.d = this.d, t.tx = this.tx, t.ty = this.ty, t }, l.prototype.copy = function (t) { return t.a = this.a, t.b = this.b, t.c = this.c, t.d = this.d, t.tx = this.tx, t.ty = this.ty, t }, r(l, null, [{ key: "IDENTITY", get: function () { return new l } }, { key: "TEMP_MATRIX", get: function () { return new l } }]), i.default = l }, { "../const": 46, "./Point": 69 }], 68: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } function s(t, e) { var i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 0, r = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : 0, n = this, o = s; if (!(n instanceof o)) throw new TypeError("Cannot call a class as a function"); this._x = i, this._y = r, this.cb = t, this.scope = e } s.prototype.set = function (t, e) { t = t || 0, e = e || (0 !== e ? t : 0); this._x === t && this._y === e || (this._x = t, this._y = e, this.cb.call(this.scope)) }, s.prototype.copy = function (t) { this._x === t.x && this._y === t.y || (this._x = t.x, this._y = t.y, this.cb.call(this.scope)) }, r(s, [{ key: "x", get: function () { return this._x }, set: function (t) { this._x !== t && (this._x = t, this.cb.call(this.scope)) } }, { key: "y", get: function () { return this._y }, set: function (t) { this._y !== t && (this._y = t, this.cb.call(this.scope)) } }]), i.default = s }, {}], 69: [function (t, e, i) { "use strict"; function n() { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 0, e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 0, i = this, r = n; if (!(i instanceof r)) throw new TypeError("Cannot call a class as a function"); this.x = t, this.y = e } i.__esModule = !0, n.prototype.clone = function () { return new n(this.x, this.y) }, n.prototype.copy = function (t) { this.set(t.x, t.y) }, n.prototype.equals = function (t) { return t.x === this.x && t.y === this.y }, n.prototype.set = function (t, e) { this.x = t || 0, this.y = e || (0 !== e ? this.x : 0) }, i.default = n }, {}], 70: [function (t, u, e) { "use strict"; e.__esModule = !0; var i = t("./Point"), r = (Object.defineProperty(e, "Point", { enumerable: !0, get: function () { return l(i).default } }), t("./ObservablePoint")), n = (Object.defineProperty(e, "ObservablePoint", { enumerable: !0, get: function () { return l(r).default } }), t("./Matrix")), o = (Object.defineProperty(e, "Matrix", { enumerable: !0, get: function () { return l(n).default } }), t("./GroupD8")), s = (Object.defineProperty(e, "GroupD8", { enumerable: !0, get: function () { return l(o).default } }), t("./shapes/Circle")), a = (Object.defineProperty(e, "Circle", { enumerable: !0, get: function () { return l(s).default } }), t("./shapes/Ellipse")), h = (Object.defineProperty(e, "Ellipse", { enumerable: !0, get: function () { return l(a).default } }), t("./shapes/Polygon")), c = (Object.defineProperty(e, "Polygon", { enumerable: !0, get: function () { return l(h).default } }), t("./shapes/Rectangle")), f = (Object.defineProperty(e, "Rectangle", { enumerable: !0, get: function () { return l(c).default } }), t("./shapes/RoundedRectangle")); function l(t) { return t && t.__esModule ? t : { default: t } } Object.defineProperty(e, "RoundedRectangle", { enumerable: !0, get: function () { return l(f).default } }) }, { "./GroupD8": 66, "./Matrix": 67, "./ObservablePoint": 68, "./Point": 69, "./shapes/Circle": 71, "./shapes/Ellipse": 72, "./shapes/Polygon": 73, "./shapes/Rectangle": 74, "./shapes/RoundedRectangle": 75 }], 71: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("./Rectangle"), n = (r = r) && r.__esModule ? r : { default: r }, o = t("../../const"); function s() { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 0, e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 0, i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 0, r = this, n = s; if (!(r instanceof n)) throw new TypeError("Cannot call a class as a function"); this.x = t, this.y = e, this.radius = i, this.type = o.SHAPES.CIRC } s.prototype.clone = function () { return new s(this.x, this.y, this.radius) }, s.prototype.contains = function (t, e) { if (this.radius <= 0) return !1; var i = this.radius * this.radius, t = this.x - t, e = this.y - e; return (t *= t) + (e *= e) <= i }, s.prototype.getBounds = function () { return new n.default(this.x - this.radius, this.y - this.radius, 2 * this.radius, 2 * this.radius) }, i.default = s }, { "../../const": 46, "./Rectangle": 74 }], 72: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("./Rectangle"), n = (r = r) && r.__esModule ? r : { default: r }, s = t("../../const"); function a() { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 0, e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 0, i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 0, r = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : 0, n = this, o = a; if (!(n instanceof o)) throw new TypeError("Cannot call a class as a function"); this.x = t, this.y = e, this.width = i, this.height = r, this.type = s.SHAPES.ELIP } a.prototype.clone = function () { return new a(this.x, this.y, this.width, this.height) }, a.prototype.contains = function (t, e) { if (this.width <= 0 || this.height <= 0) return !1; t = (t - this.x) / this.width, e = (e - this.y) / this.height; return (t *= t) + (e *= e) <= 1 }, a.prototype.getBounds = function () { return new n.default(this.x - this.width, this.y - this.height, this.width, this.height) }, i.default = a }, { "../../const": 46, "./Rectangle": 74 }], 73: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("../Point"), h = (r = r) && r.__esModule ? r : { default: r }, l = t("../../const"); function u() { for (var t = arguments.length, e = Array(t), i = 0; i < t; i++)e[i] = arguments[i]; var r = this, n = u; if (!(r instanceof n)) throw new TypeError("Cannot call a class as a function"); if ((e = Array.isArray(e[0]) ? e[0] : e)[0] instanceof h.default) { for (var o = [], s = 0, a = e.length; s < a; s++)o.push(e[s].x, e[s].y); e = o } this.closed = !0, this.points = e, this.type = l.SHAPES.POLY } u.prototype.clone = function () { return new u(this.points.slice()) }, u.prototype.close = function () { var t = this.points; t[0] === t[t.length - 2] && t[1] === t[t.length - 1] || t.push(t[0], t[1]) }, u.prototype.contains = function (t, e) { for (var i = !1, r = this.points.length / 2, n = 0, o = r - 1; n < r; o = n++) { var s = this.points[2 * n], a = this.points[2 * n + 1], h = this.points[2 * o], l = this.points[2 * o + 1]; e < a != e < l && t < (e - a) / (l - a) * (h - s) + s && (i = !i) } return i }, i.default = u }, { "../../const": 46, "../Point": 69 }], 74: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var s = t("../../const"); function a() { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 0, e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 0, i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 0, r = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : 0, n = this, o = a; if (!(n instanceof o)) throw new TypeError("Cannot call a class as a function"); this.x = Number(t), this.y = Number(e), this.width = Number(i), this.height = Number(r), this.type = s.SHAPES.RECT } a.prototype.clone = function () { return new a(this.x, this.y, this.width, this.height) }, a.prototype.copy = function (t) { return this.x = t.x, this.y = t.y, this.width = t.width, this.height = t.height, this }, a.prototype.contains = function (t, e) { return !(this.width <= 0 || this.height <= 0) && (t >= this.x && t < this.x + this.width && e >= this.y && e < this.y + this.height) }, a.prototype.pad = function (t, e) { t = t || 0, e = e || (0 !== e ? t : 0), this.x -= t, this.y -= e, this.width += 2 * t, this.height += 2 * e }, a.prototype.fit = function (t) { this.x < t.x && (this.width += this.x, this.width < 0 && (this.width = 0), this.x = t.x), this.y < t.y && (this.height += this.y, this.height < 0 && (this.height = 0), this.y = t.y), this.x + this.width > t.x + t.width && (this.width = t.width - this.x, this.width < 0 && (this.width = 0)), this.y + this.height > t.y + t.height && (this.height = t.height - this.y, this.height < 0 && (this.height = 0)) }, a.prototype.enlarge = function (t) { var e = Math.min(this.x, t.x), i = Math.max(this.x + this.width, t.x + t.width), r = Math.min(this.y, t.y), t = Math.max(this.y + this.height, t.y + t.height); this.x = e, this.width = i - e, this.y = r, this.height = t - r }, r(a, [{ key: "left", get: function () { return this.x } }, { key: "right", get: function () { return this.x + this.width } }, { key: "top", get: function () { return this.y } }, { key: "bottom", get: function () { return this.y + this.height } }], [{ key: "EMPTY", get: function () { return new a(0, 0, 0, 0) } }]), i.default = a }, { "../../const": 46 }], 75: [function (t, e, i) { "use strict"; i.__esModule = !0; var a = t("../../const"); function h() { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 0, e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 0, i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 0, r = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : 0, n = 4 < arguments.length && void 0 !== arguments[4] ? arguments[4] : 20, o = this, s = h; if (!(o instanceof s)) throw new TypeError("Cannot call a class as a function"); this.x = t, this.y = e, this.width = i, this.height = r, this.radius = n, this.type = a.SHAPES.RREC } h.prototype.clone = function () { return new h(this.x, this.y, this.width, this.height, this.radius) }, h.prototype.contains = function (t, e) { if (this.width <= 0 || this.height <= 0) return !1; if (t >= this.x && t <= this.x + this.width && e >= this.y && e <= this.y + this.height) { if (e >= this.y + this.radius && e <= this.y + this.height - this.radius || t >= this.x + this.radius && t <= this.x + this.width - this.radius) return !0; var i = t - (this.x + this.radius), r = e - (this.y + this.radius), n = this.radius * this.radius; if (i * i + r * r <= n) return !0; if ((i = t - (this.x + this.width - this.radius)) * i + r * r <= n) return !0; if (i * i + (r = e - (this.y + this.height - this.radius)) * r <= n) return !0; if ((i = t - (this.x + this.radius)) * i + r * r <= n) return !0 } return !1 }, i.default = h }, { "../../const": 46 }], 76: [function (t, o, e) { "use strict"; e.__esModule = !0; var i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var a = t("../utils"), h = t("../math"), l = t("../const"), u = n(t("../settings")), f = n(t("../display/Container")), d = n(t("../textures/RenderTexture")), t = n(t("eventemitter3")); function n(t) { return t && t.__esModule ? t : { default: t } } var c = new h.Matrix, t = function (o) { var t = s, e = o; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function s(t, e, i, r) { if (!(this instanceof s)) throw new TypeError("Cannot call a class as a function"); var n = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, o.call(this)); return (0, a.sayHello)(t), "number" == typeof e && (e = Object.assign({ width: e, height: i || u.default.RENDER_OPTIONS.height }, r)), e = Object.assign({}, u.default.RENDER_OPTIONS, e), n.options = e, n.type = l.RENDERER_TYPE.UNKNOWN, n.screen = new h.Rectangle(0, 0, e.width, e.height), n.view = e.view || document.createElement("canvas"), n.resolution = e.resolution || u.default.RESOLUTION, n.transparent = e.transparent, n.autoResize = e.autoResize || !1, n.blendModes = null, n.preserveDrawingBuffer = e.preserveDrawingBuffer, n.clearBeforeRender = e.clearBeforeRender, n.roundPixels = e.roundPixels, n._backgroundColor = 0, n._backgroundColorRgba = [0, 0, 0, 0], n._backgroundColorString = "#000000", n.backgroundColor = e.backgroundColor || n._backgroundColor, n._tempDisplayObjectParent = new f.default, n._lastObjectRendered = n._tempDisplayObjectParent, n } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), s.prototype.resize = function (t, e) { this.screen.width = t, this.screen.height = e, this.view.width = t * this.resolution, this.view.height = e * this.resolution, this.autoResize && (this.view.style.width = t + "px", this.view.style.height = e + "px") }, s.prototype.generateTexture = function (t, e, i, r) { r = r || t.getLocalBounds(); e = d.default.create(0 | r.width, 0 | r.height, e, i); return c.tx = -r.x, c.ty = -r.y, this.render(t, e, !1, c, !0), e }, s.prototype.destroy = function (t) { t && this.view.parentNode && this.view.parentNode.removeChild(this.view), this.type = l.RENDERER_TYPE.UNKNOWN, this.view = null, this.screen = null, this.resolution = 0, this.transparent = !1, this.autoResize = !1, this.blendModes = null, this.options = null, this.preserveDrawingBuffer = !1, this.clearBeforeRender = !1, this.roundPixels = !1, this._backgroundColor = 0, this._backgroundColorRgba = null, this._backgroundColorString = null, this._tempDisplayObjectParent = null, this._lastObjectRendered = null }, i(s, [{ key: "width", get: function () { return this.view.width } }, { key: "height", get: function () { return this.view.height } }, { key: "backgroundColor", get: function () { return this._backgroundColor }, set: function (t) { this._backgroundColor = t, this._backgroundColorString = (0, a.hex2string)(t), (0, a.hex2rgb)(t, this._backgroundColorRgba) } }]), s }(t.default); e.default = t }, { "../const": 46, "../display/Container": 48, "../math": 70, "../settings": 101, "../textures/RenderTexture": 113, "../utils": 125, eventemitter3: 3 }], 77: [function (t, u, e) { "use strict"; e.__esModule = !0; var i = n(t("../SystemRenderer")), o = n(t("./utils/CanvasMaskManager")), a = n(t("./utils/CanvasRenderTarget")), s = n(t("./utils/mapCanvasBlendModesToPixi")), r = t("../../utils"), h = t("../../const"), l = n(t("../../settings")); function n(t) { return t && t.__esModule ? t : { default: t } } t = function (r) { var t = n, e = r; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function n(t, e, i) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, r.call(this, "Canvas", t, e, i)); return t.type = h.RENDERER_TYPE.CANVAS, t.rootContext = t.view.getContext("2d", { alpha: t.transparent }), t.context = t.rootContext, t.refresh = !0, t.maskManager = new o.default(t), t.smoothProperty = "imageSmoothingEnabled", t.rootContext.imageSmoothingEnabled || (t.rootContext.webkitImageSmoothingEnabled ? t.smoothProperty = "webkitImageSmoothingEnabled" : t.rootContext.mozImageSmoothingEnabled ? t.smoothProperty = "mozImageSmoothingEnabled" : t.rootContext.oImageSmoothingEnabled ? t.smoothProperty = "oImageSmoothingEnabled" : t.rootContext.msImageSmoothingEnabled && (t.smoothProperty = "msImageSmoothingEnabled")), t.initPlugins(), t.blendModes = (0, s.default)(), t._activeBlendMode = null, t.renderingToScreen = !1, t.resize(t.options.width, t.options.height), t } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), n.prototype.render = function (t, e, i, r, n) { var o, s; this.view && (this.renderingToScreen = !e, this.emit("prerender"), o = this.resolution, e ? ((e = e.baseTexture || e)._canvasRenderTarget || (e._canvasRenderTarget = new a.default(e.width, e.height, e.resolution), e.source = e._canvasRenderTarget.canvas, e.valid = !0), this.context = e._canvasRenderTarget.context, this.resolution = e._canvasRenderTarget.resolution) : this.context = this.rootContext, s = this.context, e || (this._lastObjectRendered = t), n || (e = t.parent, n = this._tempDisplayObjectParent.transform.worldTransform, r ? (r.copy(n), this._tempDisplayObjectParent.transform._worldID = -1) : n.identity(), t.parent = this._tempDisplayObjectParent, t.updateTransform(), t.parent = e), s.save(), s.setTransform(1, 0, 0, 1, 0, 0), s.globalAlpha = 1, this._activeBlendMode = h.BLEND_MODES.NORMAL, s.globalCompositeOperation = this.blendModes[h.BLEND_MODES.NORMAL], navigator.isCocoonJS && this.view.screencanvas && (s.fillStyle = "black", s.clear()), (void 0 !== i ? i : this.clearBeforeRender) && this.renderingToScreen && (this.transparent ? s.clearRect(0, 0, this.width, this.height) : (s.fillStyle = this._backgroundColorString, s.fillRect(0, 0, this.width, this.height))), r = this.context, this.context = s, t.renderCanvas(this), this.context = r, s.restore(), this.resolution = o, this.emit("postrender")) }, n.prototype.clear = function (t) { var e = this.context; t = t || this._backgroundColorString, !this.transparent && t ? (e.fillStyle = t, e.fillRect(0, 0, this.width, this.height)) : e.clearRect(0, 0, this.width, this.height) }, n.prototype.setBlendMode = function (t) { this._activeBlendMode !== t && (this._activeBlendMode = t, this.context.globalCompositeOperation = this.blendModes[t]) }, n.prototype.destroy = function (t) { this.destroyPlugins(), r.prototype.destroy.call(this, t), this.context = null, this.refresh = !0, this.maskManager.destroy(), this.maskManager = null, this.smoothProperty = null }, n.prototype.resize = function (t, e) { r.prototype.resize.call(this, t, e), this.smoothProperty && (this.rootContext[this.smoothProperty] = l.default.SCALE_MODE === h.SCALE_MODES.LINEAR) }, n.prototype.invalidateBlendMode = function () { this._activeBlendMode = this.blendModes.indexOf(this.context.globalCompositeOperation) }, n }(i.default); e.default = t, r.pluginTarget.mixin(t) }, { "../../const": 46, "../../settings": 101, "../../utils": 125, "../SystemRenderer": 76, "./utils/CanvasMaskManager": 78, "./utils/CanvasRenderTarget": 79, "./utils/mapCanvasBlendModesToPixi": 81 }], 78: [function (t, e, i) { "use strict"; i.__esModule = !0; var v = t("../../../const"); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); this.renderer = t } r.prototype.pushMask = function (t) { var e = this.renderer, i = (e.context.save(), t.alpha), r = t.transform.worldTransform, n = e.resolution; e.context.setTransform(r.a * n, r.b * n, r.c * n, r.d * n, r.tx * n, r.ty * n), t._texture || (this.renderGraphicsShape(t), e.context.clip()), t.worldAlpha = i }, r.prototype.renderGraphicsShape = function (u) { var t = this.renderer.context, c = u.graphicsData.length; if (0 !== c) { t.beginPath(); for (var f = 0; f < c; f++) { var d, e, i, r, n, o, s, a, p = u.graphicsData[f], h = p.shape; if (p.type === v.SHAPES.POLY) { var l = h.points; t.moveTo(l[0], l[1]); for (var g = 1; g < l.length / 2; g++)t.lineTo(l[2 * g], l[2 * g + 1]); l[0] === l[l.length - 2] && l[1] === l[l.length - 1] && t.closePath() } else p.type === v.SHAPES.RECT ? (t.rect(h.x, h.y, h.width, h.height), t.closePath()) : p.type === v.SHAPES.CIRC ? (t.arc(h.x, h.y, h.radius, 0, 2 * Math.PI), t.closePath()) : p.type === v.SHAPES.ELIP ? (o = (n = 2 * h.width) / 2 * .5522848, s = (e = 2 * h.height) / 2 * .5522848, r = (d = h.x - n / 2) + n, a = (i = h.y - e / 2) + e, n = d + n / 2, t.moveTo(d, e = i + e / 2), t.bezierCurveTo(d, e - s, n - o, i, n, i), t.bezierCurveTo(n + o, i, r, e - s, r, e), t.bezierCurveTo(r, e + s, n + o, a, n, a), t.bezierCurveTo(n - o, a, d, e + s, d, e), t.closePath()) : p.type === v.SHAPES.RREC && (i = h.x, r = h.y, n = h.width, o = h.height, a = h.radius, s = Math.min(n, o) / 2 | 0, t.moveTo(i, r + (a = s < a ? s : a)), t.lineTo(i, r + o - a), t.quadraticCurveTo(i, r + o, i + a, r + o), t.lineTo(i + n - a, r + o), t.quadraticCurveTo(i + n, r + o, i + n, r + o - a), t.lineTo(i + n, r + a), t.quadraticCurveTo(i + n, r, i + n - a, r), t.lineTo(i + a, r), t.quadraticCurveTo(i, r, i, r + a), t.closePath()) } } }, r.prototype.popMask = function (t) { t.context.restore(), t.invalidateBlendMode() }, r.prototype.destroy = function () { }, i.default = r }, { "../../../const": 46 }], 79: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var t = t("../../../settings"), o = (t = t) && t.__esModule ? t : { default: t }; function s(t, e, i) { if (!(this instanceof s)) throw new TypeError("Cannot call a class as a function"); this.canvas = document.createElement("canvas"), this.context = this.canvas.getContext("2d"), this.resolution = i || o.default.RESOLUTION, this.resize(t, e) } s.prototype.clear = function () { this.context.setTransform(1, 0, 0, 1, 0, 0), this.context.clearRect(0, 0, this.canvas.width, this.canvas.height) }, s.prototype.resize = function (t, e) { this.canvas.width = t * this.resolution, this.canvas.height = e * this.resolution }, s.prototype.destroy = function () { this.context = null, this.canvas = null }, r(s, [{ key: "width", get: function () { return this.canvas.width }, set: function (t) { this.canvas.width = t } }, { key: "height", get: function () { return this.canvas.height }, set: function (t) { this.canvas.height = t } }]), i.default = s }, { "../../../settings": 101 }], 80: [function (t, e, i) { "use strict"; function r(t) { var e = document.createElement("canvas"), i = (e.width = 6, e.height = 1, e.getContext("2d")); return i.fillStyle = t, i.fillRect(0, 0, 6, 1), e } i.__esModule = !0, i.default = function () { if ("undefined" == typeof document) return !1; var t = r("#ff00ff"), e = r("#ffff00"), i = document.createElement("canvas"), i = (i.width = 6, i.height = 1, i.getContext("2d")), t = (i.globalCompositeOperation = "multiply", i.drawImage(t, 0, 0), i.drawImage(e, 2, 0), i.getImageData(2, 0, 1, 1)); if (!t) return !1; e = t.data; return 255 === e[0] && 0 === e[1] && 0 === e[2] } }, {}], 81: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function () { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : []; (0, n.default)() ? (t[r.BLEND_MODES.NORMAL] = "source-over", t[r.BLEND_MODES.ADD] = "lighter", t[r.BLEND_MODES.MULTIPLY] = "multiply", t[r.BLEND_MODES.SCREEN] = "screen", t[r.BLEND_MODES.OVERLAY] = "overlay", t[r.BLEND_MODES.DARKEN] = "darken", t[r.BLEND_MODES.LIGHTEN] = "lighten", t[r.BLEND_MODES.COLOR_DODGE] = "color-dodge", t[r.BLEND_MODES.COLOR_BURN] = "color-burn", t[r.BLEND_MODES.HARD_LIGHT] = "hard-light", t[r.BLEND_MODES.SOFT_LIGHT] = "soft-light", t[r.BLEND_MODES.DIFFERENCE] = "difference", t[r.BLEND_MODES.EXCLUSION] = "exclusion", t[r.BLEND_MODES.HUE] = "hue", t[r.BLEND_MODES.SATURATION] = "saturate", t[r.BLEND_MODES.COLOR] = "color", t[r.BLEND_MODES.LUMINOSITY] = "luminosity") : (t[r.BLEND_MODES.NORMAL] = "source-over", t[r.BLEND_MODES.ADD] = "lighter", t[r.BLEND_MODES.MULTIPLY] = "source-over", t[r.BLEND_MODES.SCREEN] = "source-over", t[r.BLEND_MODES.OVERLAY] = "source-over", t[r.BLEND_MODES.DARKEN] = "source-over", t[r.BLEND_MODES.LIGHTEN] = "source-over", t[r.BLEND_MODES.COLOR_DODGE] = "source-over", t[r.BLEND_MODES.COLOR_BURN] = "source-over", t[r.BLEND_MODES.HARD_LIGHT] = "source-over", t[r.BLEND_MODES.SOFT_LIGHT] = "source-over", t[r.BLEND_MODES.DIFFERENCE] = "source-over", t[r.BLEND_MODES.EXCLUSION] = "source-over", t[r.BLEND_MODES.HUE] = "source-over", t[r.BLEND_MODES.SATURATION] = "source-over", t[r.BLEND_MODES.COLOR] = "source-over", t[r.BLEND_MODES.LUMINOSITY] = "source-over"); return t[r.BLEND_MODES.NORMAL_NPM] = t[r.BLEND_MODES.NORMAL], t[r.BLEND_MODES.ADD_NPM] = t[r.BLEND_MODES.ADD], t[r.BLEND_MODES.SCREEN_NPM] = t[r.BLEND_MODES.SCREEN], t }; var r = t("../../../const"), i = t("./canUseNewCanvasBlendModes"), n = (t = i) && t.__esModule ? t : { default: t } }, { "../../../const": 46, "./canUseNewCanvasBlendModes": 80 }], 82: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("../../const"), t = t("../../settings"), n = (t = t) && t.__esModule ? t : { default: t }; function o(t) { if (!(this instanceof o)) throw new TypeError("Cannot call a class as a function"); this.renderer = t, this.count = 0, this.checkCount = 0, this.maxIdle = n.default.GC_MAX_IDLE, this.checkCountMax = n.default.GC_MAX_CHECK_COUNT, this.mode = n.default.GC_MODE } o.prototype.update = function () { this.count++, this.mode !== r.GC_MODES.MANUAL && (this.checkCount++, this.checkCount > this.checkCountMax && (this.checkCount = 0, this.run())) }, o.prototype.run = function () { for (var t = this.renderer.textureManager, e = t._managedTextures, i = !1, r = 0; r < e.length; r++) { var n = e[r]; !n._glRenderTargets && this.count - n.touched > this.maxIdle && (t.destroyTexture(n, !0), i = !(e[r] = null)) } if (i) { for (var o = 0, s = 0; s < e.length; s++)null !== e[s] && (e[o++] = e[s]); e.length = o } }, o.prototype.unload = function (t) { var e = this.renderer.textureManager; t._texture && t._texture._glRenderTargets && e.destroyTexture(t._texture, !0); for (var i = t.children.length - 1; 0 <= i; i--)this.unload(t.children[i]) }, i.default = o }, { "../../const": 46, "../../settings": 101 }], 83: [function (t, e, i) { "use strict"; i.__esModule = !0; var s = t("pixi-gl-core"), a = t("../../const"), r = t("./utils/RenderTarget"), h = (r = r) && r.__esModule ? r : { default: r }, o = t("../../utils"); function n(t) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); this.renderer = t, this.gl = t.gl, this._managedTextures = [] } n.prototype.bindTexture = function () { }, n.prototype.getTexture = function () { }, n.prototype.updateTexture = function (t, e) { var i = this.gl, r = !!t._glRenderTargets; if (!t.hasLoaded) return null; var n = this.renderer.boundTextures; if (void 0 === e) for (var o = e = 0; o < n.length; ++o)if (n[o] === t) { e = o; break } n[e] = t, i.activeTexture(i.TEXTURE0 + e); i = t._glTextures[this.renderer.CONTEXT_UID]; return i ? r ? t._glRenderTargets[this.renderer.CONTEXT_UID].resize(t.width, t.height) : i.upload(t.source) : (r ? ((r = new h.default(this.gl, t.width, t.height, t.scaleMode, t.resolution)).resize(t.width, t.height), i = (t._glRenderTargets[this.renderer.CONTEXT_UID] = r).texture) : ((i = new s.GLTexture(this.gl, null, null, null, null)).bind(e), i.premultiplyAlpha = !0, i.upload(t.source)), t._glTextures[this.renderer.CONTEXT_UID] = i, t.on("update", this.updateTexture, this), t.on("dispose", this.destroyTexture, this), this._managedTextures.push(t), t.isPowerOfTwo ? (t.mipmap && i.enableMipmap(), t.wrapMode === a.WRAP_MODES.CLAMP ? i.enableWrapClamp() : t.wrapMode === a.WRAP_MODES.REPEAT ? i.enableWrapRepeat() : i.enableWrapMirrorRepeat()) : i.enableWrapClamp(), t.scaleMode === a.SCALE_MODES.NEAREST ? i.enableNearestScaling() : i.enableLinearScaling()), i }, n.prototype.destroyTexture = function (t, e) { var i, r, n; (t = t.baseTexture || t).hasLoaded && (i = this.renderer.CONTEXT_UID, n = t._glTextures, r = t._glRenderTargets, n[i] && (this.renderer.unbindTexture(t), n[i].destroy(), t.off("update", this.updateTexture, this), t.off("dispose", this.destroyTexture, this), delete n[i], e || -1 !== (n = this._managedTextures.indexOf(t)) && (0, o.removeItems)(this._managedTextures, n, 1)), r && r[i] && (r[i].destroy(), delete r[i])) }, n.prototype.removeAll = function () { for (var t = 0; t < this._managedTextures.length; ++t) { var e = this._managedTextures[t]; e._glTextures[this.renderer.CONTEXT_UID] && delete e._glTextures[this.renderer.CONTEXT_UID] } }, n.prototype.destroy = function () { for (var t = 0; t < this._managedTextures.length; ++t) { var e = this._managedTextures[t]; this.destroyTexture(e, !0), e.off("update", this.updateTexture, this), e.off("dispose", this.destroyTexture, this) } this._managedTextures = null }, i.default = n }, { "../../const": 46, "../../utils": 125, "./utils/RenderTarget": 96, "pixi-gl-core": 15 }], 84: [function (t, n, e) { "use strict"; e.__esModule = !0; var i = r(t("../SystemRenderer")), o = r(t("./managers/MaskManager")), s = r(t("./managers/StencilManager")), a = r(t("./managers/FilterManager")), h = r(t("./utils/RenderTarget")), l = r(t("./utils/ObjectRenderer")), c = r(t("./TextureManager")), f = r(t("../../textures/BaseTexture")), d = r(t("./TextureGarbageCollector")), p = r(t("./WebGLState")), g = r(t("./utils/mapWebGLDrawModesToPixi")), v = r(t("./utils/validateContext")), m = t("../../utils"), u = r(t("pixi-gl-core")), y = t("../../const"); function r(t) { return t && t.__esModule ? t : { default: t } } var _ = 0, t = function (r) { var t = n, e = r; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function n(t, e, i) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, r.call(this, "WebGL", t, e, i)); return t.legacy = t.options.legacy, t.legacy && (u.default.VertexArrayObject.FORCE_NATIVE = !0), t.type = y.RENDERER_TYPE.WEBGL, t.handleContextLost = t.handleContextLost.bind(t), t.handleContextRestored = t.handleContextRestored.bind(t), t.view.addEventListener("webglcontextlost", t.handleContextLost, !1), t.view.addEventListener("webglcontextrestored", t.handleContextRestored, !1), t._contextOptions = { alpha: t.transparent, antialias: t.options.antialias, premultipliedAlpha: t.transparent && "notMultiplied" !== t.transparent, stencil: !0, preserveDrawingBuffer: t.options.preserveDrawingBuffer, powerPreference: t.options.powerPreference }, t._backgroundColorRgba[3] = t.transparent ? 0 : 1, t.maskManager = new o.default(t), t.stencilManager = new s.default(t), t.emptyRenderer = new l.default(t), t.currentRenderer = t.emptyRenderer, t.textureManager = null, t.filterManager = null, t.initPlugins(), t.options.context && (0, v.default)(t.options.context), t.gl = t.options.context || u.default.createContext(t.view, t._contextOptions), t.CONTEXT_UID = _++, t.state = new p.default(t.gl), t.renderingToScreen = !0, t.boundTextures = null, t._activeShader = null, t._activeVao = null, t._activeRenderTarget = null, t._initContext(), t.drawModes = (0, g.default)(t.gl), t._nextTextureLocation = 0, t.setBlendMode(0), t } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), n.prototype._initContext = function () { var t = this.gl, e = (t.isContextLost() && t.getExtension("WEBGL_lose_context") && t.getExtension("WEBGL_lose_context").restoreContext(), t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)), i = (this._activeShader = null, this._activeVao = null, this.boundTextures = new Array(e), this.emptyTextures = new Array(e), this.textureManager = new c.default(this), this.filterManager = new a.default(this), this.textureGC = new d.default(this), this.state.resetToDefault(), this.rootRenderTarget = new h.default(t, this.width, this.height, null, this.resolution, !0), this.rootRenderTarget.clearColor = this._backgroundColorRgba, this.bindRenderTarget(this.rootRenderTarget), new u.default.GLTexture.fromData(t, null, 1, 1)), r = { _glTextures: {} }; r._glTextures[this.CONTEXT_UID] = {}; for (var n = 0; n < e; n++) { var o = new f.default; o._glTextures[this.CONTEXT_UID] = i, this.boundTextures[n] = r, this.emptyTextures[n] = o, this.bindTexture(null, n) } this.emit("context", t), this.resize(this.screen.width, this.screen.height) }, n.prototype.render = function (t, e, i, r, n) { this.renderingToScreen = !e, this.emit("prerender"), this.gl && !this.gl.isContextLost() && (this._nextTextureLocation = 0, e || (this._lastObjectRendered = t), n || (n = t.parent, t.parent = this._tempDisplayObjectParent, t.updateTransform(), t.parent = n), this.bindRenderTexture(e, r), this.currentRenderer.start(), (void 0 !== i ? i : this.clearBeforeRender) && this._activeRenderTarget.clear(), t.renderWebGL(this), this.currentRenderer.flush(), this.textureGC.update(), this.emit("postrender")) }, n.prototype.setObjectRenderer = function (t) { this.currentRenderer !== t && (this.currentRenderer.stop(), this.currentRenderer = t, this.currentRenderer.start()) }, n.prototype.flush = function () { this.setObjectRenderer(this.emptyRenderer) }, n.prototype.resize = function (t, e) { i.default.prototype.resize.call(this, t, e), this.rootRenderTarget.resize(t, e), this._activeRenderTarget === this.rootRenderTarget && (this.rootRenderTarget.activate(), this._activeShader && (this._activeShader.uniforms.projectionMatrix = this.rootRenderTarget.projectionMatrix.toArray(!0))) }, n.prototype.setBlendMode = function (t) { this.state.setBlendMode(t) }, n.prototype.clear = function (t) { this._activeRenderTarget.clear(t) }, n.prototype.setTransform = function (t) { this._activeRenderTarget.transform = t }, n.prototype.clearRenderTexture = function (t, e) { t = t.baseTexture._glRenderTargets[this.CONTEXT_UID]; return t && t.clear(e), this }, n.prototype.bindRenderTexture = function (t, e) { var i, r = void 0; return t ? ((i = t.baseTexture)._glRenderTargets[this.CONTEXT_UID] || this.textureManager.updateTexture(i, 0), this.unbindTexture(i), (r = i._glRenderTargets[this.CONTEXT_UID]).setFrame(t.frame)) : r = this.rootRenderTarget, r.transform = e, this.bindRenderTarget(r), this }, n.prototype.bindRenderTarget = function (t) { return t !== this._activeRenderTarget && ((this._activeRenderTarget = t).activate(), this._activeShader && (this._activeShader.uniforms.projectionMatrix = t.projectionMatrix.toArray(!0)), this.stencilManager.setMaskStack(t.stencilMaskStack)), this }, n.prototype.bindShader = function (t, e) { return this._activeShader !== t && ((this._activeShader = t).bind(), !1 !== e && (t.uniforms.projectionMatrix = this._activeRenderTarget.projectionMatrix.toArray(!0))), this }, n.prototype.bindTexture = function (t, e, i) { if ((t = (t = t || this.emptyTextures[e]).baseTexture || t).touched = this.textureGC.count, i) e = e || 0; else { for (var r = 0; r < this.boundTextures.length; r++)if (this.boundTextures[r] === t) return r; void 0 === e && (this._nextTextureLocation++, this._nextTextureLocation %= this.boundTextures.length, e = this.boundTextures.length - this._nextTextureLocation - 1) } var i = this.gl, n = t._glTextures[this.CONTEXT_UID]; return n ? (this.boundTextures[e] = t, i.activeTexture(i.TEXTURE0 + e), i.bindTexture(i.TEXTURE_2D, n.texture)) : this.textureManager.updateTexture(t, e), e }, n.prototype.unbindTexture = function (t) { var e = this.gl; t = t.baseTexture || t; for (var i = 0; i < this.boundTextures.length; i++)this.boundTextures[i] === t && (this.boundTextures[i] = this.emptyTextures[i], e.activeTexture(e.TEXTURE0 + i), e.bindTexture(e.TEXTURE_2D, this.emptyTextures[i]._glTextures[this.CONTEXT_UID].texture)); return this }, n.prototype.createVao = function () { return new u.default.VertexArrayObject(this.gl, this.state.attribState) }, n.prototype.bindVao = function (t) { return this._activeVao === t || (t ? t.bind() : this._activeVao && this._activeVao.unbind(), this._activeVao = t), this }, n.prototype.reset = function () { this.setObjectRenderer(this.emptyRenderer), this.bindVao(null), this._activeShader = null, this._activeRenderTarget = this.rootRenderTarget; for (var t = 0; t < this.boundTextures.length; t++)this.boundTextures[t] = this.emptyTextures[t]; return this.rootRenderTarget.activate(), this.state.resetToDefault(), this }, n.prototype.handleContextLost = function (t) { t.preventDefault() }, n.prototype.handleContextRestored = function () { this.textureManager.removeAll(), this.filterManager.destroy(!0), this._initContext() }, n.prototype.destroy = function (t) { this.destroyPlugins(), this.view.removeEventListener("webglcontextlost", this.handleContextLost), this.view.removeEventListener("webglcontextrestored", this.handleContextRestored), this.textureManager.destroy(), r.prototype.destroy.call(this, t), this.uid = 0, this.maskManager.destroy(), this.stencilManager.destroy(), this.filterManager.destroy(), this.maskManager = null, this.filterManager = null, this.textureManager = null, this.currentRenderer = null, this.handleContextLost = null, this.handleContextRestored = null, this._contextOptions = null, this.gl.useProgram(null), this.gl.getExtension("WEBGL_lose_context") && this.gl.getExtension("WEBGL_lose_context").loseContext(), this.gl = null }, n }(i.default); e.default = t, m.pluginTarget.mixin(t) }, { "../../const": 46, "../../textures/BaseTexture": 112, "../../utils": 125, "../SystemRenderer": 76, "./TextureGarbageCollector": 82, "./TextureManager": 83, "./WebGLState": 85, "./managers/FilterManager": 90, "./managers/MaskManager": 91, "./managers/StencilManager": 92, "./utils/ObjectRenderer": 94, "./utils/RenderTarget": 96, "./utils/mapWebGLDrawModesToPixi": 99, "./utils/validateContext": 100, "pixi-gl-core": 15 }], 85: [function (t, e, i) { "use strict"; i.__esModule = !0; var t = t("./utils/mapWebGLBlendModesToPixi"), r = (t = t) && t.__esModule ? t : { default: t }; function n(t) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); this.activeState = new Uint8Array(16), this.defaultState = new Uint8Array(16), this.defaultState[0] = 1, this.stackIndex = 0, this.stack = [], this.gl = t, this.maxAttribs = t.getParameter(t.MAX_VERTEX_ATTRIBS), this.attribState = { tempAttribState: new Array(this.maxAttribs), attribState: new Array(this.maxAttribs) }, this.blendModes = (0, r.default)(t), this.nativeVaoExtension = t.getExtension("OES_vertex_array_object") || t.getExtension("MOZ_OES_vertex_array_object") || t.getExtension("WEBKIT_OES_vertex_array_object") } n.prototype.push = function () { var t = (t = this.stack[this.stackIndex]) || (this.stack[this.stackIndex] = new Uint8Array(16)); ++this.stackIndex; for (var e = 0; e < this.activeState.length; e++)t[e] = this.activeState[e] }, n.prototype.pop = function () { var t = this.stack[--this.stackIndex]; this.setState(t) }, n.prototype.setState = function (t) { this.setBlend(t[0]), this.setDepthTest(t[1]), this.setFrontFace(t[2]), this.setCullFace(t[3]), this.setBlendMode(t[4]) }, n.prototype.setBlend = function (t) { this.activeState[0] !== (t = t ? 1 : 0) && (this.activeState[0] = t, this.gl[t ? "enable" : "disable"](this.gl.BLEND)) }, n.prototype.setBlendMode = function (t) { t !== this.activeState[4] && (this.activeState[4] = t, 2 === (t = this.blendModes[t]).length ? this.gl.blendFunc(t[0], t[1]) : this.gl.blendFuncSeparate(t[0], t[1], t[2], t[3])) }, n.prototype.setDepthTest = function (t) { this.activeState[1] !== (t = t ? 1 : 0) && (this.activeState[1] = t, this.gl[t ? "enable" : "disable"](this.gl.DEPTH_TEST)) }, n.prototype.setCullFace = function (t) { this.activeState[3] !== (t = t ? 1 : 0) && (this.activeState[3] = t, this.gl[t ? "enable" : "disable"](this.gl.CULL_FACE)) }, n.prototype.setFrontFace = function (t) { this.activeState[2] !== (t = t ? 1 : 0) && (this.activeState[2] = t, this.gl.frontFace(this.gl[t ? "CW" : "CCW"])) }, n.prototype.resetAttributes = function () { for (var t = 0; t < this.attribState.tempAttribState.length; t++)this.attribState.tempAttribState[t] = 0; for (var e = 0; e < this.attribState.attribState.length; e++)this.attribState.attribState[e] = 0; for (var i = 1; i < this.maxAttribs; i++)this.gl.disableVertexAttribArray(i) }, n.prototype.resetToDefault = function () { this.nativeVaoExtension && this.nativeVaoExtension.bindVertexArrayOES(null), this.resetAttributes(); for (var t = 0; t < this.activeState.length; ++t)this.activeState[t] = 32; this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, !1), this.setState(this.defaultState) }, i.default = n }, { "./utils/mapWebGLBlendModesToPixi": 98 }], 86: [function (t, u, e) { "use strict"; e.__esModule = !0; var i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var n = a(t("./extractUniformsFromSrc")), o = t("../../../utils"), s = t("../../../const"), c = a(t("../../../settings")); function a(t) { return t && t.__esModule ? t : { default: t } } var h = {}; function l(t, e, i) { if (!(this instanceof l)) throw new TypeError("Cannot call a class as a function"); for (var r in this.vertexSrc = t || l.defaultVertexSrc, this.fragmentSrc = e || l.defaultFragmentSrc, this._blendMode = s.BLEND_MODES.NORMAL, this.uniformData = i || (0, n.default)(this.vertexSrc, this.fragmentSrc, "projectionMatrix|uSampler"), this.uniforms = {}, this.uniformData) this.uniforms[r] = this.uniformData[r].value, this.uniformData[r].type && (this.uniformData[r].type = this.uniformData[r].type.toLowerCase()); this.glShaders = {}, h[this.vertexSrc + this.fragmentSrc] || (h[this.vertexSrc + this.fragmentSrc] = (0, o.uid)()), this.glShaderKey = h[this.vertexSrc + this.fragmentSrc], this.padding = 4, this.resolution = c.default.FILTER_RESOLUTION, this.enabled = !0, this.autoFit = !0 } l.prototype.apply = function (t, e, i, r, n) { t.applyFilter(this, e, i, r) }, i(l, [{ key: "blendMode", get: function () { return this._blendMode }, set: function (t) { this._blendMode = t } }], [{ key: "defaultVertexSrc", get: function () { return ["attribute vec2 aVertexPosition;", "attribute vec2 aTextureCoord;", "uniform mat3 projectionMatrix;", "uniform mat3 filterMatrix;", "varying vec2 vTextureCoord;", "varying vec2 vFilterCoord;", "void main(void){", "   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);", "   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;", "   vTextureCoord = aTextureCoord ;", "}"].join("\n") } }, { key: "defaultFragmentSrc", get: function () { return ["varying vec2 vTextureCoord;", "varying vec2 vFilterCoord;", "uniform sampler2D uSampler;", "uniform sampler2D filterSampler;", "void main(void){", "   vec4 masky = texture2D(filterSampler, vFilterCoord);", "   vec4 sample = texture2D(uSampler, vTextureCoord);", "   vec4 color;", "   if(mod(vFilterCoord.x, 1.0) > 0.5)", "   {", "     color = vec4(1.0, 0.0, 0.0, 1.0);", "   }", "   else", "   {", "     color = vec4(0.0, 1.0, 0.0, 1.0);", "   }", "   gl_FragColor = mix(sample, masky, 0.5);", "   gl_FragColor *= sample.a;", "}"].join("\n") } }]), e.default = l }, { "../../../const": 46, "../../../settings": 101, "../../../utils": 125, "./extractUniformsFromSrc": 87 }], 87: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t, e, i) { t = r(t), e = r(e); return Object.assign(t, e) }; i = t("pixi-gl-core"); var l = ((t = i) && t.__esModule ? t : { default: t }).default.shader.defaultValue; function r(t) { for (var e, i = new RegExp("^(projectionMatrix|uSampler|filterArea|filterClamp)$"), r = {}, n = t.replace(/\s+/g, " ").split(/\s*;\s*/), o = 0; o < n.length; o++) { var s, a, h = n[o].trim(); -1 < h.indexOf("uniform") && (s = (h = h.split(" "))[1], -(a = 1) < (h = h[2]).indexOf("[") && (h = (e = h.split(/\[|]/))[0], a *= Number(e[1])), h.match(i) || (r[h] = { value: l(s, a), name: h, type: s })) } return r } }, { "pixi-gl-core": 15 }], 88: [function (t, e, i) { "use strict"; i.__esModule = !0, i.calculateScreenSpaceMatrix = function (t, e, i) { t = t.identity(); return t.translate(e.x / i.width, e.y / i.height), t.scale(i.width, i.height), t }, i.calculateNormalizedScreenSpaceMatrix = function (t, e, i) { var t = t.identity(), r = (t.translate(e.x / i.width, e.y / i.height), i.width / e.width), i = i.height / e.height; return t.scale(r, i), t }, i.calculateSpriteMatrix = function (t, e, i, r) { var n = r._texture.orig, t = t.set(i.width, 0, 0, i.height, e.x, e.y), i = r.worldTransform.copy(o.Matrix.TEMP_MATRIX); return i.invert(), t.prepend(i), t.scale(1 / n.width, 1 / n.height), t.translate(r.anchor.x, r.anchor.y), t }; var o = t("../../../math") }, { "../../../math": 70 }], 89: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = n(t("../Filter")), o = t("../../../../math"), s = (t("path"), n(t("../../../../textures/TextureMatrix"))); function n(t) { return t && t.__esModule ? t : { default: t } } t = function (r) { var t = n, e = r; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function n(t) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); var e = new o.Matrix, i = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, r.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n", "varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float inverse;\nuniform vec4 maskClamp;\nuniform float alphaOnly;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n vec4 originalCopy = original;    vec4 masky = texture2D(mask, vMaskCoord);\n\n    original *= abs(inverse-(masky.r * masky.a * alpha * clip));\n\n    if (alphaOnly == 1.0){gl_FragColor = (originalCopy * masky.a);}else{gl_FragColor = original;}\n}\n")); return t.renderable = !1, i.maskSprite = t, i.maskMatrix = e, i } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), n.prototype.apply = function (t, e, i) { var r = this.maskSprite, n = this.maskSprite.texture; n.valid && (n.transform || (n.transform = new s.default(n, 0)), n.transform.update(), this.uniforms.mask = n, this.uniforms.otherMatrix = t.calculateSpriteMatrix(this.maskMatrix, r).prepend(n.transform.mapCoord), this.uniforms.alpha = r.worldAlpha, this.uniforms.maskClamp = n.transform.uClampFrame, this.uniforms.inverse = r.inverseMask ? 1 : 0, this.uniforms.alphaOnly = r.maskAlphaOnly ? 1 : 0, t.applyFilter(this, e, i)) }, n }(r.default); i.default = t }, { "../../../../math": 70, "../../../../textures/TextureMatrix": 116, "../Filter": 86, path: 8 }], 90: [function (t, u, e) { "use strict"; e.__esModule = !0; var c = r(t("./WebGLManager")), f = r(t("../utils/RenderTarget")), d = r(t("../utils/Quad")), i = t("../../../math"), a = r(t("../../../Shader")), n = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../filters/filterTransforms")), h = r(t("bit-twiddle")); function r(t) { return t && t.__esModule ? t : { default: t } } function o(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") } s.prototype.clear = function () { this.filters = null, this.target = null, this.renderTarget = null }; var p = s; function s() { o(this, s), this.renderTarget = null, this.target = null, this.resolution = 1, this.sourceFrame = new i.Rectangle, this.destinationFrame = new i.Rectangle, this.filters = [] } var l = "screen", t = function (i) { var t = r, e = i; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function r(t) { o(this, r); var e = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, i.call(this, t)); return e.gl = e.renderer.gl, e.quad = new d.default(e.gl, t.state.attribState), e.shaderCache = {}, e.pool = {}, e.filterData = null, e.managedFilters = [], e.renderer.on("prerender", e.onPrerender, e), e._screenWidth = t.view.width, e._screenHeight = t.view.height, e } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), r.prototype.pushFilter = function (t, e) { var i = this.renderer, r = this.filterData, n = (r || (r = this.renderer._activeRenderTarget.filterStack, (n = new p).sourceFrame = n.destinationFrame = this.renderer._activeRenderTarget.size, n.renderTarget = i._activeRenderTarget, this.renderer._activeRenderTarget.filterData = r = { index: 0, stack: [n] }, this.filterData = r), r.stack[++r.index]), u = r.stack[0].destinationFrame, n = n || (r.stack[r.index] = new p), o = t.filterArea && 0 === t.filterArea.x && 0 === t.filterArea.y && t.filterArea.width === i.screen.width && t.filterArea.height === i.screen.height, s = e[0].resolution, c = 0 | e[0].padding, a = o ? i.screen : t.filterArea || t.getBounds(!0), h = n.sourceFrame, l = n.destinationFrame, a = (!!e[0].hasOwnProperty("roundingDisabled") && e[0].roundingDisabled ? (h.x = Math.floor(a.x * s) / s, h.y = Math.floor(a.y * s) / s, h.width = Math.ceil(a.width * s) / s, h.height = Math.ceil(a.height * s) / s) : (h.x = (a.x * s | 0) / s, h.y = (a.y * s | 0) / s, h.width = (a.width * s | 0) / s, h.height = (a.height * s | 0) / s), o || (r.stack[0].renderTarget.transform || e[0].autoFit && h.fit(u), h.pad(c)), l.width = h.width, l.height = h.height, this.getPotRenderTarget(i.gl, h.width, h.height, s)); n.target = t, n.filters = e, n.resolution = s, (n.renderTarget = a).setFrame(l, h), i.bindRenderTarget(a), a.clear() }, r.prototype.popFilter = function () { var t = this.filterData, e = t.stack[t.index - 1], i = t.stack[t.index], r = (this.quad.map(i.renderTarget.size, i.sourceFrame).upload(), i.filters); if (1 === r.length) r[0].apply(this, i.renderTarget, e.renderTarget, !1, i), this.freePotRenderTarget(i.renderTarget); else { for (var n = i.renderTarget, o = ((a = this.getPotRenderTarget(this.renderer.gl, i.sourceFrame.width, i.sourceFrame.height, i.resolution)).setFrame(i.destinationFrame, i.sourceFrame), a.clear(), 0), o = 0; o < r.length - 1; ++o) { r[o].apply(this, n, a, !0, i); var s = n, n = a, a = s } r[o].apply(this, n, e.renderTarget, !1, i), this.freePotRenderTarget(n), this.freePotRenderTarget(a) } i.clear(), t.index--, 0 === t.index && (this.filterData = null) }, r.prototype.applyFilter = function (t, e, i, r) { var n = this.renderer, o = n.gl, s = t.glShaders[n.CONTEXT_UID], r = (s || (t.glShaderKey ? (s = this.shaderCache[t.glShaderKey]) || (s = new a.default(this.gl, t.vertexSrc, t.fragmentSrc), t.glShaders[n.CONTEXT_UID] = this.shaderCache[t.glShaderKey] = s, this.managedFilters.push(t)) : (s = t.glShaders[n.CONTEXT_UID] = new a.default(this.gl, t.vertexSrc, t.fragmentSrc), this.managedFilters.push(t)), n.bindVao(null), this.quad.initVao(s)), n.bindVao(this.quad.vao), n.bindRenderTarget(i), r && (o.disable(o.SCISSOR_TEST), n.clear(), o.enable(o.SCISSOR_TEST)), i === n.maskManager.scissorRenderTarget && n.maskManager.pushScissorMask(null, n.maskManager.scissorData), n.bindShader(s), this.renderer.emptyTextures[0]); this.renderer.boundTextures[0] = r, this.syncUniforms(s, t), n.state.setBlendMode(t.blendMode), o.activeTexture(o.TEXTURE0), o.bindTexture(o.TEXTURE_2D, e.texture.texture), this.quad.vao.draw(this.renderer.gl.TRIANGLES, 6, 0), o.bindTexture(o.TEXTURE_2D, r._glTextures[this.renderer.CONTEXT_UID].texture) }, r.prototype.syncUniforms = function (t, e) { var i, r, n = e.uniformData, o = e.uniforms, s = 1, e = void 0; for (r in t.uniforms.filterArea && (e = this.filterData.stack[this.filterData.index], (i = t.uniforms.filterArea)[0] = e.renderTarget.size.width, i[1] = e.renderTarget.size.height, i[2] = e.sourceFrame.x, i[3] = e.sourceFrame.y, t.uniforms.filterArea = i), t.uniforms.filterClamp && (e = e || this.filterData.stack[this.filterData.index], (i = t.uniforms.filterClamp)[0] = 0, i[1] = 0, i[2] = (e.sourceFrame.width - 1) / e.renderTarget.size.width, i[3] = (e.sourceFrame.height - 1) / e.renderTarget.size.height, t.uniforms.filterClamp = i), n) { var a, h = n[r].type; "sampler2d" === h && 0 !== o[r] ? (o[r].baseTexture ? t.uniforms[r] = this.renderer.bindTexture(o[r].baseTexture, s) : (t.uniforms[r] = s, a = this.renderer.gl, this.renderer.boundTextures[s] = this.renderer.emptyTextures[s], a.activeTexture(a.TEXTURE0 + s), o[r].texture.bind()), s++) : "mat3" === h ? void 0 !== o[r].a ? t.uniforms[r] = o[r].toArray(!0) : t.uniforms[r] = o[r] : "vec2" === h ? void 0 !== o[r].x ? ((a = t.uniforms[r] || new Float32Array(2))[0] = o[r].x, a[1] = o[r].y, t.uniforms[r] = a) : t.uniforms[r] = o[r] : ("float" !== h || t.uniforms.data && "object" == typeof t.uniforms.data && t.uniforms.data.hasOwnProperty(r) && void 0 !== t.uniforms.data[r].value && t.uniforms.data[r].value !== n[r]) && (t.uniforms[r] = o[r]) } }, r.prototype.getRenderTarget = function (t, e) { var i = this.filterData.stack[this.filterData.index], e = this.getPotRenderTarget(this.renderer.gl, i.sourceFrame.width, i.sourceFrame.height, e || i.resolution); return e.setFrame(i.destinationFrame, i.sourceFrame), e }, r.prototype.returnRenderTarget = function (t) { this.freePotRenderTarget(t) }, r.prototype.calculateScreenSpaceMatrix = function (t) { var e = this.filterData.stack[this.filterData.index]; return n.calculateScreenSpaceMatrix(t, e.sourceFrame, e.renderTarget.size) }, r.prototype.calculateNormalizedScreenSpaceMatrix = function (t) { var e = this.filterData.stack[this.filterData.index]; return n.calculateNormalizedScreenSpaceMatrix(t, e.sourceFrame, e.renderTarget.size, e.destinationFrame) }, r.prototype.calculateSpriteMatrix = function (t, e) { var i = this.filterData.stack[this.filterData.index]; return n.calculateSpriteMatrix(t, i.sourceFrame, i.renderTarget.size, e) }, r.prototype.destroy = function () { var t = 0 < arguments.length && void 0 !== arguments[0] && arguments[0], e = this.renderer, i = this.managedFilters; e.off("prerender", this.onPrerender, this); for (var r = 0; r < i.length; r++)t || i[r].glShaders[e.CONTEXT_UID].destroy(), delete i[r].glShaders[e.CONTEXT_UID]; this.shaderCache = {}, t ? this.pool = {} : this.emptyPool() }, r.prototype.getPotRenderTarget = function (t, e, i, r) { var n, o = l, s = (i *= r, (e *= r) === this._screenWidth && i === this._screenHeight || (o = (65535 & (e = h.default.nextPow2(e))) << 16 | 65535 & (i = h.default.nextPow2(i))), this.pool[o] || (this.pool[o] = []), this.pool[o].pop()); return s || (n = this.renderer.boundTextures[0], t.activeTexture(t.TEXTURE0), s = new f.default(t, e, i, null, 1), t.bindTexture(t.TEXTURE_2D, n._glTextures[this.renderer.CONTEXT_UID].texture)), s.resolution = r, s.defaultFrame.width = s.size.width = e / r, s.defaultFrame.height = s.size.height = i / r, s.filterPoolKey = o, s }, r.prototype.emptyPool = function () { for (var t in this.pool) { var e = this.pool[t]; if (e) for (var i = 0; i < e.length; i++)e[i].destroy(!0) } this.pool = {} }, r.prototype.freePotRenderTarget = function (t) { this.pool[t.filterPoolKey].push(t) }, r.prototype.onPrerender = function () { if (this._screenWidth !== this.renderer.view.width || this._screenHeight !== this.renderer.view.height) { this._screenWidth = this.renderer.view.width, this._screenHeight = this.renderer.view.height; var t = this.pool[l]; if (t) for (var e = 0; e < t.length; e++)t[e].destroy(!0); this.pool[l] = [] } }, r }(c.default); e.default = t }, { "../../../Shader": 44, "../../../math": 70, "../filters/filterTransforms": 88, "../utils/Quad": 95, "../utils/RenderTarget": 96, "./WebGLManager": 93, "bit-twiddle": 1 }], 91: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = o(t("./WebGLManager")), n = o(t("../filters/spriteMask/SpriteMaskFilter")); function o(t) { return t && t.__esModule ? t : { default: t } } t = function (e) { var t = r, i = e; if ("function" != typeof i && null !== i) throw new TypeError("Super expression must either be null or a function, not " + typeof i); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, e.call(this, t)); return t.scissor = !1, t.scissorData = null, t.scissorRenderTarget = null, t.enableScissor = !0, t.alphaMaskPool = [], t.alphaMaskIndex = 0, t } return t.prototype = Object.create(i && i.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), i && (Object.setPrototypeOf ? Object.setPrototypeOf(t, i) : t.__proto__ = i), r.prototype.pushMask = function (t, e) { var i; e.texture ? this.pushSpriteMask(t, e) : this.enableScissor && !this.scissor && this.renderer._activeRenderTarget.root && !this.renderer.stencilManager.stencilMaskStack.length && e.isFastRect() ? (i = e.worldTransform, i = Math.atan2(i.b, i.a), (i = Math.round(i * (180 / Math.PI))) % 90 ? this.pushStencilMask(e) : this.pushScissorMask(t, e)) : this.pushStencilMask(e) }, r.prototype.popMask = function (t, e) { e.texture ? this.popSpriteMask(t, e) : this.enableScissor && !this.renderer.stencilManager.stencilMaskStack.length ? this.popScissorMask(t, e) : this.popStencilMask(t, e) }, r.prototype.pushSpriteMask = function (t, e) { var i = this.alphaMaskPool[this.alphaMaskIndex]; (i = i || (this.alphaMaskPool[this.alphaMaskIndex] = [new n.default(e)]))[0].resolution = e.useHighQualityMask ? this.renderer.resolution : 1, i[0].maskSprite = e, t.filterArea = e.getBounds(!0), this.renderer.filterManager.pushFilter(t, i), this.alphaMaskIndex++ }, r.prototype.popSpriteMask = function () { this.renderer.filterManager.popFilter(), this.alphaMaskIndex-- }, r.prototype.pushStencilMask = function (t) { this.renderer.currentRenderer.stop(), this.renderer.stencilManager.pushStencil(t) }, r.prototype.popStencilMask = function () { this.renderer.currentRenderer.stop(), this.renderer.stencilManager.popStencil() }, r.prototype.pushScissorMask = function (t, e) { e.renderable = !0; var i = this.renderer._activeRenderTarget, r = e.getBounds(), n = (r.fit(i.size), e.renderable = !1, this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST), this.renderer.resolution); this.renderer.gl.scissor(r.x * n, (i.root ? i.size.height - r.y - r.height : r.y) * n, r.width * n, r.height * n), this.scissorRenderTarget = i, this.scissorData = e, this.scissor = !0 }, r.prototype.popScissorMask = function () { this.scissorRenderTarget = null, this.scissorData = null, this.scissor = !1; var t = this.renderer.gl; t.disable(t.SCISSOR_TEST) }, r }(r.default); i.default = t }, { "../filters/spriteMask/SpriteMaskFilter": 89, "./WebGLManager": 93 }], 92: [function (t, e, i) { "use strict"; i.__esModule = !0; var t = t("./WebGLManager"), n = (t = t) && t.__esModule ? t : { default: t }; t = function (e) { var t = r, i = e; if ("function" != typeof i && null !== i) throw new TypeError("Super expression must either be null or a function, not " + typeof i); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, e.call(this, t)); return t.stencilMaskStack = null, t } return t.prototype = Object.create(i && i.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), i && (Object.setPrototypeOf ? Object.setPrototypeOf(t, i) : t.__proto__ = i), r.prototype.setMaskStack = function (t) { this.stencilMaskStack = t; var e = this.renderer.gl; 0 === t.length ? e.disable(e.STENCIL_TEST) : e.enable(e.STENCIL_TEST) }, r.prototype.pushStencil = function (t) { this.renderer.setObjectRenderer(this.renderer.plugins.graphics), this.renderer._activeRenderTarget.attachStencilBuffer(); var e = this.renderer.gl, i = this.stencilMaskStack.length; 0 === i && e.enable(e.STENCIL_TEST), this.stencilMaskStack.push(t), e.colorMask(!1, !1, !1, !1), e.stencilFunc(e.EQUAL, i, this._getBitwiseMask()), e.stencilOp(e.KEEP, e.KEEP, e.INCR), this.renderer.plugins.graphics.render(t), this._useCurrent() }, r.prototype.popStencil = function () { this.renderer.setObjectRenderer(this.renderer.plugins.graphics); var t = this.renderer.gl, e = this.stencilMaskStack.pop(); 0 === this.stencilMaskStack.length ? (t.disable(t.STENCIL_TEST), t.clear(t.STENCIL_BUFFER_BIT), t.clearStencil(0)) : (t.colorMask(!1, !1, !1, !1), t.stencilOp(t.KEEP, t.KEEP, t.DECR), this.renderer.plugins.graphics.render(e), this._useCurrent()) }, r.prototype._useCurrent = function () { var t = this.renderer.gl; t.colorMask(!0, !0, !0, !0), t.stencilFunc(t.EQUAL, this.stencilMaskStack.length, this._getBitwiseMask()), t.stencilOp(t.KEEP, t.KEEP, t.KEEP) }, r.prototype._getBitwiseMask = function () { return (1 << this.stencilMaskStack.length) - 1 }, r.prototype.destroy = function () { n.default.prototype.destroy.call(this), this.stencilMaskStack.stencilStack = null }, r }(n.default); i.default = t }, { "./WebGLManager": 93 }], 93: [function (t, e, i) { "use strict"; function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); this.renderer = t, this.renderer.on("context", this.onContextChange, this) } i.__esModule = !0, r.prototype.onContextChange = function () { }, r.prototype.destroy = function () { this.renderer.off("context", this.onContextChange, this), this.renderer = null }, i.default = r }, {}], 94: [function (t, e, i) { "use strict"; i.__esModule = !0; var t = t("../managers/WebGLManager"); t = function (i) { var t = r, e = i; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function r() { var t = this, e = r; if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function"); t = this, e = i.apply(this, arguments); if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), r.prototype.start = function () { }, r.prototype.stop = function () { this.flush() }, r.prototype.flush = function () { }, r.prototype.render = function (t) { }, r }(((t = t) && t.__esModule ? t : { default: t }).default); i.default = t }, { "../managers/WebGLManager": 93 }], 95: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = o(t("pixi-gl-core")), n = o(t("../../../utils/createIndicesForQuads")); function o(t) { return t && t.__esModule ? t : { default: t } } function s(t, e) { if (!(this instanceof s)) throw new TypeError("Cannot call a class as a function"); this.gl = t, this.vertices = new Float32Array([-1, -1, 1, -1, 1, 1, -1, 1]), this.uvs = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]), this.interleaved = new Float32Array(16); for (var i = 0; i < 4; i++)this.interleaved[4 * i] = this.vertices[2 * i], this.interleaved[4 * i + 1] = this.vertices[2 * i + 1], this.interleaved[4 * i + 2] = this.uvs[2 * i], this.interleaved[4 * i + 3] = this.uvs[2 * i + 1]; this.indices = (0, n.default)(1), this.vertexBuffer = r.default.GLBuffer.createVertexBuffer(t, this.interleaved, t.STATIC_DRAW), this.indexBuffer = r.default.GLBuffer.createIndexBuffer(t, this.indices, t.STATIC_DRAW), this.vao = new r.default.VertexArrayObject(t, e) } s.prototype.initVao = function (t) { this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer, t.attributes.aVertexPosition, this.gl.FLOAT, !1, 16, 0).addAttribute(this.vertexBuffer, t.attributes.aTextureCoord, this.gl.FLOAT, !1, 16, 8) }, s.prototype.map = function (t, e) { var i; return this.uvs[0] = 0, this.uvs[1] = 0, this.uvs[2] = 0 + e.width / t.width, this.uvs[3] = 0, this.uvs[4] = 0 + e.width / t.width, this.uvs[5] = 0 + e.height / t.height, this.uvs[6] = 0, this.uvs[7] = 0 + e.height / t.height, t = e.x, i = e.y, this.vertices[0] = t, this.vertices[1] = i, this.vertices[2] = t + e.width, this.vertices[3] = i, this.vertices[4] = t + e.width, this.vertices[5] = i + e.height, this.vertices[6] = t, this.vertices[7] = i + e.height, this }, s.prototype.upload = function () { for (var t = 0; t < 4; t++)this.interleaved[4 * t] = this.vertices[2 * t], this.interleaved[4 * t + 1] = this.vertices[2 * t + 1], this.interleaved[4 * t + 2] = this.uvs[2 * t], this.interleaved[4 * t + 3] = this.uvs[2 * t + 1]; return this.vertexBuffer.upload(this.interleaved), this }, s.prototype.destroy = function () { var t = this.gl; t.deleteBuffer(this.vertexBuffer), t.deleteBuffer(this.indexBuffer) }, i.default = s }, { "../../../utils/createIndicesForQuads": 123, "pixi-gl-core": 15 }], 96: [function (t, e, i) { "use strict"; i.__esModule = !0; var s = t("../../../math"), a = t("../../../const"), r = t("../../../settings"), h = (r = r) && r.__esModule ? r : { default: r }, l = t("pixi-gl-core"); function u(t, e, i, r, n, o) { if (!(this instanceof u)) throw new TypeError("Cannot call a class as a function"); this.gl = t, this.frameBuffer = null, this.texture = null, this.clearColor = [0, 0, 0, 0], this.size = new s.Rectangle(0, 0, 1, 1), this.resolution = n || h.default.RESOLUTION, this.projectionMatrix = new s.Matrix, this.transform = null, this.frame = null, this.defaultFrame = new s.Rectangle, this.destinationFrame = null, this.sourceFrame = null, this.stencilBuffer = null, this.stencilMaskStack = [], this.filterData = null, this.filterPoolKey = "", this.scaleMode = void 0 !== r ? r : h.default.SCALE_MODE, this.root = o, this.root ? (this.frameBuffer = new l.GLFramebuffer(t, 100, 100), this.frameBuffer.framebuffer = null) : (this.frameBuffer = l.GLFramebuffer.createRGBA(t, 100, 100), this.scaleMode === a.SCALE_MODES.NEAREST ? this.frameBuffer.texture.enableNearestScaling() : this.frameBuffer.texture.enableLinearScaling(), this.texture = this.frameBuffer.texture), this.setFrame(), this.resize(e, i) } u.prototype.clear = function (t) { t = t || this.clearColor; this.frameBuffer.clear(t[0], t[1], t[2], t[3]) }, u.prototype.attachStencilBuffer = function () { this.root || this.frameBuffer.enableStencil() }, u.prototype.setFrame = function (t, e) { this.destinationFrame = t || this.destinationFrame || this.defaultFrame, this.sourceFrame = e || this.sourceFrame || this.destinationFrame }, u.prototype.activate = function () { var t = this.gl; this.frameBuffer.bind(), this.calculateProjection(this.destinationFrame, this.sourceFrame), this.transform && this.projectionMatrix.append(this.transform), this.destinationFrame !== this.sourceFrame ? (t.enable(t.SCISSOR_TEST), t.scissor(0 | this.destinationFrame.x, 0 | this.destinationFrame.y, this.destinationFrame.width * this.resolution | 0, this.destinationFrame.height * this.resolution | 0)) : t.disable(t.SCISSOR_TEST), t.viewport(0 | this.destinationFrame.x, 0 | this.destinationFrame.y, this.destinationFrame.width * this.resolution | 0, this.destinationFrame.height * this.resolution | 0) }, u.prototype.calculateProjection = function (t, e) { var i = this.projectionMatrix; e = e || t, i.identity(), this.root ? (i.a = 1 / t.width * 2, i.d = -1 / t.height * 2, i.tx = -1 - e.x * i.a, i.ty = 1 - e.y * i.d) : (i.a = 1 / t.width * 2, i.d = 1 / t.height * 2, i.tx = -1 - e.x * i.a, i.ty = -1 - e.y * i.d) }, u.prototype.resize = function (t, e) { e |= 0, this.size.width === (t |= 0) && this.size.height === e || (this.size.width = t, this.size.height = e, this.defaultFrame.width = t, this.defaultFrame.height = e, this.frameBuffer.resize(t * this.resolution, e * this.resolution), t = this.frame || this.size, this.calculateProjection(t)) }, u.prototype.destroy = function () { this.frameBuffer.destroy(), this.frameBuffer = null, this.texture = null }, i.default = u }, { "../../../const": 46, "../../../math": 70, "../../../settings": 101, "pixi-gl-core": 15 }], 97: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t, e) { var i = !e; if (0 === t) throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`"); { var r; i && ((r = document.createElement("canvas")).width = 1, r.height = 1, e = s.default.createContext(r)) } var n = e.createShader(e.FRAGMENT_SHADER); for (; ;) { var o = a.replace(/%forloop%/gi, function (t) { for (var e = "", i = 0; i < t; ++i)0 < i && (e += "\nelse "), i < t - 1 && (e += "if(test == " + i + ".0){}"); return e }(t)); if (e.shaderSource(n, o), e.compileShader(n), e.getShaderParameter(n, e.COMPILE_STATUS)) break; t = t / 2 | 0 } i && e.getExtension("WEBGL_lose_context") && e.getExtension("WEBGL_lose_context").loseContext(); return t }; var i = t("pixi-gl-core"), s = (t = i) && t.__esModule ? t : { default: t }; var a = ["precision mediump float;", "void main(void){", "float test = 0.1;", "%forloop%", "gl_FragColor = vec4(0.0);", "}"].join("\n") }, { "pixi-gl-core": 15 }], 98: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t) { var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : []; return e[r.BLEND_MODES.NORMAL] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.ADD] = [t.ONE, t.DST_ALPHA], e[r.BLEND_MODES.MULTIPLY] = [t.DST_COLOR, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.SCREEN] = [t.ONE, t.ONE_MINUS_SRC_COLOR], e[r.BLEND_MODES.OVERLAY] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.DARKEN] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.LIGHTEN] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.COLOR_DODGE] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.COLOR_BURN] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.HARD_LIGHT] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.SOFT_LIGHT] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.DIFFERENCE] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.EXCLUSION] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.HUE] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.SATURATION] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.COLOR] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.LUMINOSITY] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.NORMAL_NPM] = [t.SRC_ALPHA, t.ONE_MINUS_SRC_ALPHA, t.ONE, t.ONE_MINUS_SRC_ALPHA], e[r.BLEND_MODES.ADD_NPM] = [t.SRC_ALPHA, t.DST_ALPHA, t.ONE, t.DST_ALPHA], e[r.BLEND_MODES.SCREEN_NPM] = [t.SRC_ALPHA, t.ONE_MINUS_SRC_COLOR, t.ONE, t.ONE_MINUS_SRC_COLOR], e }; var r = t("../../../const") }, { "../../../const": 46 }], 99: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t) { var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {}; return e[r.DRAW_MODES.POINTS] = t.POINTS, e[r.DRAW_MODES.LINES] = t.LINES, e[r.DRAW_MODES.LINE_LOOP] = t.LINE_LOOP, e[r.DRAW_MODES.LINE_STRIP] = t.LINE_STRIP, e[r.DRAW_MODES.TRIANGLES] = t.TRIANGLES, e[r.DRAW_MODES.TRIANGLE_STRIP] = t.TRIANGLE_STRIP, e[r.DRAW_MODES.TRIANGLE_FAN] = t.TRIANGLE_FAN, e }; var r = t("../../../const") }, { "../../../const": 46 }], 100: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t) { t.getContextAttributes().stencil || console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly") } }, {}], 101: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = n(t("./utils/maxRecommendedTextures")), t = n(t("./utils/canUploadSameBuffer")); function n(t) { return t && t.__esModule ? t : { default: t } } i.default = { TARGET_FPMS: .06, MIPMAP_TEXTURES: !0, RESOLUTION: 1, FILTER_RESOLUTION: 1, SPRITE_MAX_TEXTURES: (0, r.default)(32), SPRITE_BATCH_SIZE: 4096, RETINA_PREFIX: /@([0-9\.]+)x/, RENDER_OPTIONS: { view: null, antialias: !1, forceFXAA: !1, autoResize: !1, transparent: !1, backgroundColor: 0, clearBeforeRender: !0, preserveDrawingBuffer: !1, roundPixels: !1, width: 800, height: 600, legacy: !1 }, TRANSFORM_MODE: 0, GC_MODE: 0, GC_MAX_IDLE: 3600, GC_MAX_CHECK_COUNT: 600, WRAP_MODE: 0, SCALE_MODE: 0, PRECISION_VERTEX: "highp", PRECISION_FRAGMENT: "mediump", CAN_UPLOAD_SAME_BUFFER: (0, t.default)(), MESH_CANVAS_PADDING: 0 } }, { "./utils/canUploadSameBuffer": 122, "./utils/maxRecommendedTextures": 127 }], 102: [function (t, u, e) { "use strict"; e.__esModule = !0; var n = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = t("../math"), s = t("../utils"), a = t("../const"), h = i(t("../textures/Texture")), t = i(t("../display/Container")); function i(t) { return t && t.__esModule ? t : { default: t } } var l = new o.Point, t = function (i) { var t = r, e = i; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); var e = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, i.call(this)); return e._anchor = new o.ObservablePoint(e._onAnchorUpdate, e), e._texture = null, e._width = 0, e._height = 0, e._tint = null, e._tintRGB = null, e.tint = 16777215, e.blendMode = a.BLEND_MODES.NORMAL, e.shader = null, e.cachedTint = 16777215, e.texture = t || h.default.EMPTY, e.vertexData = new Float32Array(8), e.vertexTrimmedData = null, e._transformID = -1, e._textureID = -1, e._transformTrimmedID = -1, e._textureTrimmedID = -1, e.pluginName = "sprite", e } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), r.prototype._onTextureUpdate = function () { this._textureID = -1, this._textureTrimmedID = -1, this.cachedTint = 16777215, this._width && (this.scale.x = (0, s.sign)(this.scale.x) * this._width / this._texture.orig.width), this._height && (this.scale.y = (0, s.sign)(this.scale.y) * this._height / this._texture.orig.height) }, r.prototype._onAnchorUpdate = function () { this._transformID = -1, this._transformTrimmedID = -1 }, r.prototype.calculateVertices = function () { var t, e, u, c, f, i, r, n, o, d, s, a, h, l; this._transformID === this.transform._worldID && this._textureID === this._texture._updateID || (this._transformID = this.transform._worldID, this._textureID = this._texture._updateID, o = this._texture, t = (i = this.transform.worldTransform).a, e = i.b, u = i.c, c = i.d, f = i.tx, i = i.ty, r = this.vertexData, n = o.trim, o = o.orig, d = this._anchor, h = l = a = s = 0, l = n ? (s = (a = n.x - d._x * o.width) + n.width, (h = n.y - d._y * o.height) + n.height) : (s = (a = -d._x * o.width) + o.width, (h = -d._y * o.height) + o.height), r[0] = t * a + u * h + f, r[1] = c * h + e * a + i, r[2] = t * s + u * h + f, r[3] = c * h + e * s + i, r[4] = t * s + u * l + f, r[5] = c * l + e * s + i, r[6] = t * a + u * l + f, r[7] = c * l + e * a + i) }, r.prototype.calculateTrimmedVertices = function () { if (this.vertexTrimmedData) { if (this._transformTrimmedID === this.transform._worldID && this._textureTrimmedID === this._texture._updateID) return } else this.vertexTrimmedData = new Float32Array(8); this._transformTrimmedID = this.transform._worldID, this._textureTrimmedID = this._texture._updateID; var t = this._texture, e = this.vertexTrimmedData, t = t.orig, i = this._anchor, r = this.transform.worldTransform, n = r.a, o = r.b, s = r.c, a = r.d, h = r.tx, r = r.ty, l = -i._x * t.width, u = l + t.width, i = -i._y * t.height, t = i + t.height; e[0] = n * l + s * i + h, e[1] = a * i + o * l + r, e[2] = n * u + s * i + h, e[3] = a * i + o * u + r, e[4] = n * u + s * t + h, e[5] = a * t + o * u + r, e[6] = n * l + s * t + h, e[7] = a * t + o * l + r }, r.prototype._renderWebGL = function (t) { this.calculateVertices(), t.setObjectRenderer(t.plugins[this.pluginName]), t.plugins[this.pluginName].render(this) }, r.prototype._renderCanvas = function (t) { t.plugins[this.pluginName].render(this) }, r.prototype._calculateBounds = function () { var t = this._texture.trim, e = this._texture.orig; !t || t.width === e.width && t.height === e.height ? (this.calculateVertices(), this._bounds.addQuad(this.vertexData)) : (this.calculateTrimmedVertices(), this._bounds.addQuad(this.vertexTrimmedData)) }, r.prototype.getLocalBounds = function (t) { return 0 === this.children.length ? (this._bounds.minX = this._texture.orig.width * -this._anchor._x, this._bounds.minY = this._texture.orig.height * -this._anchor._y, this._bounds.maxX = this._texture.orig.width * (1 - this._anchor._x), this._bounds.maxY = this._texture.orig.height * (1 - this._anchor._y), t || (this._localBoundsRect || (this._localBoundsRect = new o.Rectangle), t = this._localBoundsRect), this._bounds.getRectangle(t)) : i.prototype.getLocalBounds.call(this, t) }, r.prototype.containsPoint = function (t) { this.worldTransform.applyInverse(t, l); var t = this._texture.orig.width, e = this._texture.orig.height, i = -t * this.anchor.x; return l.x >= i && l.x < i + t && (i = -e * this.anchor.y, l.y >= i && l.y < i + e) }, r.prototype.destroy = function (t) { i.prototype.destroy.call(this, t), this._texture.off("update", this._onTextureUpdate, this), this._anchor = null, ("boolean" == typeof t ? t : t && t.texture) && (t = "boolean" == typeof t ? t : t && t.baseTexture, this._texture.destroy(!!t)), this._texture = null, this.shader = null }, r.from = function (t) { return new r(h.default.from(t)) }, r.fromFrame = function (t) { var e = s.TextureCache[t]; if (!e) throw new Error('The frameId "' + t + '" does not exist in the texture cache'); return new r(e) }, r.fromImage = function (t, e, i) { return new r(h.default.fromImage(t, e, i)) }, n(r, [{ key: "width", get: function () { return Math.abs(this.scale.x) * this._texture.orig.width }, set: function (t) { var e = (0, s.sign)(this.scale.x) || 1; this.scale.x = e * t / this._texture.orig.width, this._width = t } }, { key: "height", get: function () { return Math.abs(this.scale.y) * this._texture.orig.height }, set: function (t) { var e = (0, s.sign)(this.scale.y) || 1; this.scale.y = e * t / this._texture.orig.height, this._height = t } }, { key: "anchor", get: function () { return this._anchor }, set: function (t) { this._anchor.copy(t) } }, { key: "tint", get: function () { return this._tint }, set: function (t) { this._tint = t, this._tintRGB = (t >> 16) + (65280 & t) + ((255 & t) << 16) } }, { key: "texture", get: function () { return this._texture }, set: function (t) { this._texture !== t && (this._texture = t, this.cachedTint = 16777215, this._textureID = -1, this._textureTrimmedID = -1, t && (t.baseTexture.hasLoaded ? this._onTextureUpdate() : t.once("update", this._onTextureUpdate, this))) } }]), r }(t.default); e.default = t }, { "../const": 46, "../display/Container": 48, "../math": 70, "../textures/Texture": 115, "../utils": 125 }], 103: [function (t, o, e) { "use strict"; e.__esModule = !0; var i = r(t("../../renderers/canvas/CanvasRenderer")), l = t("../../const"), u = t("../../math"), c = r(t("./CanvasTinter")); function r(t) { return t && t.__esModule ? t : { default: t } } var f = new u.Matrix, t = (n.prototype.render = function (t) { var e, i = t._texture, r = this.renderer, n = i._frame.width, o = i._frame.height, s = t.transform.worldTransform, a = 0, h = 0; i.orig.width <= 0 || i.orig.height <= 0 || !i.baseTexture.source || (r.setBlendMode(t.blendMode), i.valid && (r.context.globalAlpha = t.worldAlpha, e = i.baseTexture.scaleMode === l.SCALE_MODES.LINEAR, r.smoothProperty && r.context[r.smoothProperty] !== e && (r.context[r.smoothProperty] = e), h = i.trim ? (a = i.trim.width / 2 + i.trim.x - t.anchor.x * i.orig.width, i.trim.height / 2 + i.trim.y - t.anchor.y * i.orig.height) : (a = (.5 - t.anchor.x) * i.orig.width, (.5 - t.anchor.y) * i.orig.height), i.rotate && (s.copy(f), u.GroupD8.matrixAppendRotationInv(s = f, i.rotate, a, h), h = a = 0), a -= n / 2, h -= o / 2, r.roundPixels ? (r.context.setTransform(s.a, s.b, s.c, s.d, s.tx * r.resolution | 0, s.ty * r.resolution | 0), a |= 0, h |= 0) : r.context.setTransform(s.a, s.b, s.c, s.d, s.tx * r.resolution, s.ty * r.resolution), e = i.baseTexture.resolution, 16777215 !== t.tint ? (t.cachedTint === t.tint && t.tintedTexture.tintId === t._texture._updateID || (t.cachedTint = t.tint, t.tintedTexture = c.default.getTintedTexture(t, t.tint)), r.context.drawImage(t.tintedTexture, 0, 0, n * e, o * e, a * r.resolution, h * r.resolution, n * r.resolution, o * r.resolution)) : r.context.drawImage(i.baseTexture.source, i._frame.x * e, i._frame.y * e, n * e, o * e, a * r.resolution, h * r.resolution, n * r.resolution, o * r.resolution))) }, n.prototype.destroy = function () { this.renderer = null }, n); function n(t) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); this.renderer = t } e.default = t, i.default.registerPlugin("sprite", t) }, { "../../const": 46, "../../math": 70, "../../renderers/canvas/CanvasRenderer": 77, "./CanvasTinter": 104 }], 104: [function (t, e, i) { "use strict"; i.__esModule = !0; var c = t("../../utils"), t = t("../../renderers/canvas/utils/canUseNewCanvasBlendModes"); var o = { getTintedTexture: function (t, e) { var t = t._texture, i = "#" + ("00000" + (0 | (e = o.roundColor(e))).toString(16)).substr(-6), r = (t.tintCache = t.tintCache || {}, t.tintCache[i]), n = void 0; if (r) { if (r.tintId === t._updateID) return t.tintCache[i]; n = t.tintCache[i] } else n = o.canvas || document.createElement("canvas"); return o.tintMethod(t, e, n), n.tintId = t._updateID, o.convertTintToImage ? ((r = new Image).src = n.toDataURL(), t.tintCache[i] = r) : (t.tintCache[i] = n, o.canvas = null), n }, tintWithMultiply: function (t, e, i) { var r = i.getContext("2d"), n = t._frame.clone(), o = t.baseTexture.resolution; n.x *= o, n.y *= o, n.width *= o, n.height *= o, i.width = Math.ceil(n.width), i.height = Math.ceil(n.height), r.save(), r.fillStyle = "#" + ("00000" + (0 | e).toString(16)).substr(-6), r.fillRect(0, 0, n.width, n.height), r.globalCompositeOperation = "multiply", r.drawImage(t.baseTexture.source, n.x, n.y, n.width, n.height, 0, 0, n.width, n.height), r.globalCompositeOperation = "destination-atop", r.drawImage(t.baseTexture.source, n.x, n.y, n.width, n.height, 0, 0, n.width, n.height), r.restore() }, tintWithOverlay: function (t, e, i) { var r = i.getContext("2d"), n = t._frame.clone(), o = t.baseTexture.resolution; n.x *= o, n.y *= o, n.width *= o, n.height *= o, i.width = Math.ceil(n.width), i.height = Math.ceil(n.height), r.save(), r.globalCompositeOperation = "copy", r.fillStyle = "#" + ("00000" + (0 | e).toString(16)).substr(-6), r.fillRect(0, 0, n.width, n.height), r.globalCompositeOperation = "destination-atop", r.drawImage(t.baseTexture.source, n.x, n.y, n.width, n.height, 0, 0, n.width, n.height), r.restore() }, tintWithPerPixel: function (t, e, i) { for (var r = i.getContext("2d"), n = t._frame.clone(), o = t.baseTexture.resolution, o = (n.x *= o, n.y *= o, n.width *= o, n.height *= o, i.width = Math.ceil(n.width), i.height = Math.ceil(n.height), r.save(), r.globalCompositeOperation = "copy", r.drawImage(t.baseTexture.source, n.x, n.y, n.width, n.height, 0, 0, n.width, n.height), r.restore(), (0, c.hex2rgb)(e)), s = o[0], a = o[1], u = o[2], i = r.getImageData(0, 0, n.width, n.height), h = i.data, l = 0; l < h.length; l += 4)h[l + 0] *= s, h[l + 1] *= a, h[l + 2] *= u; r.putImageData(i, 0, 0) }, roundColor: function (t) { var e = o.cacheStepsPerColorChannel, t = (0, c.hex2rgb)(t); return t[0] = Math.min(255, t[0] / e * e), t[1] = Math.min(255, t[1] / e * e), t[2] = Math.min(255, t[2] / e * e), (0, c.rgb2hex)(t) }, cacheStepsPerColorChannel: 8, convertTintToImage: !1, canUseMultiply: (0, ((t = t) && t.__esModule ? t : { default: t }).default)(), tintMethod: 0 }; o.tintMethod = o.canUseMultiply ? o.tintWithMultiply : o.tintWithPerPixel, i.default = o }, { "../../renderers/canvas/utils/canUseNewCanvasBlendModes": 80, "../../utils": 125 }], 105: [function (t, e, i) { "use strict"; function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); this.vertices = new ArrayBuffer(t), this.float32View = new Float32Array(this.vertices), this.uint32View = new Uint32Array(this.vertices) } i.__esModule = !0, r.prototype.destroy = function () { this.vertices = null, this.positions = null, this.uvs = null, this.colors = null }, i.default = r }, {}], 106: [function (t, n, e) { "use strict"; e.__esModule = !0; var i = r(t("../../renderers/webgl/utils/ObjectRenderer")), o = r(t("../../renderers/webgl/WebGLRenderer")), s = r(t("../../utils/createIndicesForQuads")), a = r(t("./generateMultiTextureShader")), h = r(t("../../renderers/webgl/utils/checkMaxIfStatmentsInShader")), l = r(t("./BatchBuffer")), R = r(t("../../settings")), I = t("../../utils"), k = r(t("pixi-gl-core")), L = r(t("bit-twiddle")); function r(t) { return t && t.__esModule ? t : { default: t } } var j = 0, F = 0, t = function (n) { var t = o, e = n; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function o(t) { if (!(this instanceof o)) throw new TypeError("Cannot call a class as a function"); var e = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, n.call(this, t)); e.vertSize = 5, e.vertByteSize = 4 * e.vertSize, e.size = R.default.SPRITE_BATCH_SIZE, e.buffers = []; for (var i = 1; i <= L.default.nextPow2(e.size); i *= 2)e.buffers.push(new l.default(4 * i * e.vertByteSize)); e.indices = (0, s.default)(e.size), e.shader = null, e.currentIndex = 0, e.groups = []; for (var r = 0; r < e.size; r++)e.groups[r] = { textures: [], textureCount: 0, ids: [], size: 0, start: 0, blend: 0 }; return e.sprites = [], e.vertexBuffers = [], e.vaos = [], e.vaoMax = 2, e.vertexCount = 0, e.renderer.on("prerender", e.onPrerender, e), e } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), o.prototype.onContextChange = function () { for (var t = this.renderer.gl, e = (this.renderer.legacy ? this.MAX_TEXTURES = 1 : (this.MAX_TEXTURES = Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS), R.default.SPRITE_MAX_TEXTURES), this.MAX_TEXTURES = (0, h.default)(this.MAX_TEXTURES, t)), this.shader = (0, a.default)(t, this.MAX_TEXTURES), this.indexBuffer = k.default.GLBuffer.createIndexBuffer(t, this.indices, t.STATIC_DRAW), this.renderer.bindVao(null), this.shader.attributes), i = 0; i < this.vaoMax; i++) { var r = this.vertexBuffers[i] = k.default.GLBuffer.createVertexBuffer(t, null, t.STREAM_DRAW), n = this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(r, e.aVertexPosition, t.FLOAT, !1, this.vertByteSize, 0).addAttribute(r, e.aTextureCoord, t.UNSIGNED_SHORT, !0, this.vertByteSize, 8).addAttribute(r, e.aColor, t.UNSIGNED_BYTE, !0, this.vertByteSize, 12); e.aTextureId && n.addAttribute(r, e.aTextureId, t.FLOAT, !1, this.vertByteSize, 16), this.vaos[i] = n } this.vao = this.vaos[0], this.currentBlendMode = 99999, this.boundTextures = new Array(this.MAX_TEXTURES) }, o.prototype.onPrerender = function () { this.vertexCount = 0 }, o.prototype.render = function (t) { this.currentIndex >= this.size && this.flush(), t._texture._uvs && (this.sprites[this.currentIndex++] = t) }, o.prototype.flush = function () { if (0 !== this.currentIndex) { for (var u, c, f, d, t = this.renderer.gl, p = this.MAX_TEXTURES, g = L.default.nextPow2(this.currentIndex), g = L.default.log2(g), g = this.buffers[g], v = this.sprites, m = this.groups, e = g.float32View, i = g.uint32View, y = this.boundTextures, _ = this.renderer.boundTextures, b = this.renderer.textureGC.count, r = 0, n = void 0, o = void 0, x = 1, T = 0, s = m[0], w = I.premultiplyBlendMode[v[0]._texture.baseTexture.premultipliedAlpha ? 1 : 0][v[0].blendMode], a = (s.textureCount = 0, s.start = 0, s.blend = w, j++, void 0), a = 0; a < p; ++a) { var S = _[a]; S._enabled !== j ? ((y[a] = S)._virtalBoundId = a, S._enabled = j) : y[a] = this.renderer.emptyTextures[a] } for (j++, a = 0; a < this.currentIndex; ++a) { var C = v[a], h = (v[a] = null, n = C._texture.baseTexture, I.premultiplyBlendMode[Number(n.premultipliedAlpha)][C.blendMode]); if (w !== h && (w = h, o = null, T = p, j++), o !== n && (o = n)._enabled !== j) { if (T === p && (j++, s.size = a - s.start, T = 0, (s = m[x++]).blend = w, s.textureCount = 0, s.start = a), n.touched = b, -1 === n._virtalBoundId) for (var E = 0; E < p; ++E) { var O = (E + F) % p, P = y[O]; if (P._enabled !== j) { F++, P._virtalBoundId = -1, y[n._virtalBoundId = O] = n; break } } n._enabled = j, s.textureCount++, s.ids[T] = n._virtalBoundId, s.textures[T++] = n } h = C.vertexData, u = C._texture._uvs.uvsUint32, this.renderer.roundPixels ? (l = this.renderer.resolution, e[r] = (h[0] * l | 0) / l, e[r + 1] = (h[1] * l | 0) / l, e[r + 5] = (h[2] * l | 0) / l, e[r + 6] = (h[3] * l | 0) / l, e[r + 10] = (h[4] * l | 0) / l, e[r + 11] = (h[5] * l | 0) / l, e[r + 15] = (h[6] * l | 0) / l, e[r + 16] = (h[7] * l | 0) / l) : (e[r] = h[0], e[r + 1] = h[1], e[r + 5] = h[2], e[r + 6] = h[3], e[r + 10] = h[4], e[r + 11] = h[5], e[r + 15] = h[6], e[r + 16] = h[7]), i[r + 2] = u[0], i[r + 7] = u[1], i[r + 12] = u[2], i[r + 17] = u[3]; var l = Math.min(C.worldAlpha, 1), h = l < 1 && n.premultipliedAlpha ? (0, I.premultiplyTint)(C._tintRGB, l) : C._tintRGB + (255 * l << 24); i[r + 3] = i[r + 8] = i[r + 13] = i[r + 18] = h, e[r + 4] = e[r + 9] = e[r + 14] = e[r + 19] = n._virtalBoundId, r += 20 } for (s.size = a - s.start, R.default.CAN_UPLOAD_SAME_BUFFER ? this.vertexBuffers[this.vertexCount].upload(g.vertices, 0, !0) : (this.vaoMax <= this.vertexCount && (this.vaoMax++, c = this.shader.attributes, f = this.vertexBuffers[this.vertexCount] = k.default.GLBuffer.createVertexBuffer(t, null, t.STREAM_DRAW), d = this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(f, c.aVertexPosition, t.FLOAT, !1, this.vertByteSize, 0).addAttribute(f, c.aTextureCoord, t.UNSIGNED_SHORT, !0, this.vertByteSize, 8).addAttribute(f, c.aColor, t.UNSIGNED_BYTE, !0, this.vertByteSize, 12), c.aTextureId && d.addAttribute(f, c.aTextureId, t.FLOAT, !1, this.vertByteSize, 16), this.vaos[this.vertexCount] = d), this.renderer.bindVao(this.vaos[this.vertexCount]), this.vertexBuffers[this.vertexCount].upload(g.vertices, 0, !1), this.vertexCount++), a = 0; a < p; ++a)_[a]._virtalBoundId = -1; for (a = 0; a < x; ++a) { for (var M = m[a], A = M.textureCount, D = 0; D < A; D++)o = M.textures[D], _[M.ids[D]] !== o && this.renderer.bindTexture(o, M.ids[D], !0), o._virtalBoundId = -1; this.renderer.state.setBlendMode(M.blend), t.drawElements(t.TRIANGLES, 6 * M.size, t.UNSIGNED_SHORT, 6 * M.start * 2) } this.currentIndex = 0 } }, o.prototype.start = function () { this.renderer.bindShader(this.shader), R.default.CAN_UPLOAD_SAME_BUFFER && (this.renderer.bindVao(this.vaos[this.vertexCount]), this.vertexBuffers[this.vertexCount].bind()) }, o.prototype.stop = function () { this.flush() }, o.prototype.destroy = function () { for (var t = 0; t < this.vaoMax; t++)this.vertexBuffers[t] && this.vertexBuffers[t].destroy(), this.vaos[t] && this.vaos[t].destroy(); this.indexBuffer && this.indexBuffer.destroy(), this.renderer.off("prerender", this.onPrerender, this), n.prototype.destroy.call(this), this.shader && (this.shader.destroy(), this.shader = null), this.vertexBuffers = null, this.vaos = null, this.indexBuffer = null, this.indices = null, this.sprites = null; for (var e = 0; e < this.buffers.length; ++e)this.buffers[e].destroy() }, o }(i.default); e.default = t, o.default.registerPlugin("sprite", t) }, { "../../renderers/webgl/WebGLRenderer": 84, "../../renderers/webgl/utils/ObjectRenderer": 94, "../../renderers/webgl/utils/checkMaxIfStatmentsInShader": 97, "../../settings": 101, "../../utils": 125, "../../utils/createIndicesForQuads": 123, "./BatchBuffer": 105, "./generateMultiTextureShader": 107, "bit-twiddle": 1, "pixi-gl-core": 15 }], 107: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t, e) { for (var i = s, t = (i = (i = i.replace(/%count%/gi, e)).replace(/%forloop%/gi, function (t) { var e = ""; e += "\n\n"; for (var i = 0; i < t; i++)0 < i && (e += "\nelse "), i < t - 1 && (e += "if(textureId == " + i + ".0)"), e = (e += "\n{") + "\n\tcolor = texture2D(uSamplers[" + i + "], vTextureCoord);\n}"; return e += "\n\n" }(e)), new o.default(t, "precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}\n", i)), r = [], n = 0; n < e; n++)r[n] = n; return t.bind(), t.uniforms.uSamplers = r, t }; var i = t("../../Shader"), o = (i = i) && i.__esModule ? i : { default: i }; t("path"); var s = ["varying vec2 vTextureCoord;", "varying vec4 vColor;", "varying float vTextureId;", "uniform sampler2D uSamplers[%count%];", "void main(void){", "vec4 color;", "float textureId = floor(vTextureId+0.5);", "%forloop%", "gl_FragColor = color * vColor;", "}"].join("\n") }, { "../../Shader": 44, path: 8 }], 108: [function (t, o, e) { "use strict"; e.__esModule = !0; var i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var c = n(t("../sprites/Sprite")), s = n(t("../textures/Texture")), a = t("../math"), h = t("../utils"), g = t("../const"), l = n(t("../settings")), u = n(t("./TextStyle")), v = n(t("./TextMetrics")), f = n(t("../utils/trimCanvas")); function n(t) { return t && t.__esModule ? t : { default: t } } var d = { texture: !0, children: !1, baseTexture: !0 }, t = function (n) { var t = o, e = n; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function o(t, e, i) { if (!(this instanceof o)) throw new TypeError("Cannot call a class as a function"); (i = i || document.createElement("canvas")).width = 3, i.height = 3; var r = s.default.fromCanvas(i, l.default.SCALE_MODE, "text"), r = (r.orig = new a.Rectangle, r.trim = new a.Rectangle, function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, n.call(this, r))); return s.default.addToCache(r._texture, r._texture.baseTexture.textureCacheIds[0]), r.canvas = i, r.context = r.canvas.getContext("2d"), r.resolution = l.default.RESOLUTION, r._text = null, r._style = null, r._styleListener = null, r._font = "", r.text = t, r.style = e, r.localStyleID = -1, r } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), o.prototype.updateText = function (t) { var e = this._style; if (this.localStyleID !== e.styleID && (this.dirty = !0, this.localStyleID = e.styleID), this.dirty || !t) { this._font = this._style.toFontString(); var i = this.context, t = v.default.measureText(this._text, this._style, this._style.wordWrap, this.canvas), u = t.width, c = t.height, r = t.lines, f = t.lineHeight, n = t.lineWidths, o = t.maxLineWidth, d = t.fontProperties, s = (this.canvas.width = Math.ceil((Math.max(1, u) + 2 * e.padding) * this.resolution), this.canvas.height = Math.ceil((Math.max(1, c) + 2 * e.padding) * this.resolution), i.scale(this.resolution, this.resolution), i.clearRect(0, 0, this.canvas.width, this.canvas.height), i.font = this._font, i.strokeStyle = e.stroke, i.lineWidth = e.strokeThickness, i.textBaseline = e.textBaseline, i.lineJoin = e.lineJoin, i.miterLimit = e.miterLimit, void 0), a = void 0; if (e.dropShadow) { i.fillStyle = e.dropShadowColor, i.globalAlpha = e.dropShadowAlpha, i.shadowBlur = e.dropShadowBlur, 0 < e.dropShadowBlur && (i.shadowColor = e.dropShadowColor); for (var p = Math.cos(e.dropShadowAngle) * e.dropShadowDistance, g = Math.sin(e.dropShadowAngle) * e.dropShadowDistance, h = 0; h < r.length; h++)s = e.strokeThickness / 2, a = e.strokeThickness / 2 + h * f + d.ascent, "right" === e.align ? s += o - n[h] : "center" === e.align && (s += (o - n[h]) / 2), e.fill && (this.drawLetterSpacing(r[h], s + p + e.padding, a + g + e.padding), e.stroke && e.strokeThickness && (i.strokeStyle = e.dropShadowColor, this.drawLetterSpacing(r[h], s + p + e.padding, a + g + e.padding, !0), i.strokeStyle = e.stroke)) } i.shadowBlur = 0, i.globalAlpha = 1, i.fillStyle = this._generateFillStyle(e, r); for (var l = 0; l < r.length; l++)s = e.strokeThickness / 2, a = e.strokeThickness / 2 + l * f + d.ascent, "right" === e.align ? s += o - n[l] : "center" === e.align && (s += (o - n[l]) / 2), e.stroke && e.strokeThickness && this.drawLetterSpacing(r[l], s + e.padding, a + e.padding, !0), e.fill && this.drawLetterSpacing(r[l], s + e.padding, a + e.padding); this.updateTexture() } }, o.prototype.drawLetterSpacing = function (t, e, i) { var r = 3 < arguments.length && void 0 !== arguments[3] && arguments[3], n = this._style.letterSpacing; if (0 !== n) for (var o, s = String.prototype.split.call(t, ""), a = e, h = 0; h < t.length;)o = s[h++], r ? this.context.strokeText(o, a, i) : this.context.fillText(o, a, i), a += this.context.measureText(o).width + n; else r ? this.context.strokeText(t, e, i) : this.context.fillText(t, e, i) }, o.prototype.updateTexture = function () { var t = this.canvas, e = (this._style.trim && (e = (0, f.default)(t), t.width = e.width, t.height = e.height, this.context.putImageData(e.data, 0, 0)), this._texture), i = this._style, i = i.trim ? 0 : i.padding, r = e.baseTexture; r.hasLoaded = !0, r.resolution = this.resolution, r.realWidth = t.width, r.realHeight = t.height, r.width = t.width / this.resolution, r.height = t.height / this.resolution, e.trim.width = e._frame.width = t.width / this.resolution, e.trim.height = e._frame.height = t.height / this.resolution, e.trim.x = -i, e.trim.y = -i, e.orig.width = e._frame.width - 2 * i, e.orig.height = e._frame.height - 2 * i, this._onTextureUpdate(), r.emit("update", r), this.dirty = !1 }, o.prototype.renderWebGL = function (t) { this.resolution !== t.resolution && (this.resolution = t.resolution, this.dirty = !0), this.updateText(!0), n.prototype.renderWebGL.call(this, t) }, o.prototype._renderCanvas = function (t) { this.resolution !== t.resolution && (this.resolution = t.resolution, this.dirty = !0), this.updateText(!0), n.prototype._renderCanvas.call(this, t) }, o.prototype.getLocalBounds = function (t) { return this.updateText(!0), n.prototype.getLocalBounds.call(this, t) }, o.prototype._calculateBounds = function () { this.updateText(!0), this.calculateVertices(), this._bounds.addQuad(this.vertexData) }, o.prototype._onStyleChange = function () { this.dirty = !0 }, o.prototype._generateFillStyle = function (t, e) { if (!Array.isArray(t.fill)) return t.fill; if (navigator.isCocoonJS) return t.fill[0]; var i = void 0, r = void 0, n = void 0, o = void 0, u = this.canvas.width / this.resolution, c = this.canvas.height / this.resolution, s = t.fill.slice(), a = t.fillGradientStops.slice(); if (!a.length) for (var f = s.length + 1, d = 1; d < f; ++d)a.push(d / f); if (s.unshift(t.fill[0]), a.unshift(0), s.push(t.fill[t.fill.length - 1]), a.push(1), t.fillGradientType === g.TEXT_GRADIENT.LINEAR_VERTICAL) for (var i = this.context.createLinearGradient(u / 2, 0, u / 2, c), r = (s.length + 1) * e.length, n = 0, p = 0; p < e.length; p++) { n += 1; for (var h = 0; h < s.length; h++)o = "number" == typeof a[h] ? a[h] / e.length + p / e.length : n / r, i.addColorStop(o, s[h]), n++ } else { i = this.context.createLinearGradient(0, c / 2, u, c / 2), r = s.length + 1, n = 1; for (var l = 0; l < s.length; l++)o = "number" == typeof a[l] ? a[l] : n / r, i.addColorStop(o, s[l]), n++ } return i }, o.prototype.destroy = function (t) { "boolean" == typeof t && (t = { children: t }), t = Object.assign({}, d, t), n.prototype.destroy.call(this, t), this.context = null, this.canvas = null, this._style = null }, i(o, [{ key: "width", get: function () { return this.updateText(!0), Math.abs(this.scale.x) * this._texture.orig.width }, set: function (t) { this.updateText(!0); var e = (0, h.sign)(this.scale.x) || 1; this.scale.x = e * t / this._texture.orig.width, this._width = t } }, { key: "height", get: function () { return this.updateText(!0), Math.abs(this.scale.y) * this._texture.orig.height }, set: function (t) { this.updateText(!0); var e = (0, h.sign)(this.scale.y) || 1; this.scale.y = e * t / this._texture.orig.height, this._height = t } }, { key: "style", get: function () { return this._style }, set: function (t) { (t = t || {}) instanceof u.default ? this._style = t : this._style = new u.default(t), this.localStyleID = -1, this.dirty = !0 } }, { key: "text", get: function () { return this._text }, set: function (t) { t = String("" === t || null == t ? " " : t), this._text !== t && (this._text = t, this.dirty = !0) } }]), o }(c.default); e.default = t }, { "../const": 46, "../math": 70, "../settings": 101, "../sprites/Sprite": 102, "../textures/Texture": 115, "../utils": 125, "../utils/trimCanvas": 130, "./TextMetrics": 109, "./TextStyle": 110 }], 109: [function (t, e, i) { "use strict"; i.__esModule = !0; C.measureText = function (t, e, i) { var r = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : C._canvas, n = (i = i || e.wordWrap, e.toFontString()), o = C.measureFont(n), l = r.getContext("2d"); l.font = n; for (var s = (i ? C.wordWrap(t, e, r) : t).split(/(?:\r\n|\r|\n)/), u = new Array(s.length), a = 0, h = 0; h < s.length; h++) { var c = l.measureText(s[h]).width + (s[h].length - 1) * e.letterSpacing; u[h] = c, a = Math.max(a, c) } n = a + e.strokeThickness, e.dropShadow && (n += e.dropShadowDistance), i = e.lineHeight || o.fontSize + e.strokeThickness, r = Math.max(i, o.fontSize + e.strokeThickness) + (s.length - 1) * (i + e.leading); return e.dropShadow && (r += e.dropShadowDistance), new C(t, e, n, r, s, u, i + e.leading, a, o) }, C.wordWrap = function (u, t) { for (var c = (2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : C._canvas).getContext("2d"), e = 0, i = "", r = "", f = {}, d = t.letterSpacing, p = t.whiteSpace, g = C.collapseSpaces(p), v = C.collapseNewlines(p), n = !g, m = t.wordWrapWidth + d, y = C.tokenize(u), o = 0; o < y.length; o++) { var s = y[o]; if (C.isNewline(s)) { if (!v) { r += C.addLine(i), n = !g, i = "", e = 0; continue } s = " " } if (g) { var a = C.isBreakingSpace(s), _ = C.isBreakingSpace(i[i.length - 1]); if (a && _) continue } a = C.getFromCache(s, d, f, c); if (m < a) if ("" !== i && (r += C.addLine(i), i = "", e = 0), C.canBreakWords(s, t.breakWords)) for (var b = s.split(""), h = 0; h < b.length; h++) { for (var l = b[h], x = 1; b[h + x];) { var T = b[h + x], w = l[l.length - 1]; if (C.canBreakChars(w, T, s, h, t.breakWords)) break; l += T, x++ } h += l.length - 1; var S = C.getFromCache(l, d, f, c); m < S + e && (r += C.addLine(i), n = !1, i = "", e = 0), i += l, e += S } else { 0 < i.length && (r += C.addLine(i), i = "", e = 0); _ = o === y.length - 1; r += C.addLine(s, !_), n = !1, i = "", e = 0 } else m < a + e && (n = !1, r += C.addLine(i), i = "", e = 0), (0 < i.length || !C.isBreakingSpace(s) || n) && (i += s, e += a) } return r += C.addLine(i, !1) }, C.addLine = function (t) { var e = !(1 < arguments.length && void 0 !== arguments[1]) || arguments[1]; return t = C.trimRight(t), t = e ? t + "\n" : t }, C.getFromCache = function (t, e, i, r) { var n = i[t]; return void 0 === n && (e = t.length * e, n = r.measureText(t).width + e, i[t] = n), n }, C.collapseSpaces = function (t) { return "normal" === t || "pre-line" === t }, C.collapseNewlines = function (t) { return "normal" === t }, C.trimRight = function (t) { if ("string" != typeof t) return ""; for (var e = t.length - 1; 0 <= e; e--) { var i = t[e]; if (!C.isBreakingSpace(i)) break; t = t.slice(0, -1) } return t }, C.isNewline = function (t) { return "string" == typeof t && 0 <= C._newlines.indexOf(t.charCodeAt(0)) }, C.isBreakingSpace = function (t) { return "string" == typeof t && 0 <= C._breakingSpaces.indexOf(t.charCodeAt(0)) }, C.tokenize = function (t) { var e = [], i = ""; if ("string" != typeof t) return e; for (var r = 0; r < t.length; r++) { var n = t[r]; C.isBreakingSpace(n) || C.isNewline(n) ? ("" !== i && (e.push(i), i = ""), e.push(n)) : i += n } return "" !== i && e.push(i), e }, C.canBreakWords = function (t, e) { return e }, C.canBreakChars = function (t, e, i, r, n) { return !0 }, C.measureFont = function (t) { if (C._fonts[t]) return C._fonts[t]; for (var e = {}, u = C._canvas, i = C._context, c = (i.font = t, C.METRICS_STRING + C.BASELINE_SYMBOL), r = Math.ceil(i.measureText(c).width), n = 2 * (o = Math.ceil(i.measureText(C.BASELINE_SYMBOL).width)), o = o * C.BASELINE_MULTIPLIER | 0, f = (u.width = r, u.height = n, i.fillStyle = "#f00", i.fillRect(0, 0, r, n), i.font = t, i.textBaseline = "alphabetic", i.fillStyle = "#000", i.fillText(c, 0, o), i.getImageData(0, 0, r, n).data), u = f.length, s = 4 * r, a = 0, h = 0, l = !1, a = 0; a < o; ++a) { for (var d = 0; d < s; d += 4)if (255 !== f[h + d]) { l = !0; break } if (l) break; h += s } for (e.ascent = o - a, h = u - s, l = !1, a = n; o < a; --a) { for (var p = 0; p < s; p += 4)if (255 !== f[h + p]) { l = !0; break } if (l) break; h -= s } return e.descent = a - o, e.fontSize = e.ascent + e.descent, C._fonts[t] = e }, C.clearMetrics = function () { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : ""; t ? delete C._fonts[t] : C._fonts = {} }; var r = C; function C(t, e, i, r, n, o, s, a, h) { if (!(this instanceof C)) throw new TypeError("Cannot call a class as a function"); this.text = t, this.style = e, this.width = i, this.height = r, this.lines = n, this.lineWidths = o, this.lineHeight = s, this.maxLineWidth = a, this.fontProperties = h } i.default = r; i = document.createElement("canvas"); i.width = i.height = 10, r._canvas = i, r._context = i.getContext("2d"), r._fonts = {}, r.METRICS_STRING = "|q", r.BASELINE_SYMBOL = "M", r.BASELINE_MULTIPLIER = 1.4, r._newlines = [10, 13], r._breakingSpaces = [9, 32, 8192, 8193, 8194, 8195, 8196, 8197, 8198, 8200, 8201, 8202, 8287, 12288] }, {}], 110: [function (t, u, e) { "use strict"; e.__esModule = !0; var i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var n = t("../const"), c = t("../utils"); var o = { align: "left", breakWords: !1, dropShadow: !1, dropShadowAlpha: 1, dropShadowAngle: Math.PI / 6, dropShadowBlur: 0, dropShadowColor: "black", dropShadowDistance: 5, fill: "black", fillGradientType: n.TEXT_GRADIENT.LINEAR_VERTICAL, fillGradientStops: [], fontFamily: "Arial", fontSize: 26, fontStyle: "normal", fontVariant: "normal", fontWeight: "normal", letterSpacing: 0, lineHeight: 0, lineJoin: "miter", miterLimit: 10, padding: 0, stroke: "black", strokeThickness: 0, textBaseline: "alphabetic", trim: !1, whiteSpace: "pre", wordWrap: !1, wordWrapWidth: 100, leading: 0 }; function s(t) { if (!(this instanceof s)) throw new TypeError("Cannot call a class as a function"); this.styleID = 0, this.reset(), l(this, t, t) } function a(t) { return "number" == typeof t ? (0, c.hex2string)(t) : "string" == typeof t && 0 === t.indexOf("0x") ? t.replace("0x", "#") : t } function h(t) { if (Array.isArray(t)) { for (var e = 0; e < t.length; ++e)t[e] = a(t[e]); return t } return a(t) } function l(t, e, i) { for (var r in i) Array.isArray(e[r]) ? t[r] = e[r].slice() : t[r] = e[r] } s.prototype.clone = function () { var t = {}; return l(t, this, o), new s(t) }, s.prototype.reset = function () { l(this, o, o) }, s.prototype.toFontString = function () { for (var t = "number" == typeof this.fontSize ? this.fontSize + "px" : this.fontSize, e = this.fontFamily, i = (e = Array.isArray(this.fontFamily) ? e : this.fontFamily.split(",")).length - 1; 0 <= i; i--) { var r = e[i].trim(); /([\"\'])[^\'\"]+\1/.test(r) || (r = '"' + r + '"'), e[i] = r } return this.fontStyle + " " + this.fontVariant + " " + this.fontWeight + " " + t + " " + e.join(",") }, i(s, [{ key: "align", get: function () { return this._align }, set: function (t) { this._align !== t && (this._align = t, this.styleID++) } }, { key: "breakWords", get: function () { return this._breakWords }, set: function (t) { this._breakWords !== t && (this._breakWords = t, this.styleID++) } }, { key: "dropShadow", get: function () { return this._dropShadow }, set: function (t) { this._dropShadow !== t && (this._dropShadow = t, this.styleID++) } }, { key: "dropShadowAlpha", get: function () { return this._dropShadowAlpha }, set: function (t) { this._dropShadowAlpha !== t && (this._dropShadowAlpha = t, this.styleID++) } }, { key: "dropShadowAngle", get: function () { return this._dropShadowAngle }, set: function (t) { this._dropShadowAngle !== t && (this._dropShadowAngle = t, this.styleID++) } }, { key: "dropShadowBlur", get: function () { return this._dropShadowBlur }, set: function (t) { this._dropShadowBlur !== t && (this._dropShadowBlur = t, this.styleID++) } }, { key: "dropShadowColor", get: function () { return this._dropShadowColor }, set: function (t) { t = h(t); this._dropShadowColor !== t && (this._dropShadowColor = t, this.styleID++) } }, { key: "dropShadowDistance", get: function () { return this._dropShadowDistance }, set: function (t) { this._dropShadowDistance !== t && (this._dropShadowDistance = t, this.styleID++) } }, { key: "fill", get: function () { return this._fill }, set: function (t) { t = h(t); this._fill !== t && (this._fill = t, this.styleID++) } }, { key: "fillGradientType", get: function () { return this._fillGradientType }, set: function (t) { this._fillGradientType !== t && (this._fillGradientType = t, this.styleID++) } }, { key: "fillGradientStops", get: function () { return this._fillGradientStops }, set: function (t) { !function (t, e) { if (!Array.isArray(t) || !Array.isArray(e)) return !1; if (t.length !== e.length) return !1; for (var i = 0; i < t.length; ++i)if (t[i] !== e[i]) return !1; return !0 }(this._fillGradientStops, t) && (this._fillGradientStops = t, this.styleID++) } }, { key: "fontFamily", get: function () { return this._fontFamily }, set: function (t) { this.fontFamily !== t && (this._fontFamily = t, this.styleID++) } }, { key: "fontSize", get: function () { return this._fontSize }, set: function (t) { this._fontSize !== t && (this._fontSize = t, this.styleID++) } }, { key: "fontStyle", get: function () { return this._fontStyle }, set: function (t) { this._fontStyle !== t && (this._fontStyle = t, this.styleID++) } }, { key: "fontVariant", get: function () { return this._fontVariant }, set: function (t) { this._fontVariant !== t && (this._fontVariant = t, this.styleID++) } }, { key: "fontWeight", get: function () { return this._fontWeight }, set: function (t) { this._fontWeight !== t && (this._fontWeight = t, this.styleID++) } }, { key: "letterSpacing", get: function () { return this._letterSpacing }, set: function (t) { this._letterSpacing !== t && (this._letterSpacing = t, this.styleID++) } }, { key: "lineHeight", get: function () { return this._lineHeight }, set: function (t) { this._lineHeight !== t && (this._lineHeight = t, this.styleID++) } }, { key: "leading", get: function () { return this._leading }, set: function (t) { this._leading !== t && (this._leading = t, this.styleID++) } }, { key: "lineJoin", get: function () { return this._lineJoin }, set: function (t) { this._lineJoin !== t && (this._lineJoin = t, this.styleID++) } }, { key: "miterLimit", get: function () { return this._miterLimit }, set: function (t) { this._miterLimit !== t && (this._miterLimit = t, this.styleID++) } }, { key: "padding", get: function () { return this._padding }, set: function (t) { this._padding !== t && (this._padding = t, this.styleID++) } }, { key: "stroke", get: function () { return this._stroke }, set: function (t) { t = h(t); this._stroke !== t && (this._stroke = t, this.styleID++) } }, { key: "strokeThickness", get: function () { return this._strokeThickness }, set: function (t) { this._strokeThickness !== t && (this._strokeThickness = t, this.styleID++) } }, { key: "textBaseline", get: function () { return this._textBaseline }, set: function (t) { this._textBaseline !== t && (this._textBaseline = t, this.styleID++) } }, { key: "trim", get: function () { return this._trim }, set: function (t) { this._trim !== t && (this._trim = t, this.styleID++) } }, { key: "whiteSpace", get: function () { return this._whiteSpace }, set: function (t) { this._whiteSpace !== t && (this._whiteSpace = t, this.styleID++) } }, { key: "wordWrap", get: function () { return this._wordWrap }, set: function (t) { this._wordWrap !== t && (this._wordWrap = t, this.styleID++) } }, { key: "wordWrapWidth", get: function () { return this._wordWrapWidth }, set: function (t) { this._wordWrapWidth !== t && (this._wordWrapWidth = t, this.styleID++) } }]), e.default = s }, { "../const": 46, "../utils": 125 }], 111: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = n(t("./BaseTexture")), h = n(t("../settings")); function n(t) { return t && t.__esModule ? t : { default: t } } t = function (s) { var t = a, e = s; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function a() { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 100, e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 100, i = arguments[2], r = arguments[3], n = this, o = a; if (!(n instanceof o)) throw new TypeError("Cannot call a class as a function"); n = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, s.call(this, null, i)); return n.resolution = r || h.default.RESOLUTION, n.width = Math.ceil(t), n.height = Math.ceil(e), n.realWidth = n.width * n.resolution, n.realHeight = n.height * n.resolution, n.scaleMode = void 0 !== i ? i : h.default.SCALE_MODE, n.hasLoaded = !0, n._glRenderTargets = {}, n._canvasRenderTarget = null, n.valid = !1, n } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), a.prototype.resize = function (t, e) { t = Math.ceil(t), e = Math.ceil(e), t === this.width && e === this.height || (this.valid = 0 < t && 0 < e, this.width = t, this.height = e, this.realWidth = this.width * this.resolution, this.realHeight = this.height * this.resolution, this.valid && this.emit("update", this)) }, a.prototype.destroy = function () { s.prototype.destroy.call(this, !0), this.renderer = null }, a }(r.default); i.default = t }, { "../settings": 101, "./BaseTexture": 112 }], 112: [function (t, e, i) { "use strict"; i.__esModule = !0; var a = t("../utils"), o = n(t("../settings")), r = n(t("eventemitter3")), h = n(t("../utils/determineCrossOrigin")), l = n(t("bit-twiddle")); function n(t) { return t && t.__esModule ? t : { default: t } } t = function (n) { var t = s, e = n; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function s(t, e, i) { if (!(this instanceof s)) throw new TypeError("Cannot call a class as a function"); var r = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, n.call(this)); return r.uid = (0, a.uid)(), r.touched = 0, r.resolution = i || o.default.RESOLUTION, r.width = 100, r.height = 100, r.realWidth = 100, r.realHeight = 100, r.scaleMode = void 0 !== e ? e : o.default.SCALE_MODE, r.hasLoaded = !1, r.isLoading = !1, r.source = null, r.origSource = null, r.imageType = null, r.sourceScale = 1, r.premultipliedAlpha = !0, r.imageUrl = null, r.isPowerOfTwo = !1, r.mipmap = o.default.MIPMAP_TEXTURES, r.wrapMode = o.default.WRAP_MODE, r._glTextures = {}, r._enabled = 0, r._virtalBoundId = -1, r._destroyed = !1, r.textureCacheIds = [], t && r.loadSource(t), r } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), s.prototype.update = function () { "svg" !== this.imageType && (this.realWidth = this.source.naturalWidth || this.source.videoWidth || this.source.width, this.realHeight = this.source.naturalHeight || this.source.videoHeight || this.source.height, this._updateDimensions()), this.emit("update", this) }, s.prototype._updateDimensions = function () { this.width = this.realWidth / this.resolution, this.height = this.realHeight / this.resolution, this.isPowerOfTwo = l.default.isPow2(this.realWidth) && l.default.isPow2(this.realHeight) }, s.prototype.loadSource = function (t) { var e, i = this.isLoading, r = (this.hasLoaded = !1, this.isLoading = !1, i && this.source && (this.source.onload = null, this.source.onerror = null), !this.source); (this.source = t) && t.close ? this._sourceLoaded() : (t.src && t.complete || t.getContext) && t.width && t.height ? (this._updateImageType(), "svg" === this.imageType ? this._loadSvgSource() : this._sourceLoaded(), r && this.emit("loaded", this)) : t.getContext || (this.isLoading = !0, e = this, t.onload = function () { e._updateImageType(), t.onload = null, t.onerror = null, e.isLoading && (e.isLoading = !1, e._sourceLoaded(), "svg" !== e.imageType ? e.emit("loaded", e) : e._loadSvgSource()) }, t.onerror = function () { t.onload = null, t.onerror = null, e.isLoading && (e.isLoading = !1, e.emit("error", e)) }, t.complete && t.src && (t.onload = null, t.onerror = null, "svg" !== e.imageType ? (this.isLoading = !1, t.width && t.height ? (this._sourceLoaded(), i && this.emit("loaded", this)) : i && this.emit("error", this)) : e._loadSvgSource())) }, s.prototype._updateImageType = function () { if (this.imageUrl) { var t = (0, a.decomposeDataUri)(this.imageUrl), e = void 0; if (t && "image" === t.mediaType) { t = t.subType.split("+")[0]; if (!(e = (0, a.getUrlFileExtension)("." + t))) throw new Error("Invalid image type in data URI.") } else e = (e = (0, a.getUrlFileExtension)(this.imageUrl)) || "png"; this.imageType = e } }, s.prototype._loadSvgSource = function () { var t; "svg" === this.imageType && ((t = (0, a.decomposeDataUri)(this.imageUrl)) ? this._loadSvgSourceUsingDataUri(t) : this._loadSvgSourceUsingXhr()) }, s.prototype._loadSvgSourceUsingDataUri = function (t) { var e = void 0; if ("base64" === t.encoding) { if (!atob) throw new Error("Your browser doesn't support base64 conversions."); e = atob(t.data) } else e = t.data; this._loadSvgSourceUsingString(e) }, s.prototype._loadSvgSourceUsingXhr = function () { var t = this, e = new XMLHttpRequest; e.onload = function () { if (e.readyState !== e.DONE || 200 !== e.status) throw new Error("Failed to load SVG using XHR."); t._loadSvgSourceUsingString(e.response) }, e.onerror = function () { return t.emit("error", t) }, e.open("GET", this.imageUrl, !0), e.send() }, s.prototype._loadSvgSourceUsingString = function (t) { var t = (0, a.getSvgSize)(t), e = t.width, t = t.height; if (!e || !t) throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them."); this.realWidth = Math.round(e * this.sourceScale), this.realHeight = Math.round(t * this.sourceScale), this._updateDimensions(); var i = document.createElement("canvas"); i.width = this.realWidth, i.height = this.realHeight, i._pixiId = "canvas_" + (0, a.uid)(), i.getContext("2d").drawImage(this.source, 0, 0, e, t, 0, 0, this.realWidth, this.realHeight), this.origSource = this.source, this.source = i, s.addToCache(this, i._pixiId), this.isLoading = !1, this._sourceLoaded(), this.emit("loaded", this) }, s.prototype._sourceLoaded = function () { this.hasLoaded = !0, this.update() }, s.prototype.destroy = function () { this.imageUrl && (delete a.TextureCache[this.imageUrl], this.imageUrl = null, navigator.isCocoonJS || (this.source.src = "")), this.source = null, this.dispose(), s.removeFromCache(this), this.textureCacheIds = null, this._destroyed = !0 }, s.prototype.dispose = function () { this.emit("dispose", this) }, s.prototype.updateSourceImage = function (t) { this.source.src = t, this.loadSource(this.source) }, s.fromImage = function (t, e, i, r) { var n, o = a.BaseTextureCache[t]; return o || (n = new Image, void 0 === e && 0 !== t.indexOf("data:") ? n.crossOrigin = (0, h.default)(t) : e && (n.crossOrigin = "string" == typeof e ? e : "anonymous"), (o = new s(n, i)).imageUrl = t, r && (o.sourceScale = r), o.resolution = (0, a.getResolutionOfUrl)(t), n.src = t, s.addToCache(o, t)), o }, s.fromCanvas = function (t, e) { t._pixiId || (t._pixiId = (2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : "canvas") + "_" + (0, a.uid)()); var i = a.BaseTextureCache[t._pixiId]; return i || (i = new s(t, e), s.addToCache(i, t._pixiId)), i }, s.from = function (t, e, i) { return "string" == typeof t ? s.fromImage(t, void 0, e, i) : t instanceof HTMLImageElement ? (r = t.src, (n = a.BaseTextureCache[r]) || ((n = new s(t, e)).imageUrl = r, i && (n.sourceScale = i), n.resolution = (0, a.getResolutionOfUrl)(r), s.addToCache(n, r)), n) : t instanceof HTMLCanvasElement ? s.fromCanvas(t, e) : t; var r, n }, s.addToCache = function (t, e) { e && (-1 === t.textureCacheIds.indexOf(e) && t.textureCacheIds.push(e), a.BaseTextureCache[e] && console.warn("BaseTexture added to the cache with an id [" + e + "] that already had an entry"), a.BaseTextureCache[e] = t) }, s.removeFromCache = function (t) { if ("string" == typeof t) { var e, i = a.BaseTextureCache[t]; if (i) return -1 < (e = i.textureCacheIds.indexOf(t)) && i.textureCacheIds.splice(e, 1), delete a.BaseTextureCache[t], i } else if (t && t.textureCacheIds) { for (var r = 0; r < t.textureCacheIds.length; ++r)delete a.BaseTextureCache[t.textureCacheIds[r]]; return t.textureCacheIds.length = 0, t } return null }, s }(r.default); i.default = t }, { "../settings": 101, "../utils": 125, "../utils/determineCrossOrigin": 124, "bit-twiddle": 1, eventemitter3: 3 }], 113: [function (t, e, i) { "use strict"; i.__esModule = !0; var l = r(t("./BaseRenderTexture")); function r(t) { return t && t.__esModule ? t : { default: t } } t = function (a) { var t = h, e = a; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function h(t, e) { var i = this, r = h; if (!(i instanceof r)) throw new TypeError("Cannot call a class as a function"); var n, o, s, i = null, r = (t instanceof l.default || (r = arguments[1], n = arguments[2], o = arguments[3], s = arguments[4], console.warn("Please use RenderTexture.create(" + r + ", " + n + ") instead of the ctor directly."), i = arguments[0], e = null, t = new l.default(r, n, o, s)), function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, a.call(this, t, e))); return r.legacyRenderer = i, r.valid = !0, r._updateUvs(), r } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), h.prototype.resize = function (t, e, i) { t = Math.ceil(t), e = Math.ceil(e), this.valid = 0 < t && 0 < e, this._frame.width = this.orig.width = t, this._frame.height = this.orig.height = e, i || this.baseTexture.resize(t, e), this._updateUvs() }, h.create = function (t, e, i, r) { return new h(new l.default(t, e, i, r)) }, h }(r(t("./Texture")).default); i.default = t }, { "./BaseRenderTexture": 111, "./Texture": 115 }], 114: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var u = t("../"), o = t("../utils"); function c(t, e) { var i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : null, r = this, n = c; if (!(r instanceof n)) throw new TypeError("Cannot call a class as a function"); this.baseTexture = t, this.textures = {}, this.data = e, this.resolution = this._updateResolution(i || this.baseTexture.imageUrl), this._frames = this.data.frames, this._frameKeys = Object.keys(this._frames), this._batchIndex = 0, this._callback = null } r(c, null, [{ key: "BATCH_SIZE", get: function () { return 1e3 } }]), c.prototype._updateResolution = function (t) { var e = this.data.meta.scale, t = (0, o.getResolutionOfUrl)(t, null); return 1 !== (t = null === t ? void 0 !== e ? parseFloat(e) : 1 : t) && (this.baseTexture.resolution = t, this.baseTexture.update()), t }, c.prototype.parse = function (t) { this._batchIndex = 0, this._callback = t, this._frameKeys.length <= c.BATCH_SIZE ? (this._processFrames(0), this._parseComplete()) : this._nextBatch() }, c.prototype._processFrames = function (t) { for (var e = t, i = c.BATCH_SIZE, r = this.baseTexture.sourceScale; e - t < i && e < this._frameKeys.length;) { var n, o, s, a = this._frameKeys[e], h = this._frames[a], l = h.frame; l && (n = s = null, o = !1 !== h.trimmed && h.sourceSize ? h.sourceSize : h.frame, o = new u.Rectangle(0, 0, Math.floor(o.w * r) / this.resolution, Math.floor(o.h * r) / this.resolution), s = h.rotated ? new u.Rectangle(Math.floor(l.x * r) / this.resolution, Math.floor(l.y * r) / this.resolution, Math.floor(l.h * r) / this.resolution, Math.floor(l.w * r) / this.resolution) : new u.Rectangle(Math.floor(l.x * r) / this.resolution, Math.floor(l.y * r) / this.resolution, Math.floor(l.w * r) / this.resolution, Math.floor(l.h * r) / this.resolution), !1 !== h.trimmed && h.spriteSourceSize && (n = new u.Rectangle(Math.floor(h.spriteSourceSize.x * r) / this.resolution, Math.floor(h.spriteSourceSize.y * r) / this.resolution, Math.floor(l.w * r) / this.resolution, Math.floor(l.h * r) / this.resolution)), this.textures[a] = new u.Texture(this.baseTexture, s, o, n, h.rotated ? 2 : 0), u.Texture.addToCache(this.textures[a], a)), e++ } }, c.prototype._parseComplete = function () { var t = this._callback; this._callback = null, this._batchIndex = 0, t.call(this, this.textures) }, c.prototype._nextBatch = function () { var t = this; this._processFrames(this._batchIndex * c.BATCH_SIZE), this._batchIndex++, setTimeout(function () { t._batchIndex * c.BATCH_SIZE < t._frameKeys.length ? t._nextBatch() : t._parseComplete() }, 0) }, c.prototype.destroy = function () { var t, e = 0 < arguments.length && void 0 !== arguments[0] && arguments[0]; for (t in this.textures) this.textures[t].destroy(); this._frames = null, this._frameKeys = null, this.data = null, this.textures = null, e && this.baseTexture.destroy(), this.baseTexture = null }, i.default = c }, { "../": 65, "../utils": 125 }], 115: [function (t, u, e) { "use strict"; e.__esModule = !0; var c = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = s(t("./BaseTexture")), i = s(t("./VideoBaseTexture")), f = s(t("./TextureUvs")), n = s(t("eventemitter3")), h = t("../math"), l = t("../utils"), d = s(t("../settings")); function s(t) { return t && t.__esModule ? t : { default: t } } t = function (s) { var t = a, e = s; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function a(t, e, i, r, n) { if (!(this instanceof a)) throw new TypeError("Cannot call a class as a function"); var o = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, s.call(this)); if (o.noFrame = !1, e || (o.noFrame = !0, e = new h.Rectangle(0, 0, 1, 1)), t instanceof a && (t = t.baseTexture), o.baseTexture = t, o._frame = e, o.trim = r, o.valid = !1, o.requiresUpdate = !1, o._uvs = null, o.orig = i || e, o._rotate = Number(n || 0), !0 === n) o._rotate = 2; else if (o._rotate % 2 != 0) throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually"); return t.hasLoaded ? (o.noFrame && (e = new h.Rectangle(0, 0, t.width, t.height), t.on("update", o.onBaseTextureUpdated, o)), o.frame = e) : t.once("loaded", o.onBaseTextureLoaded, o), o._updateID = 0, o.transform = null, o.textureCacheIds = [], o } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), a.prototype.update = function () { this.baseTexture.update() }, a.prototype.onBaseTextureLoaded = function (t) { this._updateID++, this.noFrame ? this.frame = new h.Rectangle(0, 0, t.width, t.height) : this.frame = this._frame, this.baseTexture.on("update", this.onBaseTextureUpdated, this), this.emit("update", this) }, a.prototype.onBaseTextureUpdated = function (t) { this._updateID++, this._frame.width = t.width, this._frame.height = t.height, this.emit("update", this) }, a.prototype.destroy = function (t) { this.baseTexture && (t && (l.TextureCache[this.baseTexture.imageUrl] && a.removeFromCache(this.baseTexture.imageUrl), this.baseTexture.destroy()), this.baseTexture.off("update", this.onBaseTextureUpdated, this), this.baseTexture.off("loaded", this.onBaseTextureLoaded, this), this.baseTexture = null), this._frame = null, this._uvs = null, this.trim = null, this.orig = null, this.valid = !1, a.removeFromCache(this), this.textureCacheIds = null }, a.prototype.clone = function () { return new a(this.baseTexture, this.frame, this.orig, this.trim, this.rotate) }, a.prototype._updateUvs = function () { this._uvs || (this._uvs = new f.default), this._uvs.set(this._frame, this.baseTexture, this.rotate), this._updateID++ }, a.fromImage = function (t, e, i, r) { var n = l.TextureCache[t]; return n || (n = new a(o.default.fromImage(t, e, i, r)), a.addToCache(n, t)), n }, a.fromFrame = function (t) { var e = l.TextureCache[t]; if (!e) throw new Error('The frameId "' + t + '" does not exist in the texture cache'); return e }, a.fromCanvas = function (t, e) { return new a(o.default.fromCanvas(t, e, 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : "canvas")) }, a.fromVideo = function (t, e) { return "string" == typeof t ? a.fromVideoUrl(t, e) : new a(i.default.fromVideo(t, e)) }, a.fromVideoUrl = function (t, e) { return new a(i.default.fromUrl(t, e)) }, a.from = function (t) { return "string" == typeof t ? l.TextureCache[t] || (null !== t.match(/\.(mp4|webm|ogg|h264|avi|mov)$/) ? a.fromVideoUrl(t) : a.fromImage(t)) : t instanceof HTMLImageElement ? new a(o.default.from(t)) : t instanceof HTMLCanvasElement ? a.fromCanvas(t, d.default.SCALE_MODE, "HTMLCanvasElement") : t instanceof HTMLVideoElement ? a.fromVideo(t) : t instanceof o.default ? new a(t) : t }, a.fromLoader = function (t, e, i) { var t = new o.default(t, void 0, (0, l.getResolutionOfUrl)(e)), r = new a(t); return t.imageUrl = e, o.default.addToCache(r.baseTexture, i = i || e), a.addToCache(r, i), i !== e && (o.default.addToCache(r.baseTexture, e), a.addToCache(r, e)), r }, a.addToCache = function (t, e) { e && (-1 === t.textureCacheIds.indexOf(e) && t.textureCacheIds.push(e), l.TextureCache[e] && console.warn("Texture added to the cache with an id [" + e + "] that already had an entry"), l.TextureCache[e] = t) }, a.removeFromCache = function (t) { if ("string" == typeof t) { var e, i = l.TextureCache[t]; if (i) return -1 < (e = i.textureCacheIds.indexOf(t)) && i.textureCacheIds.splice(e, 1), delete l.TextureCache[t], i } else if (t && t.textureCacheIds) { for (var r = 0; r < t.textureCacheIds.length; ++r)l.TextureCache[t.textureCacheIds[r]] === t && delete l.TextureCache[t.textureCacheIds[r]]; return t.textureCacheIds.length = 0, t } return null }, c(a, [{ key: "frame", get: function () { return this._frame }, set: function (t) { this._frame = t, this.noFrame = !1; var e = t.x, i = t.y, r = t.width, n = t.height, o = e + r > this.baseTexture.width, s = i + n > this.baseTexture.height; if (o || s) throw e = "X: " + e + " + " + r + " = " + (e + r) + " > " + this.baseTexture.width, i = "Y: " + i + " + " + n + " = " + (i + n) + " > " + this.baseTexture.height, new Error("Texture Error: frame does not fit inside the base Texture dimensions: " + e + " " + (o && s ? "and" : "or") + " " + i); this.valid = r && n && this.baseTexture.hasLoaded, this.trim || this.rotate || (this.orig = t), this.valid && this._updateUvs() } }, { key: "rotate", get: function () { return this._rotate }, set: function (t) { this._rotate = t, this.valid && this._updateUvs() } }, { key: "width", get: function () { return this.orig.width } }, { key: "height", get: function () { return this.orig.height } }]), a }(n.default); function a(t) { t.destroy = function () { }, t.on = function () { }, t.once = function () { }, t.emit = function () { } } (e.default = t).EMPTY = new t(new o.default), a(t.EMPTY), a(t.EMPTY.baseTexture), t.WHITE = ((n = document.createElement("canvas")).width = 10, n.height = 10, (e = n.getContext("2d")).fillStyle = "white", e.fillRect(0, 0, 10, 10), new t(new o.default(n))), a(t.WHITE), a(t.WHITE.baseTexture) }, { "../math": 70, "../settings": 101, "../utils": 125, "./BaseTexture": 112, "./TextureUvs": 117, "./VideoBaseTexture": 118, eventemitter3: 3 }], 116: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var t = t("../math/Matrix"), o = (t = t) && t.__esModule ? t : { default: t }; var s = new o.default; function a(t, e) { if (!(this instanceof a)) throw new TypeError("Cannot call a class as a function"); this._texture = t, this.mapCoord = new o.default, this.uClampFrame = new Float32Array(4), this.uClampOffset = new Float32Array(2), this._lastTextureID = -1, this.clampOffset = 0, this.clampMargin = void 0 === e ? .5 : e } a.prototype.multiplyUvs = function (t, e) { void 0 === e && (e = t); for (var i = this.mapCoord, r = 0; r < t.length; r += 2) { var n = t[r], o = t[r + 1]; e[r] = n * i.a + o * i.c + i.tx, e[r + 1] = n * i.b + o * i.d + i.ty } return e }, a.prototype.update = function (t) { var e = this._texture; if (!e || !e.valid) return !1; if (!t && this._lastTextureID === e._updateID) return !1; this._lastTextureID = e._updateID; var t = e._uvs, t = (this.mapCoord.set(t.x1 - t.x0, t.y1 - t.y0, t.x3 - t.x0, t.y3 - t.y0, t.x0, t.y0), e.orig), i = e.trim, t = (i && (s.set(t.width / i.width, 0, 0, t.height / i.height, -i.x / i.width, -i.y / i.height), this.mapCoord.append(s)), e.baseTexture), i = this.uClampFrame, r = this.clampMargin / t.resolution, n = this.clampOffset; return i[0] = (e._frame.x + r + n) / t.width, i[1] = (e._frame.y + r + n) / t.height, i[2] = (e._frame.x + e._frame.width - r + n) / t.width, i[3] = (e._frame.y + e._frame.height - r + n) / t.height, this.uClampOffset[0] = n / t.realWidth, this.uClampOffset[1] = n / t.realHeight, !0 }, r(a, [{ key: "texture", get: function () { return this._texture }, set: function (t) { this._texture = t, this._lastTextureID = -1 } }]), i.default = a }, { "../math/Matrix": 67 }], 117: [function (t, e, i) { "use strict"; i.__esModule = !0; var t = t("../math/GroupD8"), h = (t = t) && t.__esModule ? t : { default: t }; function r() { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); this.x0 = 0, this.y0 = 0, this.x1 = 1, this.y1 = 0, this.x2 = 1, this.y2 = 1, this.x3 = 0, this.y3 = 1, this.uvsUint32 = new Uint32Array(4) } r.prototype.set = function (t, e, i) { var r, n, o, s, a = e.width, e = e.height; i ? (r = t.width / 2 / a, n = t.height / 2 / e, o = t.x / a + r, s = t.y / e + n, i = h.default.add(i, h.default.NW), this.x0 = o + r * h.default.uX(i), this.y0 = s + n * h.default.uY(i), i = h.default.add(i, 2), this.x1 = o + r * h.default.uX(i), this.y1 = s + n * h.default.uY(i), i = h.default.add(i, 2), this.x2 = o + r * h.default.uX(i), this.y2 = s + n * h.default.uY(i), i = h.default.add(i, 2), this.x3 = o + r * h.default.uX(i), this.y3 = s + n * h.default.uY(i)) : (this.x0 = t.x / a, this.y0 = t.y / e, this.x1 = (t.x + t.width) / a, this.y1 = t.y / e, this.x2 = (t.x + t.width) / a, this.y2 = (t.y + t.height) / e, this.x3 = t.x / a, this.y3 = (t.y + t.height) / e), this.uvsUint32[0] = (65535 * this.y0 & 65535) << 16 | 65535 * this.x0 & 65535, this.uvsUint32[1] = (65535 * this.y1 & 65535) << 16 | 65535 * this.x1 & 65535, this.uvsUint32[2] = (65535 * this.y2 & 65535) << 16 | 65535 * this.x2 & 65535, this.uvsUint32[3] = (65535 * this.y3 & 65535) << 16 | 65535 * this.x3 & 65535 }, i.default = r }, { "../math/GroupD8": 66 }], 118: [function (t, s, e) { "use strict"; e.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = i(t("./BaseTexture")), a = t("../utils"), h = t("../ticker"), l = t("../const"), c = i(t("../utils/determineCrossOrigin")); function i(t) { return t && t.__esModule ? t : { default: t } } t = function (i) { var t = s, e = i; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function s(t, e) { if (!(this instanceof s)) throw new TypeError("Cannot call a class as a function"); if (!t) throw new Error("No video source element specified."); (t.readyState === t.HAVE_ENOUGH_DATA || t.readyState === t.HAVE_FUTURE_DATA) && t.width && t.height && (t.complete = !0); e = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, i.call(this, t, e)); return e.width = t.videoWidth, e.height = t.videoHeight, e._autoUpdate = !0, e._isAutoUpdating = !1, e.autoPlay = !0, e.update = e.update.bind(e), e._onCanPlay = e._onCanPlay.bind(e), t.addEventListener("play", e._onPlayStart.bind(e)), t.addEventListener("pause", e._onPlayStop.bind(e)), e.hasLoaded = !1, e.__loaded = !1, e._isSourceReady() ? e._onCanPlay() : (t.addEventListener("canplay", e._onCanPlay), t.addEventListener("canplaythrough", e._onCanPlay)), e } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), s.prototype._isSourcePlaying = function () { var t = this.source; return 0 < t.currentTime && !1 === t.paused && !1 === t.ended && 2 < t.readyState }, s.prototype._isSourceReady = function () { return 3 === this.source.readyState || 4 === this.source.readyState }, s.prototype._onPlayStart = function () { this.hasLoaded || this._onCanPlay(), !this._isAutoUpdating && this.autoUpdate && (h.shared.add(this.update, this, l.UPDATE_PRIORITY.HIGH), this._isAutoUpdating = !0) }, s.prototype._onPlayStop = function () { this._isAutoUpdating && (h.shared.remove(this.update, this), this._isAutoUpdating = !1) }, s.prototype._onCanPlay = function () { this.hasLoaded = !0, this.source && (this.source.removeEventListener("canplay", this._onCanPlay), this.source.removeEventListener("canplaythrough", this._onCanPlay), this.width = this.source.videoWidth, this.height = this.source.videoHeight, this.__loaded || (this.__loaded = !0, this.emit("loaded", this)), this._isSourcePlaying() ? this._onPlayStart() : this.autoPlay && this.source.play()) }, s.prototype.destroy = function () { this._isAutoUpdating && h.shared.remove(this.update, this), this.source && this.source._pixiId && (o.default.removeFromCache(this.source._pixiId), delete this.source._pixiId, this.source.pause(), this.source.src = "", this.source.load()), i.prototype.destroy.call(this) }, s.fromVideo = function (t, e) { t._pixiId || (t._pixiId = "video_" + (0, a.uid)()); var i = a.BaseTextureCache[t._pixiId]; return i || (i = new s(t, e), o.default.addToCache(i, t._pixiId)), i }, s.fromUrl = function (t, e, i) { var r = document.createElement("video"), n = (r.setAttribute("webkit-playsinline", ""), r.setAttribute("playsinline", ""), Array.isArray(t) ? t[0].src || t[0] : t.src || t); if (void 0 === i && 0 !== n.indexOf("data:") ? r.crossOrigin = (0, c.default)(n) : i && (r.crossOrigin = "string" == typeof i ? i : "anonymous"), Array.isArray(t)) for (var o = 0; o < t.length; ++o)r.appendChild(u(t[o].src || t[o], t[o].mime)); else r.appendChild(u(n, t.mime)); return r.load(), s.fromVideo(r, e) }, r(s, [{ key: "autoUpdate", get: function () { return this._autoUpdate }, set: function (t) { t !== this._autoUpdate && (this._autoUpdate = t, !this._autoUpdate && this._isAutoUpdating ? (h.shared.remove(this.update, this), this._isAutoUpdating = !1) : this._autoUpdate && !this._isAutoUpdating && (h.shared.add(this.update, this, l.UPDATE_PRIORITY.HIGH), this._isAutoUpdating = !0)) } }]), s }(o.default); function u(t, e) { e = e || "video/" + t.substr(t.lastIndexOf(".") + 1); var i = document.createElement("source"); return i.src = t, i.type = e, i } (e.default = t).fromUrls = t.fromUrl }, { "../const": 46, "../ticker": 121, "../utils": 125, "../utils/determineCrossOrigin": 124, "./BaseTexture": 112 }], 119: [function (t, l, e) { "use strict"; e.__esModule = !0; var i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var n = a(t("../settings")), o = t("../const"), s = a(t("./TickerListener")); function a(t) { return t && t.__esModule ? t : { default: t } } function h() { var e = this; if (!(this instanceof h)) throw new TypeError("Cannot call a class as a function"); this._head = new s.default(null, null, 1 / 0), this._requestId = null, this._maxElapsedMS = 100, this.autoStart = !1, this.deltaTime = 1, this.elapsedMS = 1 / n.default.TARGET_FPMS, this.lastTime = -1, this.speed = 1, this.started = !1, this._tick = function (t) { e._requestId = null, e.started && (e.update(t), e.started && null === e._requestId && e._head.next && (e._requestId = requestAnimationFrame(e._tick))) } } h.prototype._requestIfNeeded = function () { null === this._requestId && this._head.next && (this.lastTime = performance.now(), this._requestId = requestAnimationFrame(this._tick)) }, h.prototype._cancelIfNeeded = function () { null !== this._requestId && (cancelAnimationFrame(this._requestId), this._requestId = null) }, h.prototype._startIfPossible = function () { this.started ? this._requestIfNeeded() : this.autoStart && this.start() }, h.prototype.add = function (t, e) { var i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : o.UPDATE_PRIORITY.NORMAL; return this._addListener(new s.default(t, e, i)) }, h.prototype.addOnce = function (t, e) { var i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : o.UPDATE_PRIORITY.NORMAL; return this._addListener(new s.default(t, e, i, !0)) }, h.prototype._addListener = function (t) { var e = this._head.next, i = this._head; if (e) { for (; e;) { if (t.priority > e.priority) { t.connect(i); break } e = (i = e).next } t.previous || t.connect(i) } else t.connect(i); return this._startIfPossible(), this }, h.prototype.remove = function (t, e) { for (var i = this._head.next; i;)i = i.match(t, e) ? i.destroy() : i.next; return this._head.next || this._cancelIfNeeded(), this }, h.prototype.start = function () { this.started || (this.started = !0, this._requestIfNeeded()) }, h.prototype.stop = function () { this.started && (this.started = !1, this._cancelIfNeeded()) }, h.prototype.destroy = function () { this.stop(); for (var t = this._head.next; t;)t = t.destroy(!0); this._head.destroy(), this._head = null }, h.prototype.update = function () { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : performance.now(), e = void 0; if (t > this.lastTime) { (e = this.elapsedMS = t - this.lastTime) > this._maxElapsedMS && (e = this._maxElapsedMS), this.deltaTime = e * n.default.TARGET_FPMS * this.speed; for (var e = this._head, i = e.next; i;)i = i.emit(this.deltaTime); e.next || this._cancelIfNeeded() } else this.deltaTime = this.elapsedMS = 0; this.lastTime = t }, i(h, [{ key: "FPS", get: function () { return 1e3 / this.elapsedMS } }, { key: "minFPS", get: function () { return 1e3 / this._maxElapsedMS }, set: function (t) { t = Math.min(Math.max(0, t) / 1e3, n.default.TARGET_FPMS); this._maxElapsedMS = 1 / t } }]), e.default = h }, { "../const": 46, "../settings": 101, "./TickerListener": 120 }], 120: [function (t, e, i) { "use strict"; function s(t) { var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : null, i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 0, r = 3 < arguments.length && void 0 !== arguments[3] && arguments[3], n = this, o = s; if (!(n instanceof o)) throw new TypeError("Cannot call a class as a function"); this.fn = t, this.context = e, this.priority = i, this.once = r, this.next = null, this.previous = null, this._destroyed = !1 } i.__esModule = !0, s.prototype.match = function (t, e) { return e = e || null, this.fn === t && this.context === e }, s.prototype.emit = function (t) { this.fn && (this.context ? this.fn.call(this.context, t) : this.fn(t)); t = this.next; return this.once && this.destroy(!0), this._destroyed && (this.next = null), t }, s.prototype.connect = function (t) { (this.previous = t).next && (t.next.previous = this), this.next = t.next, t.next = this }, s.prototype.destroy = function () { var t = 0 < arguments.length && void 0 !== arguments[0] && arguments[0], e = (this._destroyed = !0, this.fn = null, this.context = null, this.previous && (this.previous.next = this.next), this.next && (this.next.previous = this.previous), this.next); return this.next = t ? null : e, this.previous = null, e }, i.default = s }, {}], 121: [function (t, e, i) { "use strict"; i.__esModule = !0, i.Ticker = i.shared = void 0; var t = t("./Ticker"), t = (t = t) && t.__esModule ? t : { default: t }; var r = new t.default; r.autoStart = !0, r.destroy = function () { }, i.shared = r, i.Ticker = t.default }, { "./Ticker": 119 }], 122: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function () { return !(navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform)) } }, {}], 123: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t) { for (var e = 6 * t, i = new Uint16Array(e), r = 0, n = 0; r < e; r += 6, n += 4)i[r + 0] = n + 0, i[r + 1] = n + 1, i[r + 2] = n + 2, i[r + 3] = n + 0, i[r + 4] = n + 2, i[r + 5] = n + 3; return i } }, {}], 124: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t) { var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : window.location; if (0 === t.indexOf("data:")) return ""; e = e || window.location, n = n || document.createElement("a"); n.href = t; var i = !(t = r.default.parse(n.href)).port && "" === e.port || t.port === e.port; return t.hostname === e.hostname && i && t.protocol === e.protocol ? "" : "anonymous" }; var i = t("url"), r = (t = i) && t.__esModule ? t : { default: t }; var n = void 0 }, { url: 38 }], 125: [function (t, u, e) { "use strict"; e.__esModule = !0, e.premultiplyBlendMode = e.BaseTextureCache = e.TextureCache = e.earcut = e.mixins = e.pluginTarget = e.EventEmitter = e.removeItems = e.isMobile = void 0, e.uid = function () { return ++v }, e.hex2rgb = function (t, e) { return (e = e || [])[0] = (t >> 16 & 255) / 255, e[1] = (t >> 8 & 255) / 255, e[2] = (255 & t) / 255, e }, e.hex2string = function (t) { return t = t.toString(16), "#" + (t = "000000".substr(0, 6 - t.length) + t) }, e.rgb2hex = function (t) { return (255 * t[0] << 16) + (255 * t[1] << 8) + (255 * t[2] | 0) }, e.getResolutionOfUrl = function (t, e) { t = r.default.RETINA_PREFIX.exec(t); if (t) return parseFloat(t[1]); return void 0 !== e ? e : 1 }, e.decomposeDataUri = function (t) { t = i.DATA_URI.exec(t); if (t) return { mediaType: t[1] ? t[1].toLowerCase() : void 0, subType: t[2] ? t[2].toLowerCase() : void 0, charset: t[3] ? t[3].toLowerCase() : void 0, encoding: t[4] ? t[4].toLowerCase() : void 0, data: t[5] }; return }, e.getUrlFileExtension = function (t) { t = i.URL_FILE_EXTENSION.exec(t); if (t) return t[1].toLowerCase(); return }, e.getSvgSize = function (t) { var t = i.SVG_SIZE.exec(t), e = {}; t && (e[t[1]] = Math.round(parseFloat(t[3])), e[t[5]] = Math.round(parseFloat(t[7]))); return e }, e.skipHello = function () { a = !0 }, e.sayHello = function (t) { var e; a || (-1 < navigator.userAgent.toLowerCase().indexOf("chrome") ? (e = ["\n %c %c %c PixiJS " + i.VERSION + " -  " + t + "   %c  %c  http://www.pixijs.com/  %c %c %c%c \n\n", "background: #ff66a5; padding:5px 0;", "background: #ff66a5; padding:5px 0;", "color: #ff66a5; background: #030307; padding:5px 0;", "background: #ff66a5; padding:5px 0;", "background: #ffc3dc; padding:5px 0;", "background: #ff66a5; padding:5px 0;", "color: #ff2424; background: #fff; padding:5px 0;", "color: #ff2424; background: #fff; padding:5px 0;", "color: #ff2424; background: #fff; padding:5px 0;"], window.console.log.apply(console, e)) : window.console && window.console.log("PixiJS " + i.VERSION + " - " + t + " - http://www.pixijs.com/"), a = !0) }, e.isWebGLSupported = function () { var t = { stencil: !0, failIfMajorPerformanceCaveat: !0 }; try { if (!window.WebGLRenderingContext) return !1; var e, i = document.createElement("canvas"), r = i.getContext("webgl", t) || i.getContext("experimental-webgl", t), n = !(!r || !r.getContextAttributes().stencil); return !r || (e = r.getExtension("WEBGL_lose_context")) && e.loseContext(), r = null, n } catch (t) { return !1 } }, e.sign = function (t) { return 0 === t ? 0 : t < 0 ? -1 : 1 }, e.destroyTextureCache = function () { var t = void 0; for (t in h) h[t].destroy(); for (t in l) l[t].destroy() }, e.clearTextureCache = function () { var t = void 0; for (t in h) delete h[t]; for (t in l) delete l[t] }, e.correctBlendMode = function (t, e) { return m[e ? 1 : 0][t] }, e.premultiplyTint = function (t, e) { return 1 !== e ? 0 !== e ? (255 * e << 24) + (((t >> 16 & 255) * e + .5 | 0) << 16) + (((t >> 8 & 255) * e + .5 | 0) << 8) + ((255 & t) * e + .5 | 0) : 0 : (255 * e << 24) + t }, e.premultiplyRgba = function (t, e, i, r) { i = i || new Float32Array(4), r || void 0 === r ? (i[0] = t[0] * e, i[1] = t[1] * e, i[2] = t[2] * e) : (i[0] = t[0], i[1] = t[1], i[2] = t[2]); return i[3] = e, i }, e.premultiplyTintToRgba = function (t, e, i, r) { (i = i || new Float32Array(4))[0] = (t >> 16 & 255) / 255, i[1] = (t >> 8 & 255) / 255, i[2] = (255 & t) / 255, !r && void 0 !== r || (i[0] *= e, i[1] *= e, i[2] *= e); return i[3] = e, i }; var i = t("../const"), r = s(t("../settings")), n = s(t("eventemitter3")), c = s(t("./pluginTarget")), f = o(t("./mixin")), d = o(t("ismobilejs")), p = s(t("remove-array-items")), g = s(t("./mapPremultipliedBlendModes")), t = s(t("earcut")); function o(t) { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } function s(t) { return t && t.__esModule ? t : { default: t } } var v = 0, a = !1; e.isMobile = d, e.removeItems = p.default, e.EventEmitter = n.default, e.pluginTarget = c.default, e.mixins = f, e.earcut = t.default; var h = e.TextureCache = Object.create(null), l = e.BaseTextureCache = Object.create(null); var m = e.premultiplyBlendMode = (0, g.default)() }, { "../const": 46, "../settings": 101, "./mapPremultipliedBlendModes": 126, "./mixin": 128, "./pluginTarget": 129, earcut: 2, eventemitter3: 3, ismobilejs: 4, "remove-array-items": 31 }], 126: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function () { for (var t = [], e = [], i = 0; i < 32; i++)t[i] = i, e[i] = i; t[n.BLEND_MODES.NORMAL_NPM] = n.BLEND_MODES.NORMAL, t[n.BLEND_MODES.ADD_NPM] = n.BLEND_MODES.ADD, t[n.BLEND_MODES.SCREEN_NPM] = n.BLEND_MODES.SCREEN, e[n.BLEND_MODES.NORMAL] = n.BLEND_MODES.NORMAL_NPM, e[n.BLEND_MODES.ADD] = n.BLEND_MODES.ADD_NPM, e[n.BLEND_MODES.SCREEN] = n.BLEND_MODES.SCREEN_NPM; var r = []; return r.push(e), r.push(t), r }; var n = t("../const") }, { "../const": 46 }], 127: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t) { if (r.default.tablet || r.default.phone) return 4; return t }; var i = t("ismobilejs"), r = (t = i) && t.__esModule ? t : { default: t } }, { ismobilejs: 4 }], 128: [function (t, e, i) { "use strict"; function r(t, e) { if (t && e) for (var i = Object.keys(e), r = 0; r < i.length; ++r) { var n = i[r]; Object.defineProperty(t, n, Object.getOwnPropertyDescriptor(e, n)) } } i.__esModule = !0, i.mixin = r, i.delayMixin = function (t, e) { n.push(t, e) }, i.performMixins = function () { for (var t = 0; t < n.length; t += 2)r(n[t], n[t + 1]); n.length = 0 }; var n = [] }, {}], 129: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = { mixin: function (t) { var i; (i = t).__plugins = {}, i.registerPlugin = function (t, e) { i.__plugins[t] = e }, i.prototype.initPlugins = function () { for (var t in this.plugins = this.plugins || {}, i.__plugins) this.plugins[t] = new i.__plugins[t](this) }, i.prototype.destroyPlugins = function () { for (var t in this.plugins) this.plugins[t].destroy(), this.plugins[t] = null; this.plugins = null } } } }, {}], 130: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t) { var e = t.width, i = t.height, t = t.getContext("2d"), r = t.getImageData(0, 0, e, i).data, n = r.length, o = { top: null, left: null, right: null, bottom: null }, s = void 0, a = void 0, h = void 0; for (s = 0; s < n; s += 4)0 !== r[s + 3] && (a = s / 4 % e, h = ~~(s / 4 / e), null === o.top && (o.top = h), (null === o.left || a < o.left) && (o.left = a), (null === o.right || o.right < a) && (o.right = 1 + a), (null === o.bottom || o.bottom < h) && (o.bottom = h)); e = o.right - o.left, i = o.bottom - o.top + 1; t = t.getImageData(o.left, o.top, e, i); return { height: i, width: e, data: t } } }, {}], 131: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (i) { for (var t = i.mesh, u = i.particles, e = i.extras, r = i.filters, n = i.prepare, o = i.loaders, s = i.interaction, a = (Object.defineProperties(i, { SpriteBatch: { get: function () { throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.") } }, AssetLoader: { get: function () { throw new ReferenceError("The loader system was overhauled in PixiJS v3, please see the new PIXI.loaders.Loader class.") } }, Stage: { get: function () { return f("You do not need to use a PIXI Stage any more, you can simply render any container."), i.Container } }, DisplayObjectContainer: { get: function () { return f("DisplayObjectContainer has been shortened to Container, please use Container from now on."), i.Container } }, Strip: { get: function () { return f("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."), t.Mesh } }, Rope: { get: function () { return f("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."), t.Rope } }, ParticleContainer: { get: function () { return f("The ParticleContainer class has been moved to particles.ParticleContainer, please use particles.ParticleContainer from now on."), u.ParticleContainer } }, MovieClip: { get: function () { return f("The MovieClip class has been moved to extras.AnimatedSprite, please use extras.AnimatedSprite."), e.AnimatedSprite } }, TilingSprite: { get: function () { return f("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."), e.TilingSprite } }, BitmapText: { get: function () { return f("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."), e.BitmapText } }, blendModes: { get: function () { return f("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."), i.BLEND_MODES } }, scaleModes: { get: function () { return f("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."), i.SCALE_MODES } }, BaseTextureCache: { get: function () { return f("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."), i.utils.BaseTextureCache } }, TextureCache: { get: function () { return f("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."), i.utils.TextureCache } }, math: { get: function () { return f("The math namespace is deprecated, please access members already accessible on PIXI."), i } }, AbstractFilter: { get: function () { return f("AstractFilter has been renamed to Filter, please use PIXI.Filter"), i.Filter } }, TransformManual: { get: function () { return f("TransformManual has been renamed to TransformBase, please update your pixi-spine"), i.TransformBase } }, TARGET_FPMS: { get: function () { return f("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"), i.settings.TARGET_FPMS }, set: function (t) { f("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"), i.settings.TARGET_FPMS = t } }, FILTER_RESOLUTION: { get: function () { return f("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"), i.settings.FILTER_RESOLUTION }, set: function (t) { f("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"), i.settings.FILTER_RESOLUTION = t } }, RESOLUTION: { get: function () { return f("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"), i.settings.RESOLUTION }, set: function (t) { f("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"), i.settings.RESOLUTION = t } }, MIPMAP_TEXTURES: { get: function () { return f("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"), i.settings.MIPMAP_TEXTURES }, set: function (t) { f("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"), i.settings.MIPMAP_TEXTURES = t } }, SPRITE_BATCH_SIZE: { get: function () { return f("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"), i.settings.SPRITE_BATCH_SIZE }, set: function (t) { f("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"), i.settings.SPRITE_BATCH_SIZE = t } }, SPRITE_MAX_TEXTURES: { get: function () { return f("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"), i.settings.SPRITE_MAX_TEXTURES }, set: function (t) { f("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"), i.settings.SPRITE_MAX_TEXTURES = t } }, RETINA_PREFIX: { get: function () { return f("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"), i.settings.RETINA_PREFIX }, set: function (t) { f("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"), i.settings.RETINA_PREFIX = t } }, DEFAULT_RENDER_OPTIONS: { get: function () { return f("PIXI.DEFAULT_RENDER_OPTIONS has been deprecated, please use PIXI.settings.DEFAULT_RENDER_OPTIONS"), i.settings.RENDER_OPTIONS } } }), [{ parent: "TRANSFORM_MODE", target: "TRANSFORM_MODE" }, { parent: "GC_MODES", target: "GC_MODE" }, { parent: "WRAP_MODES", target: "WRAP_MODE" }, { parent: "SCALE_MODES", target: "SCALE_MODE" }, { parent: "PRECISION", target: "PRECISION_FRAGMENT" }]), h = 0; h < a.length; h++)!function (t) { var e = a[t]; Object.defineProperty(i[e.parent], "DEFAULT", { get: function () { return f("PIXI." + e.parent + ".DEFAULT has been deprecated, please use PIXI.settings." + e.target), i.settings[e.target] }, set: function (t) { f("PIXI." + e.parent + ".DEFAULT has been deprecated, please use PIXI.settings." + e.target), i.settings[e.target] = t } }) }(h); Object.defineProperties(i.settings, { PRECISION: { get: function () { return f("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"), i.settings.PRECISION_FRAGMENT }, set: function (t) { f("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"), i.settings.PRECISION_FRAGMENT = t } } }), e.AnimatedSprite && Object.defineProperties(e, { MovieClip: { get: function () { return f("The MovieClip class has been renamed to AnimatedSprite, please use AnimatedSprite from now on."), e.AnimatedSprite } } }); e && Object.defineProperties(e, { TextureTransform: { get: function () { return f("The TextureTransform class has been renamed to TextureMatrix, please use PIXI.TextureMatrix from now on."), i.TextureMatrix } } }); i.DisplayObject.prototype.generateTexture = function (t, e, i) { return f("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)"), t.generateTexture(this, e, i) }, i.Graphics.prototype.generateTexture = function (t, e) { return f("graphics generate texture has moved to the renderer. Or to render a graphics to a texture using canvas please use generateCanvasTexture"), this.generateCanvasTexture(t, e) }, i.GroupD8.isSwapWidthHeight = function (t) { return f("GroupD8.isSwapWidthHeight was renamed to GroupD8.isVertical"), i.GroupD8.isVertical(t) }, i.RenderTexture.prototype.render = function (t, e, i, r) { this.legacyRenderer.render(t, this, i, e, !r), f("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)") }, i.RenderTexture.prototype.getImage = function (t) { return f("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)"), this.legacyRenderer.extract.image(t) }, i.RenderTexture.prototype.getBase64 = function (t) { return f("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)"), this.legacyRenderer.extract.base64(t) }, i.RenderTexture.prototype.getCanvas = function (t) { return f("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)"), this.legacyRenderer.extract.canvas(t) }, i.RenderTexture.prototype.getPixels = function (t) { return f("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)"), this.legacyRenderer.pixels(t) }, i.Sprite.prototype.setTexture = function (t) { this.texture = t, f("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;") }, e.BitmapText && (e.BitmapText.prototype.setText = function (t) { this.text = t, f("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';") }); i.Text.prototype.setText = function (t) { this.text = t, f("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';") }, i.Text.calculateFontProperties = function (t) { return f("Text.calculateFontProperties is now deprecated, please use the TextMetrics.measureFont"), i.TextMetrics.measureFont(t) }, Object.defineProperties(i.Text, { fontPropertiesCache: { get: function () { return f("Text.fontPropertiesCache is deprecated"), i.TextMetrics._fonts } }, fontPropertiesCanvas: { get: function () { return f("Text.fontPropertiesCanvas is deprecated"), i.TextMetrics._canvas } }, fontPropertiesContext: { get: function () { return f("Text.fontPropertiesContext is deprecated"), i.TextMetrics._context } } }), i.Text.prototype.setStyle = function (t) { this.style = t, f("setStyle is now deprecated, please use the style property, e.g : myText.style = style;") }, i.Text.prototype.determineFontProperties = function (t) { return f("determineFontProperties is now deprecated, please use TextMetrics.measureFont method"), i.TextMetrics.measureFont(t) }, i.Text.getFontStyle = function (t) { return f("getFontStyle is now deprecated, please use TextStyle.toFontString() instead"), (t = (t = t || {}) instanceof i.TextStyle ? t : new i.TextStyle(t)).toFontString() }, Object.defineProperties(i.TextStyle.prototype, { font: { get: function () { f("text style property 'font' is now deprecated, please use the 'fontFamily', 'fontSize', 'fontStyle', 'fontVariant' and 'fontWeight' properties from now on"); var t = "number" == typeof this._fontSize ? this._fontSize + "px" : this._fontSize; return this._fontStyle + " " + this._fontVariant + " " + this._fontWeight + " " + t + " " + this._fontFamily }, set: function (t) { f("text style property 'font' is now deprecated, please use the 'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on"), 1 < t.indexOf("italic") ? this._fontStyle = "italic" : -1 < t.indexOf("oblique") ? this._fontStyle = "oblique" : this._fontStyle = "normal", -1 < t.indexOf("small-caps") ? this._fontVariant = "small-caps" : this._fontVariant = "normal"; var e = t.split(" "), i = -1; this._fontSize = 26; for (var r = 0; r < e.length; ++r)if (e[r].match(/(px|pt|em|%)/)) { i = r, this._fontSize = e[r]; break } this._fontWeight = "normal"; for (var n = 0; n < i; ++n)if (e[n].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)) { this._fontWeight = e[n]; break } if (-1 < i && i < e.length - 1) { this._fontFamily = ""; for (var o = i + 1; o < e.length; ++o)this._fontFamily += e[o] + " "; this._fontFamily = this._fontFamily.slice(0, -1) } else this._fontFamily = "Arial"; this.styleID++ } } }), i.Texture.prototype.setFrame = function (t) { this.frame = t, f("setFrame is now deprecated, please use the frame property, e.g: myTexture.frame = frame;") }, i.Texture.addTextureToCache = function (t, e) { i.Texture.addToCache(t, e), f("Texture.addTextureToCache is deprecated, please use Texture.addToCache from now on.") }, i.Texture.removeTextureFromCache = function (t) { return f("Texture.removeTextureFromCache is deprecated, please use Texture.removeFromCache from now on. Be aware that Texture.removeFromCache does not automatically its BaseTexture from the BaseTextureCache. For that, use BaseTexture.removeFromCache"), i.BaseTexture.removeFromCache(t), i.Texture.removeFromCache(t) }, Object.defineProperties(r, { AbstractFilter: { get: function () { return f("AstractFilter has been renamed to Filter, please use PIXI.Filter"), i.AbstractFilter } }, SpriteMaskFilter: { get: function () { return f("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."), i.SpriteMaskFilter } }, VoidFilter: { get: function () { return f("VoidFilter has been renamed to AlphaFilter, please use PIXI.filters.AlphaFilter"), r.AlphaFilter } } }), i.utils.uuid = function () { return f("utils.uuid() is deprecated, please use utils.uid() from now on."), i.utils.uid() }, i.utils.canUseNewCanvasBlendModes = function () { return f("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on"), i.CanvasTinter.canUseMultiply }; var c = !0; Object.defineProperty(i.utils, "_saidHello", { set: function (t) { t && (f("PIXI.utils._saidHello is deprecated, please use PIXI.utils.skipHello()"), this.skipHello()), c = t }, get: function () { return c } }), n.BasePrepare && (n.BasePrepare.prototype.register = function (t, e) { return f("renderer.plugins.prepare.register is now deprecated, please use renderer.plugins.prepare.registerFindHook & renderer.plugins.prepare.registerUploadHook"), t && this.registerFindHook(t), e && this.registerUploadHook(e), this }); n.canvas && Object.defineProperty(n.canvas, "UPLOADS_PER_FRAME", { set: function () { f("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer") }, get: function () { return f("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"), NaN } }); n.webgl && Object.defineProperty(n.webgl, "UPLOADS_PER_FRAME", { set: function () { f("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer") }, get: function () { return f("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"), NaN } }); { var l; o.Loader && (l = o.Resource, n = o.Loader, Object.defineProperties(l.prototype, { isJson: { get: function () { return f("The isJson property is deprecated, please use `resource.type === Resource.TYPE.JSON`."), this.type === l.TYPE.JSON } }, isXml: { get: function () { return f("The isXml property is deprecated, please use `resource.type === Resource.TYPE.XML`."), this.type === l.TYPE.XML } }, isImage: { get: function () { return f("The isImage property is deprecated, please use `resource.type === Resource.TYPE.IMAGE`."), this.type === l.TYPE.IMAGE } }, isAudio: { get: function () { return f("The isAudio property is deprecated, please use `resource.type === Resource.TYPE.AUDIO`."), this.type === l.TYPE.AUDIO } }, isVideo: { get: function () { return f("The isVideo property is deprecated, please use `resource.type === Resource.TYPE.VIDEO`."), this.type === l.TYPE.VIDEO } } }), Object.defineProperties(n.prototype, { before: { get: function () { return f("The before() method is deprecated, please use pre()."), this.pre } }, after: { get: function () { return f("The after() method is deprecated, please use use()."), this.use } } })) } s.interactiveTarget && Object.defineProperty(s.interactiveTarget, "defaultCursor", { set: function (t) { f("Property defaultCursor has been replaced with 'cursor'. "), this.cursor = t }, get: function () { return f("Property defaultCursor has been replaced with 'cursor'. "), this.cursor } }); s.InteractionManager && (Object.defineProperty(s.InteractionManager, "defaultCursorStyle", { set: function (t) { f("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "), this.cursorStyles.default = t }, get: function () { return f("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "), this.cursorStyles.default } }), Object.defineProperty(s.InteractionManager, "currentCursorStyle", { set: function (t) { f("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."), this.currentCursorMode = t }, get: function () { return f("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."), this.currentCursorMode } })) }; var r = {}; function f(t) { var e; r[t] || (void 0 === (e = (new Error).stack) ? console.warn("Deprecation Warning: ", t) : (e = e.split("\n").splice(3).join("\n"), console.groupCollapsed ? (console.groupCollapsed("%cDeprecation Warning: %c%s", "color:#614108;background:#fffbe6", "font-weight:normal;color:#614108;background:#fffbe6", t), console.warn(e), console.groupEnd()) : (console.warn("Deprecation Warning: ", t), console.warn(e))), r[t] = !0) } }, {}], 132: [function (t, e, i) { "use strict"; i.__esModule = !0; var s = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")); var a = new s.Rectangle, t = (r.prototype.image = function (t) { var e; return (e = new Image).src = this.base64(t), e }, r.prototype.base64 = function (t) { return this.canvas(t).toDataURL() }, r.prototype.canvas = function (t) { var e = this.renderer, i = void 0, r = void 0, n = void 0, o = void 0, t = ((o = t ? t instanceof s.RenderTexture ? t : e.generateTexture(t) : o) ? (i = o.baseTexture._canvasRenderTarget.context, r = o.baseTexture._canvasRenderTarget.resolution, n = o.frame) : (i = e.rootContext, (n = a).width = this.renderer.width, n.height = this.renderer.height), n.width * r), o = n.height * r, e = new s.CanvasRenderTarget(t, o), i = i.getImageData(n.x * r, n.y * r, t, o); return e.context.putImageData(i, 0, 0), e.canvas }, r.prototype.pixels = function (t) { var e = this.renderer, i = void 0, r = void 0, n = void 0, o = void 0; return (o = t ? t instanceof s.RenderTexture ? t : e.generateTexture(t) : o) ? (i = o.baseTexture._canvasRenderTarget.context, r = o.baseTexture._canvasRenderTarget.resolution, n = o.frame) : (i = e.rootContext, (n = a).width = e.width, n.height = e.height), i.getImageData(0, 0, n.width * r, n.height * r).data }, r.prototype.destroy = function () { this.renderer.extract = null, this.renderer = null }, r); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); (this.renderer = t).extract = this } i.default = t, s.CanvasRenderer.registerPlugin("extract", t) }, { "../../core": 65 }], 133: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("./webgl/WebGLExtract"), n = (Object.defineProperty(i, "webgl", { enumerable: !0, get: function () { return o(r).default } }), t("./canvas/CanvasExtract")); function o(t) { return t && t.__esModule ? t : { default: t } } Object.defineProperty(i, "canvas", { enumerable: !0, get: function () { return o(n).default } }) }, { "./canvas/CanvasExtract": 132, "./webgl/WebGLExtract": 134 }], 134: [function (t, e, i) { "use strict"; i.__esModule = !0; var u = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")); var c = new u.Rectangle, t = (r.prototype.image = function (t) { var e; return (e = new Image).src = this.base64(t), e }, r.prototype.base64 = function (t) { return this.canvas(t).toDataURL() }, r.prototype.canvas = function (t) { var e = this.renderer, i = void 0, r = void 0, n = void 0, o = !1, s = void 0, a = !1, t = (t && (t instanceof u.RenderTexture ? s = t : (s = this.renderer.generateTexture(t), a = !0)), s ? (r = (i = s.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution, n = s.frame, o = !1) : (r = (i = this.renderer.rootRenderTarget).resolution, o = !0, (n = c).width = i.size.width, n.height = i.size.height), n.width * r), h = n.height * r, l = new u.CanvasRenderTarget(t, h); return i && (e.bindRenderTarget(i), i = new Uint8Array(4 * t * h), (e = e.gl).readPixels(n.x * r, n.y * r, t, h, e.RGBA, e.UNSIGNED_BYTE, i), (n = l.context.createImageData(t, h)).data.set(i), l.context.putImageData(n, 0, 0), n = null, o && (l.context.scale(1, -1), l.context.drawImage(l.canvas, 0, -h))), a && s.destroy(!0), l.canvas }, r.prototype.pixels = function (t) { var e = this.renderer, i = void 0, r = void 0, n = void 0, o = void 0, s = !1, t = (t && (t instanceof u.RenderTexture ? o = t : (o = this.renderer.generateTexture(t), s = !0)), o ? (r = (i = o.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution, n = o.frame) : (r = (i = this.renderer.rootRenderTarget).resolution, (n = c).width = i.size.width, n.height = i.size.height), n.width * r), a = n.height * r, h = new Uint8Array(4 * t * a); return i && (e.bindRenderTarget(i), (i = e.gl).readPixels(n.x * r, n.y * r, t, a, i.RGBA, i.UNSIGNED_BYTE, h)), s && o.destroy(!0), h }, r.prototype.destroy = function () { this.renderer.extract = null, this.renderer = null }, r); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); (this.renderer = t).extract = this } i.default = t, u.WebGLRenderer.registerPlugin("extract", t) }, { "../../core": 65 }], 135: [function (t, e, i) { "use strict"; i.__esModule = !0; var o = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var s = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")); t = function (r) { var t = n, e = r; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function n(t, e) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); var i = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, r.call(this, t[0] instanceof s.Texture ? t[0] : t[0].texture)); return i._textures = null, i._durations = null, i.textures = t, i._autoUpdate = !1 !== e, i.animationSpeed = 1, i.loop = !0, i.onComplete = null, i.onFrameChange = null, i.onLoop = null, i._currentTime = 0, i.playing = !1, i } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), n.prototype.stop = function () { this.playing && (this.playing = !1, this._autoUpdate && s.ticker.shared.remove(this.update, this)) }, n.prototype.play = function () { this.playing || (this.playing = !0, this._autoUpdate && s.ticker.shared.add(this.update, this, s.UPDATE_PRIORITY.HIGH)) }, n.prototype.gotoAndStop = function (t) { this.stop(); var e = this.currentFrame; this._currentTime = t, e !== this.currentFrame && this.updateTexture() }, n.prototype.gotoAndPlay = function (t) { var e = this.currentFrame; this._currentTime = t, e !== this.currentFrame && this.updateTexture(), this.play() }, n.prototype.update = function (t) { var e = this.animationSpeed * t, i = this.currentFrame; if (null !== this._durations) { var r = this._currentTime % 1 * this._durations[this.currentFrame]; for (r += e / 60 * 1e3; r < 0;)this._currentTime--, r += this._durations[this.currentFrame]; var n = Math.sign(this.animationSpeed * t); for (this._currentTime = Math.floor(this._currentTime); r >= this._durations[this.currentFrame];)r -= this._durations[this.currentFrame] * n, this._currentTime += n; this._currentTime += r / this._durations[this.currentFrame] } else this._currentTime += e; this._currentTime < 0 && !this.loop ? (this.gotoAndStop(0), this.onComplete && this.onComplete()) : this._currentTime >= this._textures.length && !this.loop ? (this.gotoAndStop(this._textures.length - 1), this.onComplete && this.onComplete()) : i !== this.currentFrame && (this.loop && this.onLoop && (0 < this.animationSpeed && this.currentFrame < i || this.animationSpeed < 0 && this.currentFrame > i) && this.onLoop(), this.updateTexture()) }, n.prototype.updateTexture = function () { this._texture = this._textures[this.currentFrame], this._textureID = -1, this.cachedTint = 16777215, this.onFrameChange && this.onFrameChange(this.currentFrame) }, n.prototype.destroy = function (t) { this.stop(), r.prototype.destroy.call(this, t) }, n.fromFrames = function (t) { for (var e = [], i = 0; i < t.length; ++i)e.push(s.Texture.fromFrame(t[i])); return new n(e) }, n.fromImages = function (t) { for (var e = [], i = 0; i < t.length; ++i)e.push(s.Texture.fromImage(t[i])); return new n(e) }, o(n, [{ key: "totalFrames", get: function () { return this._textures.length } }, { key: "textures", get: function () { return this._textures }, set: function (t) { if (t[0] instanceof s.Texture) this._textures = t, this._durations = null; else { this._textures = [], this._durations = []; for (var e = 0; e < t.length; e++)this._textures.push(t[e].texture), this._durations.push(t[e].time) } this.gotoAndStop(0), this.updateTexture() } }, { key: "currentFrame", get: function () { var t = Math.floor(this._currentTime) % this._textures.length; return t < 0 && (t += this._textures.length), t } }]), n }(s.Sprite); i.default = t }, { "../core": 65 }], 136: [function (t, o, e) { "use strict"; e.__esModule = !0; var i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var A = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")), s = n(t("../core/math/ObservablePoint")), T = t("../core/utils"), w = n(t("../core/settings")); function n(t) { return t && t.__esModule ? t : { default: t } } t = function (o) { var t = M, e = o; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function M(t) { var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {}, i = this, r = M; if (!(i instanceof r)) throw new TypeError("Cannot call a class as a function"); var n = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, o.call(this)); return n._textWidth = 0, n._textHeight = 0, n._glyphs = [], n._font = { tint: void 0 !== e.tint ? e.tint : 16777215, align: e.align || "left", name: null, size: 0 }, n.font = e.font, n._text = t, n._maxWidth = 0, n._maxLineHeight = 0, n._letterSpacing = 0, n._anchor = new s.default(function () { n.dirty = !0 }, n, 0, 0), n.dirty = !1, n.updateText(), n } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), M.prototype.updateText = function () { for (var t = M.fonts[this._font.name], e = this._font.size / t.size, i = new A.Point, r = [], u = [], c = this.text.replace(/(?:\r\n|\r)/g, "\n"), f = c.length, d = this._maxWidth * t.size / this._font.size, p = null, n = 0, o = 0, g = 0, v = -1, m = 0, y = 0, _ = 0, s = 0; s < f; s++) { var b = c.charCodeAt(s), a = c.charAt(s); /(?:\s)/.test(a) && (v = s, m = n), "\r" !== a && "\n" !== a ? (a = t.chars[b]) && (p && a.kerning[p] && (i.x += a.kerning[p]), r.push({ texture: a.texture, line: g, charCode: b, position: new A.Point(i.x + a.xOffset + this._letterSpacing / 2, i.y + a.yOffset) }), i.x += a.xAdvance + this._letterSpacing, n = i.x, _ = Math.max(_, a.yOffset + a.texture.height), p = b, -1 !== v && 0 < d && i.x > d && (++y, A.utils.removeItems(r, 1 + v - y, 1 + s - v), s = v, v = -1, u.push(m), o = Math.max(o, m), g++, i.x = 0, i.y += t.lineHeight, p = null)) : (u.push(n), o = Math.max(o, n), ++g, ++y, i.x = 0, i.y += t.lineHeight, p = null) } for (var x = c.charAt(c.length - 1), T = ("\r" !== x && "\n" !== x && (/(?:\s)/.test(x) && (n = m), u.push(n), o = Math.max(o, n)), []), w = 0; w <= g; w++) { var S = 0; "right" === this._font.align ? S = o - u[w] : "center" === this._font.align && (S = (o - u[w]) / 2), T.push(S) } for (var C = r.length, E = this.tint, h = 0; h < C; h++) { var l = this._glyphs[h]; l ? l.texture = r[h].texture : (l = new A.Sprite(r[h].texture), this._glyphs.push(l)), l.position.x = (r[h].position.x + T[r[h].line]) * e, l.position.y = r[h].position.y * e, l.scale.x = l.scale.y = e, l.tint = E, l.parent || this.addChild(l) } for (var O = C; O < this._glyphs.length; ++O)this.removeChild(this._glyphs[O]); if (this._textWidth = o * e, this._textHeight = (i.y + t.lineHeight) * e, 0 !== this.anchor.x || 0 !== this.anchor.y) for (var P = 0; P < C; P++)this._glyphs[P].x -= this._textWidth * this.anchor.x, this._glyphs[P].y -= this._textHeight * this.anchor.y; this._maxLineHeight = _ * e }, M.prototype.updateTransform = function () { this.validate(), this.containerUpdateTransform() }, M.prototype.getLocalBounds = function () { return this.validate(), o.prototype.getLocalBounds.call(this) }, M.prototype.validate = function () { this.dirty && (this.updateText(), this.dirty = !1) }, M.registerFont = function (t, e) { var i = {}, u = t.getElementsByTagName("info")[0], c = t.getElementsByTagName("common")[0], r = t.getElementsByTagName("page"), n = (0, T.getResolutionOfUrl)(r[0].getAttribute("file"), w.default.RESOLUTION), o = {}; i.font = u.getAttribute("face"), i.size = parseInt(u.getAttribute("size"), 10), i.lineHeight = parseInt(c.getAttribute("lineHeight"), 10) / n, i.chars = {}, e instanceof A.Texture && (e = [e]); for (var s = 0; s < r.length; s++) { var f = r[s].getAttribute("id"), d = r[s].getAttribute("file"); o[f] = e instanceof Array ? e[s] : e[d] } for (var p = t.getElementsByTagName("char"), g = 0; g < p.length; g++) { var a = p[g], v = parseInt(a.getAttribute("id"), 10), h = a.getAttribute("page") || 0, m = new A.Rectangle(parseInt(a.getAttribute("x"), 10) / n + o[h].frame.x / n, parseInt(a.getAttribute("y"), 10) / n + o[h].frame.y / n, parseInt(a.getAttribute("width"), 10) / n, parseInt(a.getAttribute("height"), 10) / n); i.chars[v] = { xOffset: parseInt(a.getAttribute("xoffset"), 10) / n, yOffset: parseInt(a.getAttribute("yoffset"), 10) / n, xAdvance: parseInt(a.getAttribute("xadvance"), 10) / n, kerning: {}, texture: new A.Texture(o[h].baseTexture, m), page: h } } for (var y = t.getElementsByTagName("kerning"), _ = 0; _ < y.length; _++) { var l = y[_], b = parseInt(l.getAttribute("first"), 10) / n, x = parseInt(l.getAttribute("second"), 10) / n, l = parseInt(l.getAttribute("amount"), 10) / n; i.chars[x] && (i.chars[x].kerning[b] = l) } return M.fonts[i.font] = i }, i(M, [{ key: "tint", get: function () { return this._font.tint }, set: function (t) { this._font.tint = "number" == typeof t && 0 <= t ? t : 16777215, this.dirty = !0 } }, { key: "align", get: function () { return this._font.align }, set: function (t) { this._font.align = t || "left", this.dirty = !0 } }, { key: "anchor", get: function () { return this._anchor }, set: function (t) { "number" == typeof t ? this._anchor.set(t) : this._anchor.copy(t) } }, { key: "font", get: function () { return this._font }, set: function (t) { t && ("string" == typeof t ? (t = t.split(" "), this._font.name = 1 === t.length ? t[0] : t.slice(1).join(" "), this._font.size = 2 <= t.length ? parseInt(t[0], 10) : M.fonts[this._font.name].size) : (this._font.name = t.name, this._font.size = "number" == typeof t.size ? t.size : parseInt(t.size, 10)), this.dirty = !0) } }, { key: "text", get: function () { return this._text }, set: function (t) { t = t.toString() || " ", this._text !== t && (this._text = t, this.dirty = !0) } }, { key: "maxWidth", get: function () { return this._maxWidth }, set: function (t) { this._maxWidth !== t && (this._maxWidth = t, this.dirty = !0) } }, { key: "maxLineHeight", get: function () { return this.validate(), this._maxLineHeight } }, { key: "textWidth", get: function () { return this.validate(), this._textWidth } }, { key: "letterSpacing", get: function () { return this._letterSpacing }, set: function (t) { this._letterSpacing !== t && (this._letterSpacing = t, this.dirty = !0) } }, { key: "textHeight", get: function () { return this.validate(), this._textHeight } }]), M }(A.Container); (e.default = t).fonts = {} }, { "../core": 65, "../core/math/ObservablePoint": 68, "../core/settings": 101, "../core/utils": 125 }], 137: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var u = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")), t = t("../core/sprites/canvas/CanvasTinter"), c = (t = t) && t.__esModule ? t : { default: t }; var a = new u.Point, t = function (o) { var t = s, e = o; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function s(t) { var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 100, i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 100, r = this, n = s; if (!(r instanceof n)) throw new TypeError("Cannot call a class as a function"); r = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, o.call(this, t)); return r.tileTransform = new u.TransformStatic, r._width = e, r._height = i, r._canvasPattern = null, r.uvTransform = t.transform || new u.TextureMatrix(t), r.pluginName = "tilingSprite", r.uvRespectAnchor = !1, r } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), s.prototype._onTextureUpdate = function () { this.uvTransform && (this.uvTransform.texture = this._texture), this.cachedTint = 16777215 }, s.prototype._renderWebGL = function (t) { var e = this._texture; e && e.valid && (this.tileTransform.updateLocalTransform(), this.uvTransform.update(), t.setObjectRenderer(t.plugins[this.pluginName]), t.plugins[this.pluginName].render(this)) }, s.prototype._renderCanvas = function (t) { var e, i, r, n, o, s, a, h, l = this._texture; l.baseTexture.hasLoaded && (e = t.context, i = this.worldTransform, r = t.resolution, n = (h = l.baseTexture).resolution, o = this.tilePosition.x / this.tileScale.x % l._frame.width * n, s = this.tilePosition.y / this.tileScale.y % l._frame.height * n, this._textureID === this._texture._updateID && this.cachedTint === this.tint || (this._textureID = this._texture._updateID, a = new u.CanvasRenderTarget(l._frame.width, l._frame.height, n), 16777215 !== this.tint ? (this.tintedTexture = c.default.getTintedTexture(this, this.tint), a.context.drawImage(this.tintedTexture, 0, 0)) : a.context.drawImage(h.source, -l._frame.x * n, -l._frame.y * n), this.cachedTint = this.tint, this._canvasPattern = a.context.createPattern(a.canvas, "repeat")), e.globalAlpha = this.worldAlpha, e.setTransform(i.a * r, i.b * r, i.c * r, i.d * r, i.tx * r, i.ty * r), t.setBlendMode(this.blendMode), e.fillStyle = this._canvasPattern, e.scale(this.tileScale.x / n, this.tileScale.y / n), h = this.anchor.x * -this._width, l = this.anchor.y * -this._height, this.uvRespectAnchor ? (e.translate(o, s), e.fillRect(h - o, l - s, this._width / this.tileScale.x * n, this._height / this.tileScale.y * n)) : (e.translate(o + h, s + l), e.fillRect(-o, -s, this._width / this.tileScale.x * n, this._height / this.tileScale.y * n))) }, s.prototype._calculateBounds = function () { var t = this._width * -this._anchor._x, e = this._height * -this._anchor._y, i = this._width * (1 - this._anchor._x), r = this._height * (1 - this._anchor._y); this._bounds.addFrame(this.transform, t, e, i, r) }, s.prototype.getLocalBounds = function (t) { return 0 === this.children.length ? (this._bounds.minX = this._width * -this._anchor._x, this._bounds.minY = this._height * -this._anchor._y, this._bounds.maxX = this._width * (1 - this._anchor._x), this._bounds.maxY = this._height * (1 - this._anchor._y), t || (this._localBoundsRect || (this._localBoundsRect = new u.Rectangle), t = this._localBoundsRect), this._bounds.getRectangle(t)) : o.prototype.getLocalBounds.call(this, t) }, s.prototype.containsPoint = function (t) { this.worldTransform.applyInverse(t, a); var t = this._width, e = this._height, i = -t * this.anchor._x; if (a.x >= i && a.x < i + t) { i = -e * this.anchor._y; if (a.y >= i && a.y < i + e) return !0 } return !1 }, s.prototype.destroy = function (t) { o.prototype.destroy.call(this, t), this.tileTransform = null, this.uvTransform = null }, s.from = function (t, e, i) { return new s(u.Texture.from(t), e, i) }, s.fromFrame = function (t, e, i) { var r = u.utils.TextureCache[t]; if (!r) throw new Error('The frameId "' + t + '" does not exist in the texture cache ' + this); return new s(r, e, i) }, s.fromImage = function (t, e, i, r, n) { return new s(u.Texture.fromImage(t, r, n), e, i) }, r(s, [{ key: "clampMargin", get: function () { return this.uvTransform.clampMargin }, set: function (t) { this.uvTransform.clampMargin = t, this.uvTransform.update(!0) } }, { key: "tileScale", get: function () { return this.tileTransform.scale }, set: function (t) { this.tileTransform.scale.copy(t) } }, { key: "tilePosition", get: function () { return this.tileTransform.position }, set: function (t) { this.tileTransform.position.copy(t) } }, { key: "width", get: function () { return this._width }, set: function (t) { this._width = t } }, { key: "height", get: function () { return this._height }, set: function (t) { this._height = t } }]), s }(u.Sprite); i.default = t }, { "../core": 65, "../core/sprites/canvas/CanvasTinter": 104 }], 138: [function (t, e, n) { "use strict"; var a = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")), h = i(t("../core/textures/Texture")), l = i(t("../core/textures/BaseTexture")), u = t("../core/utils"); function i(t) { return t && t.__esModule ? t : { default: t } } function r() { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); this.textureCacheId = null, this.originalRenderWebGL = null, this.originalRenderCanvas = null, this.originalCalculateBounds = null, this.originalGetLocalBounds = null, this.originalUpdateTransform = null, this.originalHitTest = null, this.originalDestroy = null, this.originalMask = null, this.originalFilterArea = null, this.sprite = null } var t = a.DisplayObject, c = new a.Matrix; t.prototype._cacheAsBitmap = !1, t.prototype._cacheData = !1; Object.defineProperties(t.prototype, { cacheAsBitmap: { get: function () { return this._cacheAsBitmap }, set: function (t) { var e; this._cacheAsBitmap !== t && (e = void 0, (this._cacheAsBitmap = t) ? (this._cacheData || (this._cacheData = new r), (e = this._cacheData).originalRenderWebGL = this.renderWebGL, e.originalRenderCanvas = this.renderCanvas, e.originalUpdateTransform = this.updateTransform, e.originalCalculateBounds = this._calculateBounds, e.originalGetLocalBounds = this.getLocalBounds, e.originalDestroy = this.destroy, e.originalContainsPoint = this.containsPoint, e.originalMask = this._mask, e.originalFilterArea = this.filterArea, this.renderWebGL = this._renderCachedWebGL, this.renderCanvas = this._renderCachedCanvas, this.destroy = this._cacheAsBitmapDestroy) : ((e = this._cacheData).sprite && this._destroyCachedDisplayObject(), this.renderWebGL = e.originalRenderWebGL, this.renderCanvas = e.originalRenderCanvas, this._calculateBounds = e.originalCalculateBounds, this.getLocalBounds = e.originalGetLocalBounds, this.destroy = e.originalDestroy, this.updateTransform = e.originalUpdateTransform, this.containsPoint = e.originalContainsPoint, this._mask = e.originalMask, this.filterArea = e.originalFilterArea)) } } }), t.prototype._renderCachedWebGL = function (t) { !this.visible || this.worldAlpha <= 0 || !this.renderable || (this._initCachedDisplayObject(t), this._cacheData.sprite._transformID = -1, this._cacheData.sprite.worldAlpha = this.worldAlpha, this._cacheData.sprite._renderWebGL(t)) }, t.prototype._initCachedDisplayObject = function (t) { var e, i, r, n, o, s; this._cacheData && this._cacheData.sprite || (e = this.alpha, this.alpha = 1, t.currentRenderer.flush(), i = this.getLocalBounds().clone(), this._filters && (r = this._filters[0].padding, i.pad(r)), r = t._activeRenderTarget, n = t.filterManager.filterStack, o = a.RenderTexture.create(0 | i.width, 0 | i.height), s = "cacheAsBitmap_" + (0, u.uid)(), this._cacheData.textureCacheId = s, l.default.addToCache(o.baseTexture, s), h.default.addToCache(o, s), (s = c).tx = -i.x, s.ty = -i.y, this.transform.worldTransform.identity(), this.renderWebGL = this._cacheData.originalRenderWebGL, t.render(this, o, !0, s, !0), t.bindRenderTarget(r), t.filterManager.filterStack = n, this.renderWebGL = this._renderCachedWebGL, this.updateTransform = this.displayObjectUpdateTransform, this._mask = null, this.filterArea = null, (s = new a.Sprite(o)).transform.worldTransform = this.transform.worldTransform, s.anchor.x = -(i.x / i.width), s.anchor.y = -(i.y / i.height), s.alpha = e, s._bounds = this._bounds, this._calculateBounds = this._calculateCachedBounds, this.getLocalBounds = this._getCachedLocalBounds, this._cacheData.sprite = s, this.transform._parentID = -1, this.parent ? this.updateTransform() : (this.parent = t._tempDisplayObjectParent, this.updateTransform(), this.parent = null), this.containsPoint = s.containsPoint.bind(s)) }, t.prototype._renderCachedCanvas = function (t) { !this.visible || this.worldAlpha <= 0 || !this.renderable || (this._initCachedDisplayObjectCanvas(t), this._cacheData.sprite.worldAlpha = this.worldAlpha, this._cacheData.sprite.renderCanvas(t)) }, t.prototype._initCachedDisplayObjectCanvas = function (t) { var e, i, r, n, o; this._cacheData && this._cacheData.sprite || (e = this.getLocalBounds(), i = this.alpha, this.alpha = 1, r = t.context, n = a.RenderTexture.create(0 | e.width, 0 | e.height), o = "cacheAsBitmap_" + (0, u.uid)(), this._cacheData.textureCacheId = o, l.default.addToCache(n.baseTexture, o), h.default.addToCache(n, o), this.transform.localTransform.copy(o = c), o.invert(), o.tx -= e.x, o.ty -= e.y, this.renderCanvas = this._cacheData.originalRenderCanvas, t.render(this, n, !0, o, !1), t.context = r, this.renderCanvas = this._renderCachedCanvas, this._calculateBounds = this._calculateCachedBounds, this._mask = null, this.filterArea = null, (o = new a.Sprite(n)).transform.worldTransform = this.transform.worldTransform, o.anchor.x = -(e.x / e.width), o.anchor.y = -(e.y / e.height), o._bounds = this._bounds, o.alpha = i, this.parent ? this.updateTransform() : (this.parent = t._tempDisplayObjectParent, this.updateTransform(), this.parent = null), this.updateTransform = this.displayObjectUpdateTransform, this._cacheData.sprite = o, this.containsPoint = o.containsPoint.bind(o)) }, t.prototype._calculateCachedBounds = function () { this._cacheData.sprite._calculateBounds() }, t.prototype._getCachedLocalBounds = function () { return this._cacheData.sprite.getLocalBounds() }, t.prototype._destroyCachedDisplayObject = function () { this._cacheData.sprite._texture.destroy(!0), this._cacheData.sprite = null, l.default.removeFromCache(this._cacheData.textureCacheId), h.default.removeFromCache(this._cacheData.textureCacheId), this._cacheData.textureCacheId = null }, t.prototype._cacheAsBitmapDestroy = function (t) { this.cacheAsBitmap = !1, this.destroy(t) } }, { "../core": 65, "../core/textures/BaseTexture": 112, "../core/textures/Texture": 115, "../core/utils": 125 }], 139: [function (t, e, i) { "use strict"; t = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")); t.DisplayObject.prototype.name = null, t.Container.prototype.getChildByName = function (t) { for (var e = 0; e < this.children.length; e++)if (this.children[e].name === t) return this.children[e]; return null } }, { "../core": 65 }], 140: [function (t, e, i) { "use strict"; var r = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")); r.DisplayObject.prototype.getGlobalPosition = function () { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : new r.Point; return this.parent ? this.parent.toGlobal(this.position, t, 1 < arguments.length && void 0 !== arguments[1] && arguments[1]) : (t.x = this.position.x, t.y = this.position.y), t } }, { "../core": 65 }], 141: [function (t, e, i) { "use strict"; i.__esModule = !0, i.BitmapText = i.TilingSpriteRenderer = i.TilingSprite = i.AnimatedSprite = void 0; var r = t("./AnimatedSprite"), n = (Object.defineProperty(i, "AnimatedSprite", { enumerable: !0, get: function () { return a(r).default } }), t("./TilingSprite")), o = (Object.defineProperty(i, "TilingSprite", { enumerable: !0, get: function () { return a(n).default } }), t("./webgl/TilingSpriteRenderer")), s = (Object.defineProperty(i, "TilingSpriteRenderer", { enumerable: !0, get: function () { return a(o).default } }), t("./BitmapText")); function a(t) { return t && t.__esModule ? t : { default: t } } Object.defineProperty(i, "BitmapText", { enumerable: !0, get: function () { return a(s).default } }), t("./cacheAsBitmap"), t("./getChildByName"), t("./getGlobalPosition") }, { "./AnimatedSprite": 135, "./BitmapText": 136, "./TilingSprite": 137, "./cacheAsBitmap": 138, "./getChildByName": 139, "./getGlobalPosition": 140, "./webgl/TilingSpriteRenderer": 142 }], 142: [function (t, e, i) { "use strict"; i.__esModule = !0; var d = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")), p = t("../../core/const"); t("path"); var g = new d.Matrix, t = function (e) { var t = r, i = e; if ("function" != typeof i && null !== i) throw new TypeError("Super expression must either be null or a function, not " + typeof i); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, e.call(this, t)); return t.shader = null, t.simpleShader = null, t.quad = null, t } return t.prototype = Object.create(i && i.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), i && (Object.setPrototypeOf ? Object.setPrototypeOf(t, i) : t.__proto__ = i), r.prototype.onContextChange = function () { var t = this.renderer.gl; this.shader = new d.Shader(t, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n", "varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n"), this.simpleShader = new d.Shader(t, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n", "varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n"), this.renderer.bindVao(null), this.quad = new d.Quad(t, this.renderer.state.attribState), this.quad.initVao(this.shader) }, r.prototype.render = function (t) { var e = this.renderer, i = this.quad, r = (e.bindVao(i.vao), i.vertices), r = (r[0] = r[6] = t._width * -t.anchor.x, r[1] = r[3] = t._height * -t.anchor.y, r[2] = r[4] = t._width * (1 - t.anchor.x), r[5] = r[7] = t._height * (1 - t.anchor.y), t.uvRespectAnchor && ((r = i.uvs)[0] = r[6] = -t.anchor.x, r[1] = r[3] = -t.anchor.y, r[2] = r[4] = 1 - t.anchor.x, r[5] = r[7] = 1 - t.anchor.y), i.upload(), t._texture), n = r.baseTexture, o = t.tileTransform.localTransform, s = t.uvTransform, a = n.isPowerOfTwo && r.frame.width === n.width && r.frame.height === n.height, h = (a && (n._glTextures[e.CONTEXT_UID] ? a = n.wrapMode !== p.WRAP_MODES.CLAMP : n.wrapMode === p.WRAP_MODES.CLAMP && (n.wrapMode = p.WRAP_MODES.REPEAT)), a ? this.simpleShader : this.shader), u = (e.bindShader(h), r.width), c = r.height, l = t._width, f = t._height; g.set(o.a * u / l, o.b * u / f, o.c * c / l, o.d * c / f, o.tx / l, o.ty / f), g.invert(), a ? g.prepend(s.mapCoord) : (h.uniforms.uMapCoord = s.mapCoord.toArray(!0), h.uniforms.uClampFrame = s.uClampFrame, h.uniforms.uClampOffset = s.uClampOffset), h.uniforms.uTransform = g.toArray(!0), h.uniforms.uColor = d.utils.premultiplyTintToRgba(t.tint, t.worldAlpha, h.uniforms.uColor, n.premultipliedAlpha), h.uniforms.translationMatrix = t.transform.worldTransform.toArray(!0), h.uniforms.uSampler = e.bindTexture(r), e.setBlendMode(d.utils.correctBlendMode(t.blendMode, n.premultipliedAlpha)), i.vao.draw(this.renderer.gl.TRIANGLES, 6, 0) }, r }(d.ObjectRenderer); i.default = t, d.WebGLRenderer.registerPlugin("tilingSprite", t) }, { "../../core": 65, "../../core/const": 46, path: 8 }], 143: [function (t, e, i) { "use strict"; i.__esModule = !0; var o = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var n = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")); t("path"); t = function (r) { var t = n, e = r; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function n() { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 1, e = this, i = n; if (!(e instanceof i)) throw new TypeError("Cannot call a class as a function"); e = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, r.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}", "varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n")); return e.alpha = t, e.glShaderKey = "alpha", e } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), o(n, [{ key: "alpha", get: function () { return this.uniforms.uAlpha }, set: function (t) { this.uniforms.uAlpha = t } }]), n }(n.Filter); i.default = t }, { "../../core": 65, path: 8 }], 144: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var a = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")), h = o(t("./BlurXFilter")), l = o(t("./BlurYFilter")); function o(t) { return t && t.__esModule ? t : { default: t } } t = function (o) { var t = s, e = o; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function s(t, e, i, r) { if (!(this instanceof s)) throw new TypeError("Cannot call a class as a function"); var n = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, o.call(this)); return n.blurXFilter = new h.default(t, e, i, r), n.blurYFilter = new l.default(t, e, i, r), n.padding = 0, n.resolution = i || a.settings.RESOLUTION, n.quality = e || 4, n.blur = t || 8, n } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), s.prototype.apply = function (t, e, i) { var r = t.getRenderTarget(!0); this.blurXFilter.apply(t, e, r, !0), this.blurYFilter.apply(t, r, i, !1), t.returnRenderTarget(r) }, r(s, [{ key: "blur", get: function () { return this.blurXFilter.blur }, set: function (t) { this.blurXFilter.blur = this.blurYFilter.blur = t, this.padding = 2 * Math.max(Math.abs(this.blurXFilter.strength), Math.abs(this.blurYFilter.strength)) } }, { key: "quality", get: function () { return this.blurXFilter.quality }, set: function (t) { this.blurXFilter.quality = this.blurYFilter.quality = t } }, { key: "blurX", get: function () { return this.blurXFilter.blur }, set: function (t) { this.blurXFilter.blur = t, this.padding = 2 * Math.max(Math.abs(this.blurXFilter.strength), Math.abs(this.blurYFilter.strength)) } }, { key: "blurY", get: function () { return this.blurYFilter.blur }, set: function (t) { this.blurYFilter.blur = t, this.padding = 2 * Math.max(Math.abs(this.blurXFilter.strength), Math.abs(this.blurYFilter.strength)) } }, { key: "blendMode", get: function () { return this.blurYFilter._blendMode }, set: function (t) { this.blurYFilter._blendMode = t } }]), s }(a.Filter); i.default = t }, { "../../core": 65, "./BlurXFilter": 145, "./BlurYFilter": 146 }], 145: [function (t, o, e) { "use strict"; e.__esModule = !0; var i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var a = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")), l = n(t("./generateBlurVertSource")), u = n(t("./generateBlurFragSource")), c = n(t("./getMaxBlurKernelSize")); function n(t) { return t && t.__esModule ? t : { default: t } } t = function (o) { var t = s, e = o; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function s(t, e, i, r) { if (!(this instanceof s)) throw new TypeError("Cannot call a class as a function"); var n = (0, l.default)(r = r || 5, !0), r = (0, u.default)(r), n = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, o.call(this, n, r)); return n.resolution = i || a.settings.RESOLUTION, n._quality = 0, n.quality = e || 4, n.strength = t || 8, n.firstRun = !0, n } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), s.prototype.apply = function (t, e, i, r) { if (this.firstRun && (n = t.renderer.gl, n = (0, c.default)(n), this.vertexSrc = (0, l.default)(n, !0), this.fragmentSrc = (0, u.default)(n), this.firstRun = !1), this.uniforms.strength = 1 / i.size.width * (i.size.width / e.size.width), this.uniforms.strength *= this.strength, this.uniforms.strength /= this.passes, 1 === this.passes) t.applyFilter(this, e, i, r); else { for (var n = t.getRenderTarget(!0), o = e, s = n, a = 0; a < this.passes - 1; a++) { t.applyFilter(this, o, s, !0); var h = s, s = o, o = h } t.applyFilter(this, o, i, r), t.returnRenderTarget(n) } }, i(s, [{ key: "blur", get: function () { return this.strength }, set: function (t) { this.padding = 2 * Math.abs(t), this.strength = t } }, { key: "quality", get: function () { return this._quality }, set: function (t) { this._quality = t, this.passes = t } }]), s }(a.Filter); e.default = t }, { "../../core": 65, "./generateBlurFragSource": 147, "./generateBlurVertSource": 148, "./getMaxBlurKernelSize": 149 }], 146: [function (t, o, e) { "use strict"; e.__esModule = !0; var i = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var a = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")), l = n(t("./generateBlurVertSource")), u = n(t("./generateBlurFragSource")), c = n(t("./getMaxBlurKernelSize")); function n(t) { return t && t.__esModule ? t : { default: t } } t = function (o) { var t = s, e = o; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function s(t, e, i, r) { if (!(this instanceof s)) throw new TypeError("Cannot call a class as a function"); var n = (0, l.default)(r = r || 5, !1), r = (0, u.default)(r), n = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, o.call(this, n, r)); return n.resolution = i || a.settings.RESOLUTION, n._quality = 0, n.quality = e || 4, n.strength = t || 8, n.firstRun = !0, n } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), s.prototype.apply = function (t, e, i, r) { if (this.firstRun && (n = t.renderer.gl, n = (0, c.default)(n), this.vertexSrc = (0, l.default)(n, !1), this.fragmentSrc = (0, u.default)(n), this.firstRun = !1), this.uniforms.strength = 1 / i.size.height * (i.size.height / e.size.height), this.uniforms.strength *= this.strength, this.uniforms.strength /= this.passes, 1 === this.passes) t.applyFilter(this, e, i, r); else { for (var n = t.getRenderTarget(!0), o = e, s = n, a = 0; a < this.passes - 1; a++) { t.applyFilter(this, o, s, !0); var h = s, s = o, o = h } t.applyFilter(this, o, i, r), t.returnRenderTarget(n) } }, i(s, [{ key: "blur", get: function () { return this.strength }, set: function (t) { this.padding = 2 * Math.abs(t), this.strength = t } }, { key: "quality", get: function () { return this._quality }, set: function (t) { this._quality = t, this.passes = t } }]), s }(a.Filter); e.default = t }, { "../../core": 65, "./generateBlurFragSource": 147, "./generateBlurVertSource": 148, "./getMaxBlurKernelSize": 149 }], 147: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t) { for (var e = h[t], i = e.length, r = l, n = "", o = void 0, s = 0; s < t; s++) { var a = "gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%", s); i <= (o = s) && (o = t - s - 1), a = a.replace("%value%", e[o]), n = n + a + "\n" } return r = (r = r.replace("%blur%", n)).replace("%size%", t) }; var h = { 5: [.153388, .221461, .250301], 7: [.071303, .131514, .189879, .214607], 9: [.028532, .067234, .124009, .179044, .20236], 11: [.0093, .028002, .065984, .121703, .175713, .198596], 13: [.002406, .009255, .027867, .065666, .121117, .174868, .197641], 15: [489e-6, .002403, .009246, .02784, .065602, .120999, .174697, .197448] }, l = ["varying vec2 vBlurTexCoords[%size%];", "uniform sampler2D uSampler;", "void main(void)", "{", "    gl_FragColor = vec4(0.0);", "    %blur%", "}"].join("\n") }, {}], 148: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t, e) { var i = Math.ceil(t / 2), r = h, n = "", o = void 0; o = e ? "vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);" : "vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);"; for (var s = 0; s < t; s++) { var a = o.replace("%index%", s); a = a.replace("%sampleIndex%", s - (i - 1) + ".0"), n = n + a + "\n" } return r = (r = r.replace("%blur%", n)).replace("%size%", t) }; var h = ["attribute vec2 aVertexPosition;", "attribute vec2 aTextureCoord;", "uniform float strength;", "uniform mat3 projectionMatrix;", "varying vec2 vBlurTexCoords[%size%];", "void main(void)", "{", "gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);", "%blur%", "}"].join("\n") }, {}], 149: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function (t) { var e = t.getParameter(t.MAX_VARYING_VECTORS), i = 15; for (; e < i;)i -= 2; return i } }, {}], 150: [function (t, e, i) { "use strict"; i.__esModule = !0; var n = function (t, e, i) { return e && r(t.prototype, e), i && r(t, i), t }; function r(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")); t("path"); t = function (e) { var t = r, i = e; if ("function" != typeof i && null !== i) throw new TypeError("Super expression must either be null or a function, not " + typeof i); function r() { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); var t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, e.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}", "varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n")); return t.uniforms.m = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0], t.alpha = 1, t } return t.prototype = Object.create(i && i.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), i && (Object.setPrototypeOf ? Object.setPrototypeOf(t, i) : t.__proto__ = i), r.prototype._loadMatrix = function (t) { var e = t; 1 < arguments.length && void 0 !== arguments[1] && arguments[1] && (this._multiply(e, this.uniforms.m, t), e = this._colorMatrix(e)), this.uniforms.m = e }, r.prototype._multiply = function (t, e, i) { return t[0] = e[0] * i[0] + e[1] * i[5] + e[2] * i[10] + e[3] * i[15], t[1] = e[0] * i[1] + e[1] * i[6] + e[2] * i[11] + e[3] * i[16], t[2] = e[0] * i[2] + e[1] * i[7] + e[2] * i[12] + e[3] * i[17], t[3] = e[0] * i[3] + e[1] * i[8] + e[2] * i[13] + e[3] * i[18], t[4] = e[0] * i[4] + e[1] * i[9] + e[2] * i[14] + e[3] * i[19] + e[4], t[5] = e[5] * i[0] + e[6] * i[5] + e[7] * i[10] + e[8] * i[15], t[6] = e[5] * i[1] + e[6] * i[6] + e[7] * i[11] + e[8] * i[16], t[7] = e[5] * i[2] + e[6] * i[7] + e[7] * i[12] + e[8] * i[17], t[8] = e[5] * i[3] + e[6] * i[8] + e[7] * i[13] + e[8] * i[18], t[9] = e[5] * i[4] + e[6] * i[9] + e[7] * i[14] + e[8] * i[19] + e[9], t[10] = e[10] * i[0] + e[11] * i[5] + e[12] * i[10] + e[13] * i[15], t[11] = e[10] * i[1] + e[11] * i[6] + e[12] * i[11] + e[13] * i[16], t[12] = e[10] * i[2] + e[11] * i[7] + e[12] * i[12] + e[13] * i[17], t[13] = e[10] * i[3] + e[11] * i[8] + e[12] * i[13] + e[13] * i[18], t[14] = e[10] * i[4] + e[11] * i[9] + e[12] * i[14] + e[13] * i[19] + e[14], t[15] = e[15] * i[0] + e[16] * i[5] + e[17] * i[10] + e[18] * i[15], t[16] = e[15] * i[1] + e[16] * i[6] + e[17] * i[11] + e[18] * i[16], t[17] = e[15] * i[2] + e[16] * i[7] + e[17] * i[12] + e[18] * i[17], t[18] = e[15] * i[3] + e[16] * i[8] + e[17] * i[13] + e[18] * i[18], t[19] = e[15] * i[4] + e[16] * i[9] + e[17] * i[14] + e[18] * i[19] + e[19], t }, r.prototype._colorMatrix = function (t) { t = new Float32Array(t); return t[4] /= 255, t[9] /= 255, t[14] /= 255, t[19] /= 255, t }, r.prototype.brightness = function (t, e) { this._loadMatrix([t, 0, 0, 0, 0, 0, t, 0, 0, 0, 0, 0, t, 0, 0, 0, 0, 0, 1, 0], e) }, r.prototype.greyscale = function (t, e) { this._loadMatrix([t, t, t, 0, 0, t, t, t, 0, 0, t, t, t, 0, 0, 0, 0, 0, 1, 0], e) }, r.prototype.blackAndWhite = function (t) { this._loadMatrix([.3, .6, .1, 0, 0, .3, .6, .1, 0, 0, .3, .6, .1, 0, 0, 0, 0, 0, 1, 0], t) }, r.prototype.hue = function (t, e) { t = (t || 0) / 180 * Math.PI; var i = Math.cos(t), t = Math.sin(t), r = (0, Math.sqrt)(1 / 3); this._loadMatrix([i + 1 / 3 * (1 - i), 1 / 3 * (1 - i) - r * t, 1 / 3 * (1 - i) + r * t, 0, 0, 1 / 3 * (1 - i) + r * t, i + 1 / 3 * (1 - i), 1 / 3 * (1 - i) - r * t, 0, 0, 1 / 3 * (1 - i) - r * t, 1 / 3 * (1 - i) + r * t, i + 1 / 3 * (1 - i), 0, 0, 0, 0, 0, 1, 0], e) }, r.prototype.contrast = function (t, e) { var t = (t || 0) + 1, i = -.5 * (t - 1); this._loadMatrix([t, 0, 0, 0, i, 0, t, 0, 0, i, 0, 0, t, 0, i, 0, 0, 0, 1, 0], e) }, r.prototype.saturate = function () { var t = 2 * (0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 0) / 3 + 1, e = -.5 * (t - 1); this._loadMatrix([t, e, e, 0, 0, e, t, e, 0, 0, e, e, t, 0, 0, 0, 0, 0, 1, 0], arguments[1]) }, r.prototype.desaturate = function () { this.saturate(-1) }, r.prototype.negative = function (t) { this._loadMatrix([-1, 0, 0, 1, 0, 0, -1, 0, 1, 0, 0, 0, -1, 1, 0, 0, 0, 0, 1, 0], t) }, r.prototype.sepia = function (t) { this._loadMatrix([.393, .7689999, .18899999, 0, 0, .349, .6859999, .16799999, 0, 0, .272, .5339999, .13099999, 0, 0, 0, 0, 0, 1, 0], t) }, r.prototype.technicolor = function (t) { this._loadMatrix([1.9125277891456083, -.8545344976951645, -.09155508482755585, 0, 11.793603434377337, -.3087833385928097, 1.7658908555458428, -.10601743074722245, 0, -70.35205161461398, -.231103377548616, -.7501899197440212, 1.847597816108189, 0, 30.950940869491138, 0, 0, 0, 1, 0], t) }, r.prototype.polaroid = function (t) { this._loadMatrix([1.438, -.062, -.062, 0, 0, -.122, 1.378, -.122, 0, 0, -.016, -.016, 1.483, 0, 0, 0, 0, 0, 1, 0], t) }, r.prototype.toBGR = function (t) { this._loadMatrix([0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0], t) }, r.prototype.kodachrome = function (t) { this._loadMatrix([1.1285582396593525, -.3967382283601348, -.03992559172921793, 0, 63.72958762196502, -.16404339962244616, 1.0835251566291304, -.05498805115633132, 0, 24.732407896706203, -.16786010706155763, -.5603416277695248, 1.6014850761964943, 0, 35.62982807460946, 0, 0, 0, 1, 0], t) }, r.prototype.browni = function (t) { this._loadMatrix([.5997023498159715, .34553243048391263, -.2708298674538042, 0, 47.43192855600873, -.037703249837783157, .8609577587992641, .15059552388459913, 0, -36.96841498319127, .24113635128153335, -.07441037908422492, .44972182064877153, 0, -7.562075277591283, 0, 0, 0, 1, 0], t) }, r.prototype.vintage = function (t) { this._loadMatrix([.6279345635605994, .3202183420819367, -.03965408211312453, 0, 9.651285835294123, .02578397704808868, .6441188644374771, .03259127616149294, 0, 7.462829176470591, .0466055556782719, -.0851232987247891, .5241648018700465, 0, 5.159190588235296, 0, 0, 0, 1, 0], t) }, r.prototype.colorTone = function (t, e, i, r, n) { var o = ((i = i || 16770432) >> 16 & 255) / 255, s = (i >> 8 & 255) / 255, i = (255 & i) / 255, a = ((r = r || 3375104) >> 16 & 255) / 255, h = (r >> 8 & 255) / 255, r = (255 & r) / 255; this._loadMatrix([.3, .59, .11, 0, 0, o, s, i, t = t || .2, 0, a, h, r, e = e || .15, 0, o - a, s - h, i - r, 0, 0], n) }, r.prototype.night = function (t, e) { this._loadMatrix([-2 * (t = t || .1), -t, 0, 0, 0, -t, 0, t, 0, 0, 0, t, 2 * t, 0, 0, 0, 0, 0, 1, 0], e) }, r.prototype.predator = function (t, e) { this._loadMatrix([11.224130630493164 * t, -4.794486999511719 * t, -2.8746118545532227 * t, 0 * t, .40342438220977783 * t, -3.6330697536468506 * t, 9.193157196044922 * t, -2.951810836791992 * t, 0 * t, -1.316135048866272 * t, -3.2184197902679443 * t, -4.2375030517578125 * t, 7.476448059082031 * t, 0 * t, .8044459223747253 * t, 0, 0, 0, 1, 0], e) }, r.prototype.lsd = function (t) { this._loadMatrix([2, -.4, .5, 0, 0, -.5, 2, -.4, 0, 0, -.4, -.5, 3, 0, 0, 0, 0, 0, 1, 0], t) }, r.prototype.reset = function () { this._loadMatrix([1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0], !1) }, n(r, [{ key: "matrix", get: function () { return this.uniforms.m }, set: function (t) { this.uniforms.m = t } }, { key: "alpha", get: function () { return this.uniforms.uAlpha }, set: function (t) { this.uniforms.uAlpha = t } }]), r }(o.Filter); (i.default = t).prototype.grayscale = t.prototype.greyscale }, { "../../core": 65, path: 8 }], 151: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var s = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")); t("path"); t = function (n) { var t = o, e = n; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function o(t, e) { if (!(this instanceof o)) throw new TypeError("Cannot call a class as a function"); var i = new s.Matrix, r = (t.renderable = !1, function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, n.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}", "varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy *= scale / filterArea.xy;\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"))); return r.maskSprite = t, r.maskMatrix = i, r.uniforms.mapSampler = t._texture, r.uniforms.filterMatrix = i, r.uniforms.scale = { x: 1, y: 1 }, r.scale = new s.Point(e = null == e ? 20 : e, e), r } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), o.prototype.apply = function (t, e, i) { this.uniforms.filterMatrix = t.calculateSpriteMatrix(this.maskMatrix, this.maskSprite), this.uniforms.scale.x = this.scale.x, this.uniforms.scale.y = this.scale.y, t.applyFilter(this, e, i) }, r(o, [{ key: "map", get: function () { return this.uniforms.mapSampler }, set: function (t) { this.uniforms.mapSampler = t } }]), o }(s.Filter); i.default = t }, { "../../core": 65, path: 8 }], 152: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")); t("path"); t = function (i) { var t = r, e = i; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function r() { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); var t = this, e = i.call(this, "\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}", 'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n      vec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n'); if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), r }(r.Filter); i.default = t }, { "../../core": 65, path: 8 }], 153: [function (t, u, e) { "use strict"; e.__esModule = !0; var i = t("./fxaa/FXAAFilter"), r = (Object.defineProperty(e, "FXAAFilter", { enumerable: !0, get: function () { return l(i).default } }), t("./noise/NoiseFilter")), n = (Object.defineProperty(e, "NoiseFilter", { enumerable: !0, get: function () { return l(r).default } }), t("./displacement/DisplacementFilter")), o = (Object.defineProperty(e, "DisplacementFilter", { enumerable: !0, get: function () { return l(n).default } }), t("./blur/BlurFilter")), s = (Object.defineProperty(e, "BlurFilter", { enumerable: !0, get: function () { return l(o).default } }), t("./blur/BlurXFilter")), a = (Object.defineProperty(e, "BlurXFilter", { enumerable: !0, get: function () { return l(s).default } }), t("./blur/BlurYFilter")), h = (Object.defineProperty(e, "BlurYFilter", { enumerable: !0, get: function () { return l(a).default } }), t("./colormatrix/ColorMatrixFilter")), c = (Object.defineProperty(e, "ColorMatrixFilter", { enumerable: !0, get: function () { return l(h).default } }), t("./alpha/AlphaFilter")); function l(t) { return t && t.__esModule ? t : { default: t } } Object.defineProperty(e, "AlphaFilter", { enumerable: !0, get: function () { return l(c).default } }) }, { "./alpha/AlphaFilter": 143, "./blur/BlurFilter": 144, "./blur/BlurXFilter": 145, "./blur/BlurYFilter": 146, "./colormatrix/ColorMatrixFilter": 150, "./displacement/DisplacementFilter": 151, "./fxaa/FXAAFilter": 152, "./noise/NoiseFilter": 154 }], 154: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")); t("path"); t = function (n) { var t = o, e = n; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function o() { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : .5, e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : Math.random(), i = this, r = o; if (!(i instanceof r)) throw new TypeError("Cannot call a class as a function"); i = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, n.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}", "precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n")); return i.noise = t, i.seed = e, i } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), r(o, [{ key: "noise", get: function () { return this.uniforms.uNoise }, set: function (t) { this.uniforms.uNoise = t } }, { key: "seed", get: function () { return this.uniforms.uSeed }, set: function (t) { this.uniforms.uSeed = t } }]), o }(o.Filter); i.default = t }, { "../../core": 65, path: 8 }], 155: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var o = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")); function s() { if (!(this instanceof s)) throw new TypeError("Cannot call a class as a function"); this.global = new o.Point, this.target = null, this.originalEvent = null, this.identifier = null, this.isPrimary = !1, this.button = 0, this.buttons = 0, this.width = 0, this.height = 0, this.tiltX = 0, this.tiltY = 0, this.pointerType = null, this.pressure = 0, this.rotationAngle = 0, this.twist = 0, this.tangentialPressure = 0 } s.prototype.getLocalPosition = function (t, e, i) { return t.worldTransform.applyInverse(i || this.global, e) }, s.prototype.copyEvent = function (t) { t.isPrimary && (this.isPrimary = !0), this.button = t.button, this.buttons = Number.isInteger(t.buttons) ? t.buttons : t.which, this.width = t.width, this.height = t.height, this.tiltX = t.tiltX, this.tiltY = t.tiltY, this.pointerType = t.pointerType, this.pressure = t.pressure, this.rotationAngle = t.rotationAngle, this.twist = t.twist || 0, this.tangentialPressure = t.tangentialPressure || 0 }, s.prototype.reset = function () { this.isPrimary = !1 }, r(s, [{ key: "pointerId", get: function () { return this.identifier } }]), i.default = s }, { "../core": 65 }], 156: [function (t, e, i) { "use strict"; function r() { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); this.stopped = !1, this.target = null, this.currentTarget = null, this.type = null, this.data = null } i.__esModule = !0, r.prototype.stopPropagation = function () { this.stopped = !0 }, r.prototype.reset = function () { this.stopped = !1, this.currentTarget = null, this.target = null }, i.default = r }, {}], 157: [function (t, l, e) { "use strict"; e.__esModule = !0; var i = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t }, o = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")), s = n(t("./InteractionData")), a = n(t("./InteractionEvent")), u = n(t("./InteractionTrackingData")), r = n(t("eventemitter3")), t = n(t("./interactiveTarget")); function n(t) { return t && t.__esModule ? t : { default: t } } o.utils.mixins.delayMixin(o.DisplayObject.prototype, t.default); var h = { target: null, data: { global: null } }, t = function (r) { var t = n, e = r; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function n(t, e) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); var i = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, r.call(this)); return e = e || {}, i.renderer = t, i.autoPreventDefault = void 0 === e.autoPreventDefault || e.autoPreventDefault, i.interactionFrequency = e.interactionFrequency || 10, i.mouse = new s.default, i.mouse.identifier = 1, i.mouse.global.set(-999999), i.activeInteractionData = {}, i.activeInteractionData[1] = i.mouse, i.interactionDataPool = [], i.eventData = new a.default, i.interactionDOMElement = null, i.moveWhenInside = !1, i.eventsAdded = !1, i.mouseOverRenderer = !1, i.supportsTouchEvents = "ontouchstart" in window, i.supportsPointerEvents = !!window.PointerEvent, i.onPointerUp = i.onPointerUp.bind(i), i.processPointerUp = i.processPointerUp.bind(i), i.onPointerCancel = i.onPointerCancel.bind(i), i.processPointerCancel = i.processPointerCancel.bind(i), i.onPointerDown = i.onPointerDown.bind(i), i.processPointerDown = i.processPointerDown.bind(i), i.onPointerMove = i.onPointerMove.bind(i), i.processPointerMove = i.processPointerMove.bind(i), i.onPointerOut = i.onPointerOut.bind(i), i.processPointerOverOut = i.processPointerOverOut.bind(i), i.onPointerOver = i.onPointerOver.bind(i), i.cursorStyles = { default: "inherit", pointer: "pointer" }, i.currentCursorMode = null, i.cursor = null, i._tempPoint = new o.Point, i.resolution = 1, i.setTargetElement(i.renderer.view, i.renderer.resolution), i.befunkyCanvasRect = null, i } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), n.prototype.hitTest = function (t, e) { return h.target = null, h.data.global = t, e = e || this.renderer._lastObjectRendered, this.processInteractive(h, e, null, !0), h.target }, n.prototype.setTargetElement = function (t) { var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 1; this.removeEvents(), this.interactionDOMElement = t, this.resolution = e, this.addEvents() }, n.prototype.addEvents = function () { this.interactionDOMElement && (o.ticker.shared.add(this.update, this, o.UPDATE_PRIORITY.INTERACTION), window.navigator.msPointerEnabled ? (this.interactionDOMElement.style["-ms-content-zooming"] = "none", this.interactionDOMElement.style["-ms-touch-action"] = "none") : this.supportsPointerEvents && (this.interactionDOMElement.style["touch-action"] = "none"), this.supportsPointerEvents ? (window.document.addEventListener("pointermove", this.onPointerMove, !0), this.interactionDOMElement.addEventListener("pointerdown", this.onPointerDown, !0), this.interactionDOMElement.addEventListener("pointerleave", this.onPointerOut, !0), this.interactionDOMElement.addEventListener("pointerover", this.onPointerOver, !0), window.addEventListener("pointercancel", this.onPointerCancel, !0), window.addEventListener("pointerup", this.onPointerUp, !0)) : (window.document.addEventListener("mousemove", this.onPointerMove, !0), this.interactionDOMElement.addEventListener("mousedown", this.onPointerDown, !0), this.interactionDOMElement.addEventListener("mouseout", this.onPointerOut, !0), this.interactionDOMElement.addEventListener("mouseover", this.onPointerOver, !0), window.addEventListener("mouseup", this.onPointerUp, !0)), this.supportsTouchEvents && (this.interactionDOMElement.addEventListener("touchstart", this.onPointerDown, !0), this.interactionDOMElement.addEventListener("touchcancel", this.onPointerCancel, !0), this.interactionDOMElement.addEventListener("touchend", this.onPointerUp, !0), this.interactionDOMElement.addEventListener("touchmove", this.onPointerMove, !0)), this.eventsAdded = !0) }, n.prototype.removeEvents = function () { this.interactionDOMElement && (o.ticker.shared.remove(this.update, this), window.navigator.msPointerEnabled ? (this.interactionDOMElement.style["-ms-content-zooming"] = "", this.interactionDOMElement.style["-ms-touch-action"] = "") : this.supportsPointerEvents && (this.interactionDOMElement.style["touch-action"] = ""), this.supportsPointerEvents ? (window.document.removeEventListener("pointermove", this.onPointerMove, !0), this.interactionDOMElement.removeEventListener("pointerdown", this.onPointerDown, !0), this.interactionDOMElement.removeEventListener("pointerleave", this.onPointerOut, !0), this.interactionDOMElement.removeEventListener("pointerover", this.onPointerOver, !0), window.removeEventListener("pointercancel", this.onPointerCancel, !0), window.removeEventListener("pointerup", this.onPointerUp, !0)) : (window.document.removeEventListener("mousemove", this.onPointerMove, !0), this.interactionDOMElement.removeEventListener("mousedown", this.onPointerDown, !0), this.interactionDOMElement.removeEventListener("mouseout", this.onPointerOut, !0), this.interactionDOMElement.removeEventListener("mouseover", this.onPointerOver, !0), window.removeEventListener("mouseup", this.onPointerUp, !0)), this.supportsTouchEvents && (this.interactionDOMElement.removeEventListener("touchstart", this.onPointerDown, !0), this.interactionDOMElement.removeEventListener("touchcancel", this.onPointerCancel, !0), this.interactionDOMElement.removeEventListener("touchend", this.onPointerUp, !0), this.interactionDOMElement.removeEventListener("touchmove", this.onPointerMove, !0)), this.interactionDOMElement = null, this.eventsAdded = !1) }, n.prototype.update = function (t) { if (this._deltaTime += t, !(this._deltaTime < this.interactionFrequency) && (this._deltaTime = 0, this.interactionDOMElement)) if (this.didMove) this.didMove = !1; else { for (var e in this.cursor = null, this.activeInteractionData) !this.activeInteractionData.hasOwnProperty(e) || (e = this.activeInteractionData[e]).originalEvent && "touch" !== e.pointerType && (e = this.configureInteractionEventForDOMEvent(this.eventData, e.originalEvent, e), this.processInteractive(e, this.renderer._lastObjectRendered, this.processPointerOverOut, !0)); this.setCursorMode(this.cursor) } }, n.prototype.setCursorMode = function (t) { if (this.currentCursorMode !== (t = t || "default")) { this.currentCursorMode = t; var e = this.cursorStyles[t]; if (e) switch (void 0 === e ? "undefined" : i(e)) { case "string": this.interactionDOMElement.style.cursor = e; break; case "function": e(t); break; case "object": Object.assign(this.interactionDOMElement.style, e) } else "string" != typeof t || Object.prototype.hasOwnProperty.call(this.cursorStyles, t) || (this.interactionDOMElement.style.cursor = t) } }, n.prototype.dispatchEvent = function (t, e, i) { i.stopped || (i.currentTarget = t, i.type = e, t.emit(e, i), t[e] && t[e](i)) }, n.prototype.mapPositionToPoint = function (t, e, i) { var r = void 0, r = this.interactionDOMElement.parentElement ? null != this.befunkyCanvasRect ? this.befunkyCanvasRect : this.interactionDOMElement.getBoundingClientRect() : { x: 0, y: 0, width: 0, height: 0 }, n = navigator.isCocoonJS ? this.resolution : 1 / this.resolution; t.x = (e - r.left) * (this.interactionDOMElement.width / r.width) * n, t.y = (i - r.top) * (this.interactionDOMElement.height / r.height) * n }, n.prototype.overAndOutHelperForVisibility = function (t, e) { if (!e) return !1; var i = t.data.global, r = !1; if (e.hitArea ? (e.worldTransform.applyInverse(i, this._tempPoint), e.hitArea.contains(this._tempPoint.x, this._tempPoint.y) && (r = !0)) : e.containsPoint && e.containsPoint(i) && (r = !0), !r) return !1; i = t.data.identifier, r = (r = e.trackedPointers[i]) || (e.trackedPointers[i] = new u.default(i)); return e.visible ? !(!e.hasOwnProperty("befunky_ismouseout") || !0 !== e.befunky_ismouseout || 0 != r.over) && !(e.befunky_ismouseout = !1) : (e.befunky_ismouseout || 1 != r.over || (e.befunky_ismouseout = !0, t.currentTarget = e, this.supportsPointerEvents && e.emit("pointerleave", t), e.emit("mouseout", t), r.over = !1), !0) }, n.prototype.emitMouseOutIfHoveringAndNotVisible = function (t, e) { var i, r; e.visible || (i = t.data.identifier, !e.trackedPointers.hasOwnProperty(i) || (r = e.trackedPointers[i]) && r.over && (t.currentTarget = e, r.over = !1, e.bf = !0, this.supportsPointerEvents && e.emit("pointerleave", t), e.emit("mouseout", t), delete e.trackedPointers[i], delete e.bf)) }, n.prototype.processInteractive = function (t, e, i, r, n) { if (!e) return !1; if (this.emitMouseOutIfHoveringAndNotVisible(t, e), !e.visible) return !1; var o = t.data.global, s = !1, a = n = e.interactive || n, h = !0; if (e.hitArea ? (r && (e.worldTransform.applyInverse(o, this._tempPoint), e.hitArea.contains(this._tempPoint.x, this._tempPoint.y) ? s = !0 : h = r = !1), a = !1) : e._mask && r && (e._mask.containsPoint(o) || (h = r = !1)), h && e.interactiveChildren && e.children) for (var u = e.children, l = u.length - 1; 0 <= l; l--) { var c = u[l], f = this.processInteractive(t, c, i, r, a); f && c.parent && (a = !1, f && (t.target && (r = !1), s = !0)) } return n && (r && !t.target && !e.hitArea && e.containsPoint && e.containsPoint(o) && (s = !0), e.interactive && (s && !t.target && (t.target = e), i && i(t, e, !!s))), s }, n.prototype.onPointerDown = function (t) { if (!this.supportsTouchEvents || "touch" !== t.pointerType) for (var e = this.normalizeToPointerData(t), i = (!this.autoPreventDefault || !e[0].isNormalized || !t.cancelable && "cancelable" in t || t.preventDefault(), e.length), r = 0; r < i; r++) { var n = e[r], o = this.getInteractionDataForPointerId(n), o = this.configureInteractionEventForDOMEvent(this.eventData, n, o); o.data.originalEvent = t, this.processInteractive(o, this.renderer._lastObjectRendered, this.processPointerDown, !0), this.emit("pointerdown", o), "touch" === n.pointerType ? this.emit("touchstart", o) : "mouse" !== n.pointerType && "pen" !== n.pointerType || (o = 2 === n.button, this.emit(o ? "rightdown" : "mousedown", this.eventData)) } }, n.prototype.processPointerDown = function (t, e, i) { var r = t.data, n = t.data.identifier; i && (e.trackedPointers[n] || (e.trackedPointers[n] = new u.default(n)), this.dispatchEvent(e, "pointerdown", t), "touch" === r.pointerType ? this.dispatchEvent(e, "touchstart", t) : "mouse" !== r.pointerType && "pen" !== r.pointerType || ((i = 2 === r.button) ? e.trackedPointers[n].rightDown = !0 : e.trackedPointers[n].leftDown = !0, this.dispatchEvent(e, i ? "rightdown" : "mousedown", t))) }, n.prototype.onPointerComplete = function (t, e, i) { for (var r = this.normalizeToPointerData(t), u = r.length, n = t.target !== this.interactionDOMElement ? "outside" : "", o = 0; o < u; o++) { var s, a = r[o], h = this.getInteractionDataForPointerId(a), l = this.configureInteractionEventForDOMEvent(this.eventData, a, h); l.data.originalEvent = t, this.processInteractive(l, this.renderer._lastObjectRendered, i, e || !n), this.emit(e ? "pointercancel" : "pointerup" + n, l), "mouse" === a.pointerType || "pen" === a.pointerType ? (s = 2 === a.button, this.emit(s ? "rightup" + n : "mouseup" + n, l)) : "touch" === a.pointerType && (this.emit(e ? "touchcancel" : "touchend" + n, l), this.releaseInteractionDataForPointerId(a.pointerId, h)) } }, n.prototype.onPointerCancel = function (t) { this.supportsTouchEvents && "touch" === t.pointerType || this.onPointerComplete(t, !0, this.processPointerCancel) }, n.prototype.processPointerCancel = function (t, e) { var i = t.data, r = t.data.identifier; void 0 !== e.trackedPointers[r] && (delete e.trackedPointers[r], this.dispatchEvent(e, "pointercancel", t), "touch" === i.pointerType && this.dispatchEvent(e, "touchcancel", t)) }, n.prototype.onPointerUp = function (t) { this.supportsTouchEvents && "touch" === t.pointerType || this.onPointerComplete(t, !1, this.processPointerUp) }, n.prototype.processPointerUp = function (t, e, i) { var r, n = t.data, o = t.data.identifier, s = e.trackedPointers[o], a = "touch" === n.pointerType, h = "mouse" === n.pointerType || "pen" === n.pointerType, l = !1; h && (n = 2 === n.button, r = u.default.FLAGS, r = n ? r.RIGHT_DOWN : r.LEFT_DOWN, r = void 0 !== s && s.flags & r, i ? (this.dispatchEvent(e, n ? "rightup" : "mouseup", t), r && (this.dispatchEvent(e, n ? "rightclick" : "click", t), l = !0)) : r && this.dispatchEvent(e, n ? "rightupoutside" : "mouseupoutside", t), s && (n ? s.rightDown = !1 : s.leftDown = !1)), i ? (this.dispatchEvent(e, "pointerup", t), a && this.dispatchEvent(e, "touchend", t), s && (h && !l || this.dispatchEvent(e, "pointertap", t), a && (this.dispatchEvent(e, "tap", t), s.over = !1))) : s && (this.dispatchEvent(e, "pointerupoutside", t), a && this.dispatchEvent(e, "touchendoutside", t)), s && s.none && delete e.trackedPointers[o] }, n.prototype.onPointerMove = function (t) { if (!this.supportsTouchEvents || "touch" !== t.pointerType) { for (var e = this.normalizeToPointerData(t), i = ("mouse" !== e[0].pointerType && "pen" !== e[0].pointerType || (this.didMove = !0, this.cursor = null), e.length), r = 0; r < i; r++) { var n = e[r], o = this.getInteractionDataForPointerId(n), o = this.configureInteractionEventForDOMEvent(this.eventData, n, o), s = (o.data.originalEvent = t, "touch" !== n.pointerType || this.moveWhenInside); this.processInteractive(o, this.renderer._lastObjectRendered, this.processPointerMove, s), this.emit("pointermove", o), "touch" === n.pointerType && this.emit("touchmove", o), "mouse" !== n.pointerType && "pen" !== n.pointerType || this.emit("mousemove", o) } "mouse" === e[0].pointerType && this.setCursorMode(this.cursor) } }, n.prototype.processPointerMove = function (t, e, i) { var r = t.data, n = "touch" === r.pointerType, r = "mouse" === r.pointerType || "pen" === r.pointerType; r && this.processPointerOverOut(t, e, i), this.moveWhenInside && !i || (this.dispatchEvent(e, "pointermove", t), n && this.dispatchEvent(e, "touchmove", t), r && this.dispatchEvent(e, "mousemove", t)) }, n.prototype.onPointerOut = function (t) { var e, i; this.supportsTouchEvents && "touch" === t.pointerType || ("mouse" === (t = this.normalizeToPointerData(t)[0]).pointerType && (this.mouseOverRenderer = !1, this.setCursorMode(null)), e = this.getInteractionDataForPointerId(t), (i = this.configureInteractionEventForDOMEvent(this.eventData, t, e)).data.originalEvent = t, this.processInteractive(i, this.renderer._lastObjectRendered, this.processPointerOverOut, !1), this.emit("pointerout", i), "mouse" === t.pointerType || "pen" === t.pointerType ? this.emit("mouseout", i) : this.releaseInteractionDataForPointerId(e.identifier)) }, n.prototype.processPointerOverOut = function (t, e, i) { var r = t.data, n = t.data.identifier, r = "mouse" === r.pointerType || "pen" === r.pointerType, o = e.trackedPointers[n]; void 0 !== (o = i && !o ? e.trackedPointers[n] = new u.default(n) : o) && (i && this.mouseOverRenderer ? (o.over || (o.over = !0, this.dispatchEvent(e, "pointerover", t), r && this.dispatchEvent(e, "mouseover", t)), r && null === this.cursor && (this.cursor = e.cursor)) : o.over && (o.over = !1, this.dispatchEvent(e, "pointerout", this.eventData), r && this.dispatchEvent(e, "mouseout", t), o.none && delete e.trackedPointers[n])) }, n.prototype.onPointerOver = function (t) { var t = this.normalizeToPointerData(t)[0], e = this.getInteractionDataForPointerId(t), e = this.configureInteractionEventForDOMEvent(this.eventData, t, e); "mouse" === (e.data.originalEvent = t).pointerType && (this.mouseOverRenderer = !0), this.emit("pointerover", e), "mouse" !== t.pointerType && "pen" !== t.pointerType || this.emit("mouseover", e) }, n.prototype.getInteractionDataForPointerId = function (t) { var e = t.pointerId, i = void 0; return 1 === e || "mouse" === t.pointerType ? i = this.mouse : this.activeInteractionData[e] ? i = this.activeInteractionData[e] : ((i = this.interactionDataPool.pop() || new s.default).identifier = e, this.activeInteractionData[e] = i), i.copyEvent(t), i }, n.prototype.releaseInteractionDataForPointerId = function (t) { var e = this.activeInteractionData[t]; e && (delete this.activeInteractionData[t], e.reset(), this.interactionDataPool.push(e)) }, n.prototype.configureInteractionEventForDOMEvent = function (t, e, i) { return t.data = i, this.mapPositionToPoint(i.global, e.clientX, e.clientY), navigator.isCocoonJS && "touch" === e.pointerType && (i.global.x = i.global.x / this.resolution, i.global.y = i.global.y / this.resolution), "touch" === e.pointerType && (e.globalX = i.global.x, e.globalY = i.global.y), i.originalEvent = e, t.reset(), t }, n.prototype.normalizeToPointerData = function (t) { var e = []; if (void 0 !== window.TouchEvent && this.supportsTouchEvents && t instanceof TouchEvent) for (var i = 0, r = t.changedTouches.length; i < r; i++) { var n = t.changedTouches[i]; void 0 === n.button && (n.button = t.touches.length ? 1 : 0), void 0 === n.buttons && (n.buttons = t.touches.length ? 1 : 0), void 0 === n.isPrimary && (n.isPrimary = 1 === t.touches.length && "touchstart" === t.type), void 0 === n.width && (n.width = n.radiusX || 1), void 0 === n.height && (n.height = n.radiusY || 1), void 0 === n.tiltX && (n.tiltX = 0), void 0 === n.tiltY && (n.tiltY = 0), void 0 === n.pointerType && (n.pointerType = "touch"), void 0 === n.pointerId && (n.pointerId = n.identifier || 0), void 0 === n.pressure && (n.pressure = n.force || .5), n.twist = 0, void (n.tangentialPressure = 0) === n.layerX && (n.layerX = n.offsetX = n.clientX), void 0 === n.layerY && (n.layerY = n.offsetY = n.clientY), n.isNormalized = !0, e.push(n) } else !(t instanceof MouseEvent) || this.supportsPointerEvents && t instanceof window.PointerEvent || (void 0 === t.isPrimary && (t.isPrimary = !0), void 0 === t.width && (t.width = 1), void 0 === t.height && (t.height = 1), void 0 === t.tiltX && (t.tiltX = 0), void 0 === t.tiltY && (t.tiltY = 0), void 0 === t.pointerType && (t.pointerType = "mouse"), void 0 === t.pointerId && (t.pointerId = 1), void 0 === t.pressure && (t.pressure = .5), t.twist = 0, t.tangentialPressure = 0, t.isNormalized = !0), e.push(t); return e }, n.prototype.destroy = function () { this.removeEvents(), this.removeAllListeners(), this.renderer = null, this.mouse = null, this.eventData = null, this.interactionDOMElement = null, this.onPointerDown = null, this.processPointerDown = null, this.onPointerUp = null, this.processPointerUp = null, this.onPointerCancel = null, this.processPointerCancel = null, this.onPointerMove = null, this.processPointerMove = null, this.onPointerOut = null, this.processPointerOverOut = null, this.onPointerOver = null, this._tempPoint = null }, n }(r.default); e.default = t, o.WebGLRenderer.registerPlugin("interaction", t), o.CanvasRenderer.registerPlugin("interaction", t) }, { "../core": 65, "./InteractionData": 155, "./InteractionEvent": 156, "./InteractionTrackingData": 158, "./interactiveTarget": 160, eventemitter3: 3 }], 158: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } o.prototype._doSet = function (t, e) { this._flags = e ? this._flags | t : this._flags & ~t }, r(o, [{ key: "pointerId", get: function () { return this._pointerId } }, { key: "flags", get: function () { return this._flags }, set: function (t) { this._flags = t } }, { key: "none", get: function () { return this._flags === this.constructor.FLAGS.NONE } }, { key: "over", get: function () { return 0 != (this._flags & this.constructor.FLAGS.OVER) }, set: function (t) { this._doSet(this.constructor.FLAGS.OVER, t) } }, { key: "rightDown", get: function () { return 0 != (this._flags & this.constructor.FLAGS.RIGHT_DOWN) }, set: function (t) { this._doSet(this.constructor.FLAGS.RIGHT_DOWN, t) } }, { key: "leftDown", get: function () { return 0 != (this._flags & this.constructor.FLAGS.LEFT_DOWN) }, set: function (t) { this._doSet(this.constructor.FLAGS.LEFT_DOWN, t) } }]); r = o; function o(t) { if (!(this instanceof o)) throw new TypeError("Cannot call a class as a function"); this._pointerId = t, this._flags = o.FLAGS.NONE } (i.default = r).FLAGS = Object.freeze({ NONE: 0, OVER: 1, LEFT_DOWN: 2, RIGHT_DOWN: 4 }) }, {}], 159: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("./InteractionData"), n = (Object.defineProperty(i, "InteractionData", { enumerable: !0, get: function () { return h(r).default } }), t("./InteractionManager")), o = (Object.defineProperty(i, "InteractionManager", { enumerable: !0, get: function () { return h(n).default } }), t("./interactiveTarget")), s = (Object.defineProperty(i, "interactiveTarget", { enumerable: !0, get: function () { return h(o).default } }), t("./InteractionTrackingData")), a = (Object.defineProperty(i, "InteractionTrackingData", { enumerable: !0, get: function () { return h(s).default } }), t("./InteractionEvent")); function h(t) { return t && t.__esModule ? t : { default: t } } Object.defineProperty(i, "InteractionEvent", { enumerable: !0, get: function () { return h(a).default } }) }, { "./InteractionData": 155, "./InteractionEvent": 156, "./InteractionManager": 157, "./InteractionTrackingData": 158, "./interactiveTarget": 160 }], 160: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = { interactive: !1, interactiveChildren: !0, hitArea: null, get buttonMode() { return "pointer" === this.cursor }, set buttonMode(t) { t ? this.cursor = "pointer" : "pointer" === this.cursor && (this.cursor = null) }, cursor: null, get trackedPointers() { return void 0 === this._trackedPointers && (this._trackedPointers = {}), this._trackedPointers }, _trackedPointers: void 0 } }, {}], 161: [function (t, e, i) { "use strict"; i.__esModule = !0, i.parse = p, i.default = function () { return function (e, i) { if (e.data && e.type === d.Resource.TYPE.XML) if (0 !== e.data.getElementsByTagName("page").length && 0 !== e.data.getElementsByTagName("info").length && null !== e.data.getElementsByTagName("info")[0].getAttribute("face")) for (var t = e.isDataUrl ? "" : f.dirname(e.url), r = (e.isDataUrl && ("." === t && (t = ""), this.baseUrl && t && "/" === this.baseUrl.charAt(this.baseUrl.length - 1) && (t += "/")), (t = t.replace(this.baseUrl, "")) && "/" !== t.charAt(t.length - 1) && (t += "/"), e.data.getElementsByTagName("page")), n = {}, o = function (t) { n[t.metadata.pageFile] = t.texture, Object.keys(n).length === r.length && (p(e, n), i()) }, s = 0; s < r.length; ++s) { var a, h, l = r[s].getAttribute("file"), u = t + l, c = !1; for (a in this.resources) if (this.resources[a].url === u) { this.resources[a].metadata.pageFile = l, o(this.resources[a]), c = !0; break } c || (h = { crossOrigin: e.crossOrigin, loadType: d.Resource.LOAD_TYPE.IMAGE, metadata: Object.assign({ pageFile: l }, e.metadata.imageMetadata), parentResource: e }, this.add(u, h, o)) } else i(); else i() } }; var f = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("path")), d = t("resource-loader"), r = t("../extras"); function p(t, e) { t.bitmapFont = r.BitmapText.registerFont(t.data, e) } }, { "../extras": 141, path: 8, "resource-loader": 36 }], 162: [function (t, u, e) { "use strict"; e.__esModule = !0, e.shared = e.Resource = e.textureParser = e.getResourcePath = e.spritesheetParser = e.parseBitmapFontData = e.bitmapFontParser = e.Loader = void 0; var i = t("./bitmapFontParser"), r = (Object.defineProperty(e, "bitmapFontParser", { enumerable: !0, get: function () { return h(i).default } }), Object.defineProperty(e, "parseBitmapFontData", { enumerable: !0, get: function () { return i.parse } }), t("./spritesheetParser")), n = (Object.defineProperty(e, "spritesheetParser", { enumerable: !0, get: function () { return h(r).default } }), Object.defineProperty(e, "getResourcePath", { enumerable: !0, get: function () { return r.getResourcePath } }), t("./textureParser")), o = (Object.defineProperty(e, "textureParser", { enumerable: !0, get: function () { return h(n).default } }), t("resource-loader")); Object.defineProperty(e, "Resource", { enumerable: !0, get: function () { return o.Resource } }); var s = h(t("../core/Application")), a = h(t("./loader")); function h(t) { return t && t.__esModule ? t : { default: t } } e.Loader = a.default; var l = new a.default, t = (l.destroy = function () { }, e.shared = l, s.default.prototype); t._loader = null, Object.defineProperty(t, "loader", { get: function () { var t; return this._loader || (t = this._options.sharedLoader, this._loader = t ? l : new a.default), this._loader } }), t._parentDestroy = t.destroy, t.destroy = function (t, e) { this._loader && (this._loader.destroy(), this._loader = null), this._parentDestroy(t, e) } }, { "../core/Application": 43, "./bitmapFontParser": 161, "./loader": 163, "./spritesheetParser": 164, "./textureParser": 165, "resource-loader": 36 }], 163: [function (t, u, e) { "use strict"; e.__esModule = !0; var i = a(t("resource-loader")), r = t("resource-loader/lib/middlewares/parsing/blob"), s = a(t("eventemitter3")), n = a(t("./textureParser")), o = a(t("./spritesheetParser")), t = a(t("./bitmapFontParser")); function a(t) { return t && t.__esModule ? t : { default: t } } var h, l = function (n) { var t = o, e = n; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function o(t, e) { if (!(this instanceof o)) throw new TypeError("Cannot call a class as a function"); var r = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, n.call(this, t, e)); s.default.call(r); for (var i = 0; i < o._pixiMiddleware.length; ++i)r.use(o._pixiMiddleware[i]()); return r.onStart.add(function (t) { return r.emit("start", t) }), r.onProgress.add(function (t, e) { return r.emit("progress", t, e) }), r.onError.add(function (t, e, i) { return r.emit("error", t, e, i) }), r.onLoad.add(function (t, e) { return r.emit("load", t, e) }), r.onComplete.add(function (t, e) { return r.emit("complete", t, e) }), r } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), o.addPixiMiddleware = function (t) { o._pixiMiddleware.push(t) }, o.prototype.destroy = function () { this.removeAllListeners(), this.reset() }, o }(i.default); for (h in e.default = l, s.default.prototype) l.prototype[h] = s.default.prototype[h]; l._pixiMiddleware = [r.blobMiddlewareFactory, n.default, o.default, t.default]; e = i.default.Resource; e.setExtensionXhrType("fnt", e.XHR_RESPONSE_TYPE.DOCUMENT) }, { "./bitmapFontParser": 161, "./spritesheetParser": 164, "./textureParser": 165, eventemitter3: 3, "resource-loader": 36, "resource-loader/lib/middlewares/parsing/blob": 37 }], 164: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function () { return function (i, r) { var t, e, n = i.name + "_image"; i.data && i.type === o.Resource.TYPE.JSON && i.data.frames && !this.resources[n] ? (t = { crossOrigin: i.crossOrigin, metadata: i.metadata.imageMetadata, parentResource: i }, e = a(i, this.baseUrl), this.add(n, e, t, function (t) { var e; t.error ? r(t.error) : (e = new s.Spritesheet(t.texture.baseTexture, i.data, i.url)).parse(function () { i.spritesheet = e, i.textures = e.textures, r() }) })) : r() } }, i.getResourcePath = a; var o = t("resource-loader"), i = t("url"), r = (i = i) && i.__esModule ? i : { default: i }, s = t("../core"); function a(t, e) { return t.isDataUrl ? t.data.meta.image : r.default.resolve(t.url.replace(e, ""), t.data.meta.image) } }, { "../core": 65, "resource-loader": 36, url: 38 }], 165: [function (t, e, i) { "use strict"; i.__esModule = !0, i.default = function () { return function (t, e) { t.data && t.type === r.Resource.TYPE.IMAGE && (t.texture = n.default.fromLoader(t.data, t.url, t.name)), e() } }; var r = t("resource-loader"), i = t("../core/textures/Texture"), n = (t = i) && t.__esModule ? t : { default: t } }, { "../core/textures/Texture": 115, "resource-loader": 36 }], 166: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var a = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")), t = t("../core/textures/Texture"), h = (t = t) && t.__esModule ? t : { default: t }; var c = new a.Point, f = new a.Polygon, t = function (s) { var t = u, e = s; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function u(t, e, i, r, n) { if (!(this instanceof u)) throw new TypeError("Cannot call a class as a function"); var o = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, s.call(this)); return o._texture = t || h.default.EMPTY, o.uvs = i || new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]), o.vertices = e || new Float32Array([0, 0, 100, 0, 100, 100, 0, 100]), o.indices = r || new Uint16Array([0, 1, 3, 2]), o.dirty = 0, o.indexDirty = 0, o.vertexDirty = 0, o.autoUpdate = !0, o.blendMode = a.BLEND_MODES.NORMAL, o.canvasPadding = a.settings.MESH_CANVAS_PADDING, o.drawMode = n || u.DRAW_MODES.TRIANGLE_MESH, o.shader = null, o.tintRgb = new Float32Array([1, 1, 1]), o._glDatas = {}, o._uvTransform = new a.TextureMatrix(o._texture), o.uploadUvTransform = !1, o.pluginName = "mesh", o } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), u.prototype._renderWebGL = function (t) { this.refresh(), t.setObjectRenderer(t.plugins[this.pluginName]), t.plugins[this.pluginName].render(this) }, u.prototype._renderCanvas = function (t) { this.refresh(), t.plugins[this.pluginName].render(this) }, u.prototype._onTextureUpdate = function () { this._uvTransform.texture = this._texture, this.refresh() }, u.prototype.multiplyUvs = function () { this.uploadUvTransform || this._uvTransform.multiplyUvs(this.uvs) }, u.prototype.refresh = function (t) { this.autoUpdate && this.vertexDirty++, this._uvTransform.update(t) && this._refresh() }, u.prototype._refresh = function () { }, u.prototype._calculateBounds = function () { this._bounds.addVertices(this.transform, this.vertices, 0, this.vertices.length) }, u.prototype.containsPoint = function (t) { if (!this.getBounds().contains(t.x, t.y)) return !1; this.worldTransform.applyInverse(t, c); for (var e = this.vertices, i = f.points, r = this.indices, n = this.indices.length, o = this.drawMode === u.DRAW_MODES.TRIANGLES ? 3 : 1, s = 0; s + 2 < n; s += o) { var a = 2 * r[s], h = 2 * r[s + 1], l = 2 * r[s + 2]; if (i[0] = e[a], i[1] = e[1 + a], i[2] = e[h], i[3] = e[1 + h], i[4] = e[l], i[5] = e[1 + l], f.contains(c.x, c.y)) return !0 } return !1 }, u.prototype.destroy = function (t) { for (var e in this._glDatas) { e = this._glDatas[e]; e.destroy ? e.destroy() : (e.vertexBuffer && (e.vertexBuffer.destroy(), e.vertexBuffer = null), e.indexBuffer && (e.indexBuffer.destroy(), e.indexBuffer = null), e.uvBuffer && (e.uvBuffer.destroy(), e.uvBuffer = null), e.vao && (e.vao.destroy(), e.vao = null)) } this._glDatas = null, s.prototype.destroy.call(this, t) }, r(u, [{ key: "texture", get: function () { return this._texture }, set: function (t) { this._texture !== t && (this._texture = t) && (t.baseTexture.hasLoaded ? this._onTextureUpdate() : t.once("update", this._onTextureUpdate, this)) } }, { key: "tint", get: function () { return a.utils.rgb2hex(this.tintRgb) }, set: function (t) { this.tintRgb = a.utils.hex2rgb(t, this.tintRgb) } }]), u }(a.Container); (i.default = t).DRAW_MODES = { TRIANGLE_MESH: 0, TRIANGLES: 1 } }, { "../core": 65, "../core/textures/Texture": 115 }], 167: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var t = t("./Plane"), t = (t = t) && t.__esModule ? t : { default: t }; t = function (s) { var t = a, e = s; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function a(t, e, i, r, n) { if (!(this instanceof a)) throw new TypeError("Cannot call a class as a function"); var o = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, s.call(this, t, 4, 4)); return o._origWidth = t.orig.width, o._origHeight = t.orig.height, o._width = o._origWidth, o._height = o._origHeight, o._leftWidth = void 0 !== e ? e : 10, o._rightWidth = void 0 !== r ? r : 10, o._topHeight = void 0 !== i ? i : 10, o._bottomHeight = void 0 !== n ? n : 10, o.refresh(!0), o } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), a.prototype.updateHorizontalVertices = function () { var t = this.vertices, e = this._topHeight + this._bottomHeight, e = this._height > e ? 1 : this._height / e; t[9] = t[11] = t[13] = t[15] = this._topHeight * e, t[17] = t[19] = t[21] = t[23] = this._height - this._bottomHeight * e, t[25] = t[27] = t[29] = t[31] = this._height }, a.prototype.updateVerticalVertices = function () { var t = this.vertices, e = this._leftWidth + this._rightWidth, e = this._width > e ? 1 : this._width / e; t[2] = t[10] = t[18] = t[26] = this._leftWidth * e, t[4] = t[12] = t[20] = t[28] = this._width - this._rightWidth * e, t[6] = t[14] = t[22] = t[30] = this._width }, a.prototype._renderCanvas = function (t) { var e = t.context, i = (e.globalAlpha = this.worldAlpha, t.setBlendMode(this.blendMode), this.worldTransform), r = t.resolution, t = (t.roundPixels ? e.setTransform(i.a * r, i.b * r, i.c * r, i.d * r, i.tx * r | 0, i.ty * r | 0) : e.setTransform(i.a * r, i.b * r, i.c * r, i.d * r, i.tx * r, i.ty * r), this._texture.baseTexture), i = t.source, r = t.width * t.resolution, t = t.height * t.resolution; this.drawSegment(e, i, r, t, 0, 1, 10, 11), this.drawSegment(e, i, r, t, 2, 3, 12, 13), this.drawSegment(e, i, r, t, 4, 5, 14, 15), this.drawSegment(e, i, r, t, 8, 9, 18, 19), this.drawSegment(e, i, r, t, 10, 11, 20, 21), this.drawSegment(e, i, r, t, 12, 13, 22, 23), this.drawSegment(e, i, r, t, 16, 17, 26, 27), this.drawSegment(e, i, r, t, 18, 19, 28, 29), this.drawSegment(e, i, r, t, 20, 21, 30, 31) }, a.prototype.drawSegment = function (u, c, t, e, i, r, n, o) { var s = this.uvs, a = this.vertices, h = (s[n] - s[i]) * t, l = (s[o] - s[r]) * e, n = a[n] - a[i], o = a[o] - a[r]; u.drawImage(c, s[i] * t, s[r] * e, h = h < 1 ? 1 : h, l = l < 1 ? 1 : l, a[i], a[r], n = n < 1 ? 1 : n, o = o < 1 ? 1 : o) }, a.prototype._refresh = function () { s.prototype._refresh.call(this); var t = this.uvs, e = this._texture, e = (this._origWidth = e.orig.width, this._origHeight = e.orig.height, 1 / this._origWidth), i = 1 / this._origHeight; t[0] = t[8] = t[16] = t[24] = 0, t[1] = t[3] = t[5] = t[7] = 0, t[6] = t[14] = t[22] = t[30] = 1, t[25] = t[27] = t[29] = t[31] = 1, t[2] = t[10] = t[18] = t[26] = e * this._leftWidth, t[4] = t[12] = t[20] = t[28] = 1 - e * this._rightWidth, t[9] = t[11] = t[13] = t[15] = i * this._topHeight, t[17] = t[19] = t[21] = t[23] = 1 - i * this._bottomHeight, this.updateHorizontalVertices(), this.updateVerticalVertices(), this.dirty++, this.multiplyUvs() }, r(a, [{ key: "width", get: function () { return this._width }, set: function (t) { this._width = t, this._refresh() } }, { key: "height", get: function () { return this._height }, set: function (t) { this._height = t, this._refresh() } }, { key: "leftWidth", get: function () { return this._leftWidth }, set: function (t) { this._leftWidth = t, this._refresh() } }, { key: "rightWidth", get: function () { return this._rightWidth }, set: function (t) { this._rightWidth = t, this._refresh() } }, { key: "topHeight", get: function () { return this._topHeight }, set: function (t) { this._topHeight = t, this._refresh() } }, { key: "bottomHeight", get: function () { return this._bottomHeight }, set: function (t) { this._bottomHeight = t, this._refresh() } }]), a }(t.default); i.default = t }, { "./Plane": 168 }], 168: [function (t, e, i) { "use strict"; i.__esModule = !0; var t = t("./Mesh"), o = (t = t) && t.__esModule ? t : { default: t }; t = function (r) { var t = n, e = r; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function n(t, e, i) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, r.call(this, t)); return t._ready = !0, t.verticesX = e || 10, t.verticesY = i || 10, t.drawMode = o.default.DRAW_MODES.TRIANGLES, t.refresh(), t } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), n.prototype._refresh = function () { for (var t = this._texture, u = this.verticesX * this.verticesY, e = [], i = [], r = [], n = this.verticesX - 1, o = this.verticesY - 1, c = t.width / n, f = t.height / o, s = 0; s < u; s++) { var d = s % this.verticesX, p = s / this.verticesX | 0; e.push(d * c, p * f), i.push(d / n, p / o) } for (var g = n * o, a = 0; a < g; a++) { var h = a % n, l = a / n | 0, v = l * this.verticesX + h, m = l * this.verticesX + h + 1, y = (1 + l) * this.verticesX + h, l = (1 + l) * this.verticesX + h + 1; r.push(v, m, y), r.push(m, l, y) } this.vertices = new Float32Array(e), this.uvs = new Float32Array(i), this.colors = new Float32Array([]), this.indices = new Uint16Array(r), this.dirty++, this.indexDirty++, this.multiplyUvs() }, n.prototype._onTextureUpdate = function () { o.default.prototype._onTextureUpdate.call(this), this._ready && this.refresh() }, n }(o.default); i.default = t }, { "./Mesh": 166 }], 169: [function (t, e, i) { "use strict"; i.__esModule = !0; var t = t("./Mesh"); t = function (i) { var t = r, e = i; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function r(t, e) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, i.call(this, t)); return t.points = e, t.vertices = new Float32Array(4 * e.length), t.uvs = new Float32Array(4 * e.length), t.colors = new Float32Array(2 * e.length), t.indices = new Uint16Array(2 * e.length), t.autoUpdate = !0, t.refresh(), t } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), r.prototype._refresh = function () { var t = this.points; if (!(t.length < 1) && this._texture._uvs) { this.vertices.length / 4 !== t.length && (this.vertices = new Float32Array(4 * t.length), this.uvs = new Float32Array(4 * t.length), this.colors = new Float32Array(2 * t.length), this.indices = new Uint16Array(2 * t.length)); for (var e = this.uvs, i = this.indices, r = this.colors, n = (e[0] = 0, e[1] = 0, e[2] = 0, e[3] = 1, r[0] = 1, r[1] = 1, i[0] = 0, i[1] = 1, t.length), o = 1; o < n; o++) { var s = 4 * o, a = o / (n - 1); e[s] = a, e[1 + s] = 0, e[2 + s] = a, e[3 + s] = 1, r[s = 2 * o] = 1, r[1 + s] = 1, i[s = 2 * o] = s, i[1 + s] = 1 + s } this.dirty++, this.indexDirty++, this.multiplyUvs(), this.refreshVertices() } }, r.prototype.refreshVertices = function () { var t = this.points; if (!(t.length < 1)) for (var e = t[0], i = void 0, r = 0, n = 0, o = this.vertices, u = t.length, s = 0; s < u; s++) { var a = t[s], h = 4 * s, n = -((i = s < t.length - 1 ? t[s + 1] : a).x - e.x), r = i.y - e.y, l = Math.sqrt(r * r + n * n), c = this._texture.height / 2; n = n / l * c, o[h] = a.x + (r = r / l * c), o[1 + h] = a.y + n, o[2 + h] = a.x - r, o[3 + h] = a.y - n, e = a } }, r.prototype.updateTransform = function () { this.autoUpdate && this.refreshVertices(), this.containerUpdateTransform() }, r }(((t = t) && t.__esModule ? t : { default: t }).default); i.default = t }, { "./Mesh": 166 }], 170: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")), t = t("../Mesh"), o = (t = t) && t.__esModule ? t : { default: t }; n.prototype.render = function (t) { var e = this.renderer, i = e.context, r = t.worldTransform, n = e.resolution; e.roundPixels ? i.setTransform(r.a * n, r.b * n, r.c * n, r.d * n, r.tx * n | 0, r.ty * n | 0) : i.setTransform(r.a * n, r.b * n, r.c * n, r.d * n, r.tx * n, r.ty * n), e.context.globalAlpha = t.worldAlpha, e.setBlendMode(t.blendMode), t.drawMode === o.default.DRAW_MODES.TRIANGLE_MESH ? this._renderTriangleMesh(t) : this._renderTriangles(t) }, n.prototype._renderTriangleMesh = function (t) { for (var e = t.vertices.length / 2, i = 0; i < e - 2; i++) { var r = 2 * i; this._renderDrawTriangle(t, r, 2 + r, 4 + r) } }, n.prototype._renderTriangles = function (t) { for (var e = t.indices, i = e.length, r = 0; r < i; r += 3) { var n = 2 * e[r], o = 2 * e[r + 1], s = 2 * e[r + 2]; this._renderDrawTriangle(t, n, o, s) } }, n.prototype._renderDrawTriangle = function (t, e, i, r) { var u, c, f, n, o, d, p, g, v, m, y, s, _, b, x, T, w = this.renderer.context, a = t.uvs, h = t.vertices, l = t._texture; l.valid && (u = (l = l.baseTexture).source, c = l.width, f = l.height, v = g = p = d = o = n = void 0, v = t.uploadUvTransform ? (s = t._uvTransform.mapCoord, n = (a[e] * s.a + a[e + 1] * s.c + s.tx) * l.width, o = (a[i] * s.a + a[i + 1] * s.c + s.tx) * l.width, d = (a[r] * s.a + a[r + 1] * s.c + s.tx) * l.width, p = (a[e] * s.b + a[e + 1] * s.d + s.ty) * l.height, g = (a[i] * s.b + a[i + 1] * s.d + s.ty) * l.height, (a[r] * s.b + a[r + 1] * s.d + s.ty) * l.height) : (n = a[e] * l.width, o = a[i] * l.width, d = a[r] * l.width, p = a[e + 1] * l.height, g = a[i + 1] * l.height, a[r + 1] * l.height), s = h[e], a = h[i], m = h[r], e = h[e + 1], i = h[i + 1], h = h[r + 1], 0 < (r = t.canvasPadding / this.renderer.resolution) && (y = r / Math.abs(t.worldTransform.a), r = r / Math.abs(t.worldTransform.d), b = e - (t = (e + i + h) / 3), s = (T = (s + a + m) / 3) + (_ = s - T) / (x = Math.sqrt(_ * _ + b * b)) * (x + y), e = t + b / x * (x + r), b = i - t, a = T + (_ = a - T) / (x = Math.sqrt(_ * _ + b * b)) * (x + y), i = t + b / x * (x + r), b = h - t, m = T + (_ = m - T) / (x = Math.sqrt(_ * _ + b * b)) * (x + y), h = t + b / x * (x + r)), w.save(), w.beginPath(), w.moveTo(s, e), w.lineTo(a, i), w.lineTo(m, h), w.closePath(), w.clip(), w.transform((s * g + p * m + a * v - g * m - p * a - s * v) / (T = n * g + p * d + o * v - g * d - p * o - n * v), (e * g + p * h + i * v - g * h - p * i - e * v) / T, (n * a + s * d + o * m - a * d - s * o - n * m) / T, (n * i + e * d + o * h - i * d - e * o - n * h) / T, (n * g * m + p * a * d + s * o * v - s * g * d - p * o * m - n * a * v) / T, (n * g * h + p * i * d + e * o * v - e * g * d - p * o * h - n * i * v) / T), w.drawImage(u, 0, 0, c * l.resolution, f * l.resolution, 0, 0, c, f), w.restore(), this.renderer.invalidateBlendMode()) }, n.prototype.renderMeshFlat = function (t) { var e = this.renderer.context, i = t.vertices, r = i.length / 2; e.beginPath(); for (var n = 1; n < r - 2; ++n) { var o = 2 * n, s = i[o], a = i[1 + o], h = i[2 + o], l = i[3 + o], u = i[4 + o], o = i[5 + o]; e.moveTo(s, a), e.lineTo(h, l), e.lineTo(u, o) } e.fillStyle = "#FF0000", e.fill(), e.closePath() }, n.prototype.destroy = function () { this.renderer = null }; t = n; function n(t) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); this.renderer = t } i.default = t, r.CanvasRenderer.registerPlugin("mesh", t) }, { "../../core": 65, "../Mesh": 166 }], 171: [function (t, l, e) { "use strict"; e.__esModule = !0; var i = t("./Mesh"), r = (Object.defineProperty(e, "Mesh", { enumerable: !0, get: function () { return h(i).default } }), t("./webgl/MeshRenderer")), n = (Object.defineProperty(e, "MeshRenderer", { enumerable: !0, get: function () { return h(r).default } }), t("./canvas/CanvasMeshRenderer")), o = (Object.defineProperty(e, "CanvasMeshRenderer", { enumerable: !0, get: function () { return h(n).default } }), t("./Plane")), s = (Object.defineProperty(e, "Plane", { enumerable: !0, get: function () { return h(o).default } }), t("./NineSlicePlane")), a = (Object.defineProperty(e, "NineSlicePlane", { enumerable: !0, get: function () { return h(s).default } }), t("./Rope")); function h(t) { return t && t.__esModule ? t : { default: t } } Object.defineProperty(e, "Rope", { enumerable: !0, get: function () { return h(a).default } }) }, { "./Mesh": 166, "./NineSlicePlane": 167, "./Plane": 168, "./Rope": 169, "./canvas/CanvasMeshRenderer": 170, "./webgl/MeshRenderer": 172 }], 172: [function (t, e, i) { "use strict"; i.__esModule = !0; var o = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")), s = r(t("pixi-gl-core")), a = r(t("../Mesh")); t("path"); function r(t) { return t && t.__esModule ? t : { default: t } } var h = o.Matrix.IDENTITY, t = function (e) { var t = r, i = e; if ("function" != typeof i && null !== i) throw new TypeError("Super expression must either be null or a function, not " + typeof i); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, e.call(this, t)); return t.shader = null, t } return t.prototype = Object.create(i && i.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), i && (Object.setPrototypeOf ? Object.setPrototypeOf(t, i) : t.__proto__ = i), r.prototype.onContextChange = function () { var t = this.renderer.gl; this.shader = new o.Shader(t, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n", "varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n") }, r.prototype.render = function (t) { var e, i = this.renderer, r = i.gl, n = t._texture; n.valid && ((e = t._glDatas[i.CONTEXT_UID]) || (i.bindVao(null), (e = { shader: this.shader, vertexBuffer: s.default.GLBuffer.createVertexBuffer(r, t.vertices, r.STREAM_DRAW), uvBuffer: s.default.GLBuffer.createVertexBuffer(r, t.uvs, r.STREAM_DRAW), indexBuffer: s.default.GLBuffer.createIndexBuffer(r, t.indices, r.STATIC_DRAW), vao: null, dirty: t.dirty, indexDirty: t.indexDirty, vertexDirty: t.vertexDirty }).vao = new s.default.VertexArrayObject(r).addIndex(e.indexBuffer).addAttribute(e.vertexBuffer, e.shader.attributes.aVertexPosition, r.FLOAT, !1, 8, 0).addAttribute(e.uvBuffer, e.shader.attributes.aTextureCoord, r.FLOAT, !1, 8, 0), t._glDatas[i.CONTEXT_UID] = e), i.bindVao(e.vao), t.dirty !== e.dirty && (e.dirty = t.dirty, e.uvBuffer.upload(t.uvs)), t.indexDirty !== e.indexDirty && (e.indexDirty = t.indexDirty, e.indexBuffer.upload(t.indices)), t.vertexDirty !== e.vertexDirty && (e.vertexDirty = t.vertexDirty, e.vertexBuffer.upload(t.vertices)), i.bindShader(e.shader), e.shader.uniforms.uSampler = i.bindTexture(n), i.state.setBlendMode(o.utils.correctBlendMode(t.blendMode, n.baseTexture.premultipliedAlpha)), e.shader.uniforms.uTransform && (t.uploadUvTransform ? e.shader.uniforms.uTransform = t._uvTransform.mapCoord.toArray(!0) : e.shader.uniforms.uTransform = h.toArray(!0)), e.shader.uniforms.translationMatrix = t.worldTransform.toArray(!0), e.shader.uniforms.uColor = o.utils.premultiplyRgba(t.tintRgb, t.worldAlpha, e.shader.uniforms.uColor, n.baseTexture.premultipliedAlpha), i = t.drawMode === a.default.DRAW_MODES.TRIANGLE_MESH ? r.TRIANGLE_STRIP : r.TRIANGLES, e.vao.draw(i, t.indices.length, 0)) }, r }(o.ObjectRenderer); i.default = t, o.WebGLRenderer.registerPlugin("mesh", t) }, { "../../core": 65, "../Mesh": 166, path: 8, "pixi-gl-core": 15 }], 173: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t, e, i) { return e && n(t.prototype, e), i && n(t, i), t }; function n(t, e) { for (var i = 0; i < e.length; i++) { var r = e[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } var h = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")), o = t("../core/utils"); t = function (s) { var t = a, e = s; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function a() { var t = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 1500, e = arguments[1], i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 16384, r = 3 < arguments.length && void 0 !== arguments[3] && arguments[3], n = this, o = a; if (!(n instanceof o)) throw new TypeError("Cannot call a class as a function"); n = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, s.call(this)); return t < (i = 16384 < i ? 16384 : i) && (i = t), n._properties = [!1, !0, !1, !1, !1], n._maxSize = t, n._batchSize = i, n._glBuffers = {}, n._bufferUpdateIDs = [], n._updateID = 0, n.interactiveChildren = !1, n.blendMode = h.BLEND_MODES.NORMAL, n.autoResize = r, n.roundPixels = !0, n.baseTexture = null, n.setProperties(e), n._tint = 0, n.tintRgb = new Float32Array(4), n.tint = 16777215, n } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), a.prototype.setProperties = function (t) { t && (this._properties[0] = "vertices" in t || "scale" in t ? !!t.vertices || !!t.scale : this._properties[0], this._properties[1] = "position" in t ? !!t.position : this._properties[1], this._properties[2] = "rotation" in t ? !!t.rotation : this._properties[2], this._properties[3] = "uvs" in t ? !!t.uvs : this._properties[3], this._properties[4] = "tint" in t || "alpha" in t ? !!t.tint || !!t.alpha : this._properties[4]) }, a.prototype.updateTransform = function () { this.displayObjectUpdateTransform() }, a.prototype.renderWebGL = function (t) { var e = this; this.visible && !(this.worldAlpha <= 0) && this.children.length && this.renderable && (this.baseTexture || (this.baseTexture = this.children[0]._texture.baseTexture, this.baseTexture.hasLoaded || this.baseTexture.once("update", function () { return e.onChildrenChange(0) })), t.setObjectRenderer(t.plugins.particle), t.plugins.particle.render(this)) }, a.prototype.onChildrenChange = function (t) { for (var e = Math.floor(t / this._batchSize); this._bufferUpdateIDs.length < e;)this._bufferUpdateIDs.push(0); this._bufferUpdateIDs[e] = ++this._updateID }, a.prototype.renderCanvas = function (t) { if (this.visible && !(this.worldAlpha <= 0) && this.children.length && this.renderable) { var e = t.context, i = this.worldTransform, r = !0, n = 0, o = 0, s = 0, u = 0; t.setBlendMode(this.blendMode), e.globalAlpha = this.worldAlpha, this.displayObjectUpdateTransform(); for (var c = 0; c < this.children.length; ++c) { var a, h, l = this.children[c]; l.visible && (a = l._texture.frame, e.globalAlpha = this.worldAlpha * l.alpha, u = l.rotation % (2 * Math.PI) == 0 ? (r && (e.setTransform(i.a, i.b, i.c, i.d, i.tx * t.resolution, i.ty * t.resolution), r = !1), n = l.anchor.x * (-a.width * l.scale.x) + l.position.x + .5, o = l.anchor.y * (-a.height * l.scale.y) + l.position.y + .5, s = a.width * l.scale.x, a.height * l.scale.y) : (r = r || !0, l.displayObjectUpdateTransform(), h = l.worldTransform, t.roundPixels ? e.setTransform(h.a, h.b, h.c, h.d, h.tx * t.resolution | 0, h.ty * t.resolution | 0) : e.setTransform(h.a, h.b, h.c, h.d, h.tx * t.resolution, h.ty * t.resolution), n = l.anchor.x * -a.width + .5, o = l.anchor.y * -a.height + .5, s = a.width, a.height), h = l._texture.baseTexture.resolution, e.drawImage(l._texture.baseTexture.source, a.x * h, a.y * h, a.width * h, a.height * h, n * t.resolution, o * t.resolution, s * t.resolution, u * t.resolution)) } } }, a.prototype.destroy = function (t) { if (s.prototype.destroy.call(this, t), this._buffers) for (var e = 0; e < this._buffers.length; ++e)this._buffers[e].destroy(); this._properties = null, this._buffers = null, this._bufferUpdateIDs = null }, r(a, [{ key: "tint", get: function () { return this._tint }, set: function (t) { this._tint = t, (0, o.hex2rgb)(t, this.tintRgb) } }]), a }(h.Container); i.default = t }, { "../core": 65, "../core/utils": 125 }], 174: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("./ParticleContainer"), n = (Object.defineProperty(i, "ParticleContainer", { enumerable: !0, get: function () { return o(r).default } }), t("./webgl/ParticleRenderer")); function o(t) { return t && t.__esModule ? t : { default: t } } Object.defineProperty(i, "ParticleRenderer", { enumerable: !0, get: function () { return o(n).default } }) }, { "./ParticleContainer": 173, "./webgl/ParticleRenderer": 176 }], 175: [function (t, e, i) { "use strict"; i.__esModule = !0; var f = r(t("pixi-gl-core")), d = r(t("../../core/utils/createIndicesForQuads")); function r(t) { return t && t.__esModule ? t : { default: t } } function s(t, e, i, r) { if (!(this instanceof s)) throw new TypeError("Cannot call a class as a function"); this.gl = t, this.size = r, this.dynamicProperties = [], this.staticProperties = []; for (var n = 0; n < e.length; ++n) { var o = { attribute: (o = e[n]).attribute, size: o.size, uploadFunction: o.uploadFunction, unsignedByte: o.unsignedByte, offset: o.offset }; (i[n] ? this.dynamicProperties : this.staticProperties).push(o) } this.staticStride = 0, this.staticBuffer = null, this.staticData = null, this.staticDataUint32 = null, this.dynamicStride = 0, this.dynamicBuffer = null, this.dynamicData = null, this.dynamicDataUint32 = null, this._updateID = 0, this.initBuffers() } s.prototype.initBuffers = function () { var t = this.gl, u = 0; this.indices = (0, d.default)(this.size), this.indexBuffer = f.default.GLBuffer.createIndexBuffer(t, this.indices, t.STATIC_DRAW); for (var e = this.dynamicStride = 0; e < this.dynamicProperties.length; ++e) { var i = this.dynamicProperties[e]; i.offset = u, u += i.size, this.dynamicStride += i.size } for (var r = new ArrayBuffer(this.size * this.dynamicStride * 4 * 4), c = (this.dynamicData = new Float32Array(r), this.dynamicDataUint32 = new Uint32Array(r), this.dynamicBuffer = f.default.GLBuffer.createVertexBuffer(t, r, t.STREAM_DRAW), 0), n = this.staticStride = 0; n < this.staticProperties.length; ++n) { var o = this.staticProperties[n]; o.offset = c, c += o.size, this.staticStride += o.size } r = new ArrayBuffer(this.size * this.staticStride * 4 * 4); this.staticData = new Float32Array(r), this.staticDataUint32 = new Uint32Array(r), this.staticBuffer = f.default.GLBuffer.createVertexBuffer(t, r, t.STATIC_DRAW), this.vao = new f.default.VertexArrayObject(t).addIndex(this.indexBuffer); for (var s = 0; s < this.dynamicProperties.length; ++s) { var a = this.dynamicProperties[s]; a.unsignedByte ? this.vao.addAttribute(this.dynamicBuffer, a.attribute, t.UNSIGNED_BYTE, !0, 4 * this.dynamicStride, 4 * a.offset) : this.vao.addAttribute(this.dynamicBuffer, a.attribute, t.FLOAT, !1, 4 * this.dynamicStride, 4 * a.offset) } for (var h = 0; h < this.staticProperties.length; ++h) { var l = this.staticProperties[h]; l.unsignedByte ? this.vao.addAttribute(this.staticBuffer, l.attribute, t.UNSIGNED_BYTE, !0, 4 * this.staticStride, 4 * l.offset) : this.vao.addAttribute(this.staticBuffer, l.attribute, t.FLOAT, !1, 4 * this.staticStride, 4 * l.offset) } }, s.prototype.uploadDynamic = function (t, e, i) { for (var r = 0; r < this.dynamicProperties.length; r++) { var n = this.dynamicProperties[r]; n.uploadFunction(t, e, i, n.unsignedByte ? this.dynamicDataUint32 : this.dynamicData, this.dynamicStride, n.offset) } this.dynamicBuffer.upload() }, s.prototype.uploadStatic = function (t, e, i) { for (var r = 0; r < this.staticProperties.length; r++) { var n = this.staticProperties[r]; n.uploadFunction(t, e, i, n.unsignedByte ? this.staticDataUint32 : this.staticData, this.staticStride, n.offset) } this.staticBuffer.upload() }, s.prototype.destroy = function () { this.dynamicProperties = null, this.dynamicBuffer.destroy(), this.dynamicBuffer = null, this.dynamicData = null, this.dynamicDataUint32 = null, this.staticProperties = null, this.staticBuffer.destroy(), this.staticBuffer = null, this.staticData = null, this.staticDataUint32 = null }, i.default = s }, { "../../core/utils/createIndicesForQuads": 123, "pixi-gl-core": 15 }], 176: [function (t, e, i) { "use strict"; i.__esModule = !0; var g = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")), n = r(t("./ParticleShader")), a = r(t("./ParticleBuffer")), u = t("../../core/utils"); function r(t) { return t && t.__esModule ? t : { default: t } } t = function (e) { var t = r, i = e; if ("function" != typeof i && null !== i) throw new TypeError("Super expression must either be null or a function, not " + typeof i); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, e.call(this, t)); return t.shader = null, t.indexBuffer = null, t.properties = null, t.tempMatrix = new g.Matrix, t.CONTEXT_UID = 0, t } return t.prototype = Object.create(i && i.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), i && (Object.setPrototypeOf ? Object.setPrototypeOf(t, i) : t.__proto__ = i), r.prototype.onContextChange = function () { var t = this.renderer.gl; this.CONTEXT_UID = this.renderer.CONTEXT_UID, this.shader = new n.default(t), this.properties = [{ attribute: this.shader.attributes.aVertexPosition, size: 2, uploadFunction: this.uploadVertices, offset: 0 }, { attribute: this.shader.attributes.aPositionCoord, size: 2, uploadFunction: this.uploadPosition, offset: 0 }, { attribute: this.shader.attributes.aRotation, size: 1, uploadFunction: this.uploadRotation, offset: 0 }, { attribute: this.shader.attributes.aTextureCoord, size: 2, uploadFunction: this.uploadUvs, offset: 0 }, { attribute: this.shader.attributes.aColor, size: 1, unsignedByte: !0, uploadFunction: this.uploadTint, offset: 0 }] }, r.prototype.start = function () { this.renderer.bindShader(this.shader) }, r.prototype.render = function (t) { var e = t.children, i = t._maxSize, u = t._batchSize, r = this.renderer, n = e.length; if (0 !== n) { i < n && (n = i); for (var o = (o = t._glBuffers[r.CONTEXT_UID]) || (t._glBuffers[r.CONTEXT_UID] = this.generateBuffers(t)), i = e[0]._texture.baseTexture, c = (this.renderer.setBlendMode(g.utils.correctBlendMode(t.blendMode, i.premultipliedAlpha)), r.gl), f = t.worldTransform.copy(this.tempMatrix), d = (f.prepend(r._activeRenderTarget.projectionMatrix), this.shader.uniforms.projectionMatrix = f.toArray(!0), this.shader.uniforms.uColor = g.utils.premultiplyRgba(t.tintRgb, t.worldAlpha, this.shader.uniforms.uColor, i.premultipliedAlpha), this.shader.uniforms.uSampler = r.bindTexture(i), !1), s = 0, a = 0; s < n; s += u, a += 1) { var h = n - s; if (u < h && (h = u), a >= o.length) { if (!t.autoResize) break; o.push(this._generateOneMoreBuffer(t)) } var l = o[a], p = (l.uploadDynamic(e, s, h), t._bufferUpdateIDs[a] || 0); (d = d || l._updateID < p) && (l._updateID = t._updateID, l.uploadStatic(e, s, h)), r.bindVao(l.vao), l.vao.draw(c.TRIANGLES, 6 * h) } } }, r.prototype.generateBuffers = function (t) { for (var e = this.renderer.gl, i = [], r = t._maxSize, n = t._batchSize, o = t._properties, s = 0; s < r; s += n)i.push(new a.default(e, this.properties, o, n)); return i }, r.prototype._generateOneMoreBuffer = function (t) { var e = this.renderer.gl, i = t._batchSize, t = t._properties; return new a.default(e, this.properties, t, i) }, r.prototype.uploadVertices = function (u, c, f, t, e, i) { for (var r = 0, n = 0, o = 0, s = 0, d = 0; d < f; ++d) { var a = u[c + d], h = a._texture, p = a.scale.x, g = a.scale.y, l = h.trim, h = h.orig; l ? (r = (n = l.x - a.anchor.x * h.width) + l.width, o = (s = l.y - a.anchor.y * h.height) + l.height) : (r = h.width * (1 - a.anchor.x), n = h.width * -a.anchor.x, o = h.height * (1 - a.anchor.y), s = h.height * -a.anchor.y), t[i] = n * p, t[i + 1] = s * g, t[i + e] = r * p, t[i + e + 1] = s * g, t[i + 2 * e] = r * p, t[i + 2 * e + 1] = o * g, t[i + 3 * e] = n * p, t[i + 3 * e + 1] = o * g, i += 4 * e } }, r.prototype.uploadPosition = function (t, e, i, r, n, o) { for (var s = 0; s < i; s++) { var a = t[e + s].position; r[o] = a.x, r[o + 1] = a.y, r[o + n] = a.x, r[o + n + 1] = a.y, r[o + 2 * n] = a.x, r[o + 2 * n + 1] = a.y, r[o + 3 * n] = a.x, r[o + 3 * n + 1] = a.y, o += 4 * n } }, r.prototype.uploadRotation = function (t, e, i, r, n, o) { for (var s = 0; s < i; s++) { var a = t[e + s].rotation; r[o] = a, r[o + n] = a, r[o + 2 * n] = a, r[o + 3 * n] = a, o += 4 * n } }, r.prototype.uploadUvs = function (t, e, i, r, n, o) { for (var s = 0; s < i; ++s) { var a = t[e + s]._texture._uvs; a ? (r[o] = a.x0, r[o + 1] = a.y0, r[o + n] = a.x1, r[o + n + 1] = a.y1, r[o + 2 * n] = a.x2, r[o + 2 * n + 1] = a.y2, r[o + 3 * n] = a.x3, r[o + 3 * n + 1] = a.y3) : (r[o] = 0, r[o + 1] = 0, r[o + n] = 0, r[o + n + 1] = 0, r[o + 2 * n] = 0, r[o + 2 * n + 1] = 0, r[o + 3 * n] = 0, r[o + 3 * n + 1] = 0), o += 4 * n } }, r.prototype.uploadTint = function (t, e, i, r, n, o) { for (var s = 0; s < i; ++s) { var a = t[e + s], h = a._texture.baseTexture.premultipliedAlpha, l = a.alpha, h = l < 1 && h ? (0, u.premultiplyTint)(a._tintRGB, l) : a._tintRGB + (255 * l << 24); r[o] = h, r[o + n] = h, r[o + 2 * n] = h, r[o + 3 * n] = h, o += 4 * n } }, r.prototype.destroy = function () { this.renderer.gl && this.renderer.gl.deleteBuffer(this.indexBuffer), e.prototype.destroy.call(this), this.shader.destroy(), this.indices = null, this.tempMatrix = null }, r }(g.ObjectRenderer); i.default = t, g.WebGLRenderer.registerPlugin("particle", t) }, { "../../core": 65, "../../core/utils": 125, "./ParticleBuffer": 175, "./ParticleShader": 177 }], 177: [function (t, e, i) { "use strict"; i.__esModule = !0; var t = t("../../core/Shader"); t = function (i) { var t = r, e = i; if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); var e = this, t = i.call(this, t, ["attribute vec2 aVertexPosition;", "attribute vec2 aTextureCoord;", "attribute vec4 aColor;", "attribute vec2 aPositionCoord;", "attribute float aRotation;", "uniform mat3 projectionMatrix;", "uniform vec4 uColor;", "varying vec2 vTextureCoord;", "varying vec4 vColor;", "void main(void){", "   float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);", "   float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);", "   vec2 v = vec2(x, y);", "   v = v + aPositionCoord;", "   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);", "   vTextureCoord = aTextureCoord;", "   vColor = aColor * uColor;", "}"].join("\n"), ["varying vec2 vTextureCoord;", "varying vec4 vColor;", "uniform sampler2D uSampler;", "void main(void){", "  vec4 color = texture2D(uSampler, vTextureCoord) * vColor;", "  gl_FragColor = color;", "}"].join("\n")); if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } return t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e), r }(((t = t) && t.__esModule ? t : { default: t }).default); i.default = t }, { "../../core/Shader": 44 }], 178: [function (t, e, i) { "use strict"; Math.sign || (Math.sign = function (t) { return 0 === (t = Number(t)) || isNaN(t) ? t : 0 < t ? 1 : -1 }) }, {}], 179: [function (t, e, i) { "use strict"; Number.isInteger || (Number.isInteger = function (t) { return "number" == typeof t && isFinite(t) && Math.floor(t) === t }) }, {}], 180: [function (t, e, i) { "use strict"; var t = t("object-assign"), t = (t = t) && t.__esModule ? t : { default: t }; Object.assign || (Object.assign = t.default) }, { "object-assign": 6 }], 181: [function (t, e, i) { "use strict"; t("./Object.assign"), t("./requestAnimationFrame"), t("./Math.sign"), t("./Number.isInteger"), window.ArrayBuffer || (window.ArrayBuffer = Array), window.Float32Array || (window.Float32Array = Array), window.Uint32Array || (window.Uint32Array = Array), window.Uint16Array || (window.Uint16Array = Array) }, { "./Math.sign": 178, "./Number.isInteger": 179, "./Object.assign": 180, "./requestAnimationFrame": 182 }], 182: [function (t, e, i) { !function (t) { "use strict"; Date.now && Date.prototype.getTime || (Date.now = function () { return (new Date).getTime() }), t.performance && t.performance.now || (e = Date.now(), t.performance || (t.performance = {}), t.performance.now = function () { return Date.now() - e }); for (var e, r = Date.now(), i = ["ms", "moz", "webkit", "o"], n = 0; n < i.length && !t.requestAnimationFrame; ++n) { var o = i[n]; t.requestAnimationFrame = t[o + "RequestAnimationFrame"], t.cancelAnimationFrame = t[o + "CancelAnimationFrame"] || t[o + "CancelRequestAnimationFrame"] } t.requestAnimationFrame || (t.requestAnimationFrame = function (t) { if ("function" != typeof t) throw new TypeError(t + "is not a function"); var e = Date.now(), i = 16 + r - e; return i < 0 && (i = 0), r = e, setTimeout(function () { r = Date.now(), t(performance.now()) }, i) }), t.cancelAnimationFrame || (t.cancelAnimationFrame = function (t) { return clearTimeout(t) }) }.call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, {}], 183: [function (t, u, e) { "use strict"; e.__esModule = !0; var a = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../core")), t = t("./limiters/CountLimiter"), i = (t = t) && t.__esModule ? t : { default: t }; var h = a.ticker.shared; function r(t) { var e = this; if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); this.limiter = new i.default(a.settings.UPLOADS_PER_FRAME), this.renderer = t, this.uploadHookHelper = null, this.queue = [], this.addHooks = [], this.uploadHooks = [], this.completes = [], this.ticking = !1, this.delayedTick = function () { e.queue && e.prepareItems() }, this.registerFindHook(f), this.registerFindHook(d), this.registerFindHook(n), this.registerFindHook(o), this.registerFindHook(s), this.registerUploadHook(l), this.registerUploadHook(c) } function n(t, e) { var i = !1; if (t && t._textures && t._textures.length) for (var r, n = 0; n < t._textures.length; n++)t._textures[n] instanceof a.Texture && (r = t._textures[n].baseTexture, -1 === e.indexOf(r) && (e.push(r), i = !0)); return i } function o(t, e) { return t instanceof a.BaseTexture && (-1 === e.indexOf(t) && e.push(t), !0) } function s(t, e) { return !!(t._texture && t._texture instanceof a.Texture) && (t = t._texture.baseTexture, -1 === e.indexOf(t) && e.push(t), !0) } function l(t, e) { return e instanceof a.Text && (e.updateText(!0), !0) } function c(t, e) { return e instanceof a.TextStyle && (e = e.toFontString(), a.TextMetrics.measureFont(e), !0) } function f(t, e) { return t instanceof a.Text && (-1 === e.indexOf(t.style) && e.push(t.style), -1 === e.indexOf(t) && e.push(t), t = t._texture.baseTexture, -1 === e.indexOf(t) && e.push(t), !0) } function d(t, e) { return t instanceof a.TextStyle && (-1 === e.indexOf(t) && e.push(t), !0) } a.settings.UPLOADS_PER_FRAME = 4, r.prototype.upload = function (t, e) { "function" == typeof t && (e = t, t = null), t && this.add(t), this.queue.length ? (e && this.completes.push(e), this.ticking || (this.ticking = !0, h.addOnce(this.tick, this, a.UPDATE_PRIORITY.UTILITY))) : e && e() }, r.prototype.tick = function () { setTimeout(this.delayedTick, 0) }, r.prototype.prepareItems = function () { for (this.limiter.beginFrame(); this.queue.length && this.limiter.allowedToUpload();) { var t = this.queue[0], e = !1; if (t && !t._destroyed) for (var i = 0, r = this.uploadHooks.length; i < r; i++)if (this.uploadHooks[i](this.uploadHookHelper, t)) { this.queue.shift(), e = !0; break } e || this.queue.shift() } if (this.queue.length) h.addOnce(this.tick, this, a.UPDATE_PRIORITY.UTILITY); else { this.ticking = !1; for (var n = this.completes.slice(0), o = this.completes.length = 0, s = n.length; o < s; o++)n[o]() } }, r.prototype.registerFindHook = function (t) { return t && this.addHooks.push(t), this }, r.prototype.registerUploadHook = function (t) { return t && this.uploadHooks.push(t), this }, r.prototype.add = function (t) { for (var e = 0, i = this.addHooks.length; e < i && !this.addHooks[e](t, this.queue); e++); if (t instanceof a.Container) for (var r = t.children.length - 1; 0 <= r; r--)this.add(t.children[r]); return this }, r.prototype.destroy = function () { this.ticking && h.remove(this.tick, this), this.ticking = !1, this.addHooks = null, this.uploadHooks = null, this.renderer = null, this.completes = null, this.queue = null, this.limiter = null, this.uploadHookHelper = null }, e.default = r }, { "../core": 65, "./limiters/CountLimiter": 186 }], 184: [function (t, e, i) { "use strict"; i.__esModule = !0; var n = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")), t = t("../BasePrepare"), t = (t = t) && t.__esModule ? t : { default: t }; t = function (e) { var t = r, i = e; if ("function" != typeof i && null !== i) throw new TypeError("Super expression must either be null or a function, not " + typeof i); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, e.call(this, t)); return (t.uploadHookHelper = t).canvas = document.createElement("canvas"), t.canvas.width = 16, t.canvas.height = 16, t.ctx = t.canvas.getContext("2d"), t.registerUploadHook(o), t } return t.prototype = Object.create(i && i.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), i && (Object.setPrototypeOf ? Object.setPrototypeOf(t, i) : t.__proto__ = i), r.prototype.destroy = function () { e.prototype.destroy.call(this), this.ctx = null, this.canvas = null }, r }(t.default); function o(t, e) { var i, r; return e instanceof n.BaseTexture && (i = 0 === (e = e.source).width ? t.canvas.width : Math.min(t.canvas.width, e.width), r = 0 === e.height ? t.canvas.height : Math.min(t.canvas.height, e.height), t.ctx.drawImage(e, 0, 0, i, r, 0, 0, t.canvas.width, t.canvas.height), !0) } i.default = t, n.CanvasRenderer.registerPlugin("prepare", t) }, { "../../core": 65, "../BasePrepare": 183 }], 185: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = t("./webgl/WebGLPrepare"), n = (Object.defineProperty(i, "webgl", { enumerable: !0, get: function () { return h(r).default } }), t("./canvas/CanvasPrepare")), o = (Object.defineProperty(i, "canvas", { enumerable: !0, get: function () { return h(n).default } }), t("./BasePrepare")), s = (Object.defineProperty(i, "BasePrepare", { enumerable: !0, get: function () { return h(o).default } }), t("./limiters/CountLimiter")), a = (Object.defineProperty(i, "CountLimiter", { enumerable: !0, get: function () { return h(s).default } }), t("./limiters/TimeLimiter")); function h(t) { return t && t.__esModule ? t : { default: t } } Object.defineProperty(i, "TimeLimiter", { enumerable: !0, get: function () { return h(a).default } }) }, { "./BasePrepare": 183, "./canvas/CanvasPrepare": 184, "./limiters/CountLimiter": 186, "./limiters/TimeLimiter": 187, "./webgl/WebGLPrepare": 188 }], 186: [function (t, e, i) { "use strict"; function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); this.maxItemsPerFrame = t, this.itemsLeft = 0 } i.__esModule = !0, r.prototype.beginFrame = function () { this.itemsLeft = this.maxItemsPerFrame }, r.prototype.allowedToUpload = function () { return 0 < this.itemsLeft-- }, i.default = r }, {}], 187: [function (t, e, i) { "use strict"; function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); this.maxMilliseconds = t, this.frameStart = 0 } i.__esModule = !0, r.prototype.beginFrame = function () { this.frameStart = Date.now() }, r.prototype.allowedToUpload = function () { return Date.now() - this.frameStart < this.maxMilliseconds }, i.default = r }, {}], 188: [function (t, e, i) { "use strict"; i.__esModule = !0; var r = function (t) { { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } }(t("../../core")), t = t("../BasePrepare"); t = function (e) { var t = r, i = e; if ("function" != typeof i && null !== i) throw new TypeError("Super expression must either be null or a function, not " + typeof i); function r(t) { if (!(this instanceof r)) throw new TypeError("Cannot call a class as a function"); t = function (t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e }(this, e.call(this, t)); return t.uploadHookHelper = t.renderer, t.registerFindHook(s), t.registerUploadHook(n), t.registerUploadHook(o), t } return t.prototype = Object.create(i && i.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), i && (Object.setPrototypeOf ? Object.setPrototypeOf(t, i) : t.__proto__ = i), r }(((t = t) && t.__esModule ? t : { default: t }).default); function n(t, e) { return e instanceof r.BaseTexture && (e._glTextures[t.CONTEXT_UID] || t.textureManager.updateTexture(e), !0) } function o(t, e) { return e instanceof r.Graphics && (!e.dirty && !e.clearDirty && e._webGL[t.plugins.graphics.CONTEXT_UID] || t.plugins.graphics.updateGraphics(e), !0) } function s(t, e) { return t instanceof r.Graphics && (e.push(t), !0) } i.default = t, r.WebGLRenderer.registerPlugin("prepare", t) }, { "../../core": 65, "../BasePrepare": 183 }], 189: [function (g, t, v) { !function (t) { "use strict"; v.__esModule = !0, v.loader = v.prepare = v.particles = v.mesh = v.loaders = v.interaction = v.filters = v.extras = v.extract = v.accessibility = void 0; var e = g("./polyfill"), i = (Object.keys(e).forEach(function (t) { "default" !== t && "__esModule" !== t && Object.defineProperty(v, t, { enumerable: !0, get: function () { return e[t] } }) }), g("./core")), r = (Object.keys(i).forEach(function (t) { "default" !== t && "__esModule" !== t && Object.defineProperty(v, t, { enumerable: !0, get: function () { return i[t] } }) }), g("./deprecation")), r = (r = r) && r.__esModule ? r : { default: r }, n = l(g("./accessibility")), o = l(g("./extract")), s = l(g("./extras")), a = l(g("./filters")), u = l(g("./interaction")), h = l(g("./loaders")), c = l(g("./mesh")), f = l(g("./particles")), d = l(g("./prepare")); function l(t) { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e.default = t, e } i.utils.mixins.performMixins(); var p = h.shared || null; v.accessibility = n, v.extract = o, v.extras = s, v.filters = a, v.interaction = u, v.loaders = h, v.mesh = c, v.particles = f, v.prepare = d, v.loader = p, "function" == typeof r.default && (0, r.default)(v), t.PIXI = v }.call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { "./accessibility": 42, "./core": 65, "./deprecation": 131, "./extract": 133, "./extras": 141, "./filters": 153, "./interaction": 159, "./loaders": 162, "./mesh": 171, "./particles": 174, "./polyfill": 181, "./prepare": 185 }] }, {}, [189])(189) }); var fabric = fabric || { version: "2.2.4" }; function resizeCanvasIfNeeded(t) { var e = t.targetCanvas, i = e.width, r = e.height, n = t.destinationWidth, t = t.destinationHeight; i === n && r === t || (e.width = n, e.height = t) } function copyGLTo2DDrawImage(t, e) { var t = t.canvas, e = e.targetCanvas, i = e.getContext("2d"), r = (i.translate(0, e.height), i.scale(1, -1), t.height - e.height); i.drawImage(t, 0, r, e.width, e.height, 0, 0, e.width, e.height) } function copyGLTo2DPutImageData(t, e) { var i = e.targetCanvas.getContext("2d"), r = e.destinationWidth, e = e.destinationHeight, n = r * e * 4, o = new Uint8Array(this.imageBuffer, 0, n), n = new Uint8ClampedArray(this.imageBuffer, 0, n), t = (t.readPixels(0, 0, r, e, t.RGBA, t.UNSIGNED_BYTE, o), new ImageData(n, r, e)); i.putImageData(t, 0, 0) } "undefined" != typeof exports ? exports.fabric = fabric : "function" == typeof define && define.amd && define([], function () { return fabric }), "undefined" != typeof document && "undefined" != typeof window ? (fabric.document = document, fabric.window = window) : (fabric.document = require("jsdom").jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"), { features: { FetchExternalResources: ["img"] } }), fabric.jsdomImplForWrapper = require("jsdom/lib/jsdom/living/generated/utils").implForWrapper, fabric.nodeCanvas = require("jsdom/lib/jsdom/utils").Canvas, fabric.window = fabric.document.defaultView, DOMParser = require("xmldom").DOMParser), fabric.isTouchSupported = "ontouchstart" in fabric.window, fabric.isLikelyNode = "undefined" != typeof Buffer && "undefined" == typeof window, fabric.SHARED_ATTRIBUTES = ["display", "transform", "fill", "fill-opacity", "fill-rule", "opacity", "stroke", "stroke-dasharray", "stroke-linecap", "stroke-linejoin", "stroke-miterlimit", "stroke-opacity", "stroke-width", "id", "paint-order", "instantiated_by_use"], fabric.DPI = 96, fabric.reNum = "(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)", fabric.fontPaths = {}, fabric.iMatrix = [1, 0, 0, 1, 0, 0], fabric.canvasModule = "canvas", fabric.perfLimitSizeTotal = Math.pow(4096, 2), fabric.maxCacheSideLimit = 4096, fabric.minCacheSideLimit = 256, fabric.charWidthsCache = {}, fabric.textureSize = 2048, fabric.enableGLFiltering = !0, fabric.devicePixelRatio = fabric.window.devicePixelRatio || fabric.window.webkitDevicePixelRatio || fabric.window.mozDevicePixelRatio || 1, fabric.browserShadowBlurConstant = 1, fabric.initFilterBackend = function () { return fabric.enableGLFiltering && fabric.isWebglSupported && fabric.isWebglSupported(fabric.textureSize) ? (console.log("max texture size: " + fabric.maxTextureSize), new fabric.WebglFilterBackend({ tileSize: fabric.textureSize })) : fabric.Canvas2dFilterBackend ? new fabric.Canvas2dFilterBackend : void 0 }, "undefined" != typeof document && "undefined" != typeof window && (window.fabric = fabric), function () { function r(t, e) { this.__eventListeners[t] && (t = this.__eventListeners[t], e ? t[t.indexOf(e)] = !1 : fabric.util.array.fill(t, !1)) } function t(t, e) { if (this.__eventListeners || (this.__eventListeners = {}), 1 === arguments.length) for (var i in t) this.on(i, t[i]); else this.__eventListeners[t] || (this.__eventListeners[t] = []), this.__eventListeners[t].push(e); return this } function e(t, e) { if (this.__eventListeners) { if (0 === arguments.length) for (t in this.__eventListeners) r.call(this, t); else if (1 === arguments.length && "object" == typeof arguments[0]) for (var i in t) r.call(this, i, t[i]); else r.call(this, t, e); return this } } function i(t, e) { if (this.__eventListeners) { var i = this.__eventListeners[t]; if (i) { for (var r = 0, n = i.length; r < n; r++)i[r] && i[r].call(this, e || {}); return this.__eventListeners[t] = i.filter(function (t) { return !1 !== t }), this } } } fabric.Observable = { observe: t, stopObserving: e, fire: i, on: t, off: e, trigger: i } }(), fabric.Collection = { _objects: [], add: function () { if (this._objects.push.apply(this._objects, arguments), this._onObjectAdded) for (var t = 0, e = arguments.length; t < e; t++)this._onObjectAdded(arguments[t]); return this.renderOnAddRemove && this.requestRenderAll(), this }, insertAt: function (t, e, i) { var r = this.getObjects(); return i ? r[e] = t : r.splice(e, 0, t), this._onObjectAdded && this._onObjectAdded(t), this.renderOnAddRemove && this.requestRenderAll(), this }, remove: function () { for (var t, e = this.getObjects(), i = !1, r = 0, n = arguments.length; r < n; r++)-1 !== (t = e.indexOf(arguments[r])) && (i = !0, e.splice(t, 1), this._onObjectRemoved && this._onObjectRemoved(arguments[r])); return this.renderOnAddRemove && i && this.requestRenderAll(), this }, forEachObject: function (t, e) { for (var i = this.getObjects(), r = 0, n = i.length; r < n; r++)t.call(e, i[r], r, i); return this }, getObjects: function (e) { return void 0 === e ? this._objects : this._objects.filter(function (t) { return t.type === e }) }, item: function (t) { return this.getObjects()[t] }, isEmpty: function () { return 0 === this.getObjects().length }, size: function () { return this.getObjects().length }, contains: function (t) { return -1 < this.getObjects().indexOf(t) }, complexity: function () { return this.getObjects().reduce(function (t, e) { return t += e.complexity ? e.complexity() : 0 }, 0) } }, fabric.CommonMethods = { _setOptions: function (t) { for (var e in t) this.set(e, t[e]) }, _initGradient: function (t, e) { !t || !t.colorStops || t instanceof fabric.Gradient || this.set(e, new fabric.Gradient(t)) }, _initPattern: function (t, e, i) { !t || !t.source || t instanceof fabric.Pattern ? i && i() : this.set(e, new fabric.Pattern(t, i)) }, _initClipping: function (t) { !t.clipTo || "string" != typeof t.clipTo || void 0 !== (t = fabric.util.getFunctionBody(t.clipTo)) && (this.clipTo = new Function("ctx", t)) }, _setObject: function (t) { for (var e in t) this._set(e, t[e]) }, set: function (t, e) { return "object" == typeof t ? this._setObject(t) : "function" == typeof e && "clipTo" !== t ? this._set(t, e(this.get(t))) : this._set(t, e), this }, _set: function (t, e) { this[t] = e }, toggle: function (t) { var e = this.get(t); return "boolean" == typeof e && this.set(t, !e), this }, get: function (t) { return this[t] } }, function (o) { var u = Math.sqrt, c = Math.atan2, s = Math.pow, r = Math.abs, a = Math.PI / 180, i = Math.PI / 2; fabric.util = { cos: function (t) { if (0 === t) return 1; switch ((t = t < 0 ? -t : t) / i) { case 1: case 3: return 0; case 2: return -1 }return Math.cos(t) }, sin: function (t) { if (0 === t) return 0; var e = t < 0 ? -1 : 1; switch (t / i) { case 1: return e; case 2: return 0; case 3: return -e }return Math.sin(t) }, removeFromArray: function (t, e) { e = t.indexOf(e); return -1 !== e && t.splice(e, 1), t }, getRandomInt: function (t, e) { return Math.floor(Math.random() * (e - t + 1)) + t }, degreesToRadians: function (t) { return t * a }, radiansToDegrees: function (t) { return t / a }, rotatePoint: function (t, e, i) { t.subtractEquals(e); t = fabric.util.rotateVector(t, i); return new fabric.Point(t.x, t.y).addEquals(e) }, rotateVector: function (t, e) { var i = fabric.util.sin(e), e = fabric.util.cos(e); return { x: t.x * e - t.y * i, y: t.x * i + t.y * e } }, transformPoint: function (t, e, i) { return i ? new fabric.Point(e[0] * t.x + e[2] * t.y, e[1] * t.x + e[3] * t.y) : new fabric.Point(e[0] * t.x + e[2] * t.y + e[4], e[1] * t.x + e[3] * t.y + e[5]) }, makeBoundingBoxFromPoints: function (t) { var e = [t[0].x, t[1].x, t[2].x, t[3].x], i = fabric.util.array.min(e), e = fabric.util.array.max(e) - i, t = [t[0].y, t[1].y, t[2].y, t[3].y], r = fabric.util.array.min(t); return { left: i, top: r, width: e, height: fabric.util.array.max(t) - r } }, invertTransform: function (t) { var e = 1 / (t[0] * t[3] - t[1] * t[2]), e = [e * t[3], -e * t[1], -e * t[2], e * t[0]], t = fabric.util.transformPoint({ x: t[4], y: t[5] }, e, !0); return e[4] = -t.x, e[5] = -t.y, e }, toFixed: function (t, e) { return parseFloat(Number(t).toFixed(e)) }, parseUnit: function (t, e) { var i = /\D{0,2}$/.exec(t), r = parseFloat(t); switch (e = e || fabric.Text.DEFAULT_SVG_FONT_SIZE, i[0]) { case "mm": return r * fabric.DPI / 25.4; case "cm": return r * fabric.DPI / 2.54; case "in": return r * fabric.DPI; case "pt": return r * fabric.DPI / 72; case "pc": return r * fabric.DPI / 72 * 12; case "em": return r * e; default: return r } }, falseFunction: function () { return !1 }, getKlass: function (t, e) { return t = fabric.util.string.camelize(t.charAt(0).toUpperCase() + t.slice(1)), fabric.util.resolveNamespace(e)[t] }, getSvgAttributes: function (t) { var e = ["instantiated_by_use", "style", "id", "class"]; switch (t) { case "linearGradient": e = e.concat(["x1", "y1", "x2", "y2", "gradientUnits", "gradientTransform"]); break; case "radialGradient": e = e.concat(["gradientUnits", "gradientTransform", "cx", "cy", "r", "fx", "fy", "fr"]); break; case "stop": e = e.concat(["offset", "stop-color", "stop-opacity"]) }return e }, resolveNamespace: function (t) { if (!t) return fabric; for (var e = t.split("."), i = e.length, r = o || fabric.window, n = 0; n < i; ++n)r = r[e[n]]; return r }, loadImage: function (t, e, i, r) { var n, o; t ? ((n = fabric.util.createImage()).onload = o = function () { e && e.call(i, n), n = n.onload = n.onerror = null }, n.onerror = function () { fabric.log("Error loading " + n.src), e && e.call(i, null, !0), n = n.onload = n.onerror = null }, 0 !== t.indexOf("data") && r && (n.crossOrigin = r), "data:image/svg" === t.substring(0, 14) && (n.onload = null, fabric.util.loadImageInDom(n, o)), n.src = t) : e && e.call(i, t) }, loadImageInDom: function (t, e) { var i = fabric.document.createElement("div"); i.style.width = i.style.height = "1px", i.style.left = i.style.top = "-100%", i.style.position = "absolute", i.appendChild(t), fabric.document.querySelector("body").appendChild(i), t.onload = function () { e(), i.parentNode.removeChild(i), i = null } }, enlivenObjects: function (t, e, n, o) { function s() { ++i === r && e && e(a) } var a = [], i = 0, r = (t = t || []).length; r ? t.forEach(function (i, r) { i && i.type ? fabric.util.getKlass(i.type, n).fromObject(i, function (t, e) { e || (a[r] = t), o && o(i, t, e), s() }) : s() }) : e && e(a) }, enlivenPatterns: function (t, e) { function i() { ++n === o && e && e(r) } var r = [], n = 0, o = (t = t || []).length; o ? t.forEach(function (t, e) { t && t.source ? new fabric.Pattern(t, function (t) { r[e] = t, i() }) : (r[e] = t, i()) }) : e && e(r) }, groupSVGElements: function (t, e, i) { return 1 === t.length ? t[0] : (e && (e.width && e.height ? e.centerPoint = { x: e.width / 2, y: e.height / 2 } : (delete e.width, delete e.height)), t = new fabric.Group(t, e), void 0 !== i && (t.sourcePath = i), t) }, populateWithProperties: function (t, e, i) { if (i && "[object Array]" === Object.prototype.toString.call(i)) for (var r = 0, n = i.length; r < n; r++)i[r] in t && (e[i[r]] = t[i[r]]) }, drawDashedLine: function (t, e, i, r, n, o) { var r = r - e, n = n - i, s = u(r * r + n * n), n = c(n, r), a = o.length, h = 0, l = !0; for (t.save(), t.translate(e, i), t.moveTo(0, 0), t.rotate(n), e = 0; e < s;)s < (e += o[h++ % a]) && (e = s), t[l ? "lineTo" : "moveTo"](e, 0), l = !l; t.restore() }, createCanvasElement: function () { return fabric.document.createElement("canvas") }, createImage: function () { return fabric.document.createElement("img") }, clipContext: function (t, e) { e.save(), e.beginPath(), t.clipTo(e), e.clip() }, multiplyTransformMatrices: function (t, e, i) { return [t[0] * e[0] + t[2] * e[1], t[1] * e[0] + t[3] * e[1], t[0] * e[2] + t[2] * e[3], t[1] * e[2] + t[3] * e[3], i ? 0 : t[0] * e[4] + t[2] * e[5] + t[4], i ? 0 : t[1] * e[4] + t[3] * e[5] + t[5]] }, qrDecompose: function (t) { var e = c(t[1], t[0]), i = s(t[0], 2) + s(t[1], 2), r = u(i), n = (t[0] * t[3] - t[2] * t[1]) / r, i = c(t[0] * t[2] + t[1] * t[3], i); return { angle: e / a, scaleX: r, scaleY: n, skewX: i / a, skewY: 0, translateX: t[4], translateY: t[5] } }, customTransformMatrix: function (t, e, i) { i = [1, 0, r(Math.tan(i * a)), 1], t = [r(t), 0, 0, r(e)]; return fabric.util.multiplyTransformMatrices(t, i, !0) }, resetObjectTransform: function (t) { t.scaleX = 1, t.scaleY = 1, t.skewX = 0, t.skewY = 0, t.flipX = !1, t.flipY = !1, t.rotate(0) }, getFunctionBody: function (t) { return (String(t).match(/function[^{]*\{([\s\S]*)\}/) || {})[1] }, isTransparent: function (t, e, i, r) { 0 < r && (r < e ? e -= r : e = 0, r < i ? i -= r : i = 0); for (var n = !0, o = t.getImageData(e, i, 2 * r || 1, 2 * r || 1), s = o.data.length, a = 3; a < s && !1 != (n = o.data[a] <= 0); a += 4); return o = null, n }, parsePreserveAspectRatioAttribute: function (t) { var e, i = "meet", t = t.split(" "); return t && t.length && ("meet" !== (i = t.pop()) && "slice" !== i ? (e = i, i = "meet") : t.length && (e = t.pop())), { meetOrSlice: i, alignX: "none" !== e ? e.slice(1, 4) : "none", alignY: "none" !== e ? e.slice(5, 8) : "none" } }, clearFabricFontCache: function (t) { t ? fabric.charWidthsCache[t] && delete fabric.charWidthsCache[t] : fabric.charWidthsCache = {} }, limitDimsByArea: function (t, e) { t = Math.sqrt(e * t), e = Math.floor(e / t); return { x: Math.floor(t), y: e } }, capValue: function (t, e, i) { return Math.max(t, Math.min(e, i)) }, findScaleToFit: function (t, e) { return Math.min(e.width / t.width, e.height / t.height) }, findScaleToCover: function (t, e) { return Math.max(e.width / t.width, e.height / t.height) } } }("undefined" != typeof exports ? exports : this), function () { var D = {}, R = {}, C = {}, I = Array.prototype.join; function v(u, c, t, e, f, d, p) { var g = I.call(arguments); if (D[g]) return D[g]; for (var v = Math.PI, i = p * v / 180, r = fabric.util.sin(i), n = fabric.util.cos(i), m = 0, y = 0, i = -n * u * .5 - r * c * .5, o = -n * c * .5 + r * u * .5, s = (t = Math.abs(t)) * t, _ = (e = Math.abs(e)) * e, b = o * o, x = i * i, a = s * _ - s * b - _ * x, T = 0, h = (a < 0 ? (t *= h = Math.sqrt(1 - a / (s * _)), e *= h) : T = (f === d ? -1 : 1) * Math.sqrt(a / (s * b + _ * x)), T * t * o / e), a = -T * e * i / t, w = n * h - r * a + .5 * u, S = r * h + n * a + .5 * c, C = k(1, 0, (i - h) / t, (o - a) / e), s = k((i - h) / t, (o - a) / e, (-i - h) / t, (-o - a) / e), E = (0 === d && 0 < s ? s -= 2 * v : 1 === d && s < 0 && (s += 2 * v), Math.ceil(Math.abs(s / v * 2))), O = [], l = s / E, P = 8 / 3 * Math.sin(l / 4) * Math.sin(l / 4) / Math.sin(l / 2), M = C + l, A = 0; A < E; A++)O[A] = function (u, c, t, e, i, r, f, d, n, p, g) { var o = I.call(arguments); if (R[o]) return R[o]; var s = fabric.util.cos(u), a = fabric.util.sin(u), h = fabric.util.cos(c), l = fabric.util.sin(c), v = t * i * h - e * r * l + f, m = e * i * h + t * r * l + d, y = p + n * (-t * i * a - e * r * s), a = g + n * (-e * i * a + t * r * s), s = v + n * (t * i * l + e * r * h), l = m + n * (e * i * l - t * r * h); return R[o] = [y, a, s, l, v, m], R[o] }(C, M, n, r, t, e, w, S, P, m, y), m = O[A][4], y = O[A][5], C = M, M += l; return D[g] = O } function k(t, e, i, r) { e = Math.atan2(e, t), t = Math.atan2(r, i); return e <= t ? t - e : 2 * Math.PI - (e - t) } function m(t, e, u, c, f, d, p, g) { var v = I.call(arguments); if (C[v]) return C[v]; for (var i, r, m, y = Math.sqrt, _ = Math.min, b = Math.max, x = Math.abs, n = [], o = [[], []], s = 6 * t - 12 * u + 6 * f, a = -3 * t + 9 * u - 9 * f + 3 * p, T = 3 * u - 3 * t, w = 0; w < 2; ++w)0 < w && (s = 6 * e - 12 * c + 6 * d, a = -3 * e + 9 * c - 9 * d + 3 * g, T = 3 * c - 3 * e), x(a) < 1e-12 ? x(s) < 1e-12 || 0 < (i = -T / s) && i < 1 && n.push(i) : (m = s * s - 4 * T * a) < 0 || (0 < (r = (-s + (m = y(m))) / (2 * a)) && r < 1 && n.push(r), 0 < (r = (-s - m) / (2 * a)) && r < 1 && n.push(r)); for (var h, S = n.length, l = S; S--;)i = n[S], o[0][S] = (h = 1 - i) * h * h * t + 3 * h * h * i * u + 3 * h * i * i * f + i * i * i * p, o[1][S] = h * h * h * e + 3 * h * h * i * c + 3 * h * i * i * d + i * i * i * g; o[0][l] = t, o[1][l] = e, o[0][l + 1] = p, o[1][l + 1] = g; l = [{ x: _.apply(null, o[0]), y: _.apply(null, o[1]) }, { x: b.apply(null, o[0]), y: b.apply(null, o[1]) }]; return C[v] = l } fabric.util.drawArc = function (t, e, i, r) { for (var n = r[0], o = r[1], s = r[2], u = r[3], c = r[4], a = [[], [], [], []], h = v(r[5] - e, r[6] - i, n, o, u, c, s), l = 0, f = h.length; l < f; l++)a[l][0] = h[l][0] + e, a[l][1] = h[l][1] + i, a[l][2] = h[l][2] + e, a[l][3] = h[l][3] + i, a[l][4] = h[l][4] + e, a[l][5] = h[l][5] + i, t.bezierCurveTo.apply(t, a[l]) }, fabric.util.getBoundsOfArc = function (t, e, i, r, u, c, f, d, p) { for (var n, o = 0, s = 0, a = [], h = v(d - t, p - e, i, r, c, f, u), l = 0, g = h.length; l < g; l++)n = m(o, s, h[l][0], h[l][1], h[l][2], h[l][3], h[l][4], h[l][5]), a.push({ x: n[0].x + t, y: n[0].y + e }), a.push({ x: n[1].x + t, y: n[1].y + e }), o = h[l][4], s = h[l][5]; return a }, fabric.util.getBoundsOfCurve = m }(), function () { var s = Array.prototype.slice; function i(t, e, i) { if (t && 0 !== t.length) { var r = t.length - 1, n = e ? t[r][e] : t[r]; if (e) for (; r--;)i(t[r][e], n) && (n = t[r][e]); else for (; r--;)i(t[r], n) && (n = t[r]); return n } } fabric.util.array = { fill: function (t, e) { for (var i = t.length; i--;)t[i] = e; return t }, invoke: function (t, e) { for (var i = s.call(arguments, 2), r = [], n = 0, o = t.length; n < o; n++)r[n] = i.length ? t[n][e].apply(t[n], i) : t[n][e].call(t[n]); return r }, min: function (t, e) { return i(t, e, function (t, e) { return t < e }) }, max: function (t, e) { return i(t, e, function (t, e) { return e <= t }) } } }(), function () { function s(t, e, i) { if (i) if (!fabric.isLikelyNode && e instanceof Element) t = e; else if (e instanceof Array) { t = []; for (var r = 0, n = e.length; r < n; r++)t[r] = s({}, e[r], i) } else if (e && "object" == typeof e) for (var o in e) e.hasOwnProperty(o) && (t[o] = s({}, e[o], i)); else t = e; else for (var o in e) t[o] = e[o]; return t } fabric.util.object = { extend: s, clone: function (t, e) { return s({}, t, e) } }, fabric.util.object.extend(fabric.util, fabric.Observable) }(), fabric.util.string = { camelize: function (t) { return t.replace(/-+(.)?/g, function (t, e) { return e ? e.toUpperCase() : "" }) }, capitalize: function (t, e) { return t.charAt(0).toUpperCase() + (e ? t.slice(1) : t.slice(1).toLowerCase()) }, escapeXml: function (t) { return t.replace(/&/g, "&amp;").replace(/"/g, "&quot;").replace(/'/g, "&apos;").replace(/</g, "&lt;").replace(/>/g, "&gt;") }, graphemeSplit: function (t) { for (var e, i = 0, r = [], i = 0; i < t.length; i++)!1 !== (e = function (t, e) { var i = t.charCodeAt(e); if (isNaN(i)) return ""; if (i < 55296 || 57343 < i) return t.charAt(e); if (55296 <= i && i <= 56319) { if (t.length <= e + 1) throw "High surrogate without following low surrogate"; i = t.charCodeAt(e + 1); if (i < 56320 || 57343 < i) throw "High surrogate without following low surrogate"; return t.charAt(e) + t.charAt(e + 1) } if (0 === e) throw "Low surrogate without preceding high surrogate"; i = t.charCodeAt(e - 1); if (i < 55296 || 56319 < i) throw "Low surrogate without preceding high surrogate"; return !1 }(t, i)) && r.push(e); return r } }, function () { function o() { } var s = Array.prototype.slice, a = function () { for (var t in { toString: 1 }) if ("toString" === t) return !1; return !0 }(); function h() { } function l(t) { for (var e = null, i = this; i.constructor.superclass;) { var r = i.constructor.superclass.prototype[t]; if (i[t] !== r) { e = r; break } i = i.constructor.superclass.prototype } return e ? 1 < arguments.length ? e.apply(this, s.call(arguments, 1)) : e.call(this) : console.log("tried to callSuper " + t + ", method not found in prototype chain", this) } fabric.util.createClass = function () { var t = null, e = s.call(arguments, 0); function i() { this.initialize.apply(this, arguments) } "function" == typeof e[0] && (t = e.shift()), i.superclass = t, i.subclasses = [], t && (h.prototype = t.prototype, i.prototype = new h, t.subclasses.push(i)); for (var r = 0, n = e.length; r < n; r++)!function (t, r, n) { for (var e in r) e in t.prototype && "function" == typeof t.prototype[e] && -1 < (r[e] + "").indexOf("callSuper") ? t.prototype[e] = function (i) { return function () { var t = this.constructor.superclass, e = (this.constructor.superclass = n, r[i].apply(this, arguments)); if (this.constructor.superclass = t, "initialize" !== i) return e } }(e) : t.prototype[e] = r[e], a && (r.toString !== Object.prototype.toString && (t.prototype.toString = r.toString), r.valueOf !== Object.prototype.valueOf && (t.prototype.valueOf = r.valueOf)) }(i, e[r], t); return i.prototype.initialize || (i.prototype.initialize = o), (i.prototype.constructor = i).prototype.callSuper = l, i } }(), function () { function t(t) { for (var e, i = Array.prototype.slice.call(arguments, 1), r = i.length, n = 0; n < r; n++)if (e = typeof t[i[n]], !/^(?:function|object|unknown)$/.test(e)) return !1; return !0 } u = 0; var n, o, u, i, a = function (t) { return t.__uniqueID || (t.__uniqueID = "uniqueID__" + u++) }; function c(t, e) { return { handler: e, wrappedHandler: (i = t, r = e, function (t) { r.call(n(i), t || fabric.window.event) }) }; var i, r } i = {}, n = function (t) { return i[t] }, o = function (t, e) { i[t] = e }; var e, r = t(fabric.document.documentElement, "addEventListener", "removeEventListener") && t(fabric.window, "addEventListener", "removeEventListener"), s = t(fabric.document.documentElement, "attachEvent", "detachEvent") && t(fabric.window, "attachEvent", "detachEvent"), h = {}, l = {}; r = r ? (e = function (t, e, i, r) { t && t.addEventListener(e, i, !s && r) }, function (t, e, i, r) { t && t.removeEventListener(e, i, !s && r) }) : s ? (e = function (t, e, i) { var r; t && (r = a(t), o(r, t), h[r] || (h[r] = {}), h[r][e] || (h[r][e] = []), i = c(r, i), h[r][e].push(i), t.attachEvent("on" + e, i.wrappedHandler)) }, function (t, e, i) { if (t) { var r, n = a(t); if (h[n] && h[n][e]) for (var o = 0, s = h[n][e].length; o < s; o++)(r = h[n][e][o]) && r.handler === i && (t.detachEvent("on" + e, r.wrappedHandler), h[n][e][o] = null) } }) : (e = function (t, e, i) { var r, n, o, s; t && (r = a(t), l[r] || (l[r] = {}), l[r][e] || (l[r][e] = [], (n = t["on" + e]) && l[r][e].push(n), t["on" + e] = (o = r, s = e, function (t) { if (l[o] && l[o][s]) for (var e = l[o][s], i = 0, r = e.length; i < r; i++)e[i].call(this, t || fabric.window.event) })), l[r][e].push(i)) }, function (t, e, i) { if (t) { t = a(t); if (l[t] && l[t][e]) for (var r = l[t][e], n = 0, o = r.length; n < o; n++)r[n] === i && r.splice(n, 1) } }), fabric.util.addListener = e, fabric.util.removeListener = r; var f = function (t) { return t.clientX }, d = function (t) { return t.clientY }; function p(t, e, i) { var r, n = t["touchend" === t.type ? "changedTouches" : "touches"]; return r = void 0 === (r = n && n[0] ? n[0][i] : r) ? t[i] : r } fabric.isTouchSupported && (f = function (t) { return p(t, 0, "clientX") }, d = function (t) { return p(t, 0, "clientY") }), fabric.util.getPointer = function (t) { var e = (t = t || fabric.window.event).target || ("unknown" != typeof t.srcElement ? t.srcElement : null), e = fabric.util.getScrollLeftTop(e); return { x: f(t) + e.left, y: d(t) + e.top } } }(), function () { var t = fabric.document.createElement("div"), e = "string" == typeof t.style.opacity, t = "string" == typeof t.style.filter, r = /alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/, n = function (t) { return t }; e ? n = function (t, e) { return t.style.opacity = e, t } : t && (n = function (t, e) { var i = t.style; return t.currentStyle && !t.currentStyle.hasLayout && (i.zoom = 1), r.test(i.filter) ? i.filter = i.filter.replace(r, e = .9999 <= e ? "" : "alpha(opacity=" + 100 * e + ")") : i.filter += " alpha(opacity=" + 100 * e + ")", t }), fabric.util.setStyle = function (t, e) { var i, r = t.style; if (!r) return t; if ("string" == typeof e) return t.style.cssText += ";" + e, -1 < e.indexOf("opacity") ? n(t, e.match(/opacity:\s*(\d?\.?\d*)/)[1]) : t; for (i in e) "opacity" === i ? n(t, e[i]) : r["float" === i || "cssFloat" === i ? void 0 === r.styleFloat ? "cssFloat" : "styleFloat" : i] = e[i]; return t } }(), function () { var e = Array.prototype.slice; var a, t, i, r = function (t) { return e.call(t, 0) }; try { t = r(fabric.document.childNodes) instanceof Array } catch (t) { } function n(t, e) { var i, r = fabric.document.createElement(t); for (i in e) "class" === i ? r.className = e[i] : "for" === i ? r.htmlFor = e[i] : r.setAttribute(i, e[i]); return r } function h(t) { for (var e = 0, i = 0, r = fabric.document.documentElement, n = fabric.document.body || { scrollLeft: 0, scrollTop: 0 }; t && (t.parentNode || t.host) && ((t = t.parentNode || t.host) === fabric.document ? (e = n.scrollLeft || r.scrollLeft || 0, i = n.scrollTop || r.scrollTop || 0) : (e += t.scrollLeft || 0, i += t.scrollTop || 0), 1 !== t.nodeType || "fixed" !== t.style.position);); return { left: e, top: i } } t || (r = function (t) { for (var e = new Array(t.length), i = t.length; i--;)e[i] = t[i]; return e }), a = fabric.document.defaultView && fabric.document.defaultView.getComputedStyle ? function (t, e) { t = fabric.document.defaultView.getComputedStyle(t, null); return t ? t[e] : void 0 } : function (t, e) { var i = t.style[e]; return i = !i && t.currentStyle ? t.currentStyle[e] : i }, t = fabric.document.documentElement.style, i = "userSelect" in t ? "userSelect" : "MozUserSelect" in t ? "MozUserSelect" : "WebkitUserSelect" in t ? "WebkitUserSelect" : "KhtmlUserSelect" in t ? "KhtmlUserSelect" : "", fabric.util.makeElementUnselectable = function (t) { return void 0 !== t.onselectstart && (t.onselectstart = fabric.util.falseFunction), i ? t.style[i] = "none" : "string" == typeof t.unselectable && (t.unselectable = "on"), t }, fabric.util.makeElementSelectable = function (t) { return void 0 !== t.onselectstart && (t.onselectstart = null), i ? t.style[i] = "" : "string" == typeof t.unselectable && (t.unselectable = ""), t }, fabric.util.getScript = function (t, e) { var i = fabric.document.getElementsByTagName("head")[0], r = fabric.document.createElement("script"), n = !0; r.onload = r.onreadystatechange = function (t) { n && ("string" == typeof this.readyState && "loaded" !== this.readyState && "complete" !== this.readyState || (n = !1, e(t || fabric.window.event), r = r.onload = r.onreadystatechange = null)) }, r.src = t, i.appendChild(r) }, fabric.util.getById = function (t) { return "string" == typeof t ? fabric.document.getElementById(t) : t }, fabric.util.toArray = r, fabric.util.makeElement = n, fabric.util.addClass = function (t, e) { t && -1 === (" " + t.className + " ").indexOf(" " + e + " ") && (t.className += (t.className ? " " : "") + e) }, fabric.util.wrapElement = function (t, e, i) { return "string" == typeof e && (e = n(e, i)), t.parentNode && t.parentNode.replaceChild(e, t), e.appendChild(t), e }, fabric.util.getScrollLeftTop = h, fabric.util.getElementOffset = function (t) { var e, i, r = t && t.ownerDocument, n = { left: 0, top: 0 }, o = { left: 0, top: 0 }, s = { borderLeftWidth: "left", borderTopWidth: "top", paddingLeft: "left", paddingTop: "top" }; if (!r) return o; for (i in s) o[s[i]] += parseInt(a(t, i), 10) || 0; return r = r.documentElement, void 0 !== t.getBoundingClientRect && (n = t.getBoundingClientRect()), e = h(t), { left: n.left + e.left - (r.clientLeft || 0) + o.left, top: n.top + e.top - (r.clientTop || 0) + o.top } }, fabric.util.getElementStyle = a, fabric.util.getNodeCanvas = function (t) { return (t = fabric.jsdomImplForWrapper(t))._canvas || t._image } }(), function () { var a = function () { for (var t = [function () { return new ActiveXObject("Microsoft.XMLHTTP") }, function () { return new ActiveXObject("Msxml2.XMLHTTP") }, function () { return new ActiveXObject("Msxml2.XMLHTTP.3.0") }, function () { return new XMLHttpRequest }], e = t.length; e--;)try { if (t[e]()) return t[e] } catch (t) { } }(); function h() { } fabric.util.request = function (t, e) { var i, r = (e = e || {}).method ? e.method.toUpperCase() : "GET", n = e.onComplete || function () { }, o = a(), s = e.body || e.parameters; return o.onreadystatechange = function () { 4 === o.readyState && (n(o), o.onreadystatechange = h) }, "GET" === r && (s = null, "string" == typeof e.parameters && (i = t, e = e.parameters, t = i + (/\?/.test(i) ? "&" : "?") + e)), o.open(r, t, !0), "POST" !== r && "PUT" !== r || o.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"), o.send(s), o } }(), fabric.log = function () { }, fabric.warn = function () { }, "undefined" != typeof console && ["log", "warn"].forEach(function (t) { void 0 !== console[t] && "function" == typeof console[t].apply && (fabric[t] = function () { return console[t].apply(console, arguments) }) }), function () { function e() { return !1 } var t = fabric.window.requestAnimationFrame || fabric.window.webkitRequestAnimationFrame || fabric.window.mozRequestAnimationFrame || fabric.window.oRequestAnimationFrame || fabric.window.msRequestAnimationFrame || function (t) { return fabric.window.setTimeout(t, 1e3 / 60) }, i = fabric.window.cancelAnimationFrame || fabric.window.clearTimeout; function v() { return t.apply(fabric.window, arguments) } fabric.util.animate = function (g) { v(function (t) { g = g || {}; var n, o = t || +new Date, s = g.duration || 500, a = o + s, h = g.onChange || e, l = g.abort || e, d = g.onComplete || e, p = g.easing || function (t, e, i, r) { return -i * Math.cos(t / r * (Math.PI / 2)) + i + e }, u = "startValue" in g ? g.startValue : 0, c = "endValue" in g ? g.endValue : 100, f = g.byValue || c - u; g.onStart && g.onStart(), function t(e) { var i, r; l() ? d(c, 1, 1) : (n = e || +new Date, i = (e = a < n ? s : n - o) / s, e = p(e, u, f, s), r = Math.abs((e - u) / f), h(e, r, i), a < n ? g.onComplete && g.onComplete() : v(t)) }(o) }) }, fabric.util.requestAnimFrame = v, fabric.util.cancelAnimFrame = function () { return i.apply(fabric.window, arguments) } }(), fabric.util.animateColor = function (t, e, i, n) { t = new fabric.Color(t).getSource(), e = new fabric.Color(e).getSource(), n = n || {}, fabric.util.animate(fabric.util.object.extend(n, { duration: i || 500, startValue: t, endValue: e, byValue: e, easing: function (t, e, i, r) { t = n.colorEasing ? n.colorEasing(t, r) : 1 - Math.cos(t / r * (Math.PI / 2)); return r = e, e = i, i = t, "rgba(" + parseInt(r[0] + i * (e[0] - r[0]), 10) + "," + parseInt(r[1] + i * (e[1] - r[1]), 10) + "," + parseInt(r[2] + i * (e[2] - r[2]), 10) + "," + (r && e ? parseFloat(r[3] + i * (e[3] - r[3])) : 1) + ")" } })) }, function () { function o(t, e, i, r) { return r = t < Math.abs(e) ? (t = e, i / 4) : 0 === e && 0 === t ? i / (2 * Math.PI) * Math.asin(1) : i / (2 * Math.PI) * Math.asin(e / t), { a: t, c: e, p: i, s: r } } function s(t, e, i) { return t.a * Math.pow(2, 10 * --e) * Math.sin((e * i - t.s) * (2 * Math.PI) / t.p) } function n(t, e, i, r) { return i - a(r - t, 0, i, r) + e } function a(t, e, i, r) { return (t /= r) < 1 / 2.75 ? i * (7.5625 * t * t) + e : t < 2 / 2.75 ? i * (7.5625 * (t -= 1.5 / 2.75) * t + .75) + e : t < 2.5 / 2.75 ? i * (7.5625 * (t -= 2.25 / 2.75) * t + .9375) + e : i * (7.5625 * (t -= 2.625 / 2.75) * t + .984375) + e } fabric.util.ease = { easeInQuad: function (t, e, i, r) { return i * (t /= r) * t + e }, easeOutQuad: function (t, e, i, r) { return -i * (t /= r) * (t - 2) + e }, easeInOutQuad: function (t, e, i, r) { return (t /= r / 2) < 1 ? i / 2 * t * t + e : -i / 2 * (--t * (t - 2) - 1) + e }, easeInCubic: function (t, e, i, r) { return i * (t /= r) * t * t + e }, easeOutCubic: function (t, e, i, r) { return i * ((t = t / r - 1) * t * t + 1) + e }, easeInOutCubic: function (t, e, i, r) { return (t /= r / 2) < 1 ? i / 2 * t * t * t + e : i / 2 * ((t -= 2) * t * t + 2) + e }, easeInQuart: function (t, e, i, r) { return i * (t /= r) * t * t * t + e }, easeOutQuart: function (t, e, i, r) { return -i * ((t = t / r - 1) * t * t * t - 1) + e }, easeInOutQuart: function (t, e, i, r) { return (t /= r / 2) < 1 ? i / 2 * t * t * t * t + e : -i / 2 * ((t -= 2) * t * t * t - 2) + e }, easeInQuint: function (t, e, i, r) { return i * (t /= r) * t * t * t * t + e }, easeOutQuint: function (t, e, i, r) { return i * ((t = t / r - 1) * t * t * t * t + 1) + e }, easeInOutQuint: function (t, e, i, r) { return (t /= r / 2) < 1 ? i / 2 * t * t * t * t * t + e : i / 2 * ((t -= 2) * t * t * t * t + 2) + e }, easeInSine: function (t, e, i, r) { return -i * Math.cos(t / r * (Math.PI / 2)) + i + e }, easeOutSine: function (t, e, i, r) { return i * Math.sin(t / r * (Math.PI / 2)) + e }, easeInOutSine: function (t, e, i, r) { return -i / 2 * (Math.cos(Math.PI * t / r) - 1) + e }, easeInExpo: function (t, e, i, r) { return 0 === t ? e : i * Math.pow(2, 10 * (t / r - 1)) + e }, easeOutExpo: function (t, e, i, r) { return t === r ? e + i : i * (1 - Math.pow(2, -10 * t / r)) + e }, easeInOutExpo: function (t, e, i, r) { return 0 === t ? e : t === r ? e + i : (t /= r / 2) < 1 ? i / 2 * Math.pow(2, 10 * (t - 1)) + e : i / 2 * (2 - Math.pow(2, -10 * --t)) + e }, easeInCirc: function (t, e, i, r) { return -i * (Math.sqrt(1 - (t /= r) * t) - 1) + e }, easeOutCirc: function (t, e, i, r) { return i * Math.sqrt(1 - (t = t / r - 1) * t) + e }, easeInOutCirc: function (t, e, i, r) { return (t /= r / 2) < 1 ? -i / 2 * (Math.sqrt(1 - t * t) - 1) + e : i / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + e }, easeInElastic: function (t, e, i, r) { var n = 0; return 0 === t ? e : 1 === (t /= r) ? e + i : -s(o(i, i, n = n || .3 * r, 1.70158), t, r) + e }, easeOutElastic: function (t, e, i, r) { return 0 === t ? e : 1 === (t /= r) ? e + i : (i = o(i, i, 0 || .3 * r, 1.70158)).a * Math.pow(2, -10 * t) * Math.sin((t * r - i.s) * (2 * Math.PI) / i.p) + i.c + e }, easeInOutElastic: function (t, e, i, r) { return 0 === t ? e : 2 === (t /= r / 2) ? e + i : (i = o(i, i, 0 || r * (.3 * 1.5), 1.70158), t < 1 ? -.5 * s(i, t, r) + e : i.a * Math.pow(2, -10 * --t) * Math.sin((t * r - i.s) * (2 * Math.PI) / i.p) * .5 + i.c + e) }, easeInBack: function (t, e, i, r, n) { return i * (t /= r) * t * (((n = void 0 === n ? 1.70158 : n) + 1) * t - n) + e }, easeOutBack: function (t, e, i, r, n) { return i * ((t = t / r - 1) * t * (((n = void 0 === n ? 1.70158 : n) + 1) * t + n) + 1) + e }, easeInOutBack: function (t, e, i, r, n) { return void 0 === n && (n = 1.70158), (t /= r / 2) < 1 ? i / 2 * (t * t * ((1 + (n *= 1.525)) * t - n)) + e : i / 2 * ((t -= 2) * t * ((1 + (n *= 1.525)) * t + n) + 2) + e }, easeInBounce: n, easeOutBounce: a, easeInOutBounce: function (t, e, i, r) { return t < r / 2 ? .5 * n(2 * t, 0, i, r) + e : .5 * a(2 * t - r, 0, i, r) + .5 * i + e } } }(), function (t) { "use strict"; var c, e, f, r, n, _ = t.fabric || (t.fabric = {}), b = _.util.object.extend, d = _.util.object.clone, w = _.util.toFixed, x = _.util.parseUnit, S = _.util.multiplyTransformMatrices, C = { cx: "left", x: "left", r: "radius", cy: "top", y: "top", display: "visible", visibility: "visible", transform: "transformMatrix", "fill-opacity": "fillOpacity", "fill-rule": "fillRule", "font-family": "fontFamily", "font-size": "fontSize", "font-style": "fontStyle", "font-weight": "fontWeight", "letter-spacing": "charSpacing", "paint-order": "paintFirst", "stroke-dasharray": "strokeDashArray", "stroke-linecap": "strokeLineCap", "stroke-linejoin": "strokeLineJoin", "stroke-miterlimit": "strokeMiterLimit", "stroke-opacity": "strokeOpacity", "stroke-width": "strokeWidth", "text-decoration": "textDecoration", "text-anchor": "textAnchor", opacity: "opacity" }, T = { stroke: "strokeOpacity", fill: "fillOpacity" }; function i(t) { return new RegExp("^(" + t.join("|") + ")\\b", "i") } function g(t, e) { for (var i, r = [], n = 0, o = e.length; n < o; n++)i = e[n], i = t.getElementsByTagName(i), r = r.concat(Array.prototype.slice.call(i)); return r } function v(t, e, i) { t[i] = Math.tan(_.util.degreesToRadians(e[0])) } function E(t, e) { var i, r = {}; for (i in _.cssRules[e]) if (function (t, e) { var i, r = !0; (i = o(t, e.pop())) && e.length && (r = function (t, e) { var i, r = !0; for (; t.parentNode && 1 === t.parentNode.nodeType && e.length;)r && (i = e.pop()), t = t.parentNode, r = o(t, i); return 0 === e.length }(t, e)); return i && r && 0 === e.length }(t, i.split(" "))) for (var n in _.cssRules[e][i]) r[n] = _.cssRules[e][i][n]; return r } function o(t, e) { var i, r = t.nodeName, n = t.getAttribute("class"), t = t.getAttribute("id"), o = new RegExp("^" + r, "i"); if (e = e.replace(o, ""), t && e.length && (o = new RegExp("#" + t + "(?![a-zA-Z\\-]+)", "i"), e = e.replace(o, "")), n && e.length) for (i = (n = n.split(" ")).length; i--;)o = new RegExp("\\." + n[i] + "(?![a-zA-Z\\-]+)", "i"), e = e.replace(o, ""); return 0 === e.length } function m(u) { for (var t = g(u, ["use", "svg:use"]), e = 0; t.length && e < t.length;) { var i, r = t[e], c = r.getAttribute("xlink:href").substr(1), f = r.getAttribute("x") || 0, d = r.getAttribute("y") || 0, n = function (t, e) { var i; if (i = t.getElementById ? t.getElementById(e) : i) return i; for (var r, n = t.getElementsByTagName("*"), o = 0, s = n.length; o < s; o++)if (e === (r = n[o]).getAttribute("id")) return r }(u, c).cloneNode(!0), o = (n.getAttribute("transform") || "") + " translate(" + f + ", " + d + ")", c = t.length; if (p(n), /^svg$/i.test(n.nodeName)) { for (var s, a = n.ownerDocument.createElement("g"), h = 0, l = (s = n.attributes).length; h < l; h++)i = s.item(h), a.setAttribute(i.nodeName, i.nodeValue); for (; n.firstChild;)a.appendChild(n.firstChild); n = a } for (h = 0, l = (s = r.attributes).length; h < l; h++)"x" !== (i = s.item(h)).nodeName && "y" !== i.nodeName && "xlink:href" !== i.nodeName && ("transform" === i.nodeName ? o = i.nodeValue + " " + o : n.setAttribute(i.nodeName, i.nodeValue)); n.setAttribute("transform", o), n.setAttribute("instantiated_by_use", "1"), n.removeAttribute("id"), r.parentNode.replaceChild(n, r), t.length === c && e++ } } _.svgValidTagNamesRegEx = i(["path", "circle", "polygon", "polyline", "ellipse", "rect", "line", "image", "text", "linearGradient", "radialGradient", "stop"]), _.svgViewBoxElementsRegEx = i(["symbol", "image", "marker", "pattern", "view", "svg"]), _.svgInvalidAncestorsRegEx = i(["pattern", "defs", "symbol", "metadata", "clipPath", "mask", "desc"]), _.svgValidParentsRegEx = i(["symbol", "g", "a", "svg"]), _.cssRules = {}, _.gradientDefs = {}, _.parseTransformAttribute = (c = [1, 0, 0, 1, 0, 0], t = _.reNum, f = "(?:" + ("(?:(matrix)\\s*\\(\\s*(" + t + ")" + (e = "(?:\\s+,?\\s*|,\\s*)") + "(" + t + ")" + e + "(" + t + ")" + e + "(" + t + ")" + e + "(" + t + ")" + e + "(" + t + ")\\s*\\))") + "|" + ("(?:(translate)\\s*\\(\\s*(" + t + ")(?:" + e + "(" + t + "))?\\s*\\))") + "|" + ("(?:(scale)\\s*\\(\\s*(" + t + ")(?:" + e + "(" + t + "))?\\s*\\))") + "|" + ("(?:(rotate)\\s*\\(\\s*(" + t + ")(?:" + e + "(" + t + ")" + e + "(" + t + "))?\\s*\\))") + "|" + ("(?:(skewX)\\s*\\(\\s*(" + t + ")\\s*\\))") + "|" + ("(?:(skewY)\\s*\\(\\s*(" + t + ")\\s*\\))") + ")", r = new RegExp("^\\s*(?:" + ("(?:" + f + "(?:" + e + "*" + f + ")*)") + "?)\\s*$"), n = new RegExp(f, "g"), function (t) { var l = c.concat(), u = []; if (!t || !r.test(t)) return l; t.replace(n, function (t) { var e, i, r, n, o, s, t = new RegExp(f).exec(t).filter(function (t) { return !!t }), a = t[1], h = t.slice(2).map(parseFloat); switch (a) { case "translate": s = h, (o = l)[4] = s[0], 2 === s.length && (o[5] = s[1]); break; case "rotate": h[0] = _.util.degreesToRadians(h[0]), o = l, s = h, e = _.util.cos(s[0]), i = _.util.sin(s[0]), n = r = 0, 3 === s.length && (r = s[1], n = s[2]), o[0] = e, o[1] = i, o[2] = -i, o[3] = e, o[4] = r - (e * r - i * n), o[5] = n - (i * r + e * n); break; case "scale": i = l, e = (r = h)[0], r = 2 === r.length ? r[1] : r[0], i[0] = e, i[3] = r; break; case "skewX": v(l, h, 2); break; case "skewY": v(l, h, 1); break; case "matrix": l = h }u.push(l.concat()), l = c.concat() }); for (var e = u[0]; 1 < u.length;)u.shift(), e = _.util.multiplyTransformMatrices(e, u[0]); return e }); var y = new RegExp("^\\s*(" + _.reNum + "+)\\s*,?\\s*(" + _.reNum + "+)\\s*,?\\s*(" + _.reNum + "+)\\s*,?\\s*(" + _.reNum + "+)\\s*$"); function p(t) { var u, e, i = t.getAttribute("viewBox"), r = 1, n = 1, o = t.getAttribute("width"), s = t.getAttribute("height"), c = t.getAttribute("x") || 0, f = t.getAttribute("y") || 0, d = t.getAttribute("preserveAspectRatio") || "", a = !i || !_.svgViewBoxElementsRegEx.test(t.nodeName) || !(i = i.match(y)), h = !o || !s || "100%" === o || "100%" === s, p = a && h, l = {}, g = ""; if (l.width = 0, l.height = 0, l.toBeParsed = p) return l; if (a) return l.width = x(o), l.height = x(s), l; if (p = -parseFloat(i[1]), a = -parseFloat(i[2]), u = parseFloat(i[3]), i = parseFloat(i[4]), h ? (l.width = u, l.height = i) : (l.width = x(o), l.height = x(s), r = l.width / u, n = l.height / i), "none" !== _.util.parsePreserveAspectRatioAttribute(d).alignX && (n = r = n < r ? n : r), 1 === r && 1 === n && 0 == p && 0 == a && 0 === c && 0 === f) return l; if (h = (g = c || f ? " translate(" + x(c) + " " + x(f) + ") " : g) + " matrix(" + r + " 0 0 " + n + " " + p * r + " " + a * n + ") ", "svg" === t.nodeName) { for (e = t.ownerDocument.createElement("g"); t.firstChild;)e.appendChild(t.firstChild); t.appendChild(e) } else h = (e = t).getAttribute("transform") + h; return e.setAttribute("transform", h), l } _.parseSVGDocument = function (t, i, e, r) { if (t) { m(t); var n = _.Object.__uid++, o = p(t), s = _.util.toArray(t.getElementsByTagName("*")); if (o.crossOrigin = r && r.crossOrigin, o.svgUid = n, 0 === s.length && _.isLikelyNode) { for (var a = [], h = 0, u = (s = t.selectNodes('//*[name(.)!="svg"]')).length; h < u; h++)a[h] = s[h]; s = a } var l = s.filter(function (t) { return p(t), _.svgValidTagNamesRegEx.test(t.nodeName.replace("svg:", "")) && !function (t, e) { for (; t = t && t.parentNode;)if (t.nodeName && e.test(t.nodeName.replace("svg:", "")) && !t.getAttribute("instantiated_by_use")) return 1 }(t, _.svgInvalidAncestorsRegEx) }); l && l.length ? (_.gradientDefs[n] = _.getGradientDefs(t), _.cssRules[n] = _.getCSSRules(t), _.parseElements(l, function (t, e) { i && i(t, o, e, s) }, d(o), e, r)) : i && i([], {}) } }; var s = new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*(" + _.reNum + "(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|" + _.reNum + "))?\\s+(.*)"); b(_, { parseFontDeclaration: function (t, e) { var i, r, n, o, t = t.match(s); t && (i = t[1], r = t[3], n = t[4], o = t[5], t = t[6], i && (e.fontStyle = i), r && (e.fontWeight = isNaN(parseFloat(r)) ? r : parseFloat(r)), n && (e.fontSize = x(n)), t && (e.fontFamily = t), o && (e.lineHeight = "normal" === o ? 1 : o)) }, getGradientDefs: function (t) { for (var e, i, r = g(t, ["linearGradient", "radialGradient", "svg:linearGradient", "svg:radialGradient"]), n = 0, o = {}, s = {}, n = r.length; n--;)i = (h = r[n]).getAttribute("xlink:href"), e = h.getAttribute("id"), i && (s[e] = i.substr(1)), o[e] = h; for (e in s) for (var a = o[s[e]].cloneNode(!0), h = o[e]; a.firstChild;)h.appendChild(a.firstChild); return o }, parseAttributes: function (i, u, c) { if (i) { var f, d, p, t, e, r, g, n, v, o, s = {}, m = (void 0 === c && (c = i.getAttribute("svgUid")), d = (s = i.parentNode && _.svgValidParentsRegEx.test(i.parentNode.nodeName) ? _.parseAttributes(i.parentNode, u, c) : s) && s.fontSize || i.getAttribute("font-size") || _.Text.DEFAULT_SVG_FONT_SIZE, u.reduce(function (t, e) { return (f = i.getAttribute(e)) && (t[e] = f), t }, {})), a = {}; for (p in m = b(m, b(E(i, c), _.parseStyleAttribute(i)))) t = o = (o = p) in C ? C[o] : o, e = m[p], r = s, g = d, v = n = void 0, v = "[object Array]" === Object.prototype.toString.call(e), "fill" !== t && "stroke" !== t || "none" !== e ? "strokeDashArray" === t ? e = "none" === e ? null : e.replace(/,/g, " ").split(/\s+/).map(function (t) { return parseFloat(t) }) : "transformMatrix" === t ? e = r && r.transformMatrix ? S(r.transformMatrix, _.parseTransformAttribute(e)) : _.parseTransformAttribute(e) : "visible" === t ? (e = "none" !== e && "hidden" !== e, r && !1 === r.visible && (e = !1)) : "opacity" === t ? (e = parseFloat(e), r && void 0 !== r.opacity && (e *= r.opacity)) : "textAnchor" === t ? e = "start" === e ? "left" : "end" === e ? "right" : "center" : "charSpacing" === t ? n = x(e, g) / g * 1e3 : "paintFirst" === t ? (r = e.indexOf("fill"), t = e.indexOf("stroke"), e = -1 < r && -1 < t && t < r || -1 === r && -1 < t ? "stroke" : "fill") : n = v ? e.map(x) : x(e, g) : e = "", r = !v && isNaN(n) ? e : n, a[o] = r; a && a.font && _.parseFontDeclaration(a.font, a); var y, u = b(s, a); if (_.svgValidParentsRegEx.test(i.nodeName)) return u; var h, l = u; for (h in T) if (void 0 !== l[T[h]] && "" !== l[h]) { if (void 0 === l[h]) { if (!_.Object.prototype[h]) continue; l[h] = _.Object.prototype[h] } 0 !== l[h].indexOf("url(") && (y = new _.Color(l[h]), l[h] = y.setAlpha(w(y.getAlpha() * l[T[h]], 2)).toRgba()) } return l } }, parseElements: function (t, e, i, r, n) { new _.ElementsParser(t, e, i, r, n).parse() }, parseStyleAttribute: function (t) { var e, i, r, n = {}, t = t.getAttribute("style"); if (!t) return n; if ("string" == typeof t) e = n, t.replace(/;\s*$/, "").split(";").forEach(function (t) { t = t.split(":"); i = t[0].trim().toLowerCase(), r = t[1].trim(), e[i] = r }); else { var o, s, a, h = t, l = n; for (a in h) void 0 !== h[a] && (o = a.toLowerCase(), s = h[a], l[o] = s) } return n }, parsePointsAttribute: function (t) { if (!t) return null; for (var e = [], i = 0, r = (t = (t = t.replace(/,/g, " ").trim()).split(/\s+/)).length; i < r; i += 2)e.push({ x: parseFloat(t[i]), y: parseFloat(t[i + 1]) }); return e }, getCSSRules: function (t) { for (var e = t.getElementsByTagName("style"), s = {}, a = 0, h = e.length; a < h; a++) { var i = e[a].textContent || e[a].text; "" !== (i = i.replace(/\/\*[\s\S]*?\*\//g, "")).trim() && i.match(/[^{]*\{[\s\S]*?\}/g).map(function (t) { return t.trim() }).forEach(function (t) { var e = t.match(/([\s\S]*?)\s*\{([^}]*)\}/), i = {}, r = e[2].trim().replace(/;$/, "").split(/\s*;\s*/); for (a = 0, h = r.length; a < h; a++) { var n = r[a].split(/\s*:\s*/), o = n[0], n = n[1]; i[o] = n } (t = e[1]).split(",").forEach(function (t) { "" !== (t = t.replace(/^svg/i, "").trim()) && (s[t] ? _.util.object.extend(s[t], i) : s[t] = _.util.object.clone(i)) }) }) } return s }, loadSVGFromURL: function (t, n, i, r) { t = t.replace(/^\n\s*/, "").trim(), new _.util.request(t, { method: "get", onComplete: function (t) { var e = t.responseXML; e && !e.documentElement && _.window.ActiveXObject && t.responseText && ((e = new ActiveXObject("Microsoft.XMLDOM")).async = "false", e.loadXML(t.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i, ""))); e && e.documentElement || n && n(null); _.parseSVGDocument(e.documentElement, function (t, e, i, r) { n && n(t, e, i, r) }, i, r) } }) }, loadSVGFromString: function (t, n, e, i) { var r, o; t = t.trim(), "undefined" != typeof DOMParser ? (o = new DOMParser) && o.parseFromString && (r = o.parseFromString(t, "text/xml")) : _.window.ActiveXObject && ((r = new ActiveXObject("Microsoft.XMLDOM")).async = "false", r.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i, ""))), _.parseSVGDocument(r.documentElement, function (t, e, i, r) { n(t, e, i, r) }, e, i) } }) }("undefined" != typeof exports ? exports : this), fabric.ElementsParser = function (t, e, i, r, n) { this.elements = t, this.callback = e, this.options = i, this.reviver = r, this.svgUid = i && i.svgUid || 0, this.parsingOptions = n, this.regexUrl = /^url\(['"]?#([^'"]+)['"]?\)/g }, fabric.ElementsParser.prototype.parse = function () { this.instances = new Array(this.elements.length), this.numElements = this.elements.length, this.createObjects() }, fabric.ElementsParser.prototype.createObjects = function () { for (var t = 0, e = this.elements.length; t < e; t++)this.elements[t].setAttribute("svgUid", this.svgUid), function (t, e) { setTimeout(function () { t.createObject(t.elements[e], e) }, 0) }(this, t) }, fabric.ElementsParser.prototype.createObject = function (t, e) { var i = fabric[fabric.util.string.capitalize(t.tagName.replace("svg:", ""))]; if (i && i.fromElement) try { this._createObject(i, t, e) } catch (t) { fabric.log(t) } else this.checkIfDone() }, fabric.ElementsParser.prototype._createObject = function (t, e, i) { t.fromElement(e, this.createCallback(i, e), this.options) }, fabric.ElementsParser.prototype.createCallback = function (i, r) { var n = this; return function (t) { var e; n.resolveGradient(t, "fill"), n.resolveGradient(t, "stroke"), t instanceof fabric.Image && (e = t.parsePreserveAspectRatioAttribute(r)), t._removeTransformMatrix(e), n.reviver && n.reviver(r, t), n.instances[i] = t, n.checkIfDone() } }, fabric.ElementsParser.prototype.resolveGradient = function (t, e) { var i = t[e]; /^url\(/.test(i) && (i = this.regexUrl.exec(i)[1], this.regexUrl.lastIndex = 0, fabric.gradientDefs[this.svgUid][i] && t.set(e, fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][i], t))) }, fabric.ElementsParser.prototype.checkIfDone = function () { 0 == --this.numElements && (this.instances = this.instances.filter(function (t) { return null != t }), this.callback(this.instances, this.elements)) }, function (t) { "use strict"; t = t.fabric || (t.fabric = {}); function i(t, e) { this.x = t, this.y = e } t.Point ? t.warn("fabric.Point is already defined") : (t.Point = i).prototype = { type: "point", constructor: i, add: function (t) { return new i(this.x + t.x, this.y + t.y) }, addEquals: function (t) { return this.x += t.x, this.y += t.y, this }, scalarAdd: function (t) { return new i(this.x + t, this.y + t) }, scalarAddEquals: function (t) { return this.x += t, this.y += t, this }, subtract: function (t) { return new i(this.x - t.x, this.y - t.y) }, subtractEquals: function (t) { return this.x -= t.x, this.y -= t.y, this }, scalarSubtract: function (t) { return new i(this.x - t, this.y - t) }, scalarSubtractEquals: function (t) { return this.x -= t, this.y -= t, this }, multiply: function (t) { return new i(this.x * t, this.y * t) }, multiplyEquals: function (t) { return this.x *= t, this.y *= t, this }, divide: function (t) { return new i(this.x / t, this.y / t) }, divideEquals: function (t) { return this.x /= t, this.y /= t, this }, eq: function (t) { return this.x === t.x && this.y === t.y }, lt: function (t) { return this.x < t.x && this.y < t.y }, lte: function (t) { return this.x <= t.x && this.y <= t.y }, gt: function (t) { return this.x > t.x && this.y > t.y }, gte: function (t) { return this.x >= t.x && this.y >= t.y }, lerp: function (t, e) { return void 0 === e && (e = .5), e = Math.max(Math.min(1, e), 0), new i(this.x + (t.x - this.x) * e, this.y + (t.y - this.y) * e) }, distanceFrom: function (t) { var e = this.x - t.x, t = this.y - t.y; return Math.sqrt(e * e + t * t) }, midPointFrom: function (t) { return this.lerp(t) }, min: function (t) { return new i(Math.min(this.x, t.x), Math.min(this.y, t.y)) }, max: function (t) { return new i(Math.max(this.x, t.x), Math.max(this.y, t.y)) }, toString: function () { return this.x + "," + this.y }, setXY: function (t, e) { return this.x = t, this.y = e, this }, setX: function (t) { return this.x = t, this }, setY: function (t) { return this.y = t, this }, setFromPoint: function (t) { return this.x = t.x, this.y = t.y, this }, swap: function (t) { var e = this.x, i = this.y; this.x = t.x, this.y = t.y, t.x = e, t.y = i }, clone: function () { return new i(this.x, this.y) } } }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var a = t.fabric || (t.fabric = {}); function h(t) { this.status = t, this.points = [] } a.Intersection ? a.warn("fabric.Intersection is already defined") : (a.Intersection = h, a.Intersection.prototype = { constructor: h, appendPoint: function (t) { return this.points.push(t), this }, appendPoints: function (t) { return this.points = this.points.concat(t), this } }, a.Intersection.intersectLineLine = function (t, e, i, r) { var n, o = (r.x - i.x) * (t.y - i.y) - (r.y - i.y) * (t.x - i.x), s = (e.x - t.x) * (t.y - i.y) - (e.y - t.y) * (t.x - i.x), r = (r.y - i.y) * (e.x - t.x) - (r.x - i.x) * (e.y - t.y); return 0 != r ? (i = s / r, 0 <= (r = o / r) && r <= 1 && 0 <= i && i <= 1 ? (n = new h("Intersection")).appendPoint(new a.Point(t.x + r * (e.x - t.x), t.y + r * (e.y - t.y))) : n = new h) : n = new h(0 == o || 0 == s ? "Coincident" : "Parallel"), n }, a.Intersection.intersectLinePolygon = function (t, e, i) { for (var r, n, o = new h, s = i.length, a = 0; a < s; a++)n = i[a], r = i[(a + 1) % s], n = h.intersectLineLine(t, e, n, r), o.appendPoints(n.points); return 0 < o.points.length && (o.status = "Intersection"), o }, a.Intersection.intersectPolygonPolygon = function (t, e) { for (var i = new h, r = t.length, n = 0; n < r; n++) { var o = t[n], s = t[(n + 1) % r], o = h.intersectLinePolygon(o, s, e); i.appendPoints(o.points) } return 0 < i.points.length && (i.status = "Intersection"), i }, a.Intersection.intersectPolygonRectangle = function (t, e, i) { var r = e.min(i), e = e.max(i), i = new a.Point(e.x, r.y), n = new a.Point(r.x, e.y), o = h.intersectLinePolygon(r, i, t), i = h.intersectLinePolygon(i, e, t), e = h.intersectLinePolygon(e, n, t), n = h.intersectLinePolygon(n, r, t), r = new h; return r.appendPoints(o.points), r.appendPoints(i.points), r.appendPoints(e.points), r.appendPoints(n.points), 0 < r.points.length && (r.status = "Intersection"), r }) }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var l = t.fabric || (t.fabric = {}); function a(t) { t ? this._tryParsingColor(t) : this.setSource([0, 0, 0, 1]) } function h(t, e, i) { return i < 0 && (i += 1), 1 < i && --i, i < 1 / 6 ? t + 6 * (e - t) * i : i < .5 ? e : i < 2 / 3 ? t + (e - t) * (2 / 3 - i) * 6 : t } l.Color ? l.warn("fabric.Color is already defined.") : (l.Color = a, l.Color.prototype = { _tryParsingColor: function (t) { var e; (e = (e = (e = (e = (e = "transparent" === (t = t in a.colorNameMap ? a.colorNameMap[t] : t) ? [255, 255, 255, 0] : e) || a.sourceFromHex(t)) || a.sourceFromRgb(t)) || a.sourceFromHsl(t)) || [0, 0, 0, 1]) && this.setSource(e) }, _rgbToHsl: function (t, e, i) { var r, n = l.util.array.max([t /= 255, e /= 255, i /= 255]), o = l.util.array.min([t, e, i]), s = (n + o) / 2; if (n === o) r = h = 0; else { var a = n - o, h = .5 < s ? a / (2 - n - o) : a / (n + o); switch (n) { case t: r = (e - i) / a + (e < i ? 6 : 0); break; case e: r = (i - t) / a + 2; break; case i: r = (t - e) / a + 4 }r /= 6 } return [Math.round(360 * r), Math.round(100 * h), Math.round(100 * s)] }, getSource: function () { return this._source }, setSource: function (t) { this._source = t }, toRgb: function () { var t = this.getSource(); return "rgb(" + t[0] + "," + t[1] + "," + t[2] + ")" }, toRgba: function () { var t = this.getSource(); return "rgba(" + t[0] + "," + t[1] + "," + t[2] + "," + t[3] + ")" }, toHsl: function () { var t = this.getSource(), t = this._rgbToHsl(t[0], t[1], t[2]); return "hsl(" + t[0] + "," + t[1] + "%," + t[2] + "%)" }, toHsla: function () { var t = this.getSource(), e = this._rgbToHsl(t[0], t[1], t[2]); return "hsla(" + e[0] + "," + e[1] + "%," + e[2] + "%," + t[3] + ")" }, toHex: function () { var t, e = this.getSource(), i = e[0].toString(16); return i = 1 === i.length ? "0" + i : i, t = 1 === (t = e[1].toString(16)).length ? "0" + t : t, e = 1 === (e = e[2].toString(16)).length ? "0" + e : e, i.toUpperCase() + t.toUpperCase() + e.toUpperCase() }, toHexa: function () { var t = this.getSource(), t = Math.round(255 * t[3]); return t = 1 === (t = t.toString(16)).length ? "0" + t : t, this.toHex() + t.toUpperCase() }, getAlpha: function () { return this.getSource()[3] }, setAlpha: function (t) { var e = this.getSource(); return e[3] = t, this.setSource(e), this }, toGrayscale: function () { var t = this.getSource(), e = parseInt((.3 * t[0] + .59 * t[1] + .11 * t[2]).toFixed(0), 10), t = t[3]; return this.setSource([e, e, e, t]), this }, toBlackWhite: function (t) { var e = this.getSource(), i = (.3 * e[0] + .59 * e[1] + .11 * e[2]).toFixed(0), e = e[3]; return t = t || 127, i = Number(i) < Number(t) ? 0 : 255, this.setSource([i, i, i, e]), this }, overlayWith: function (t) { t instanceof a || (t = new a(t)); for (var e = [], i = this.getAlpha(), r = this.getSource(), n = t.getSource(), o = 0; o < 3; o++)e.push(Math.round(.5 * r[o] + .5 * n[o])); return e[3] = i, this.setSource(e), this } }, l.Color.reRGBa = /^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/, l.Color.reHSLa = /^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/, l.Color.reHex = /^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i, l.Color.colorNameMap = { aliceblue: "#F0F8FF", antiquewhite: "#FAEBD7", aqua: "#00FFFF", aquamarine: "#7FFFD4", azure: "#F0FFFF", beige: "#F5F5DC", bisque: "#FFE4C4", black: "#000000", blanchedalmond: "#FFEBCD", blue: "#0000FF", blueviolet: "#8A2BE2", brown: "#A52A2A", burlywood: "#DEB887", cadetblue: "#5F9EA0", chartreuse: "#7FFF00", chocolate: "#D2691E", coral: "#FF7F50", cornflowerblue: "#6495ED", cornsilk: "#FFF8DC", crimson: "#DC143C", cyan: "#00FFFF", darkblue: "#00008B", darkcyan: "#008B8B", darkgoldenrod: "#B8860B", darkgray: "#A9A9A9", darkgrey: "#A9A9A9", darkgreen: "#006400", darkkhaki: "#BDB76B", darkmagenta: "#8B008B", darkolivegreen: "#556B2F", darkorange: "#FF8C00", darkorchid: "#9932CC", darkred: "#8B0000", darksalmon: "#E9967A", darkseagreen: "#8FBC8F", darkslateblue: "#483D8B", darkslategray: "#2F4F4F", darkslategrey: "#2F4F4F", darkturquoise: "#00CED1", darkviolet: "#9400D3", deeppink: "#FF1493", deepskyblue: "#00BFFF", dimgray: "#696969", dimgrey: "#696969", dodgerblue: "#1E90FF", firebrick: "#B22222", floralwhite: "#FFFAF0", forestgreen: "#228B22", fuchsia: "#FF00FF", gainsboro: "#DCDCDC", ghostwhite: "#F8F8FF", gold: "#FFD700", goldenrod: "#DAA520", gray: "#808080", grey: "#808080", green: "#008000", greenyellow: "#ADFF2F", honeydew: "#F0FFF0", hotpink: "#FF69B4", indianred: "#CD5C5C", indigo: "#4B0082", ivory: "#FFFFF0", khaki: "#F0E68C", lavender: "#E6E6FA", lavenderblush: "#FFF0F5", lawngreen: "#7CFC00", lemonchiffon: "#FFFACD", lightblue: "#ADD8E6", lightcoral: "#F08080", lightcyan: "#E0FFFF", lightgoldenrodyellow: "#FAFAD2", lightgray: "#D3D3D3", lightgrey: "#D3D3D3", lightgreen: "#90EE90", lightpink: "#FFB6C1", lightsalmon: "#FFA07A", lightseagreen: "#20B2AA", lightskyblue: "#87CEFA", lightslategray: "#778899", lightslategrey: "#778899", lightsteelblue: "#B0C4DE", lightyellow: "#FFFFE0", lime: "#00FF00", limegreen: "#32CD32", linen: "#FAF0E6", magenta: "#FF00FF", maroon: "#800000", mediumaquamarine: "#66CDAA", mediumblue: "#0000CD", mediumorchid: "#BA55D3", mediumpurple: "#9370DB", mediumseagreen: "#3CB371", mediumslateblue: "#7B68EE", mediumspringgreen: "#00FA9A", mediumturquoise: "#48D1CC", mediumvioletred: "#C71585", midnightblue: "#191970", mintcream: "#F5FFFA", mistyrose: "#FFE4E1", moccasin: "#FFE4B5", navajowhite: "#FFDEAD", navy: "#000080", oldlace: "#FDF5E6", olive: "#808000", olivedrab: "#6B8E23", orange: "#FFA500", orangered: "#FF4500", orchid: "#DA70D6", palegoldenrod: "#EEE8AA", palegreen: "#98FB98", paleturquoise: "#AFEEEE", palevioletred: "#DB7093", papayawhip: "#FFEFD5", peachpuff: "#FFDAB9", peru: "#CD853F", pink: "#FFC0CB", plum: "#DDA0DD", powderblue: "#B0E0E6", purple: "#800080", rebeccapurple: "#663399", red: "#FF0000", rosybrown: "#BC8F8F", royalblue: "#4169E1", saddlebrown: "#8B4513", salmon: "#FA8072", sandybrown: "#F4A460", seagreen: "#2E8B57", seashell: "#FFF5EE", sienna: "#A0522D", silver: "#C0C0C0", skyblue: "#87CEEB", slateblue: "#6A5ACD", slategray: "#708090", slategrey: "#708090", snow: "#FFFAFA", springgreen: "#00FF7F", steelblue: "#4682B4", tan: "#D2B48C", teal: "#008080", thistle: "#D8BFD8", tomato: "#FF6347", turquoise: "#40E0D0", violet: "#EE82EE", wheat: "#F5DEB3", white: "#FFFFFF", whitesmoke: "#F5F5F5", yellow: "#FFFF00", yellowgreen: "#9ACD32" }, l.Color.fromRgb = function (t) { return a.fromSource(a.sourceFromRgb(t)) }, l.Color.sourceFromRgb = function (t) { var e, i, r, t = t.match(a.reRGBa); if (t) return e = parseInt(t[1], 10) / (/%$/.test(t[1]) ? 100 : 1) * (/%$/.test(t[1]) ? 255 : 1), i = parseInt(t[2], 10) / (/%$/.test(t[2]) ? 100 : 1) * (/%$/.test(t[2]) ? 255 : 1), r = parseInt(t[3], 10) / (/%$/.test(t[3]) ? 100 : 1) * (/%$/.test(t[3]) ? 255 : 1), [parseInt(e, 10), parseInt(i, 10), parseInt(r, 10), t[4] ? parseFloat(t[4]) : 1] }, l.Color.fromRgba = a.fromRgb, l.Color.fromHsl = function (t) { return a.fromSource(a.sourceFromHsl(t)) }, l.Color.sourceFromHsl = function (t) { var e, i, r, n, o, s, t = t.match(a.reHSLa); if (t) return e = (parseFloat(t[1]) % 360 + 360) % 360 / 360, r = parseFloat(t[2]) / (/%$/.test(t[2]) ? 100 : 1), i = parseFloat(t[3]) / (/%$/.test(t[3]) ? 100 : 1), 0 == r ? n = o = s = i : (n = h(r = 2 * i - (i = i <= .5 ? i * (1 + r) : i + r - i * r), i, e + 1 / 3), o = h(r, i, e), s = h(r, i, e - 1 / 3)), [Math.round(255 * n), Math.round(255 * o), Math.round(255 * s), t[4] ? parseFloat(t[4]) : 1] }, l.Color.fromHsla = a.fromHsl, l.Color.fromHex = function (t) { return a.fromSource(a.sourceFromHex(t)) }, l.Color.sourceFromHex = function (t) { var e, i, r, n, o; if (t.match(a.reHex)) return e = 3 === (t = t.slice(t.indexOf("#") + 1)).length || 4 === t.length, o = 8 === t.length || 4 === t.length, i = e ? t.charAt(0) + t.charAt(0) : t.substring(0, 2), r = e ? t.charAt(1) + t.charAt(1) : t.substring(2, 4), n = e ? t.charAt(2) + t.charAt(2) : t.substring(4, 6), o = o ? e ? t.charAt(3) + t.charAt(3) : t.substring(6, 8) : "FF", [parseInt(i, 16), parseInt(r, 16), parseInt(n, 16), parseFloat((parseInt(o, 16) / 255).toFixed(2))] }, l.Color.fromSource = function (t) { var e = new a; return e.setSource(t), e }) }("undefined" != typeof exports ? exports : this), function () { var f = fabric.util.object.clone; function l(t, e, i) { var r, n, o, s = 0, a = 1, h = ""; for (n in e) "Infinity" === e[n] ? e[n] = 1 : "-Infinity" === e[n] && (e[n] = 0), r = parseFloat(e[n], 10), a = "string" == typeof e[n] && /^(\d+\.\d+)%|(\d+)%$/.test(e[n]) ? .01 : 1, "x1" === n || "x2" === n || "r2" === n ? (a *= "objectBoundingBox" === i ? t.width : 1, s = "objectBoundingBox" === i && t.left || 0) : "y1" !== n && "y2" !== n || (a *= "objectBoundingBox" === i ? t.height : 1, s = "objectBoundingBox" === i && t.top || 0), e[n] = r * a + s; return "ellipse" === t.type && null !== e.r2 && "objectBoundingBox" === i && t.rx !== t.ry && (h = " scale(1, " + (o = t.ry / t.rx) + ")", e.y1 && (e.y1 /= o), e.y2 && (e.y2 /= o)), h } fabric.Gradient = fabric.util.createClass({ offsetX: 0, offsetY: 0, initialize: function (t) { t = t || {}; var e = {}; this.id = fabric.Object.__uid++, this.type = t.type || "linear", e = { x1: t.coords.x1 || 0, y1: t.coords.y1 || 0, x2: t.coords.x2 || 0, y2: t.coords.y2 || 0 }, "radial" === this.type && (e.r1 = t.coords.r1 || 0, e.r2 = t.coords.r2 || 0), this.coords = e, this.colorStops = t.colorStops.slice(), t.gradientTransform && (this.gradientTransform = t.gradientTransform), this.offsetX = t.offsetX || this.offsetX, this.offsetY = t.offsetY || this.offsetY }, addColorStop: function (t) { for (var e in t) { var i = new fabric.Color(t[e]); this.colorStops.push({ offset: parseFloat(e), color: i.toRgb(), opacity: i.getAlpha() }) } return this }, toObject: function (t) { var e = { type: this.type, coords: this.coords, colorStops: this.colorStops, offsetX: this.offsetX, offsetY: this.offsetY, gradientTransform: this.gradientTransform && this.gradientTransform.concat() }; return fabric.util.populateWithProperties(this, e, t), e }, toSVG: function (t) { var e, i, r = f(this.coords, !0), n = f(this.colorStops, !0), o = r.r1 > r.r2, s = t.width / 2, u = t.height / 2; for (i in n.sort(function (t, e) { return t.offset - e.offset }), "path" === t.type && (s -= t.pathOffset.x, u -= t.pathOffset.y), r) "x1" === i || "x2" === i ? r[i] += this.offsetX - s : "y1" !== i && "y2" !== i || (r[i] += this.offsetY - u); if (t = 'id="SVGID_' + this.id + '" gradientUnits="userSpaceOnUse"', this.gradientTransform && (t += ' gradientTransform="matrix(' + this.gradientTransform.join(" ") + ')" '), "linear" === this.type ? e = ["<linearGradient ", t, ' x1="', r.x1, '" y1="', r.y1, '" x2="', r.x2, '" y2="', r.y2, '">\n'] : "radial" === this.type && (e = ["<radialGradient ", t, ' cx="', o ? r.x1 : r.x2, '" cy="', o ? r.y1 : r.y2, '" r="', o ? r.r1 : r.r2, '" fx="', o ? r.x2 : r.x1, '" fy="', o ? r.y2 : r.y1, '">\n']), "radial" === this.type) { if (o) for ((n = n.concat()).reverse(), a = 0, h = n.length; a < h; a++)n[a].offset = 1 - n[a].offset; t = Math.min(r.r1, r.r2); if (0 < t) for (var c = t / Math.max(r.r1, r.r2), a = 0, h = n.length; a < h; a++)n[a].offset += c * (1 - n[a].offset) } for (a = 0, h = n.length; a < h; a++) { var l = n[a]; e.push("<stop ", 'offset="', 100 * l.offset + "%", '" style="stop-color:', l.color, void 0 !== l.opacity ? ";stop-opacity: " + l.opacity : ";", '"/>\n') } return e.push("linear" === this.type ? "</linearGradient>\n" : "</radialGradient>\n"), e.join("") }, toLive: function (t) { var e, i, r, n = fabric.util.object.clone(this.coords); if (this.type) { for ("linear" === this.type ? e = t.createLinearGradient(n.x1, n.y1, n.x2, n.y2) : "radial" === this.type && (e = t.createRadialGradient(n.x1, n.y1, n.r1, n.x2, n.y2, n.r2)), i = 0, r = this.colorStops.length; i < r; i++) { var o = this.colorStops[i].color, s = this.colorStops[i].opacity, a = this.colorStops[i].offset; void 0 !== s && (o = new fabric.Color(o).setAlpha(s).toRgba()), e.addColorStop(a, o) } return e } } }), fabric.util.object.extend(fabric.Gradient, { fromElement: function (t, e) { var i, r, n = t.getElementsByTagName("stop"), o = t.getAttribute("gradientUnits") || "objectBoundingBox", s = t.getAttribute("gradientTransform"), a = [], h = "linearGradient" === t.nodeName || "LINEARGRADIENT" === t.nodeName ? "linear" : "radial"; for ("linear" === h ? r = { x1: (r = t).getAttribute("x1") || 0, y1: r.getAttribute("y1") || 0, x2: r.getAttribute("x2") || "100%", y2: r.getAttribute("y2") || 0 } : "radial" === h && (r = { x1: (t = t).getAttribute("fx") || t.getAttribute("cx") || "50%", y1: t.getAttribute("fy") || t.getAttribute("cy") || "50%", r1: 0, x2: t.getAttribute("cx") || "50%", y2: t.getAttribute("cy") || "50%", r2: t.getAttribute("r") || "50%" }), i = n.length; i--;)a.push(function (t) { var e, i, r, n = t.getAttribute("style"), o = t.getAttribute("offset") || 0; if (o = (o = parseFloat(o) / (/%$/.test(o) ? 100 : 1)) < 0 ? 0 : 1 < o ? 1 : o, n) { var s = n.split(/\s*;\s*/); for ("" === s[s.length - 1] && s.pop(), r = s.length; r--;) { var a = s[r].split(/\s*:\s*/), h = a[0].trim(), a = a[1].trim(); "stop-color" === h ? e = a : "stop-opacity" === h && (i = a) } } return e = e || (t.getAttribute("stop-color") || "rgb(0,0,0)"), i = i || t.getAttribute("stop-opacity"), n = (e = new fabric.Color(e)).getAlpha(), i = isNaN(parseFloat(i)) ? 1 : parseFloat(i), i *= n, { offset: o, color: e.toRgb(), opacity: i } }(n[i])); t = l(e, r, o), o = new fabric.Gradient({ type: h, coords: r, colorStops: a, offsetX: -e.left, offsetY: -e.top }); return !s && "" === t || (o.gradientTransform = fabric.parseTransformAttribute((s || "") + t)), o }, forObject: function (t, e) { return l(t, (e = e || {}).coords, "userSpaceOnUse"), new fabric.Gradient(e) } }) }(), function () { "use strict"; var r = fabric.util.toFixed; fabric.Pattern = fabric.util.createClass({ repeat: "repeat", offsetX: 0, offsetY: 0, crossOrigin: "", patternTransform: null, initialize: function (t, e) { var i; t = t || {}, this.id = fabric.Object.__uid++, this.setOptions(t), !t.source || t.source && "string" != typeof t.source ? e && e(this) : void 0 !== fabric.util.getFunctionBody(t.source) ? (this.source = new Function(fabric.util.getFunctionBody(t.source)), e && e(this)) : ((i = this).source = fabric.util.createImage(), fabric.util.loadImage(t.source, function (t) { i.source = t, e && e(i) }, null, this.crossOrigin)) }, toObject: function (t) { var e, i = fabric.Object.NUM_FRACTION_DIGITS; return "function" == typeof this.source ? e = String(this.source) : "string" == typeof this.source.src ? e = this.source.src : "object" == typeof this.source && this.source.toDataURL && (e = this.source.toDataURL()), e = { type: "pattern", source: e, repeat: this.repeat, crossOrigin: this.crossOrigin, offsetX: r(this.offsetX, i), offsetY: r(this.offsetY, i), patternTransform: this.patternTransform ? this.patternTransform.concat() : null }, fabric.util.populateWithProperties(this, e, t), e }, toSVG: function (t) { var e = "function" == typeof this.source ? this.source() : this.source, i = e.width / t.width, r = e.height / t.height, n = this.offsetX / t.width, t = this.offsetY / t.height, o = ""; return "repeat-x" !== this.repeat && "no-repeat" !== this.repeat || (r = 1), "repeat-y" !== this.repeat && "no-repeat" !== this.repeat || (i = 1), e.src ? o = e.src : e.toDataURL && (o = e.toDataURL()), '<pattern id="SVGID_' + this.id + '" x="' + n + '" y="' + t + '" width="' + i + '" height="' + r + '">\n<image x="0" y="0" width="' + e.width + '" height="' + e.height + '" xlink:href="' + o + '"></image>\n</pattern>\n' }, setOptions: function (t) { for (var e in t) this[e] = t[e] }, toLive: function (t) { var e = "function" == typeof this.source ? this.source() : this.source; if (!e) return ""; if (void 0 !== e.src) { if (!e.complete) return ""; if (0 === e.naturalWidth || 0 === e.naturalHeight) return "" } return t.createPattern(e, this.repeat) } }) }(), function (t) { "use strict"; var s = t.fabric || (t.fabric = {}), a = s.util.toFixed; s.Shadow ? s.warn("fabric.Shadow is already defined.") : (s.Shadow = s.util.createClass({ color: "rgb(0,0,0)", blur: 0, offsetX: 0, offsetY: 0, affectStroke: !1, includeDefaultValues: !0, initialize: function (t) { for (var e in t = "string" == typeof t ? this._parseShadow(t) : t) this[e] = t[e]; this.id = s.Object.__uid++ }, _parseShadow: function (t) { var t = t.trim(), e = s.Shadow.reOffsetsAndBlur.exec(t) || []; return { color: (t.replace(s.Shadow.reOffsetsAndBlur, "") || "rgb(0,0,0)").trim(), offsetX: parseInt(e[1], 10) || 0, offsetY: parseInt(e[2], 10) || 0, blur: parseInt(e[3], 10) || 0 } }, toString: function () { return [this.offsetX, this.offsetY, this.blur, this.color].join("px ") }, toSVG: function (t) { var e = 40, i = 40, r = s.Object.NUM_FRACTION_DIGITS, n = s.util.rotateVector({ x: this.offsetX, y: this.offsetY }, s.util.degreesToRadians(-t.angle)), o = new s.Color(this.color); return t.width && t.height && (e = 100 * a((Math.abs(n.x) + this.blur) / t.width, r) + 20, i = 100 * a((Math.abs(n.y) + this.blur) / t.height, r) + 20), t.flipX && (n.x *= -1), t.flipY && (n.y *= -1), '<filter id="SVGID_' + this.id + '" y="-' + i + '%" height="' + (100 + 2 * i) + '%" x="-' + e + '%" width="' + (100 + 2 * e) + '%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="' + a(this.blur ? this.blur / 2 : 0, r) + '"></feGaussianBlur>\n\t<feOffset dx="' + a(n.x, r) + '" dy="' + a(n.y, r) + '" result="oBlur" ></feOffset>\n\t<feFlood flood-color="' + o.toRgb() + '" flood-opacity="' + o.getAlpha() + '"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n' }, toObject: function () { if (this.includeDefaultValues) return { color: this.color, blur: this.blur, offsetX: this.offsetX, offsetY: this.offsetY, affectStroke: this.affectStroke }; var e = {}, i = s.Shadow.prototype; return ["color", "blur", "offsetX", "offsetY", "affectStroke"].forEach(function (t) { this[t] !== i[t] && (e[t] = this[t]) }, this), e } }), s.Shadow.reOffsetsAndBlur = /(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/) }("undefined" != typeof exports ? exports : this), function () { "use strict"; var r, t, l, s, n, o, e; fabric.StaticCanvas ? fabric.warn("fabric.StaticCanvas is already defined.") : (r = fabric.util.object.extend, t = fabric.util.getElementOffset, l = fabric.util.removeFromArray, s = fabric.util.toFixed, n = fabric.util.transformPoint, o = fabric.util.invertTransform, e = new Error("Could not initialize `canvas` element"), fabric.StaticCanvas = fabric.util.createClass(fabric.CommonMethods, { initialize: function (t, e) { e = e || {}, this.renderAndResetBound = this.renderAndReset.bind(this), this.requestRenderAllBound = this.requestRenderAll.bind(this), this._initStatic(t, e) }, backgroundColor: "", backgroundImage: null, overlayColor: "", overlayImage: null, includeDefaultValues: !0, stateful: !1, renderOnAddRemove: !0, clipTo: null, controlsAboveOverlay: !1, allowTouchScrolling: !1, imageSmoothingEnabled: !0, viewportTransform: fabric.iMatrix.concat(), backgroundVpt: !0, overlayVpt: !0, onBeforeScaleRotate: function () { }, enableRetinaScaling: !0, vptCoords: {}, skipOffscreen: !0, _initStatic: function (t, e) { var i = this.requestRenderAllBound; this._objects = [], this._createLowerCanvas(t), this._initOptions(e), this._setImageSmoothing(), this.interactive || this._initRetinaScaling(), e.overlayImage && this.setOverlayImage(e.overlayImage, i), e.backgroundImage && this.setBackgroundImage(e.backgroundImage, i), e.backgroundColor && this.setBackgroundColor(e.backgroundColor, i), e.overlayColor && this.setOverlayColor(e.overlayColor, i), this.calcOffset() }, _isRetinaScaling: function () { return 1 !== fabric.devicePixelRatio && this.enableRetinaScaling }, getRetinaScaling: function () { return this._isRetinaScaling() ? fabric.devicePixelRatio : 1 }, _initRetinaScaling: function () { this._isRetinaScaling() && (this.lowerCanvasEl.setAttribute("width", this.width * fabric.devicePixelRatio), this.lowerCanvasEl.setAttribute("height", this.height * fabric.devicePixelRatio), this.contextContainer.scale(fabric.devicePixelRatio, fabric.devicePixelRatio)) }, calcOffset: function () { return this._offset = t(this.lowerCanvasEl), this }, setOverlayImage: function (t, e, i) { return this.__setBgOverlayImage("overlayImage", t, e, i) }, setBackgroundImage: function (t, e, i) { return this.__setBgOverlayImage("backgroundImage", t, e, i) }, setOverlayColor: function (t, e) { return this.__setBgOverlayColor("overlayColor", t, e) }, setBackgroundColor: function (t, e) { return this.__setBgOverlayColor("backgroundColor", t, e) }, _setImageSmoothing: function () { var t = this.getContext(); t.imageSmoothingEnabled = t.imageSmoothingEnabled || t.webkitImageSmoothingEnabled || t.mozImageSmoothingEnabled || t.msImageSmoothingEnabled || t.oImageSmoothingEnabled, t.imageSmoothingEnabled = this.imageSmoothingEnabled }, __setBgOverlayImage: function (e, t, i, r) { return "string" == typeof t ? fabric.util.loadImage(t, function (t) { t && (this[e] = new fabric.Image(t, r)), i && i(t) }, this, r && r.crossOrigin) : (r && t.setOptions(r), this[e] = t, i && i(t)), this }, __setBgOverlayColor: function (t, e, i) { return this[t] = e, this._initGradient(e, t), this._initPattern(e, t, i), this }, _createCanvasElement: function () { var t = fabric.util.createCanvasElement(); if (!t) throw e; if (t.style || (t.style = {}), void 0 === t.getContext) throw e; return t }, _initOptions: function (t) { this._setOptions(t), this.width = this.width || parseInt(this.lowerCanvasEl.width, 10) || 0, this.height = this.height || parseInt(this.lowerCanvasEl.height, 10) || 0, this.lowerCanvasEl.style && (this.lowerCanvasEl.width = this.width, this.lowerCanvasEl.height = this.height, this.lowerCanvasEl.style.width = this.width + "px", this.lowerCanvasEl.style.height = this.height + "px", this.viewportTransform = this.viewportTransform.slice()) }, _createLowerCanvas: function (t) { t && t.getContext ? this.lowerCanvasEl = t : this.lowerCanvasEl = fabric.util.getById(t) || this._createCanvasElement(), fabric.util.addClass(this.lowerCanvasEl, "lower-canvas"), this.interactive && this._applyCanvasStyle(this.lowerCanvasEl), this.contextContainer = this.lowerCanvasEl.getContext("2d") }, getWidth: function () { return this.width }, getHeight: function () { return this.height }, setWidth: function (t, e) { return this.setDimensions({ width: t }, e) }, setHeight: function (t, e) { return this.setDimensions({ height: t }, e) }, setDimensions: function (t, e) { var i, r; for (r in e = e || {}, t) i = t[r], e.cssOnly || (this._setBackstoreDimension(r, t[r]), i += "px", this.hasLostContext = !0), e.backstoreOnly || this._setCssDimension(r, i); return this._isCurrentlyDrawing && this.freeDrawingBrush && this.freeDrawingBrush._setBrushStyles(), this._initRetinaScaling(), this._setImageSmoothing(), this.calcOffset(), e.cssOnly || this.requestRenderAll(), this }, _setBackstoreDimension: function (t, e) { return this.lowerCanvasEl[t] = e, this.upperCanvasEl && (this.upperCanvasEl[t] = e), this.cacheCanvasEl && (this.cacheCanvasEl[t] = e), this[t] = e, this }, _setCssDimension: function (t, e) { return this.lowerCanvasEl.style[t] = e, this.upperCanvasEl && (this.upperCanvasEl.style[t] = e), this.wrapperEl && (this.wrapperEl.style[t] = e), this }, getZoom: function () { return this.viewportTransform[0] }, setViewportTransform: function (t) { var e, i, r, n = this._activeObject; for (this.viewportTransform = t, i = 0, r = this._objects.length; i < r; i++)(e = this._objects[i]).group || e.setCoords(!1, !0); return n && "activeSelection" === n.type && n.setCoords(!1, !0), this.calcViewportBoundaries(), this.renderOnAddRemove && this.requestRenderAll(), this }, zoomToPoint: function (t, e) { var i = t, r = this.viewportTransform.slice(0), e = (t = n(t, o(this.viewportTransform)), r[0] = e, r[3] = e, n(t, r)); return r[4] += i.x - e.x, r[5] += i.y - e.y, this.setViewportTransform(r) }, setZoom: function (t) { return this.zoomToPoint(new fabric.Point(0, 0), t), this }, absolutePan: function (t) { var e = this.viewportTransform.slice(0); return e[4] = -t.x, e[5] = -t.y, this.setViewportTransform(e) }, relativePan: function (t) { return this.absolutePan(new fabric.Point(-t.x - this.viewportTransform[4], -t.y - this.viewportTransform[5])) }, getElement: function () { return this.lowerCanvasEl }, _onObjectAdded: function (t) { this.stateful && t.setupState(), t._set("canvas", this), t.setCoords(), this.fire("object:added", { target: t }), t.fire("added") }, _onObjectRemoved: function (t) { this.fire("object:removed", { target: t }), t.fire("removed"), delete t.canvas }, clearContext: function (t) { return t.clearRect(0, 0, this.width, this.height), this }, getContext: function () { return this.contextContainer }, clear: function () { return this._objects.length = 0, this.backgroundImage = null, this.overlayImage = null, this.backgroundColor = "", this.overlayColor = "", this._hasITextHandlers && (this.off("mouse:up", this._mouseUpITextHandler), this._iTextInstances = null, this._hasITextHandlers = !1), this.clearContext(this.contextContainer), this.fire("canvas:cleared"), this.renderOnAddRemove && this.requestRenderAll(), this }, renderAll: function () { var t = this.contextContainer; return this.renderCanvas(t, this._objects), this }, renderAndReset: function () { this.isRendering = 0, this.renderAll() }, requestRenderAll: function () { return this.isRendering || (this.isRendering = fabric.util.requestAnimFrame(this.renderAndResetBound)), this }, calcViewportBoundaries: function () { var t = {}, e = this.width, i = this.height, r = o(this.viewportTransform); return t.tl = n({ x: 0, y: 0 }, r), t.br = n({ x: e, y: i }, r), t.tr = new fabric.Point(t.br.x, t.tl.y), t.bl = new fabric.Point(t.tl.x, t.br.y), this.vptCoords = t }, renderCanvas: function (t, e) { var i = this.viewportTransform; this.isRendering && (fabric.util.cancelAnimFrame(this.isRendering), this.isRendering = 0), this.calcViewportBoundaries(), this.clearContext(t), this.fire("before:render"), this.clipTo && fabric.util.clipContext(this, t), this._renderBackground(t), t.save(), t.transform(i[0], i[1], i[2], i[3], i[4], i[5]), this._renderObjects(t, e), t.restore(), !this.controlsAboveOverlay && this.interactive && this.drawControls(t), this.clipTo && t.restore(), this._renderOverlay(t), this.controlsAboveOverlay && this.interactive && this.drawControls(t), this.fire("after:render") }, _renderObjects: function (t, e) { for (var i = 0, r = e.length; i < r; ++i)e[i] && e[i].render(t) }, _renderBackgroundOrOverlay: function (t, e) { var i, r = this[e + "Color"]; r && (t.fillStyle = r.toLive ? r.toLive(t, this) : r, t.fillRect(r.offsetX || 0, r.offsetY || 0, this.width, this.height)), (r = this[e + "Image"]) && (this[e + "Vpt"] && (i = this.viewportTransform, t.save(), t.transform(i[0], i[1], i[2], i[3], i[4], i[5])), r.render(t), this[e + "Vpt"] && t.restore()) }, _renderBackground: function (t) { this._renderBackgroundOrOverlay(t, "background") }, _renderOverlay: function (t) { this._renderBackgroundOrOverlay(t, "overlay") }, getCenter: function () { return { top: this.height / 2, left: this.width / 2 } }, centerObjectH: function (t) { return this._centerObject(t, new fabric.Point(this.getCenter().left, t.getCenterPoint().y)) }, centerObjectV: function (t) { return this._centerObject(t, new fabric.Point(t.getCenterPoint().x, this.getCenter().top)) }, centerObject: function (t) { var e = this.getCenter(); return this._centerObject(t, new fabric.Point(e.left, e.top)) }, viewportCenterObject: function (t) { var e = this.getVpCenter(); return this._centerObject(t, e) }, viewportCenterObjectH: function (t) { var e = this.getVpCenter(); return this._centerObject(t, new fabric.Point(e.x, t.getCenterPoint().y)), this }, viewportCenterObjectV: function (t) { var e = this.getVpCenter(); return this._centerObject(t, new fabric.Point(t.getCenterPoint().x, e.y)) }, getVpCenter: function () { var t = this.getCenter(), e = o(this.viewportTransform); return n({ x: t.left, y: t.top }, e) }, _centerObject: function (t, e) { return t.setPositionByOrigin(e, "center", "center"), t.setCoords(), this.renderOnAddRemove && this.requestRenderAll(), this }, toDatalessJSON: function (t) { return this.toDatalessObject(t) }, toObject: function (t) { return this._toObjectMethod("toObject", t) }, toDatalessObject: function (t) { return this._toObjectMethod("toDatalessObject", t) }, _toObjectMethod: function (t, e) { var i = { version: fabric.version, objects: this._toObjects(t, e) }; return r(i, this.__serializeBgOverlay(t, e)), fabric.util.populateWithProperties(this, i, e), i }, _toObjects: function (e, i) { return this.getObjects().filter(function (t) { return !t.excludeFromExport }).map(function (t) { return this._toObject(t, e, i) }, this) }, _toObject: function (t, e, i) { this.includeDefaultValues || (r = t.includeDefaultValues, t.includeDefaultValues = !1); var r, e = t[e](i); return this.includeDefaultValues || (t.includeDefaultValues = r), e }, __serializeBgOverlay: function (t, e) { var i = {}, r = this.backgroundImage, n = this.overlayImage; return this.backgroundColor && (i.background = this.backgroundColor.toObject ? this.backgroundColor.toObject(e) : this.backgroundColor), this.overlayColor && (i.overlay = this.overlayColor.toObject ? this.overlayColor.toObject(e) : this.overlayColor), r && !r.excludeFromExport && (i.backgroundImage = this._toObject(r, t, e)), n && !n.excludeFromExport && (i.overlayImage = this._toObject(n, t, e)), i }, svgViewportTransformation: !0, toSVG: function (t, e) { var i = []; return this._setSVGPreamble(i, t = t || {}), this._setSVGHeader(i, t), this._setSVGBgOverlayColor(i, "backgroundColor"), this._setSVGBgOverlayImage(i, "backgroundImage", e), this._setSVGObjects(i, e), this._setSVGBgOverlayColor(i, "overlayColor"), this._setSVGBgOverlayImage(i, "overlayImage", e), i.push("</svg>"), i.join("") }, _setSVGPreamble: function (t, e) { e.suppressPreamble || t.push('<?xml version="1.0" encoding="', e.encoding || "UTF-8", '" standalone="no" ?>\n', '<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ', '"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n') }, _setSVGHeader: function (t, e) { var i = e.width || this.width, r = e.height || this.height, n = 'viewBox="0 0 ' + this.width + " " + this.height + '" ', o = fabric.Object.NUM_FRACTION_DIGITS; e.viewBox ? n = 'viewBox="' + e.viewBox.x + " " + e.viewBox.y + " " + e.viewBox.width + " " + e.viewBox.height + '" ' : this.svgViewportTransformation && (e = this.viewportTransform, n = 'viewBox="' + s(-e[4] / e[0], o) + " " + s(-e[5] / e[3], o) + " " + s(this.width / e[0], o) + " " + s(this.height / e[3], o) + '" '), t.push("<svg ", 'xmlns="http://www.w3.org/2000/svg" ', 'xmlns:xlink="http://www.w3.org/1999/xlink" ', 'version="1.1" ', 'width="', i, '" ', 'height="', r, '" ', n, 'xml:space="preserve">\n', "<desc>Created with Fabric.js ", fabric.version, "</desc>\n", "<defs>\n", this.createSVGFontFacesMarkup(), this.createSVGRefElementsMarkup(), "</defs>\n") }, createSVGRefElementsMarkup: function () { var e = this; return ["backgroundColor", "overlayColor"].map(function (t) { t = e[t]; if (t && t.toLive) return t.toSVG(e, !1) }).join("") }, createSVGFontFacesMarkup: function () { for (var t, e, i, r, n, u, o, s = "", a = {}, h = fabric.fontPaths, c = this.getObjects(), l = 0, f = c.length; l < f; l++)if (e = (t = c[l]).fontFamily, -1 !== t.type.indexOf("text") && !a[e] && h[e] && (a[e] = !0, t.styles)) for (n in i = t.styles) for (u in r = i[n]) !a[e = r[u].fontFamily] && h[e] && (a[e] = !0); for (o in a) s += ["\t\t@font-face {\n", "\t\t\tfont-family: '", o, "';\n", "\t\t\tsrc: url('", h[o], "');\n", "\t\t}\n"].join(""); return s = s && ['\t<style type="text/css">', "<![CDATA[\n", s, "]]>", "</style>\n"].join("") }, _setSVGObjects: function (t, e) { for (var i, r = this.getObjects(), n = 0, o = r.length; n < o; n++)(i = r[n]).excludeFromExport || this._setSVGObject(t, i, e) }, _setSVGObject: function (t, e, i) { t.push(e.toSVG(i)) }, _setSVGBgOverlayImage: function (t, e, i) { this[e] && this[e].toSVG && t.push(this[e].toSVG(i)) }, _setSVGBgOverlayColor: function (t, e) { var i, r = this[e], n = this.viewportTransform, o = this.width / n[0], n = this.height / n[3]; r && (r.toLive ? (i = r.repeat, t.push('<rect transform="translate(', o / 2, ",", n / 2, ')"', ' x="', r.offsetX - o / 2, '" y="', r.offsetY - n / 2, '" ', 'width="', "repeat-y" === i || "no-repeat" === i ? r.source.width : o, '" height="', "repeat-x" === i || "no-repeat" === i ? r.source.height : n, '" fill="url(#SVGID_' + r.id + ')"', "></rect>\n")) : t.push('<rect x="0" y="0" width="100%" height="100%" ', 'fill="', this[e], '"', "></rect>\n")) }, sendToBack: function (t) { if (!t) return this; var e, i, r, n = this._activeObject; if (t === n && "activeSelection" === t.type) for (e = (r = n._objects).length; e--;)i = r[e], l(this._objects, i), this._objects.unshift(i); else l(this._objects, t), this._objects.unshift(t); return this.renderOnAddRemove && this.requestRenderAll(), this }, bringToFront: function (t) { if (!t) return this; var e, i, r, n = this._activeObject; if (t === n && "activeSelection" === t.type) for (r = n._objects, e = 0; e < r.length; e++)i = r[e], l(this._objects, i), this._objects.push(i); else l(this._objects, t), this._objects.push(t); return this.renderOnAddRemove && this.requestRenderAll(), this }, sendBackwards: function (t, e) { if (!t) return this; var i, r, n, o, s, a = this._activeObject, h = 0; if (t === a && "activeSelection" === t.type) for (s = a._objects, i = 0; i < s.length; i++)r = s[i], 0 + h < (n = this._objects.indexOf(r)) && (o = n - 1, l(this._objects, r), this._objects.splice(o, 0, r)), h++; else 0 !== (n = this._objects.indexOf(t)) && (o = this._findNewLowerIndex(t, n, e), l(this._objects, t), this._objects.splice(o, 0, t)); return this.renderOnAddRemove && this.requestRenderAll(), this }, _findNewLowerIndex: function (t, e, i) { var r, n; if (i) { for (n = (r = e) - 1; 0 <= n; --n)if (t.intersectsWithObject(this._objects[n]) || t.isContainedWithinObject(this._objects[n]) || this._objects[n].isContainedWithinObject(t)) { r = n; break } } else r = e - 1; return r }, bringForward: function (t, e) { if (!t) return this; var i, r, n, o, s, a = this._activeObject, h = 0; if (t === a && "activeSelection" === t.type) for (i = (s = a._objects).length; i--;)r = s[i], (n = this._objects.indexOf(r)) < this._objects.length - 1 - h && (o = n + 1, l(this._objects, r), this._objects.splice(o, 0, r)), h++; else (n = this._objects.indexOf(t)) !== this._objects.length - 1 && (o = this._findNewUpperIndex(t, n, e), l(this._objects, t), this._objects.splice(o, 0, t)); return this.renderOnAddRemove && this.requestRenderAll(), this }, _findNewUpperIndex: function (t, e, i) { var r, n, o; if (i) { for (n = (r = e) + 1, o = this._objects.length; n < o; ++n)if (t.intersectsWithObject(this._objects[n]) || t.isContainedWithinObject(this._objects[n]) || this._objects[n].isContainedWithinObject(t)) { r = n; break } } else r = e + 1; return r }, moveTo: function (t, e) { return l(this._objects, t), this._objects.splice(e, 0, t), this.renderOnAddRemove && this.requestRenderAll() }, dispose: function () { return this.isRendering && (fabric.util.cancelAnimFrame(this.isRendering), this.isRendering = 0), this.forEachObject(function (t) { t.dispose && t.dispose() }), this._objects = [], this.backgroundImage = null, this.overlayImage = null, this._iTextInstances = null, this.lowerCanvasEl = null, this.contextContainer = null, this }, toString: function () { return "#<fabric.Canvas (" + this.complexity() + "): { objects: " + this.getObjects().length + " }>" } }), r(fabric.StaticCanvas.prototype, fabric.Observable), r(fabric.StaticCanvas.prototype, fabric.Collection), r(fabric.StaticCanvas.prototype, fabric.DataURLExporter), r(fabric.StaticCanvas, { EMPTY_JSON: '{"objects": [], "background": "white"}', supports: function (t) { var e = fabric.util.createCanvasElement(); if (!e || !e.getContext) return null; var i = e.getContext("2d"); if (!i) return null; switch (t) { case "getImageData": return void 0 !== i.getImageData; case "setLineDash": return void 0 !== i.setLineDash; case "toDataURL": return void 0 !== e.toDataURL; case "toDataURLWithQuality": try { return e.toDataURL("image/jpeg", 0), !0 } catch (t) { } return !1; default: return null } } }), fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject, fabric.isLikelyNode && (fabric.StaticCanvas.prototype.createPNGStream = function () { var t = fabric.util.getNodeCanvas(this.lowerCanvasEl); return t && t.createPNGStream() }, fabric.StaticCanvas.prototype.createJPEGStream = function (t) { var e = fabric.util.getNodeCanvas(this.lowerCanvasEl); return e && e.createJPEGStream(t) })) }(), fabric.BaseBrush = fabric.util.createClass({ color: "rgb(0, 0, 0)", width: 1, shadow: null, strokeLineCap: "round", strokeLineJoin: "round", strokeMiterLimit: 10, strokeDashArray: null, setShadow: function (t) { return this.shadow = new fabric.Shadow(t), this }, _setBrushStyles: function () { var t = this.canvas.contextTop; t.strokeStyle = this.color, t.lineWidth = this.width, t.lineCap = this.strokeLineCap, t.miterLimit = this.strokeMiterLimit, t.lineJoin = this.strokeLineJoin, fabric.StaticCanvas.supports("setLineDash") && t.setLineDash(this.strokeDashArray || []) }, _saveAndTransform: function (t) { var e = this.canvas.viewportTransform; t.save(), t.transform(e[0], e[1], e[2], e[3], e[4], e[5]) }, _setShadow: function () { var t, e; this.shadow && (t = this.canvas.contextTop, e = this.canvas.getZoom(), t.shadowColor = this.shadow.color, t.shadowBlur = this.shadow.blur * e, t.shadowOffsetX = this.shadow.offsetX * e, t.shadowOffsetY = this.shadow.offsetY * e) }, _resetShadow: function () { var t = this.canvas.contextTop; t.shadowColor = "", t.shadowBlur = t.shadowOffsetX = t.shadowOffsetY = 0 } }), fabric.PencilBrush = fabric.util.createClass(fabric.BaseBrush, { initialize: function (t) { this.canvas = t, this._points = [] }, _drawSegment: function (t, e, i) { i = e.midPointFrom(i); return t.quadraticCurveTo(e.x, e.y, i.x, i.y), i }, onMouseDown: function (t) { this._prepareForDrawing(t), this._captureDrawingPath(t), this._render() }, onMouseMove: function (t) { var e, i; this._captureDrawingPath(t) && 1 < this._points.length && (this.needsFullRender ? (this.canvas.clearContext(this.canvas.contextTop), this._render()) : (e = (t = this._points).length, i = this.canvas.contextTop, this._saveAndTransform(i), this.oldEnd && (i.beginPath(), i.moveTo(this.oldEnd.x, this.oldEnd.y)), this.oldEnd = this._drawSegment(i, t[e - 2], t[e - 1], !0), i.stroke(), i.restore())) }, onMouseUp: function () { this.oldEnd = void 0, this._finalizeAndAddPath() }, _prepareForDrawing: function (t) { t = new fabric.Point(t.x, t.y); this._reset(), this._addPoint(t), this.canvas.contextTop.moveTo(t.x, t.y) }, _addPoint: function (t) { return !(1 < this._points.length && t.eq(this._points[this._points.length - 1])) && (this._points.push(t), !0) }, _reset: function () { this._points.length = 0, this._setBrushStyles(); var t = new fabric.Color(this.color); this.needsFullRender = t.getAlpha() < 1, this._setShadow() }, _captureDrawingPath: function (t) { t = new fabric.Point(t.x, t.y); return this._addPoint(t) }, _render: function () { var t, e, i, r = this.canvas.contextTop, n = this._points[0], o = this._points[1]; for (this._saveAndTransform(r), r.beginPath(), 2 === this._points.length && n.x === o.x && n.y === o.y && (i = this.width / 1e3, n = new fabric.Point(n.x, n.y), o = new fabric.Point(o.x, o.y), n.x -= i, o.x += i), r.moveTo(n.x, n.y), t = 1, e = this._points.length; t < e; t++)this._drawSegment(r, n, o), n = this._points[t], o = this._points[t + 1]; r.lineTo(n.x, n.y), r.stroke(), r.restore() }, convertPointsToSVGPath: function (t) { var e, i, r = [], n = this.width / 1e3, o = new fabric.Point(t[0].x, t[0].y), s = new fabric.Point(t[1].x, t[1].y), a = t.length, h = 1, l = 1, u = 2 < a; for (u && (h = t[2].x < s.x ? -1 : t[2].x === s.x ? 0 : 1, l = t[2].y < s.y ? -1 : t[2].y === s.y ? 0 : 1), r.push("M ", o.x - h * n, " ", o.y - l * n, " "), e = 1; e < a; e++)o.eq(s) || (i = o.midPointFrom(s), r.push("Q ", o.x, " ", o.y, " ", i.x, " ", i.y, " ")), o = t[e], e + 1 < t.length && (s = t[e + 1]); return u && (h = o.x > t[e - 2].x ? 1 : o.x === t[e - 2].x ? 0 : -1, l = o.y > t[e - 2].y ? 1 : o.y === t[e - 2].y ? 0 : -1), r.push("L ", o.x + h * n, " ", o.y + l * n), r }, createPath: function (t) { var t = new fabric.Path(t, { fill: null, stroke: this.color, strokeWidth: this.width, strokeLineCap: this.strokeLineCap, strokeMiterLimit: this.strokeMiterLimit, strokeLineJoin: this.strokeLineJoin, strokeDashArray: this.strokeDashArray }), e = new fabric.Point(t.left + t.width / 2, t.top + t.height / 2), e = t.translateToGivenOrigin(e, "center", "center", t.originX, t.originY); return t.top = e.y, t.left = e.x, this.shadow && (this.shadow.affectStroke = !0, t.setShadow(this.shadow)), t }, _finalizeAndAddPath: function () { this.canvas.contextTop.closePath(); var t = this.convertPointsToSVGPath(this._points).join(""); "M 0 0 Q 0 0 0 0 L 0 0" !== t ? (t = this.createPath(t), this.canvas.clearContext(this.canvas.contextTop), this.canvas.add(t), this.canvas.renderAll(), t.setCoords(), this._resetShadow(), this.canvas.fire("path:created", { path: t })) : this.canvas.requestRenderAll() } }), fabric.CircleBrush = fabric.util.createClass(fabric.BaseBrush, { width: 10, initialize: function (t) { this.canvas = t, this.points = [] }, drawDot: function (t) { var t = this.addPoint(t), e = this.canvas.contextTop; this._saveAndTransform(e), e.fillStyle = t.fill, e.beginPath(), e.arc(t.x, t.y, t.radius, 0, 2 * Math.PI, !1), e.closePath(), e.fill(), e.restore() }, onMouseDown: function (t) { this.points.length = 0, this.canvas.clearContext(this.canvas.contextTop), this._setShadow(), this.drawDot(t) }, _render: function () { var t, e, i, r = this.canvas.contextTop, n = this.points; for (this._saveAndTransform(r), t = 0, e = n.length; t < e; t++)i = n[t], r.fillStyle = i.fill, r.beginPath(), r.arc(i.x, i.y, i.radius, 0, 2 * Math.PI, !1), r.closePath(), r.fill(); r.restore() }, onMouseMove: function (t) { this.drawDot(t) }, onMouseUp: function () { for (var t = this.canvas.renderOnAddRemove, e = (this.canvas.renderOnAddRemove = !1, []), i = 0, r = this.points.length; i < r; i++) { var n = this.points[i], n = new fabric.Circle({ radius: n.radius, left: n.x, top: n.y, originX: "center", originY: "center", fill: n.fill }); this.shadow && n.setShadow(this.shadow), e.push(n) } var o = new fabric.Group(e, { originX: "center", originY: "center" }); o.canvas = this.canvas, this.canvas.add(o), this.canvas.fire("path:created", { path: o }), this.canvas.clearContext(this.canvas.contextTop), this._resetShadow(), this.canvas.renderOnAddRemove = t, this.canvas.requestRenderAll() }, addPoint: function (t) { var t = new fabric.Point(t.x, t.y), e = fabric.util.getRandomInt(Math.max(0, this.width - 20), this.width + 20) / 2, i = new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0, 100) / 100).toRgba(); return t.radius = e, t.fill = i, this.points.push(t), t } }), fabric.SprayBrush = fabric.util.createClass(fabric.BaseBrush, { width: 10, density: 20, dotWidth: 1, dotWidthVariance: 1, randomOpacity: !1, optimizeOverlapping: !0, initialize: function (t) { this.canvas = t, this.sprayChunks = [] }, onMouseDown: function (t) { this.sprayChunks.length = 0, this.canvas.clearContext(this.canvas.contextTop), this._setShadow(), this.addSprayChunk(t), this.render(this.sprayChunkPoints) }, onMouseMove: function (t) { this.addSprayChunk(t), this.render(this.sprayChunkPoints) }, onMouseUp: function () { for (var t = this.canvas.renderOnAddRemove, e = (this.canvas.renderOnAddRemove = !1, []), i = 0, r = this.sprayChunks.length; i < r; i++)for (var n = this.sprayChunks[i], o = 0, s = n.length; o < s; o++) { var a = new fabric.Rect({ width: n[o].width, height: n[o].width, left: n[o].x + 1, top: n[o].y + 1, originX: "center", originY: "center", fill: this.color }); e.push(a) } this.optimizeOverlapping && (e = this._getOptimizedRects(e)); var h = new fabric.Group(e, { originX: "center", originY: "center" }); this.shadow && h.setShadow(this.shadow), this.canvas.add(h), this.canvas.fire("path:created", { path: h }), this.canvas.clearContext(this.canvas.contextTop), this._resetShadow(), this.canvas.renderOnAddRemove = t, this.canvas.requestRenderAll() }, _getOptimizedRects: function (t) { for (var e, i = {}, r = 0, n = t.length; r < n; r++)i[e = t[r].left + "" + t[r].top] || (i[e] = t[r]); var o = []; for (e in i) o.push(i[e]); return o }, render: function (t) { var e, i, r = this.canvas.contextTop; for (r.fillStyle = this.color, this._saveAndTransform(r), e = 0, i = t.length; e < i; e++) { var n = t[e]; void 0 !== n.opacity && (r.globalAlpha = n.opacity), r.fillRect(n.x, n.y, n.width, n.width) } r.restore() }, _render: function () { var t, e, i = this.canvas.contextTop; for (i.fillStyle = this.color, this._saveAndTransform(i), t = 0, e = this.sprayChunks.length; t < e; t++)this.render(this.sprayChunks[t]); i.restore() }, addSprayChunk: function (t) { this.sprayChunkPoints = []; for (var e = this.width / 2, i = 0; i < this.density; i++) { var r = fabric.util.getRandomInt(t.x - e, t.x + e), n = fabric.util.getRandomInt(t.y - e, t.y + e), o = this.dotWidthVariance ? fabric.util.getRandomInt(Math.max(1, this.dotWidth - this.dotWidthVariance), this.dotWidth + this.dotWidthVariance) : this.dotWidth, r = new fabric.Point(r, n); r.width = o, this.randomOpacity && (r.opacity = fabric.util.getRandomInt(0, 100) / 100), this.sprayChunkPoints.push(r) } this.sprayChunks.push(this.sprayChunkPoints) } }), fabric.PatternBrush = fabric.util.createClass(fabric.PencilBrush, { getPatternSrc: function () { var t = fabric.document.createElement("canvas"), e = t.getContext("2d"); return t.width = t.height = 25, e.fillStyle = this.color, e.beginPath(), e.arc(10, 10, 10, 0, 2 * Math.PI, !1), e.closePath(), e.fill(), t }, getPatternSrcFunction: function () { return String(this.getPatternSrc).replace("this.color", '"' + this.color + '"') }, getPattern: function () { return this.canvas.contextTop.createPattern(this.source || this.getPatternSrc(), "repeat") }, _setBrushStyles: function () { this.callSuper("_setBrushStyles"), this.canvas.contextTop.strokeStyle = this.getPattern() }, createPath: function (t) { var t = this.callSuper("createPath", t), e = t._getLeftTopCoords().scalarAdd(t.strokeWidth / 2); return t.stroke = new fabric.Pattern({ source: this.source || this.getPatternSrcFunction(), offsetX: -e.x, offsetY: -e.y }), t } }), function () { var t, s = fabric.util.getPointer, a = fabric.util.degreesToRadians, h = fabric.util.radiansToDegrees, l = Math.atan2, u = Math.abs, c = fabric.StaticCanvas.supports("setLineDash"); for (t in fabric.Canvas = fabric.util.createClass(fabric.StaticCanvas, { initialize: function (t, e) { e = e || {}, this.renderAndResetBound = this.renderAndReset.bind(this), this._initStatic(t, e), this._initInteractive(), this._createCacheCanvas() }, uniScaleTransform: !1, uniScaleKey: "shiftKey", centeredScaling: !1, centeredRotation: !1, centeredKey: "altKey", altActionKey: "shiftKey", interactive: !0, selection: !0, selectionKey: "shiftKey", altSelectionKey: null, selectionColor: "rgba(100, 100, 255, 0.3)", selectionDashArray: [], selectionBorderColor: "rgba(255, 255, 255, 0.3)", selectionLineWidth: 1, selectionFullyContained: !1, hoverCursor: "move", moveCursor: "move", defaultCursor: "default", freeDrawingCursor: "crosshair", rotationCursor: "crosshair", notAllowedCursor: "not-allowed", containerClass: "canvas-container", perPixelTargetFind: !1, targetFindTolerance: 0, skipTargetFind: !1, isDrawingMode: !1, preserveObjectStacking: !1, snapAngle: 0, snapThreshold: null, stopContextMenu: !1, fireRightClick: !1, fireMiddleClick: !1, _initInteractive: function () { this._currentTransform = null, this._groupSelector = null, this._initWrapperElement(), this._createUpperCanvas(), this._initEventListeners(), this._initRetinaScaling(), this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this), this.calcOffset() }, _chooseObjectsToRender: function () { var t, e = this.getActiveObjects(); if (0 < e.length && !this.preserveObjectStacking) { for (var i = [], r = [], n = 0, o = this._objects.length; n < o; n++)t = this._objects[n], (-1 === e.indexOf(t) ? i : r).push(t); 1 < e.length && (this._activeObject._objects = r), i.push.apply(i, r) } else i = this._objects; return i }, renderAll: function () { !this.contextTopDirty || this._groupSelector || this.isDrawingMode || (this.clearContext(this.contextTop), this.contextTopDirty = !1), this.hasLostContext && this.renderTopLayer(this.contextTop); var t = this.contextContainer; return this.renderCanvas(t, this._chooseObjectsToRender()), this }, renderTopLayer: function (t) { this.isDrawingMode && this._isCurrentlyDrawing && this.freeDrawingBrush && this.freeDrawingBrush._render(), this.selection && this._groupSelector && this._drawSelection(t) }, renderTop: function () { var t = this.contextTop; return this.clearContext(t), this.renderTopLayer(t), this.fire("after:render"), this.contextTopDirty = !0, this }, _resetCurrentTransform: function () { var t = this._currentTransform; t.target.set({ scaleX: t.original.scaleX, scaleY: t.original.scaleY, skewX: t.original.skewX, skewY: t.original.skewY, left: t.original.left, top: t.original.top }), this._shouldCenterTransform(t.target) ? ("center" !== t.originX && ("right" === t.originX ? t.mouseXSign = -1 : t.mouseXSign = 1), "center" !== t.originY && ("bottom" === t.originY ? t.mouseYSign = -1 : t.mouseYSign = 1), t.originX = "center", t.originY = "center") : (t.originX = t.original.originX, t.originY = t.original.originY) }, containsPoint: function (t, e, i) { i = i || this.getPointer(t, !0), t = e.group && e.group === this._activeObject && "activeSelection" === e.group.type ? this._normalizePointer(e.group, i) : { x: i.x, y: i.y }; return e.containsPoint(t) || e._findTargetCorner(i) }, _normalizePointer: function (t, e) { t = t.calcTransformMatrix(), t = fabric.util.invertTransform(t), e = this.restorePointerVpt(e); return fabric.util.transformPoint(e, t) }, isTargetTransparent: function (t, e, i) { var r = this.contextCache, n = t.selectionBackgroundColor, o = this.viewportTransform; return t.selectionBackgroundColor = "", this.clearContext(r), r.save(), r.transform(o[0], o[1], o[2], o[3], o[4], o[5]), t.render(r), r.restore(), t === this._activeObject && t._renderControls(r, { hasBorders: !1, transparentCorners: !1 }, { hasBorders: !1 }), t.selectionBackgroundColor = n, fabric.util.isTransparent(r, e, i, this.targetFindTolerance) }, _isSelectionKeyPressed: function (e) { return "[object Array]" === Object.prototype.toString.call(this.selectionKey) ? !!this.selectionKey.find(function (t) { return !0 === e[t] }) : e[this.selectionKey] }, _shouldClearSelection: function (t, e) { var i = this.getActiveObjects(), r = this._activeObject; return !e || r && 1 < i.length && -1 === i.indexOf(e) && r !== e && !this._isSelectionKeyPressed(t) || e && !e.evented || e && !e.selectable && r && r !== e }, _shouldCenterTransform: function (t) { var e, i; if (t) return e = this._currentTransform, "scale" === e.action || "scaleX" === e.action || "scaleY" === e.action ? i = this.centeredScaling || t.centeredScaling : "rotate" === e.action && (i = this.centeredRotation || t.centeredRotation), i ? !e.altKey : e.altKey }, _getOriginFromCorner: function (t, e) { t = { x: t.originX, y: t.originY }; return "ml" === e || "tl" === e || "bl" === e ? t.x = "right" : "mr" !== e && "tr" !== e && "br" !== e || (t.x = "left"), "tl" === e || "mt" === e || "tr" === e ? t.y = "bottom" : "bl" !== e && "mb" !== e && "br" !== e || (t.y = "top"), t }, _getActionFromCorner: function (t, e, i) { if (!e) return "drag"; switch (e) { case "mtr": return "rotate"; case "ml": case "mr": return i[this.altActionKey] ? "skewY" : "scaleX"; case "mt": case "mb": return i[this.altActionKey] ? "skewX" : "scaleY"; default: return "scale" } }, _setupCurrentTransform: function (t, e) { var i, r, n, o; e && (i = this.getPointer(t), r = e._findTargetCorner(this.getPointer(t, !0)), n = this._getActionFromCorner(e, r, t), o = this._getOriginFromCorner(e, r), this._currentTransform = { target: e, action: n, corner: r, scaleX: e.scaleX, scaleY: e.scaleY, skewX: e.skewX, skewY: e.skewY, offsetX: i.x - e.left, offsetY: i.y - e.top, originX: o.x, originY: o.y, ex: i.x, ey: i.y, lastX: i.x, lastY: i.y, theta: a(e.angle), width: e.width * e.scaleX, mouseXSign: 1, mouseYSign: 1, shiftKey: t.shiftKey, altKey: t[this.centeredKey] }, this._currentTransform.original = { left: e.left, top: e.top, scaleX: e.scaleX, scaleY: e.scaleY, skewX: e.skewX, skewY: e.skewY, originX: o.x, originY: o.y }, this._resetCurrentTransform()) }, _translateObject: function (t, e) { var i = this._currentTransform, r = i.target, t = t - i.offsetX, e = e - i.offsetY, i = !r.get("lockMovementX") && r.left !== t, n = !r.get("lockMovementY") && r.top !== e; return i && r.set("left", t), n && r.set("top", e), i || n }, _changeSkewTransformOrigin: function (t, e, i) { var r = "originX", n = { 0: "center" }, o = e.target.skewX, s = "left", a = "right", h = "mt" === e.corner || "ml" === e.corner ? 1 : -1, l = 1; t = 0 < t ? 1 : -1, "y" === i && (o = e.target.skewY, s = "top", a = "bottom", r = "originY"), n[-1] = s, n[1] = a, e.target.flipX && (l *= -1), e.target.flipY && (l *= -1), 0 === o ? (e.skewSign = -h * t * l, e[r] = n[-t]) : (e.skewSign = o = 0 < o ? 1 : -1, e[r] = n[o * h * l]) }, _skewObject: function (t, e, i) { var r = this._currentTransform, n = r.target, o = n.get("lockSkewingX"), s = n.get("lockSkewingY"); if (o && "x" === i || s && "y" === i) return !1; var o = n.getCenterPoint(), s = n.toLocalPoint(new fabric.Point(t, e), "center", "center")[i], a = n.toLocalPoint(new fabric.Point(r.lastX, r.lastY), "center", "center")[i], h = n._getTransformedDimensions(); return this._changeSkewTransformOrigin(s - a, r, i), s = n.toLocalPoint(new fabric.Point(t, e), r.originX, r.originY)[i], a = n.translateToOriginPoint(o, r.originX, r.originY), o = this._setObjectSkew(s, r, i, h), r.lastX = t, r.lastY = e, n.setPositionByOrigin(a, r.originX, r.originY), o }, _setObjectSkew: function (t, e, i, u) { var r, n, o, s = e.target, e = e.skewSign, a = "x" === i ? (r = "y", n = "Y", o = "X", h = 0, s.skewY) : (r = "x", n = "X", o = "Y", h = s.skewX, 0), h = s._getTransformedDimensions(h, a), a = 2 * Math.abs(t) - h[i], l = a <= 2 ? 0 : (l = e * Math.atan(a / s["scale" + o] / (h[r] / s["scale" + n])), fabric.util.radiansToDegrees(l)), t = s["skew" + o] !== l; return s.set("skew" + o, l), 0 !== s["skew" + n] && (i = s._getTransformedDimensions(), l = u[r] / i[r] * s["scale" + n], s.set("scale" + n, l)), t }, _scaleObject: function (t, e, i) { var r = this._currentTransform, n = r.target, o = n.lockScalingX, s = n.lockScalingY, a = n.lockScalingFlip; if (o && s) return !1; var h = n.translateToOriginPoint(n.getCenterPoint(), r.originX, r.originY), t = n.toLocalPoint(new fabric.Point(t, e), r.originX, r.originY), e = n._getTransformedDimensions(); return this._setLocalMouse(t, r), t = this._setObjectScale(t, r, o, s, i, a, e), n.setPositionByOrigin(h, r.originX, r.originY), t }, _setObjectScale: function (t, e, i, u, r, c, f) { var n = e.target, o = !1, s = !1, a = !1, h = t.x * n.scaleX / f.x, l = t.y * n.scaleY / f.y, d = n.scaleX !== h, p = n.scaleY !== l; return c && h <= 0 && h < n.scaleX && (o = !0, t.x = 0), c && l <= 0 && l < n.scaleY && (s = !0, t.y = 0), "equally" !== r || i || u ? r ? "x" !== r || n.get("lockUniScaling") ? "y" !== r || n.get("lockUniScaling") || s || u || n.set("scaleY", l) && (a = a || p) : o || i || n.set("scaleX", h) && (a = a || d) : (o || i || n.set("scaleX", h) && (a = a || d), s || u || n.set("scaleY", l) && (a = a || p)) : a = this._scaleObjectEqually(t, n, e, f), e.newScaleX = h, e.newScaleY = l, o || s || this._flipObject(e, r), a }, _scaleObjectEqually: function (t, e, i, r) { var n = t.y + t.x, r = r.y * i.original.scaleY / e.scaleY + r.x * i.original.scaleX / e.scaleX, o = t.x < 0 ? -1 : 1, t = t.y < 0 ? -1 : 1; return i.newScaleX = o * Math.abs(i.original.scaleX * n / r), i.newScaleY = t * Math.abs(i.original.scaleY * n / r), o = i.newScaleX !== e.scaleX || i.newScaleY !== e.scaleY, e.set("scaleX", i.newScaleX), e.set("scaleY", i.newScaleY), o }, _flipObject: function (t, e) { t.newScaleX < 0 && "y" !== e && ("left" === t.originX ? t.originX = "right" : "right" === t.originX && (t.originX = "left")), t.newScaleY < 0 && "x" !== e && ("top" === t.originY ? t.originY = "bottom" : "bottom" === t.originY && (t.originY = "top")) }, _setLocalMouse: function (t, e) { var i = e.target, r = this.getZoom(), i = i.padding / r; "right" === e.originX ? t.x *= -1 : "center" === e.originX && (t.x *= 2 * e.mouseXSign, t.x < 0 && (e.mouseXSign = -e.mouseXSign)), "bottom" === e.originY ? t.y *= -1 : "center" === e.originY && (t.y *= 2 * e.mouseYSign, t.y < 0 && (e.mouseYSign = -e.mouseYSign)), u(t.x) > i ? t.x < 0 ? t.x += i : t.x -= i : t.x = 0, u(t.y) > i ? t.y < 0 ? t.y += i : t.y -= i : t.y = 0 }, _rotateObject: function (t, e) { var i = this._currentTransform, r = i.target, n = r.translateToOriginPoint(r.getCenterPoint(), i.originX, i.originY); if (r.lockRotation) return !1; var o, s, a = l(i.ey - n.y, i.ex - n.x), e = l(e - n.y, t - n.x), t = h(e - a + i.theta), e = !0; return 0 < r.snapAngle && (a = r.snapAngle, o = r.snapThreshold || a, s = Math.ceil(t / a) * a, a = Math.floor(t / a) * a, Math.abs(t - a) < o ? t = a : Math.abs(t - s) < o && (t = s)), t < 0 && (t = 360 + t), r.angle === (t %= 360) ? e = !1 : (r.angle = t, r.setPositionByOrigin(n, i.originX, i.originY)), e }, setCursor: function (t) { this.upperCanvasEl.style.cursor = t }, _resetObjectTransform: function (t) { t.scaleX = 1, t.scaleY = 1, t.skewX = 0, t.skewY = 0, t.rotate(0) }, _drawSelection: function (t) { var e, i, r = this._groupSelector, n = r.left, o = r.top, s = u(n), a = u(o); this.selectionColor && (t.fillStyle = this.selectionColor, t.fillRect(r.ex - (0 < n ? 0 : -n), r.ey - (0 < o ? 0 : -o), s, a)), this.selectionLineWidth && this.selectionBorderColor && (t.lineWidth = this.selectionLineWidth, t.strokeStyle = this.selectionBorderColor, 1 < this.selectionDashArray.length && !c ? (e = r.ex + .5 - (0 < n ? 0 : s), i = r.ey + .5 - (0 < o ? 0 : a), t.beginPath(), fabric.util.drawDashedLine(t, e, i, e + s, i, this.selectionDashArray), fabric.util.drawDashedLine(t, e, i + a - 1, e + s, i + a - 1, this.selectionDashArray), fabric.util.drawDashedLine(t, e, i, e, i + a, this.selectionDashArray), fabric.util.drawDashedLine(t, e + s - 1, i, e + s - 1, i + a, this.selectionDashArray), t.closePath(), t.stroke()) : (fabric.Object.prototype._setLineDash.call(this, t, this.selectionDashArray), t.strokeRect(r.ex + .5 - (0 < n ? 0 : s), r.ey + .5 - (0 < o ? 0 : a), s, a))) }, findTarget: function (t, e) { if (!this.skipTargetFind) { var i, r, n = this.getPointer(t, !0), o = this._activeObject, s = this.getActiveObjects(); if (this.targets = [], 1 < s.length && !e && o === this._searchPossibleTargets([o], n)) return o; if (1 === s.length && o._findTargetCorner(n)) return o; if (1 === s.length && o === this._searchPossibleTargets([o], n)) { if (!this.preserveObjectStacking) return o; i = o, r = this.targets, this.targets = [] } e = this._searchPossibleTargets(this._objects, n); return t[this.altSelectionKey] && e && i && e !== i && (e = i, this.targets = r), e } }, _checkTarget: function (t, e) { if (e && e.visible && e.evented && this.containsPoint(null, e, t)) return !((this.perPixelTargetFind || e.perPixelTargetFind) && !e.isEditing) || (!this.isTargetTransparent(e, t.x, t.y) || void 0) }, _searchPossibleTargets: function (t, e) { for (var i, r, n = t.length; n--;)if (this._checkTarget(e, t[n])) { (i = t[n]).subTargetCheck && i instanceof fabric.Group && (r = this._normalizePointer(i, e), (r = this._searchPossibleTargets(i._objects, r)) && this.targets.push(r)); break } return i }, restorePointerVpt: function (t) { return fabric.util.transformPoint(t, fabric.util.invertTransform(this.viewportTransform)) }, getPointer: function (t, e, i) { i = i || this.upperCanvasEl; var t = s(t), r = i.getBoundingClientRect(), n = r.width || 0, o = r.height || 0; return n && o || ("top" in r && "bottom" in r && (o = Math.abs(r.top - r.bottom)), "right" in r && "left" in r && (n = Math.abs(r.right - r.left))), this.calcOffset(), t.x = t.x - this._offset.left, t.y = t.y - this._offset.top, e || (t = this.restorePointerVpt(t)), r = 0 === n || 0 === o ? { width: 1, height: 1 } : { width: i.width / n, height: i.height / o }, { x: t.x * r.width, y: t.y * r.height } }, _createUpperCanvas: function () { var t = this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/, ""); this.upperCanvasEl ? this.upperCanvasEl.className = "" : this.upperCanvasEl = this._createCanvasElement(), fabric.util.addClass(this.upperCanvasEl, "upper-canvas " + t), this.wrapperEl.appendChild(this.upperCanvasEl), this._copyCanvasStyle(this.lowerCanvasEl, this.upperCanvasEl), this._applyCanvasStyle(this.upperCanvasEl), this.contextTop = this.upperCanvasEl.getContext("2d") }, _createCacheCanvas: function () { this.cacheCanvasEl = this._createCanvasElement(), this.cacheCanvasEl.setAttribute("width", this.width), this.cacheCanvasEl.setAttribute("height", this.height), this.contextCache = this.cacheCanvasEl.getContext("2d") }, _initWrapperElement: function () { this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, "div", { class: this.containerClass }), fabric.util.setStyle(this.wrapperEl, { width: this.width + "px", height: this.height + "px", position: "relative" }), fabric.util.makeElementUnselectable(this.wrapperEl) }, _applyCanvasStyle: function (t) { var e = this.width || t.width, i = this.height || t.height; fabric.util.setStyle(t, { position: "absolute", width: e + "px", height: i + "px", left: 0, top: 0, "touch-action": this.allowTouchScrolling ? "manipulation" : "none" }), t.width = e, t.height = i, fabric.util.makeElementUnselectable(t) }, _copyCanvasStyle: function (t, e) { e.style.cssText = t.style.cssText }, getSelectionContext: function () { return this.contextTop }, getSelectionElement: function () { return this.upperCanvasEl }, getActiveObject: function () { return this._activeObject }, getActiveObjects: function () { var t = this._activeObject; return t ? "activeSelection" === t.type && t._objects ? t._objects.slice(0) : [t] : [] }, _onObjectRemoved: function (t) { t === this._activeObject && (this.fire("before:selection:cleared", { target: t }), this._discardActiveObject(), this.fire("selection:cleared", { target: t }), t.fire("deselected")), this._hoveredTarget === t && (this._hoveredTarget = null), this.callSuper("_onObjectRemoved", t) }, _fireSelectionEvents: function (e, t) { var i = !1, r = this.getActiveObjects(), n = [], o = [], s = { e: t }; e.forEach(function (t) { -1 === r.indexOf(t) && (i = !0, t.fire("deselected", s), o.push(t)) }), r.forEach(function (t) { -1 === e.indexOf(t) && (i = !0, t.fire("selected", s), n.push(t)) }), 0 < e.length && 0 < r.length ? (s.selected = n, s.deselected = o, s.updated = n[0] || o[0], s.target = this._activeObject, i && this.fire("selection:updated", s)) : 0 < r.length ? (1 === r.length && (s.target = n[0], this.fire("object:selected", s)), s.selected = n, s.target = this._activeObject, this.fire("selection:created", s)) : 0 < e.length && (s.deselected = o, this.fire("selection:cleared", s)) }, setActiveObject: function (t, e) { var i = this.getActiveObjects(); return this._setActiveObject(t, e), this._fireSelectionEvents(i, e), this }, _setActiveObject: function (t, e) { return this._activeObject !== t && (!!this._discardActiveObject(e, t) && (!t.onSelect({ e: e }) && (this._activeObject = t, !0))) }, _discardActiveObject: function (t, e) { var i = this._activeObject; if (i) { if (i.onDeselect({ e: t, object: e })) return !1; this._activeObject = null } return !0 }, discardActiveObject: function (t) { var e = this.getActiveObjects(); return e.length && this.fire("before:selection:cleared", { target: e[0], e: t }), this._discardActiveObject(t), this._fireSelectionEvents(e, t), this }, dispose: function () { var t = this.wrapperEl; return this.removeListeners(), t.removeChild(this.upperCanvasEl), t.removeChild(this.lowerCanvasEl), this.upperCanvasEl = null, this.cacheCanvasEl = null, this.contextCache = null, this.contextTop = null, t.parentNode && t.parentNode.replaceChild(this.lowerCanvasEl, this.wrapperEl), delete this.wrapperEl, fabric.StaticCanvas.prototype.dispose.call(this), this }, clear: function () { return this.discardActiveObject(), this.clearContext(this.contextTop), this.callSuper("clear") }, drawControls: function (t) { var e = this._activeObject; e && e._renderControls(t) }, _toObject: function (t, e, i) { var r = this._realizeGroupTransformOnObject(t), e = this.callSuper("_toObject", t, e, i); return this._unwindGroupTransformOnObject(t, r), e }, _realizeGroupTransformOnObject: function (e) { var i; return e.group && "activeSelection" === e.group.type && this._activeObject === e.group ? (i = {}, ["angle", "flipX", "flipY", "left", "scaleX", "scaleY", "skewX", "skewY", "top"].forEach(function (t) { i[t] = e[t] }), this._activeObject.realizeTransform(e), i) : null }, _unwindGroupTransformOnObject: function (t, e) { e && t.set(e) }, _setSVGObject: function (t, e, i) { var r = this._realizeGroupTransformOnObject(e); this.callSuper("_setSVGObject", t, e, i), this._unwindGroupTransformOnObject(e, r) } }), fabric.StaticCanvas) "prototype" !== t && (fabric.Canvas[t] = fabric.StaticCanvas[t]); fabric.isTouchSupported && (fabric.Canvas.prototype._setCursorFromEvent = function () { }) }(), function () { var r = { mt: 0, tr: 1, mr: 2, br: 3, mb: 4, bl: 5, ml: 6, tl: 7 }, i = fabric.util.addListener, n = fabric.util.removeListener, o = { passive: !1 }; function s(t, e) { return "which" in t ? t.which === e : t.button === e - 1 } fabric.util.object.extend(fabric.Canvas.prototype, { cursorMap: ["n-resize", "ne-resize", "e-resize", "se-resize", "s-resize", "sw-resize", "w-resize", "nw-resize"], _initEventListeners: function () { this.removeListeners(), this._bindEvents(), i(fabric.window, "resize", this._onResize), i(this.upperCanvasEl, "mousedown", this._onMouseDown), i(this.upperCanvasEl, "dblclick", this._onDoubleClick), i(this.upperCanvasEl, "mousemove", this._onMouseMove, o), i(this.upperCanvasEl, "mouseout", this._onMouseOut), i(this.upperCanvasEl, "mouseenter", this._onMouseEnter), i(this.upperCanvasEl, "wheel", this._onMouseWheel), i(this.upperCanvasEl, "contextmenu", this._onContextMenu), i(this.upperCanvasEl, "dragover", this._onDragOver), i(this.upperCanvasEl, "dragenter", this._onDragEnter), i(this.upperCanvasEl, "dragleave", this._onDragLeave), i(this.upperCanvasEl, "drop", this._onDrop), i(this.upperCanvasEl, "touchstart", this._onMouseDown, o), i(this.upperCanvasEl, "touchmove", this._onMouseMove, o), "undefined" != typeof eventjs && "add" in eventjs && (eventjs.add(this.upperCanvasEl, "gesture", this._onGesture), eventjs.add(this.upperCanvasEl, "drag", this._onDrag), eventjs.add(this.upperCanvasEl, "orientation", this._onOrientationChange), eventjs.add(this.upperCanvasEl, "shake", this._onShake), eventjs.add(this.upperCanvasEl, "longpress", this._onLongPress)) }, _bindEvents: function () { this.eventsBound || (this._onMouseDown = this._onMouseDown.bind(this), this._onMouseMove = this._onMouseMove.bind(this), this._onMouseUp = this._onMouseUp.bind(this), this._onResize = this._onResize.bind(this), this._onGesture = this._onGesture.bind(this), this._onDrag = this._onDrag.bind(this), this._onShake = this._onShake.bind(this), this._onLongPress = this._onLongPress.bind(this), this._onOrientationChange = this._onOrientationChange.bind(this), this._onMouseWheel = this._onMouseWheel.bind(this), this._onMouseOut = this._onMouseOut.bind(this), this._onMouseEnter = this._onMouseEnter.bind(this), this._onContextMenu = this._onContextMenu.bind(this), this._onDoubleClick = this._onDoubleClick.bind(this), this._onDragOver = this._onDragOver.bind(this), this._onDragEnter = this._simpleEventHandler.bind(this, "dragenter"), this._onDragLeave = this._simpleEventHandler.bind(this, "dragleave"), this._onDrop = this._simpleEventHandler.bind(this, "drop"), this.eventsBound = !0) }, removeListeners: function () { n(fabric.window, "resize", this._onResize), n(this.upperCanvasEl, "mousedown", this._onMouseDown), n(this.upperCanvasEl, "mousemove", this._onMouseMove), n(this.upperCanvasEl, "mouseout", this._onMouseOut), n(this.upperCanvasEl, "mouseenter", this._onMouseEnter), n(this.upperCanvasEl, "wheel", this._onMouseWheel), n(this.upperCanvasEl, "contextmenu", this._onContextMenu), n(this.upperCanvasEl, "doubleclick", this._onDoubleClick), n(this.upperCanvasEl, "touchstart", this._onMouseDown), n(this.upperCanvasEl, "touchmove", this._onMouseMove), n(this.upperCanvasEl, "dragover", this._onDragOver), n(this.upperCanvasEl, "dragenter", this._onDragEnter), n(this.upperCanvasEl, "dragleave", this._onDragLeave), n(this.upperCanvasEl, "drop", this._onDrop), "undefined" != typeof eventjs && "remove" in eventjs && (eventjs.remove(this.upperCanvasEl, "gesture", this._onGesture), eventjs.remove(this.upperCanvasEl, "drag", this._onDrag), eventjs.remove(this.upperCanvasEl, "orientation", this._onOrientationChange), eventjs.remove(this.upperCanvasEl, "shake", this._onShake), eventjs.remove(this.upperCanvasEl, "longpress", this._onLongPress)) }, _onGesture: function (t, e) { this.__onTransformGesture && this.__onTransformGesture(t, e) }, _onDrag: function (t, e) { this.__onDrag && this.__onDrag(t, e) }, _onMouseWheel: function (t) { this.__onMouseWheel(t) }, _onMouseOut: function (t) { var e = this._hoveredTarget; this.fire("mouse:out", { target: e, e: t }), this._hoveredTarget = null, e && e.fire("mouseout", { e: t }), this._iTextInstances && this._iTextInstances.forEach(function (t) { t.isEditing && t.hiddenTextarea.focus() }) }, _onMouseEnter: function (t) { this.findTarget(t) || (this.fire("mouse:over", { target: null, e: t }), this._hoveredTarget = null) }, _onOrientationChange: function (t, e) { this.__onOrientationChange && this.__onOrientationChange(t, e) }, _onShake: function (t, e) { this.__onShake && this.__onShake(t, e) }, _onLongPress: function (t, e) { this.__onLongPress && this.__onLongPress(t, e) }, _onDragOver: function (t) { t.preventDefault(); var e = this._simpleEventHandler("dragover", t); this._fireEnterLeaveEvents(e, t) }, _onContextMenu: function (t) { return this.stopContextMenu && (t.stopPropagation(), t.preventDefault()), !1 }, _onDoubleClick: function (t) { this._handleEvent(t, "dblclick") }, _onMouseDown: function (t) { this.__onMouseDown(t), i(fabric.document, "touchend", this._onMouseUp, o), i(fabric.document, "touchmove", this._onMouseMove, o), n(this.upperCanvasEl, "mousemove", this._onMouseMove), n(this.upperCanvasEl, "touchmove", this._onMouseMove), "touchstart" === t.type ? n(this.upperCanvasEl, "mousedown", this._onMouseDown) : (i(fabric.document, "mouseup", this._onMouseUp), i(fabric.document, "mousemove", this._onMouseMove)) }, _onMouseUp: function (t) { var e; this.__onMouseUp(t), n(fabric.document, "mouseup", this._onMouseUp), n(fabric.document, "touchend", this._onMouseUp, o), n(fabric.document, "mousemove", this._onMouseMove), n(fabric.document, "touchmove", this._onMouseMove), i(this.upperCanvasEl, "mousemove", this._onMouseMove, o), i(this.upperCanvasEl, "touchmove", this._onMouseMove, o), "touchend" === t.type && (e = this, setTimeout(function () { i(e.upperCanvasEl, "mousedown", e._onMouseDown) }, 400)) }, _onMouseMove: function (t) { !this.allowTouchScrolling && t.preventDefault && t.preventDefault(), this.__onMouseMove(t) }, _onResize: function () { this.calcOffset() }, _shouldRender: function (t, e) { var i = this._activeObject; return (!i || !i.isEditing || t !== i) && !!(t && (t.isMoving || t !== i) || !t && i || !t && !i && !this._groupSelector || e && this._previousPointer && this.selection && (e.x !== this._previousPointer.x || e.y !== this._previousPointer.y)) }, __onMouseUp: function (t) { var e, i = !0, r = this._currentTransform, n = this._groupSelector, n = !n || 0 === n.left && 0 === n.top; s(t, 3) ? this.fireRightClick && this._handleEvent(t, "up", e, 3, n) : s(t, 2) ? this.fireMiddleClick && this._handleEvent(t, "up", e, 2, n) : this.isDrawingMode && this._isCurrentlyDrawing ? this._onMouseUpInDrawingMode(t) : (r && (this._finalizeCurrentTransform(t), i = !r.actionPerformed), e = i ? this.findTarget(t, !0) : r.target, i = this._shouldRender(e, this.getPointer(t)), e || !n ? this._maybeGroupObjects(t) : (this._groupSelector = null, this._currentTransform = null), e && (e.isMoving = !1), this._setCursorFromEvent(t, e), this._handleEvent(t, "up", e || null, 1, n), e && (e.__corner = 0), i && this.requestRenderAll()) }, _simpleEventHandler: function (t, e) { var i = this.findTarget(e), r = this.targets, n = { e: e, target: i, subTargets: r }; if (this.fire(t, n), i && i.fire(t, n), !r) return i; for (var o = 0; o < r.length; o++)r[o].fire(t, n); return i }, _handleEvent: function (t, e, i, r, n) { var i = void 0 === i ? this.findTarget(t) : i, o = this.targets || [], s = { e: t, target: i, subTargets: o, button: r || 1, isClick: n || !1 }; this.fire("mouse:" + e, s), i && i.fire("mouse" + e, s); for (var a = 0; a < o.length; a++)o[a].fire("mouse" + e, s) }, _finalizeCurrentTransform: function (t) { var e = this._currentTransform, i = e.target; i._scaling && (i._scaling = !1), i.setCoords(), (e.actionPerformed || this.stateful && i.hasStateChanged()) && (this.fire("object:modified", { target: i, e: t }), i.fire("modified", { e: t })) }, _onMouseDownInDrawingMode: function (t) { this._isCurrentlyDrawing = !0, this.getActiveObject() && this.discardActiveObject(t).requestRenderAll(), this.clipTo && fabric.util.clipContext(this, this.contextTop); var e = this.getPointer(t); this.freeDrawingBrush.onMouseDown(e), this._handleEvent(t, "down") }, _onMouseMoveInDrawingMode: function (t) { var e; this._isCurrentlyDrawing && (e = this.getPointer(t), this.freeDrawingBrush.onMouseMove(e)), this.setCursor(this.freeDrawingCursor), this._handleEvent(t, "move") }, _onMouseUpInDrawingMode: function (t) { this._isCurrentlyDrawing = !1, this.clipTo && this.contextTop.restore(), this.freeDrawingBrush.onMouseUp(), this._handleEvent(t, "up") }, __onMouseDown: function (t) { var e, i, r, n = this.findTarget(t) || null; s(t, 3) ? this.fireRightClick && this._handleEvent(t, "down", n, 3) : s(t, 2) ? this.fireMiddleClick && this._handleEvent(t, "down", n, 2) : this.isDrawingMode ? this._onMouseDownInDrawingMode(t) : this._currentTransform || (e = this.getPointer(t, !0), this._previousPointer = e, i = this._shouldRender(n, e), r = this._shouldGroup(t, n), this._shouldClearSelection(t, n) ? this.discardActiveObject(t) : r && (this._handleGrouping(t, n), n = this._activeObject), !this.selection || n && (n.selectable || n.isEditing || n === this._activeObject) || (this._groupSelector = { ex: e.x, ey: e.y, top: 0, left: 0 }), n && (n.selectable && this.setActiveObject(n, t), n !== this._activeObject || !n.__corner && r || (this._beforeTransform(t, n), this._setupCurrentTransform(t, n))), this._handleEvent(t, "down", n), i && this.requestRenderAll()) }, _beforeTransform: function (t, e) { this.stateful && e.saveState(), e._findTargetCorner(this.getPointer(t, !0)) && this.onBeforeScaleRotate(e) }, __onMouseMove: function (t) { var e, i, r; this.isDrawingMode ? this._onMouseMoveInDrawingMode(t) : void 0 !== t.touches && 1 < t.touches.length || ((r = this._groupSelector) ? (i = this.getPointer(t, !0), r.left = i.x - r.ex, r.top = i.y - r.ey, this.renderTop()) : this._currentTransform ? this._transformObject(t) : (e = this.findTarget(t) || null, this._setCursorFromEvent(t, e), this._fireOverOutEvents(e, t)), this._handleEvent(t, "move", this._currentTransform ? null : e)) }, _fireOverOutEvents: function (t, e) { this.fireSynteticInOutEvents(t, e, { targetName: "_hoveredTarget", canvasEvtOut: "mouse:out", evtOut: "mouseout", canvasEvtIn: "mouse:over", evtIn: "mouseover" }) }, _fireEnterLeaveEvents: function (t, e) { this.fireSynteticInOutEvents(t, e, { targetName: "_draggedoverTarget", evtOut: "dragleave", evtIn: "dragenter" }) }, fireSynteticInOutEvents: function (t, e, i) { var r, n, o = this[i.targetName], s = o !== t, a = i.canvasEvtIn, h = i.canvasEvtOut; s && (r = { e: e, target: t, previousTarget: o }, n = { e: e, target: o, nextTarget: t }, this[i.targetName] = t), e = t && s, o && s && (h && this.fire(h, n), o.fire(i.evtOut, n)), e && (a && this.fire(a, r), t.fire(i.evtIn, r)) }, __onMouseWheel: function (t) { this._handleEvent(t, "wheel") }, _transformObject: function (t) { var e = this.getPointer(t), i = this._currentTransform; i.reset = !1, i.target.isMoving = !0, i.shiftKey = t.shiftKey, i.altKey = t[this.centeredKey], this._beforeScaleTransform(t, i), this._performTransformAction(t, i, e), i.actionPerformed && this.requestRenderAll() }, _performTransformAction: function (t, e, i) { var r = i.x, i = i.y, n = e.target, o = e.action, s = !1; "rotate" === o ? (s = this._rotateObject(r, i)) && this._fire("rotating", n, t) : "scale" === o ? (s = this._onScale(t, e, r, i)) && this._fire("scaling", n, t) : "scaleX" === o ? (s = this._scaleObject(r, i, "x")) && this._fire("scaling", n, t) : "scaleY" === o ? (s = this._scaleObject(r, i, "y")) && this._fire("scaling", n, t) : "skewX" === o ? (s = this._skewObject(r, i, "x")) && this._fire("skewing", n, t) : "skewY" === o ? (s = this._skewObject(r, i, "y")) && this._fire("skewing", n, t) : (s = this._translateObject(r, i)) && (this._fire("moving", n, t), this.setCursor(n.moveCursor || this.moveCursor)), e.actionPerformed = e.actionPerformed || s }, _fire: function (t, e, i) { this.fire("object:" + t, { target: e, e: i }), e.fire(t, { e: i }) }, _beforeScaleTransform: function (t, e) { var i; "scale" !== e.action && "scaleX" !== e.action && "scaleY" !== e.action || ((i = this._shouldCenterTransform(e.target)) && ("center" !== e.originX || "center" !== e.originY) || !i && "center" === e.originX && "center" === e.originY) && (this._resetCurrentTransform(), e.reset = !0) }, _onScale: function (t, e, i, r) { return this._isUniscalePossible(t, e.target) ? (e.currentAction = "scale", this._scaleObject(i, r)) : (e.reset || "scale" !== e.currentAction || this._resetCurrentTransform(), e.currentAction = "scaleEqually", this._scaleObject(i, r, "equally")) }, _isUniscalePossible: function (t, e) { return (t[this.uniScaleKey] || this.uniScaleTransform) && !e.get("lockUniScaling") }, _setCursorFromEvent: function (t, e) { if (!e) return this.setCursor(this.defaultCursor), !1; var i = e.hoverCursor || this.hoverCursor, r = this._activeObject && "activeSelection" === this._activeObject.type ? this._activeObject : null, r = (!r || !r.contains(e)) && e._findTargetCorner(this.getPointer(t, !0)); r ? this.setCursor(this.getCornerCursor(r, e, t)) : this.setCursor(i) }, getCornerCursor: function (t, e, i) { return this.actionIsDisabled(t, e, i) ? this.notAllowedCursor : t in r ? this._getRotatedCornerCursor(t, e, i) : "mtr" === t && e.hasRotatingPoint ? this.rotationCursor : this.defaultCursor }, actionIsDisabled: function (t, e, i) { return "mt" === t || "mb" === t ? i[this.altActionKey] ? e.lockSkewingX : e.lockScalingY : "ml" === t || "mr" === t ? i[this.altActionKey] ? e.lockSkewingY : e.lockScalingX : "mtr" === t ? e.lockRotation : this._isUniscalePossible(i, e) ? e.lockScalingX && e.lockScalingY : e.lockScalingX || e.lockScalingY }, _getRotatedCornerCursor: function (t, e, i) { e = Math.round(e.angle % 360 / 45); return e < 0 && (e += 8), e += r[t], i[this.altActionKey] && r[t] % 2 == 0 && (e += 2), this.cursorMap[e %= 8] } }) }(), function () { var c = Math.min, f = Math.max; fabric.util.object.extend(fabric.Canvas.prototype, { _shouldGroup: function (t, e) { var i = this._activeObject; return i && this._isSelectionKeyPressed(t) && e && e.selectable && this.selection && (i !== e || "activeSelection" === i.type) }, _handleGrouping: function (t, e) { var i = this._activeObject; i.__corner || e === i && !(e = this.findTarget(t, !0)) || (i && "activeSelection" === i.type ? this._updateActiveSelection(e, t) : this._createActiveSelection(e, t)) }, _updateActiveSelection: function (t, e) { var i = this._activeObject, r = i._objects.slice(0); i.contains(t) ? (i.removeWithUpdate(t), this._hoveredTarget = t, 1 === i.size() && this._setActiveObject(i.item(0), e)) : (i.addWithUpdate(t), this._hoveredTarget = i), this._fireSelectionEvents(r, e) }, _createActiveSelection: function (t, e) { var i = this.getActiveObjects(), t = this._createGroup(t); this._hoveredTarget = t, this._setActiveObject(t, e), this._fireSelectionEvents(i, e) }, _createGroup: function (t) { var e = this.getObjects(), e = e.indexOf(this._activeObject) < e.indexOf(t) ? [this._activeObject, t] : [t, this._activeObject]; return this._activeObject.isEditing && this._activeObject.exitEditing(), new fabric.ActiveSelection(e, { canvas: this }) }, _groupSelectedObjects: function (t) { var e = this._collectObjects(); 1 === e.length ? this.setActiveObject(e[0], t) : 1 < e.length && (e = new fabric.ActiveSelection(e.reverse(), { canvas: this }), this.setActiveObject(e, t)) }, _collectObjects: function () { for (var t, e = [], i = this._groupSelector.ex, r = this._groupSelector.ey, n = i + this._groupSelector.left, o = r + this._groupSelector.top, s = new fabric.Point(c(i, n), c(r, o)), a = new fabric.Point(f(i, n), f(r, o)), h = !this.selectionFullyContained, u = i === n && r === o, l = this._objects.length; l-- && !((t = this._objects[l]) && t.selectable && t.visible && (h && t.intersectsWithRect(s, a) || t.isContainedWithinRect(s, a) || h && t.containsPoint(s) || h && t.containsPoint(a)) && (e.push(t), u));); return e }, _maybeGroupObjects: function (t) { this.selection && this._groupSelector && this._groupSelectedObjects(t), this.setCursor(this.defaultCursor), this._groupSelector = null, this._currentTransform = null } }) }(), function () { var r = fabric.StaticCanvas.supports("toDataURLWithQuality"); fabric.util.object.extend(fabric.StaticCanvas.prototype, { toDataURL: function (t) { var e = (t = t || {}).format || "png", i = t.quality || 1, r = (t.multiplier || 1) * (t.enableRetinaScaling ? 1 : 1 / this.getRetinaScaling()), t = { left: t.left || 0, top: t.top || 0, width: t.width || 0, height: t.height || 0 }; return this.__toDataURLWithMultiplier(e, i, t, r) }, __toDataURLWithMultiplier: function (t, u, e, i) { var r = this.width, n = this.height, o = (e.width || this.width) * i, s = (e.height || this.height) * i, a = this.getZoom() * i, h = this.viewportTransform, c = (h[4] - e.left) * i, i = (h[5] - e.top) * i, f = this.interactive, d = this.skipOffscreen, l = r !== o || n !== s, a = (this.viewportTransform = [a, 0, 0, a, c, i], this.skipOffscreen = !1, this.interactive = !1, l && this.setDimensions({ width: o, height: s }, { backstoreOnly: !0 }), this.renderAll(), this.__toDataURL(t, u, e)); return this.interactive = f, this.skipOffscreen = d, this.viewportTransform = h, l && this.setDimensions({ width: r, height: n }, { backstoreOnly: !0 }), this.renderAll(), a }, __toDataURL: function (t, e) { var i = this.contextContainer.canvas; return "jpg" === t && (t = "jpeg"), r ? i.toDataURL("image/" + t, e) : i.toDataURL("image/" + t) } }) }(), fabric.util.object.extend(fabric.StaticCanvas.prototype, { loadFromDatalessJSON: function (t, e, i) { return this.loadFromJSON(t, e, i) }, loadFromJSON: function (t, e, i) { var r, n, o; if (t) return r = "string" == typeof t ? JSON.parse(t) : fabric.util.object.clone(t), n = this, o = this.renderOnAddRemove, this.renderOnAddRemove = !1, this._enlivenObjects(r.objects, function (t) { n.clear(), n._setBgOverlay(r, function () { t.forEach(function (t, e) { n.insertAt(t, e) }), n.renderOnAddRemove = o, delete r.objects, delete r.backgroundImage, delete r.overlayImage, delete r.background, delete r.overlay, n._setOptions(r), n.renderAll(), e && e() }) }, i), this }, _setBgOverlay: function (t, e) { var i, r = { backgroundColor: !1, overlayColor: !1, backgroundImage: !1, overlayImage: !1 }; t.backgroundImage || t.overlayImage || t.background || t.overlay ? (this.__setBgOverlay("backgroundImage", t.backgroundImage, r, i = function () { r.backgroundImage && r.overlayImage && r.backgroundColor && r.overlayColor && e && e() }), this.__setBgOverlay("overlayImage", t.overlayImage, r, i), this.__setBgOverlay("backgroundColor", t.background, r, i), this.__setBgOverlay("overlayColor", t.overlay, r, i)) : e && e() }, __setBgOverlay: function (e, t, i, r) { var n = this; if (!t) return i[e] = !0, void (r && r()); "backgroundImage" === e || "overlayImage" === e ? fabric.util.enlivenObjects([t], function (t) { n[e] = t[0], i[e] = !0, r && r() }) : this["set" + fabric.util.string.capitalize(e, !0)](t, function () { i[e] = !0, r && r() }) }, _enlivenObjects: function (t, e, i) { t && 0 !== t.length ? fabric.util.enlivenObjects(t, function (t) { e && e(t) }, null, i) : e && e([]) }, _toDataURL: function (e, i) { this.clone(function (t) { i(t.toDataURL(e)) }) }, _toDataURLWithMultiplier: function (e, i, r) { this.clone(function (t) { r(t.toDataURLWithMultiplier(e, i)) }) }, clone: function (e, t) { var i = JSON.stringify(this.toJSON(t)); this.cloneWithoutData(function (t) { t.loadFromJSON(i, function () { e && e(t) }) }) }, cloneWithoutData: function (t) { var e = fabric.document.createElement("canvas"), i = (e.width = this.width, e.height = this.height, new fabric.Canvas(e)); i.clipTo = this.clipTo, this.backgroundImage ? (i.setBackgroundImage(this.backgroundImage.src, function () { i.renderAll(), t && t(i) }), i.backgroundImageOpacity = this.backgroundImageOpacity, i.backgroundImageStretch = this.backgroundImageStretch) : t && t(i) } }), function (t) { "use strict"; var g = t.fabric || (t.fabric = {}), t = g.util.object.extend, o = g.util.object.clone, i = g.util.toFixed, e = g.util.string.capitalize, s = g.util.degreesToRadians, r = g.StaticCanvas.supports("setLineDash"), n = !g.isLikelyNode; g.Object || (g.Object = g.util.createClass(g.CommonMethods, { type: "object", originX: "left", originY: "top", top: 0, left: 0, width: 0, height: 0, scaleX: 1, scaleY: 1, flipX: !1, flipY: !1, opacity: 1, angle: 0, skewX: 0, skewY: 0, cornerSize: 13, transparentCorners: !0, hoverCursor: null, moveCursor: null, padding: 0, borderColor: "rgba(102,153,255,0.75)", borderDashArray: null, cornerColor: "rgba(102,153,255,0.5)", cornerStrokeColor: null, cornerStyle: "rect", cornerDashArray: null, centeredScaling: !1, centeredRotation: !0, fill: "rgb(0,0,0)", fillRule: "nonzero", globalCompositeOperation: "source-over", backgroundColor: "", selectionBackgroundColor: "", stroke: null, strokeWidth: 0, strokeDashArray: null, strokeLineCap: "butt", strokeLineJoin: "miter", strokeMiterLimit: 10, shadow: null, borderOpacityWhenMoving: .4, borderScaleFactor: 1, transformMatrix: null, minScaleLimit: 0, selectable: !0, evented: !0, visible: !0, hasControls: !0, hasBorders: !0, hasRotatingPoint: !0, rotatingPointOffset: 40, perPixelTargetFind: !1, includeDefaultValues: !0, clipTo: null, lockMovementX: !1, lockMovementY: !1, lockRotation: !1, lockScalingX: !1, lockScalingY: !1, lockUniScaling: !1, lockSkewingX: !1, lockSkewingY: !1, lockScalingFlip: !1, excludeFromExport: !1, objectCaching: n, statefullCache: !1, noScaleCache: !0, dirty: !0, __corner: 0, paintFirst: "fill", stateProperties: "top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst".split(" "), cacheProperties: "fill stroke strokeWidth strokeDashArray width height paintFirst strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor".split(" "), initialize: function (t) { t && this.setOptions(t) }, _createCacheCanvas: function () { this._cacheProperties = {}, this._cacheCanvas = g.document.createElement("canvas"), this._cacheContext = this._cacheCanvas.getContext("2d"), this._updateCacheCanvas() }, _limitCacheSize: function (t) { var e = g.perfLimitSizeTotal, i = t.width, r = t.height, n = g.maxCacheSideLimit, o = g.minCacheSideLimit; if (i <= n && r <= n && i * r <= e) return i < o && (t.width = o), r < o && (t.height = o), t; var e = g.util.limitDimsByArea(i / r, e), s = g.util.capValue, a = s(o, e.x, n), s = s(o, e.y, n); return a < i && (t.zoomX /= i / a, t.width = a, t.capped = !0), s < r && (t.zoomY /= r / s, t.height = s, t.capped = !0), t }, _getCacheCanvasDimensions: function () { var t = this.canvas && this.canvas.getZoom() || 1, e = this.getObjectScaling(), i = this.canvas && this.canvas._isRetinaScaling() ? g.devicePixelRatio : 1, r = this._getNonTransformedDimensions(), n = e.scaleX * t * i, e = e.scaleY * t * i; return { width: 2 + r.x * n, height: 2 + r.y * e, zoomX: n, zoomY: e, x: r.x, y: r.y } }, _updateCacheCanvas: function () { if (this.noScaleCache && this.canvas && this.canvas._currentTransform) { var t = this.canvas._currentTransform.target, e = this.canvas._currentTransform.action; if (this === t && e.slice && "scale" === e.slice(0, 5)) return !1 } var i, r, n, t = this._cacheCanvas, e = this._limitCacheSize(this._getCacheCanvasDimensions()), o = g.minCacheSideLimit, s = e.width, a = e.height, h = e.zoomX, l = e.zoomY, u = s !== this.cacheWidth || a !== this.cacheHeight, c = this.zoomX !== h || this.zoomY !== l, f = 0, d = 0, p = !1; return u && (i = this._cacheCanvas.width, r = this._cacheCanvas.height, p = (n = i < s || r < a) || (s < .9 * i || a < .9 * r) && o < i && o < r, n && !e.capped && (o < s || o < a) && (f = .1 * s, d = .1 * a)), (u || c) && (p ? (t.width = Math.ceil(s + f), t.height = Math.ceil(a + d)) : (this._cacheContext.setTransform(1, 0, 0, 1, 0, 0), this._cacheContext.clearRect(0, 0, t.width, t.height)), i = e.x * h / 2, r = e.y * l / 2, this.cacheTranslationX = Math.round(t.width / 2 - i) + i, this.cacheTranslationY = Math.round(t.height / 2 - r) + r, this.cacheWidth = s, this.cacheHeight = a, this._cacheContext.translate(this.cacheTranslationX, this.cacheTranslationY), this._cacheContext.scale(h, l), this.zoomX = h, this.zoomY = l, !0) }, setOptions: function (t) { this._setOptions(t), this._initGradient(t.fill, "fill"), this._initGradient(t.stroke, "stroke"), this._initClipping(t), this._initPattern(t.fill, "fill"), this._initPattern(t.stroke, "stroke") }, transform: function (t) { var e = this.group && !this.group._transformDone ? this.calcTransformMatrix() : this.calcOwnMatrix(); t.transform(e[0], e[1], e[2], e[3], e[4], e[5]) }, toObject: function (t) { var e = g.Object.NUM_FRACTION_DIGITS, e = { type: this.type, version: g.version, originX: this.originX, originY: this.originY, left: i(this.left, e), top: i(this.top, e), width: i(this.width, e), height: i(this.height, e), fill: this.fill && this.fill.toObject ? this.fill.toObject() : this.fill, stroke: this.stroke && this.stroke.toObject ? this.stroke.toObject() : this.stroke, strokeWidth: i(this.strokeWidth, e), strokeDashArray: this.strokeDashArray && this.strokeDashArray.concat(), strokeLineCap: this.strokeLineCap, strokeLineJoin: this.strokeLineJoin, strokeMiterLimit: i(this.strokeMiterLimit, e), scaleX: i(this.scaleX, e), scaleY: i(this.scaleY, e), angle: i(this.angle, e), flipX: this.flipX, flipY: this.flipY, opacity: i(this.opacity, e), shadow: this.shadow && this.shadow.toObject ? this.shadow.toObject() : this.shadow, visible: this.visible, clipTo: this.clipTo && String(this.clipTo), backgroundColor: this.backgroundColor, fillRule: this.fillRule, paintFirst: this.paintFirst, globalCompositeOperation: this.globalCompositeOperation, transformMatrix: this.transformMatrix ? this.transformMatrix.concat() : null, skewX: i(this.skewX, e), skewY: i(this.skewY, e) }; return g.util.populateWithProperties(this, e, t), e = this.includeDefaultValues ? e : this._removeDefaultValues(e) }, toDatalessObject: function (t) { return this.toObject(t) }, _removeDefaultValues: function (e) { var i = g.util.getKlass(e.type).prototype; return i.stateProperties.forEach(function (t) { e[t] === i[t] && delete e[t], "[object Array]" === Object.prototype.toString.call(e[t]) && "[object Array]" === Object.prototype.toString.call(i[t]) && 0 === e[t].length && 0 === i[t].length && delete e[t] }), e }, toString: function () { return "#<fabric." + e(this.type) + ">" }, getObjectScaling: function () { var t, e = this.scaleX, i = this.scaleY; return this.group && (e *= (t = this.group.getObjectScaling()).scaleX, i *= t.scaleY), { scaleX: e, scaleY: i } }, getObjectOpacity: function () { var t = this.opacity; return this.group && (t *= this.group.getObjectOpacity()), t }, _set: function (t, e) { var i = this[t] !== e; return ("scaleX" === t || "scaleY" === t) && (e = this._constrainScale(e)), "scaleX" === t && e < 0 ? (this.flipX = !this.flipX, e *= -1) : "scaleY" === t && e < 0 ? (this.flipY = !this.flipY, e *= -1) : "shadow" !== t || !e || e instanceof g.Shadow ? "dirty" === t && this.group && this.group.set("dirty", e) : e = new g.Shadow(e), this[t] = e, i && (e = this.group && this.group.isOnACache(), -1 < this.cacheProperties.indexOf(t) ? (this.dirty = !0, e && this.group.set("dirty", !0)) : e && -1 < this.stateProperties.indexOf(t) && this.group.set("dirty", !0)), this }, setOnGroup: function () { }, getViewportTransform: function () { return this.canvas && this.canvas.viewportTransform ? this.canvas.viewportTransform : g.iMatrix.concat() }, isNotVisible: function () { return 0 === this.opacity || 0 === this.width && 0 === this.height || !this.visible }, render: function (t) { this.isNotVisible() || this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen() || (t.save(), this._setupCompositeOperation(t), this.drawSelectionBackground(t), this.transform(t), this._setOpacity(t), this._setShadow(t, this), this.transformMatrix && t.transform.apply(t, this.transformMatrix), this.clipTo && g.util.clipContext(this, t), this.shouldCache() ? (this._cacheCanvas || this._createCacheCanvas(), this.isCacheDirty() && (this.statefullCache && this.saveState({ propertySet: "cacheProperties" }), this.drawObject(this._cacheContext), this.dirty = !1), this.drawCacheOnCanvas(t)) : (this._removeCacheCanvas(), this.dirty = !1, this.drawObject(t), this.objectCaching && this.statefullCache && this.saveState({ propertySet: "cacheProperties" })), this.clipTo && t.restore(), t.restore()) }, _removeCacheCanvas: function () { this._cacheCanvas = null, this.cacheWidth = 0, this.cacheHeight = 0 }, needsItsOwnCache: function () { return "stroke" === this.paintFirst && "object" == typeof this.shadow }, shouldCache: function () { return this.ownCaching = this.objectCaching && (!this.group || this.needsItsOwnCache() || !this.group.isOnACache()), this.ownCaching }, willDrawShadow: function () { return !!this.shadow && (0 !== this.shadow.offsetX || 0 !== this.shadow.offsetY) }, drawObject: function (t) { this._renderBackground(t), this._setStrokeStyles(t, this), this._setFillStyles(t, this), this._render(t) }, drawCacheOnCanvas: function (t) { t.scale(1 / this.zoomX, 1 / this.zoomY), t.drawImage(this._cacheCanvas, -this.cacheTranslationX, -this.cacheTranslationY) }, isCacheDirty: function (t) { return !this.isNotVisible() && (!(!this._cacheCanvas || t || !this._updateCacheCanvas()) || !!(this.dirty || this.statefullCache && this.hasStateChanged("cacheProperties")) && (this._cacheCanvas && !t && (t = this.cacheWidth / this.zoomX, e = this.cacheHeight / this.zoomY, this._cacheContext.clearRect(-t / 2, -e / 2, t, e)), !0)); var e }, _renderBackground: function (t) { var e; this.backgroundColor && (e = this._getNonTransformedDimensions(), t.fillStyle = this.backgroundColor, t.fillRect(-e.x / 2, -e.y / 2, e.x, e.y), this._removeShadow(t)) }, _setOpacity: function (t) { this.group && !this.group._transformDone ? t.globalAlpha = this.getObjectOpacity() : t.globalAlpha *= this.opacity }, _setStrokeStyles: function (t, e) { e.stroke && (t.lineWidth = e.strokeWidth, t.lineCap = e.strokeLineCap, t.lineJoin = e.strokeLineJoin, t.miterLimit = e.strokeMiterLimit, t.strokeStyle = e.stroke.toLive ? e.stroke.toLive(t, this) : e.stroke) }, _setFillStyles: function (t, e) { e.fill && (t.fillStyle = e.fill.toLive ? e.fill.toLive(t, this) : e.fill) }, _setLineDash: function (t, e, i) { e && (1 & e.length && e.push.apply(e, e), r ? t.setLineDash(e) : i && i(t)) }, _renderControls: function (t, e) { var i = this.getViewportTransform(), r = this.calcTransformMatrix(), n = (void 0 !== (e = e || {}).hasBorders ? e : this).hasBorders, o = (void 0 !== e.hasControls ? e : this).hasControls, r = g.util.multiplyTransformMatrices(i, r), i = g.util.qrDecompose(r); t.save(), t.translate(i.translateX, i.translateY), t.lineWidth = +this.borderScaleFactor, this.group || (t.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1), e.forActiveSelection ? (t.rotate(s(i.angle)), n && this.drawBordersInGroup(t, i, e)) : (t.rotate(s(this.angle)), n && this.drawBorders(t, e)), o && this.drawControls(t, e), t.restore() }, _setShadow: function (t) { var e, i, r; this.shadow && (e = this.canvas && this.canvas.viewportTransform[0] || 1, i = this.canvas && this.canvas.viewportTransform[3] || 1, r = this.getObjectScaling(), this.canvas && this.canvas._isRetinaScaling() && (e *= g.devicePixelRatio, i *= g.devicePixelRatio), t.shadowColor = this.shadow.color, t.shadowBlur = this.shadow.blur * g.browserShadowBlurConstant * (e + i) * (r.scaleX + r.scaleY) / 4, t.shadowOffsetX = this.shadow.offsetX * e * r.scaleX, t.shadowOffsetY = this.shadow.offsetY * i * r.scaleY) }, _removeShadow: function (t) { this.shadow && (t.shadowColor = "", t.shadowBlur = t.shadowOffsetX = t.shadowOffsetY = 0) }, _applyPatternGradientTransform: function (t, e) { if (!e || !e.toLive) return { offsetX: 0, offsetY: 0 }; var i = e.gradientTransform || e.patternTransform, r = -this.width / 2 + e.offsetX || 0, e = -this.height / 2 + e.offsetY || 0; return t.translate(r, e), i && t.transform(i[0], i[1], i[2], i[3], i[4], i[5]), { offsetX: r, offsetY: e } }, _renderPaintInOrder: function (t) { "stroke" === this.paintFirst ? (this._renderStroke(t), this._renderFill(t)) : (this._renderFill(t), this._renderStroke(t)) }, _renderFill: function (t) { this.fill && (t.save(), this._applyPatternGradientTransform(t, this.fill), "evenodd" === this.fillRule ? t.fill("evenodd") : t.fill(), t.restore()) }, _renderStroke: function (t) { this.stroke && 0 !== this.strokeWidth && (this.shadow && !this.shadow.affectStroke && this._removeShadow(t), t.save(), this._setLineDash(t, this.strokeDashArray, this._renderDashedStroke), this._applyPatternGradientTransform(t, this.stroke), t.stroke(), t.restore()) }, _findCenterFromElement: function () { return { x: this.left + this.width / 2, y: this.top + this.height / 2 } }, _assignTransformMatrixProps: function () { var t; this.transformMatrix && (t = g.util.qrDecompose(this.transformMatrix), this.flipX = !1, this.flipY = !1, this.set("scaleX", t.scaleX), this.set("scaleY", t.scaleY), this.angle = t.angle, this.skewX = t.skewX, this.skewY = 0) }, _removeTransformMatrix: function (t) { var e = this._findCenterFromElement(); this.transformMatrix && (this._assignTransformMatrixProps(), e = g.util.transformPoint(e, this.transformMatrix)), this.transformMatrix = null, t && (this.scaleX *= t.scaleX, this.scaleY *= t.scaleY, this.cropX = t.cropX, this.cropY = t.cropY, e.x += t.offsetLeft, e.y += t.offsetTop, this.width = t.width, this.height = t.height), this.setPositionByOrigin(e, "center", "center") }, clone: function (t, e) { e = this.toObject(e); this.constructor.fromObject ? this.constructor.fromObject(e, t) : g.Object._fromObject("Object", e, t) }, cloneAsImage: function (e, t) { t = this.toDataURL(t); return g.util.loadImage(t, function (t) { e && e(new g.Image(t)) }), this }, toDataURL: function (t) { t = t || {}; var e = g.util.createCanvasElement(), i = this.getBoundingRect(), i = (e.width = i.width, e.height = i.height, g.util.wrapElement(e, "div"), new g.StaticCanvas(e, { enableRetinaScaling: t.enableRetinaScaling, renderOnAddRemove: !1, skipOffscreen: !1 })), e = ("jpg" === t.format && (t.format = "jpeg"), "jpeg" === t.format && (i.backgroundColor = "#fff"), { left: this.left, top: this.top }), r = (this.setPositionByOrigin(new g.Point(i.width / 2, i.height / 2), "center", "center"), this.canvas), t = (i.add(this), i.toDataURL(t)); return this.set(e).setCoords(), this.canvas = r, i._objects = [], i.dispose(), i = null, t }, isType: function (t) { return this.type === t }, complexity: function () { return 1 }, toJSON: function (t) { return this.toObject(t) }, setGradient: function (t, e) { var i = { colorStops: [] }; return i.type = (e = e || {}).type || (e.r1 || e.r2 ? "radial" : "linear"), i.coords = { x1: e.x1, y1: e.y1, x2: e.x2, y2: e.y2 }, (e.r1 || e.r2) && (i.coords.r1 = e.r1, i.coords.r2 = e.r2), i.gradientTransform = e.gradientTransform, g.Gradient.prototype.addColorStop.call(i, e.colorStops), this.set(t, g.Gradient.forObject(this, i)) }, setPatternFill: function (t) { return this.set("fill", new g.Pattern(t)) }, setShadow: function (t) { return this.set("shadow", t ? new g.Shadow(t) : null) }, setColor: function (t) { return this.set("fill", t), this }, rotate: function (t) { var e = ("center" !== this.originX || "center" !== this.originY) && this.centeredRotation; return e && this._setOriginToCenter(), this.set("angle", t), e && this._resetOrigin(), this }, centerH: function () { return this.canvas && this.canvas.centerObjectH(this), this }, viewportCenterH: function () { return this.canvas && this.canvas.viewportCenterObjectH(this), this }, centerV: function () { return this.canvas && this.canvas.centerObjectV(this), this }, viewportCenterV: function () { return this.canvas && this.canvas.viewportCenterObjectV(this), this }, center: function () { return this.canvas && this.canvas.centerObject(this), this }, viewportCenter: function () { return this.canvas && this.canvas.viewportCenterObject(this), this }, getLocalPointer: function (t, e) { e = e || this.canvas.getPointer(t); t = new g.Point(e.x, e.y), e = this._getLeftTopCoords(); return { x: (t = this.angle ? g.util.rotatePoint(t, e, s(-this.angle)) : t).x - e.x, y: t.y - e.y } }, _setupCompositeOperation: function (t) { this.globalCompositeOperation && (t.globalCompositeOperation = this.globalCompositeOperation) } }), g.util.createAccessors && g.util.createAccessors(g.Object), t(g.Object.prototype, g.Observable), g.Object.NUM_FRACTION_DIGITS = 2, g.Object._fromObject = function (t, e, i, r) { var n = g[t]; e = o(e, !0), g.util.enlivenPatterns([e.fill, e.stroke], function (t) { void 0 !== t[0] && (e.fill = t[0]), void 0 !== t[1] && (e.stroke = t[1]); t = r ? new n(e[r], e) : new n(e); i && i(t) }) }, g.Object.__uid = 0) }("undefined" != typeof exports ? exports : this), function () { var o = fabric.util.degreesToRadians, a = { left: -.5, center: 0, right: .5 }, h = { top: -.5, center: 0, bottom: .5 }; fabric.util.object.extend(fabric.Object.prototype, { translateToGivenOrigin: function (t, e, i, r, n) { var o = t.x, s = t.y; return "string" == typeof e ? e = a[e] : e -= .5, "string" == typeof r ? r = a[r] : r -= .5, "string" == typeof i ? i = h[i] : i -= .5, "string" == typeof n ? n = h[n] : n -= .5, n = n - i, ((i = r - e) || n) && (r = this._getTransformedDimensions(), o = t.x + i * r.x, s = t.y + n * r.y), new fabric.Point(o, s) }, translateToCenterPoint: function (t, e, i) { e = this.translateToGivenOrigin(t, e, i, "center", "center"); return this.angle ? fabric.util.rotatePoint(e, t, o(this.angle)) : e }, translateToOriginPoint: function (t, e, i) { e = this.translateToGivenOrigin(t, "center", "center", e, i); return this.angle ? fabric.util.rotatePoint(e, t, o(this.angle)) : e }, getCenterPoint: function () { var t = new fabric.Point(this.left, this.top); return this.translateToCenterPoint(t, this.originX, this.originY) }, getPointByOrigin: function (t, e) { var i = this.getCenterPoint(); return this.translateToOriginPoint(i, t, e) }, toLocalPoint: function (t, e, i) { var r = this.getCenterPoint(), e = void 0 !== e && void 0 !== i ? this.translateToGivenOrigin(r, "center", "center", e, i) : new fabric.Point(this.left, this.top), i = new fabric.Point(t.x, t.y); return (i = this.angle ? fabric.util.rotatePoint(i, r, -o(this.angle)) : i).subtractEquals(e) }, setPositionByOrigin: function (t, e, i) { t = this.translateToCenterPoint(t, e, i), e = this.translateToOriginPoint(t, this.originX, this.originY); this.set("left", e.x), this.set("top", e.y) }, adjustPosition: function (t) { var e = o(this.angle), i = this.getScaledWidth(), r = fabric.util.cos(e) * i, e = fabric.util.sin(e) * i, i = "string" == typeof this.originX ? a[this.originX] : this.originX - .5, n = "string" == typeof t ? a[t] : t - .5; this.left += r * (n - i), this.top += e * (n - i), this.setCoords(), this.originX = t }, _setOriginToCenter: function () { this._originalOriginX = this.originX, this._originalOriginY = this.originY; var t = this.getCenterPoint(); this.originX = "center", this.originY = "center", this.left = t.x, this.top = t.y }, _resetOrigin: function () { var t = this.translateToOriginPoint(this.getCenterPoint(), this._originalOriginX, this._originalOriginY); this.originX = this._originalOriginX, this.originY = this._originalOriginY, this.left = t.x, this.top = t.y, this._originalOriginX = null, this._originalOriginY = null }, _getLeftTopCoords: function () { return this.translateToOriginPoint(this.getCenterPoint(), "left", "top") }, onDeselect: function () { } }) }(), function () { var f = fabric.util.degreesToRadians, d = fabric.util.multiplyTransformMatrices, p = fabric.util.transformPoint; fabric.util.object.extend(fabric.Object.prototype, { oCoords: null, aCoords: null, ownMatrixCache: null, matrixCache: null, getCoords: function (t, e) { this.oCoords || this.setCoords(); var i = t ? this.aCoords : this.oCoords; return e = e ? this.calcCoords(t) : i, [new fabric.Point(e.tl.x, e.tl.y), new fabric.Point(e.tr.x, e.tr.y), new fabric.Point(e.br.x, e.br.y), new fabric.Point(e.bl.x, e.bl.y)] }, intersectsWithRect: function (t, e, i, r) { i = this.getCoords(i, r); return "Intersection" === fabric.Intersection.intersectPolygonRectangle(i, t, e).status }, intersectsWithObject: function (t, e, i) { return "Intersection" === fabric.Intersection.intersectPolygonPolygon(this.getCoords(e, i), t.getCoords(e, i)).status || t.isContainedWithinObject(this, e, i) || this.isContainedWithinObject(t, e, i) }, isContainedWithinObject: function (t, e, i) { for (var r = this.getCoords(e, i), n = 0, o = t._getImageLines(i ? t.calcCoords(e) : e ? t.aCoords : t.oCoords); n < 4; n++)if (!t.containsPoint(r[n], o)) return !1; return !0 }, isContainedWithinRect: function (t, e, i, r) { i = this.getBoundingRect(i, r); return i.left >= t.x && i.left + i.width <= e.x && i.top >= t.y && i.top + i.height <= e.y }, containsPoint: function (t, e, i, r) { e = e || this._getImageLines(r ? this.calcCoords(i) : i ? this.aCoords : this.oCoords), r = this._findCrossPoints(t, e); return 0 !== r && r % 2 == 1 }, isOnScreen: function (t) { if (!this.canvas) return !1; for (var e, i = this.canvas.vptCoords.tl, r = this.canvas.vptCoords.br, n = this.getCoords(!0, t), o = 0; o < 4; o++)if ((e = n[o]).x <= r.x && e.x >= i.x && e.y <= r.y && e.y >= i.y) return !0; return !!this.intersectsWithRect(i, r, !0, t) || this._containsCenterOfCanvas(i, r, t) }, _containsCenterOfCanvas: function (t, e, i) { t = { x: (t.x + e.x) / 2, y: (t.y + e.y) / 2 }; return !!this.containsPoint(t, null, !0, i) }, isPartiallyOnScreen: function (t) { if (!this.canvas) return !1; var e = this.canvas.vptCoords.tl, i = this.canvas.vptCoords.br; return !!this.intersectsWithRect(e, i, !0, t) || this._containsCenterOfCanvas(e, i, t) }, _getImageLines: function (t) { return { topline: { o: t.tl, d: t.tr }, rightline: { o: t.tr, d: t.br }, bottomline: { o: t.br, d: t.bl }, leftline: { o: t.bl, d: t.tl } } }, _findCrossPoints: function (t, e) { var i, r, n, o = 0; for (n in e) if (!((r = e[n]).o.y < t.y && r.d.y < t.y || r.o.y >= t.y && r.d.y >= t.y || ((r.o.x === r.d.x && r.o.x >= t.x ? r.o.x : (i = (r.d.y - r.o.y) / (r.d.x - r.o.x), -(t.y - 0 * t.x - (r.o.y - i * r.o.x)) / (0 - i))) >= t.x && (o += 1), 2 !== o))) break; return o }, getBoundingRect: function (t, e) { t = this.getCoords(t, e); return fabric.util.makeBoundingBoxFromPoints(t) }, getScaledWidth: function () { return this._getTransformedDimensions().x }, getScaledHeight: function () { return this._getTransformedDimensions().y }, _constrainScale: function (t) { return Math.abs(t) < this.minScaleLimit ? t < 0 ? -this.minScaleLimit : this.minScaleLimit : 0 === t ? 1e-4 : t }, scale: function (t) { return this._set("scaleX", t), this._set("scaleY", t), this.setCoords() }, scaleToWidth: function (t, e) { e = this.getBoundingRect(e).width / this.getScaledWidth(); return this.scale(t / this.width / e) }, scaleToHeight: function (t, e) { e = this.getBoundingRect(e).height / this.getScaledHeight(); return this.scale(t / this.height / e) }, calcCoords: function (u) { var t, e, i, c, r, n = this._calcRotateMatrix(), o = this._calcTranslateMatrix(), o = d(o, n), n = this.getViewportTransform(), n = u ? o : d(n, o), o = this._getTransformedDimensions(), s = o.x / 2, o = o.y / 2, a = p({ x: -s, y: -o }, n), h = p({ x: s, y: -o }, n), l = p({ x: -s, y: o }, n), s = p({ x: s, y: o }, n), o = (u || (o = this.padding, n = f(this.angle), i = (e = (r = fabric.util.cos(n)) * o) + (t = (n = fabric.util.sin(n)) * o), e = e - t, o && (a.x -= e, a.y -= i, h.x += i, h.y -= e, l.x -= i, l.y += e, s.x += e, s.y += i), t = new fabric.Point((a.x + l.x) / 2, (a.y + l.y) / 2), e = new fabric.Point((h.x + a.x) / 2, (h.y + a.y) / 2), i = new fabric.Point((s.x + h.x) / 2, (s.y + h.y) / 2), c = new fabric.Point((s.x + l.x) / 2, (s.y + l.y) / 2), r = new fabric.Point(e.x + n * this.rotatingPointOffset, e.y - r * this.rotatingPointOffset)), { tl: a, tr: h, br: s, bl: l }); return u || (o.ml = t, o.mt = e, o.mr = i, o.mb = c, o.mtr = r), o }, setCoords: function (t, e) { return this.oCoords = this.calcCoords(t), e || (this.aCoords = this.calcCoords(!0)), t || this._setCornerCoords && this._setCornerCoords(), this }, _calcRotateMatrix: function () { var t, e; return this.angle ? (e = f(this.angle), [t = fabric.util.cos(e), e = fabric.util.sin(e), -e, t, 0, 0]) : fabric.iMatrix.concat() }, _calcTranslateMatrix: function () { var t = this.getCenterPoint(); return [1, 0, 0, 1, t.x, t.y] }, transformMatrixKey: function (t) { var e = ""; return (e = !t && this.group ? this.group.transformMatrixKey(t) + "_" : e) + this.top + "_" + this.left + "_" + this.scaleX + "_" + this.scaleY + "_" + this.skewX + "_" + this.skewY + "_" + this.angle + "_" + this.originX + "_" + this.originY + "_" + this.width + "_" + this.height + "_" + this.strokeWidth + this.flipX + this.flipY }, calcTransformMatrix: function (t) { if (t) return this.calcOwnMatrix(); var t = this.transformMatrixKey(), e = this.matrixCache || (this.matrixCache = {}); if (e.key === t) return e.value; var i = this.calcOwnMatrix(); return this.group && (i = d(this.group.calcTransformMatrix(), i)), e.key = t, e.value = i }, calcOwnMatrix: function () { var t = this.transformMatrixKey(!0), e = this.ownMatrixCache || (this.ownMatrixCache = {}); if (e.key === t) return e.value; var i, r = this._calcTranslateMatrix(), n = this._calcDimensionsTransformMatrix(this.skewX, this.skewY, !0); return this.angle && (i = this._calcRotateMatrix(), r = d(r, i)), r = d(r, n), e.key = t, e.value = r }, _calcDimensionsTransformMatrix: function (t, e, i) { var r, i = [this.scaleX * (i && this.flipX ? -1 : 1), 0, 0, this.scaleY * (i && this.flipY ? -1 : 1), 0, 0]; return t && (r = [1, 0, Math.tan(f(t)), 1], i = d(i, r, !0)), e && (r = [1, Math.tan(f(e)), 0, 1], i = d(i, r, !0)), i }, _getNonTransformedDimensions: function () { var t = this.strokeWidth; return { x: this.width + t, y: this.height + t } }, _getTransformedDimensions: function (t, e) { void 0 === t && (t = this.skewX), void 0 === e && (e = this.skewY); var i = this._getNonTransformedDimensions(); if (0 === t && 0 === e) return { x: i.x * this.scaleX, y: i.y * this.scaleY }; for (var r = i.x / 2, i = i.y / 2, n = [{ x: -r, y: -i }, { x: r, y: -i }, { x: -r, y: i }, { x: r, y: i }], o = this._calcDimensionsTransformMatrix(t, e, !1), s = 0; s < n.length; s++)n[s] = fabric.util.transformPoint(n[s], o); return { x: (r = fabric.util.makeBoundingBoxFromPoints(n)).width, y: r.height } }, _calculateCurrentDimensions: function () { var t = this.getViewportTransform(), e = this._getTransformedDimensions(); return fabric.util.transformPoint(e, t, !0).scalarAdd(2 * this.padding) } }) }(), fabric.util.object.extend(fabric.Object.prototype, { sendToBack: function () { return this.group ? fabric.StaticCanvas.prototype.sendToBack.call(this.group, this) : this.canvas.sendToBack(this), this }, bringToFront: function () { return this.group ? fabric.StaticCanvas.prototype.bringToFront.call(this.group, this) : this.canvas.bringToFront(this), this }, sendBackwards: function (t) { return this.group ? fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, t) : this.canvas.sendBackwards(this, t), this }, bringForward: function (t) { return this.group ? fabric.StaticCanvas.prototype.bringForward.call(this.group, this, t) : this.canvas.bringForward(this, t), this }, moveTo: function (t) { return this.group && "activeSelection" !== this.group.type ? fabric.StaticCanvas.prototype.moveTo.call(this.group, this, t) : this.canvas.moveTo(this, t), this } }), function () { function u(t, e) { var i; return e ? e.toLive ? t + ": url(#SVGID_" + e.id + "); " : (i = t + ": " + (e = new fabric.Color(e)).toRgb() + "; ", 1 !== (e = e.getAlpha()) && (i += t + "-opacity: " + e.toString() + "; "), i) : t + ": none; " } var s = fabric.util.toFixed; fabric.util.object.extend(fabric.Object.prototype, { getSvgStyles: function (t) { var e = this.fillRule, i = this.strokeWidth || "0", r = this.strokeDashArray ? this.strokeDashArray.join(" ") : "none", n = this.strokeLineCap || "butt", o = this.strokeLineJoin || "miter", s = this.strokeMiterLimit || "4", a = void 0 !== this.opacity ? this.opacity : "1", h = this.visible ? "" : " visibility: hidden;", t = t ? "" : this.getSvgFilter(), l = u("fill", this.fill); return [u("stroke", this.stroke), "stroke-width: ", i, "; ", "stroke-dasharray: ", r, "; ", "stroke-linecap: ", n, "; ", "stroke-linejoin: ", o, "; ", "stroke-miterlimit: ", s, "; ", l, "fill-rule: ", e, "; ", "opacity: ", a, ";", t, h].join("") }, getSvgSpanStyles: function (t, e) { var i = t.fontFamily ? "font-family: " + (-1 === t.fontFamily.indexOf("'") && -1 === t.fontFamily.indexOf('"') ? "'" + t.fontFamily + "'" : t.fontFamily) + "; " : "", r = t.strokeWidth ? "stroke-width: " + t.strokeWidth + "; " : "", n = t.fontSize ? "font-size: " + t.fontSize + "px; " : "", o = t.fontStyle ? "font-style: " + t.fontStyle + "; " : "", s = t.fontWeight ? "font-weight: " + t.fontWeight + "; " : "", a = t.fill ? u("fill", t.fill) : "", h = t.stroke ? u("stroke", t.stroke) : "", l = this.getSvgTextDecoration(t); return [h, r, i, n, o, s, l = l && "text-decoration: " + l + "; ", a, t.deltaY ? "baseline-shift: " + -t.deltaY + "; " : "", e ? "white-space: pre; " : ""].join("") }, getSvgTextDecoration: function (t) { return "overline" in t || "underline" in t || "linethrough" in t ? (t.overline ? "overline " : "") + (t.underline ? "underline " : "") + (t.linethrough ? "line-through " : "") : "" }, getSvgFilter: function () { return this.shadow ? "filter: url(#SVGID_" + this.shadow.id + ");" : "" }, getSvgId: function () { return this.id ? 'id="' + this.id + '" ' : "" }, getSvgTransform: function () { var t = this.angle, e = this.skewX % 360, i = this.skewY % 360, r = this.getCenterPoint(), n = fabric.Object.NUM_FRACTION_DIGITS, r = "translate(" + s(r.x, n) + " " + s(r.y, n) + ")", t = 0 !== t ? " rotate(" + s(t, n) + ")" : "", o = 1 === this.scaleX && 1 === this.scaleY ? "" : " scale(" + s(this.scaleX, n) + " " + s(this.scaleY, n) + ")", e = 0 != e ? " skewX(" + s(e, n) + ")" : "", i = 0 != i ? " skewY(" + s(i, n) + ")" : ""; return [r, t, o, this.flipX ? " matrix(-1 0 0 1 0 0) " : "", this.flipY ? " matrix(1 0 0 -1 0 0)" : "", e, i].join("") }, getSvgTransformMatrix: function () { return this.transformMatrix ? " matrix(" + this.transformMatrix.join(" ") + ") " : "" }, _setSVGBg: function (t) { var e; this.backgroundColor && (e = fabric.Object.NUM_FRACTION_DIGITS, t.push("\t\t<rect ", this._getFillAttributes(this.backgroundColor), ' x="', s(-this.width / 2, e), '" y="', s(-this.height / 2, e), '" width="', s(this.width, e), '" height="', s(this.height, e), '"></rect>\n')) }, _createBaseSVGMarkup: function () { var t = []; return this.fill && this.fill.toLive && t.push(this.fill.toSVG(this, !1)), this.stroke && this.stroke.toLive && t.push(this.stroke.toSVG(this, !1)), this.shadow && t.push(this.shadow.toSVG(this)), t }, addPaintOrder: function () { return "fill" !== this.paintFirst ? ' paint-order="' + this.paintFirst + '" ' : "" } }) }(), function () { var n = fabric.util.object.extend, r = "stateProperties"; function o(e, t, i) { var r = {}; i.forEach(function (t) { r[t] = e[t] }), n(e[t], r, !0) } fabric.util.object.extend(fabric.Object.prototype, { hasStateChanged: function (t) { var e = "_" + (t = t || r); return Object.keys(this[e]).length < this[t].length || !function t(e, i, r) { if (e === i) return 1; if (Array.isArray(e)) { if (Array.isArray(i) && e.length === i.length) { for (var n = 0, o = e.length; n < o; n++)if (!t(e[n], i[n])) return; return 1 } } else if (e && "object" == typeof e) { var s, a = Object.keys(e); if (i && "object" == typeof i && (r || a.length === Object.keys(i).length)) { for (n = 0, o = a.length; n < o; n++)if (!t(e[s = a[n]], i[s])) return; return 1 } } }(this[e], this, !0) }, saveState: function (t) { var e = t && t.propertySet || r, i = "_" + e; return this[i] ? (o(this, i, this[e]), t && t.stateProperties && o(this, i, t.stateProperties), this) : this.setupState(t) }, setupState: function (t) { var e = (t = t || {}).propertySet || r; return this["_" + (t.propertySet = e)] = {}, this.saveState(t), this } }) }(), function () { var h = fabric.util.degreesToRadians; fabric.util.object.extend(fabric.Object.prototype, { _controlsVisibility: null, _findTargetCorner: function (t) { if (!this.hasControls || this.group || !this.canvas || this.canvas._activeObject !== this) return !1; var e, i, r = t.x, n = t.y; for (i in this.__corner = 0, this.oCoords) if (this.isControlVisible(i) && ("mtr" !== i || this.hasRotatingPoint) && (!this.get("lockUniScaling") || "mt" !== i && "mr" !== i && "mb" !== i && "ml" !== i) && (e = this._getImageLines(this.oCoords[i].corner), 0 !== (e = this._findCrossPoints({ x: r, y: n }, e)) && e % 2 == 1)) return this.__corner = i; return !1 }, _setCornerCoords: function () { var t, e, i, r = this.oCoords, n = h(45 - this.angle), o = .707106 * this.cornerSize, s = o * fabric.util.cos(n), a = o * fabric.util.sin(n); for (i in r) t = r[i].x, e = r[i].y, r[i].corner = { tl: { x: t - a, y: e - s }, tr: { x: t + s, y: e - a }, bl: { x: t - s, y: e + a }, br: { x: t + a, y: e + s } } }, drawSelectionBackground: function (t) { if (!this.selectionBackgroundColor || this.canvas && !this.canvas.interactive || this.canvas && this.canvas._activeObject !== this) return this; t.save(); var e = this.getCenterPoint(), i = this._calculateCurrentDimensions(), r = this.canvas.viewportTransform; return t.translate(e.x, e.y), t.scale(1 / r[0], 1 / r[3]), t.rotate(h(this.angle)), t.fillStyle = this.selectionBackgroundColor, t.fillRect(-i.x / 2, -i.y / 2, i.x, i.y), t.restore(), this }, drawBorders: function (t, e) { e = e || {}; var i = this._calculateCurrentDimensions(), r = 1 / this.borderScaleFactor, n = i.x + r, i = i.y + r, r = (void 0 !== e.hasRotatingPoint ? e : this).hasRotatingPoint, o = (void 0 !== e.hasControls ? e : this).hasControls, s = (void 0 !== e.rotatingPointOffset ? e : this).rotatingPointOffset; return t.save(), t.strokeStyle = e.borderColor || this.borderColor, this._setLineDash(t, e.borderDashArray || this.borderDashArray, null), t.strokeRect(-n / 2, -i / 2, n, i), r && this.isControlVisible("mtr") && o && (e = -i / 2, t.beginPath(), t.moveTo(0, e), t.lineTo(0, e - s), t.stroke()), t.restore(), this }, drawBordersInGroup: function (t, e, i) { i = i || {}; var r = this._getNonTransformedDimensions(), e = fabric.util.customTransformMatrix(e.scaleX, e.scaleY, e.skewX), r = fabric.util.transformPoint(r, e), e = 1 / this.borderScaleFactor, n = r.x + e, r = r.y + e; return t.save(), this._setLineDash(t, i.borderDashArray || this.borderDashArray, null), t.strokeStyle = i.borderColor || this.borderColor, t.strokeRect(-n / 2, -r / 2, n, r), t.restore(), this }, drawControls: function (t, e) { e = e || {}; var i = this._calculateCurrentDimensions(), r = i.x, i = i.y, n = e.cornerSize || this.cornerSize, o = -(r + n) / 2, n = -(i + n) / 2, s = (void 0 !== e.transparentCorners ? e : this).transparentCorners, a = (void 0 !== e.hasRotatingPoint ? e : this).hasRotatingPoint, s = s ? "stroke" : "fill"; return t.save(), t.strokeStyle = t.fillStyle = e.cornerColor || this.cornerColor, this.transparentCorners || (t.strokeStyle = e.cornerStrokeColor || this.cornerStrokeColor), this._setLineDash(t, e.cornerDashArray || this.cornerDashArray, null), this._drawControl("tl", t, s, o, n, e), this._drawControl("tr", t, s, o + r, n, e), this._drawControl("bl", t, s, o, n + i, e), this._drawControl("br", t, s, o + r, n + i, e), this.get("lockUniScaling") || (this._drawControl("mt", t, s, o + r / 2, n, e), this._drawControl("mb", t, s, o + r / 2, n + i, e), this._drawControl("mr", t, s, o + r, n + i / 2, e), this._drawControl("ml", t, s, o, n + i / 2, e)), a && this._drawControl("mtr", t, s, o + r / 2, n - this.rotatingPointOffset, e), t.restore(), this }, _drawControl: function (t, e, i, r, n, o) { var s; o = o || {}, this.isControlVisible(t) && (t = this.cornerSize, s = !this.transparentCorners && this.cornerStrokeColor, "circle" === (o.cornerStyle || this.cornerStyle) ? (e.beginPath(), e.arc(r + t / 2, n + t / 2, t / 2, 0, 2 * Math.PI, !1), e[i](), s && e.stroke()) : (this.transparentCorners || e.clearRect(r, n, t, t), e[i + "Rect"](r, n, t, t), s && e.strokeRect(r, n, t, t))) }, isControlVisible: function (t) { return this._getControlsVisibility()[t] }, setControlVisible: function (t, e) { return this._getControlsVisibility()[t] = e, this }, setControlsVisibility: function (t) { for (var e in t = t || {}) this.setControlVisible(e, t[e]); return this }, _getControlsVisibility: function () { return this._controlsVisibility || (this._controlsVisibility = { tl: !0, tr: !0, br: !0, bl: !0, ml: !0, mt: !0, mr: !0, mb: !0, mtr: !0 }), this._controlsVisibility }, onDeselect: function () { }, onSelect: function () { } }) }(), fabric.util.object.extend(fabric.StaticCanvas.prototype, { FX_DURATION: 500, fxCenterObjectH: function (e, t) { function i() { } var r = (t = t || {}).onComplete || i, n = t.onChange || i, o = this; return fabric.util.animate({ startValue: e.left, endValue: this.getCenter().left, duration: this.FX_DURATION, onChange: function (t) { e.set("left", t), o.requestRenderAll(), n() }, onComplete: function () { e.setCoords(), r() } }), this }, fxCenterObjectV: function (e, t) { function i() { } var r = (t = t || {}).onComplete || i, n = t.onChange || i, o = this; return fabric.util.animate({ startValue: e.top, endValue: this.getCenter().top, duration: this.FX_DURATION, onChange: function (t) { e.set("top", t), o.requestRenderAll(), n() }, onComplete: function () { e.setCoords(), r() } }), this }, fxRemove: function (e, t) { function i() { } var r = (t = t || {}).onComplete || i, n = t.onChange || i, o = this; return fabric.util.animate({ startValue: e.opacity, endValue: 0, duration: this.FX_DURATION, onChange: function (t) { e.set("opacity", t), o.requestRenderAll(), n() }, onComplete: function () { o.remove(e), r() } }), this } }), fabric.util.object.extend(fabric.Object.prototype, { animate: function () { if (arguments[0] && "object" == typeof arguments[0]) { var t, e, i = []; for (t in arguments[0]) i.push(t); for (var r = 0, n = i.length; r < n; r++)t = i[r], e = r !== n - 1, this._animate(t, arguments[0][t], arguments[1], e) } else this._animate.apply(this, arguments); return this }, _animate: function (r, t, n, o) { var s, a = this, e = (t = t.toString(), n = n ? fabric.util.object.clone(n) : {}, (s = ~r.indexOf(".") ? r.split(".") : s) ? this.get(s[0])[s[1]] : this.get(r)); "from" in n || (n.from = e), t = ~t.indexOf("=") ? e + parseFloat(t.replace("=", "")) : parseFloat(t), fabric.util.animate({ startValue: n.from, endValue: t, byValue: n.by, easing: n.easing, duration: n.duration, abort: n.abort && function () { return n.abort.call(a) }, onChange: function (t, e, i) { s ? a[s[0]][s[1]] = t : a.set(r, t), o || n.onChange && n.onChange(t, e, i) }, onComplete: function (t, e, i) { o || (a.setCoords(), n.onComplete && n.onComplete(t, e, i)) } }) } }), function (t) { "use strict"; var n = t.fabric || (t.fabric = {}), o = n.util.object.extend, r = n.util.object.clone, i = { x1: 1, x2: 1, y1: 1, y2: 1 }, s = n.StaticCanvas.supports("setLineDash"); function e(t, e) { var i = t.origin, r = t.axis1, n = t.axis2, o = t.dimension, s = e.nearest, a = e.center, h = e.farthest; return function () { switch (this.get(i)) { case s: return Math.min(this.get(r), this.get(n)); case a: return Math.min(this.get(r), this.get(n)) + .5 * this.get(o); case h: return Math.max(this.get(r), this.get(n)) } } } n.Line ? n.warn("fabric.Line is already defined") : (n.Line = n.util.createClass(n.Object, { type: "line", x1: 0, y1: 0, x2: 0, y2: 0, cacheProperties: n.Object.prototype.cacheProperties.concat("x1", "x2", "y1", "y2"), initialize: function (t, e) { t = t || [0, 0, 0, 0], this.callSuper("initialize", e), this.set("x1", t[0]), this.set("y1", t[1]), this.set("x2", t[2]), this.set("y2", t[3]), this._setWidthHeight(e) }, _setWidthHeight: function (t) { t = t || {}, this.width = Math.abs(this.x2 - this.x1), this.height = Math.abs(this.y2 - this.y1), this.left = "left" in t ? t.left : this._getLeftToOriginX(), this.top = "top" in t ? t.top : this._getTopToOriginY() }, _set: function (t, e) { return this.callSuper("_set", t, e), void 0 !== i[t] && this._setWidthHeight(), this }, _getLeftToOriginX: e({ origin: "originX", axis1: "x1", axis2: "x2", dimension: "width" }, { nearest: "left", center: "center", farthest: "right" }), _getTopToOriginY: e({ origin: "originY", axis1: "y1", axis2: "y2", dimension: "height" }, { nearest: "top", center: "center", farthest: "bottom" }), _render: function (t) { t.beginPath(), (!this.strokeDashArray || this.strokeDashArray && s) && (e = this.calcLinePoints(), t.moveTo(e.x1, e.y1), t.lineTo(e.x2, e.y2)), t.lineWidth = this.strokeWidth; var e = t.strokeStyle; t.strokeStyle = this.stroke || t.fillStyle, this.stroke && this._renderStroke(t), t.strokeStyle = e }, _renderDashedStroke: function (t) { var e = this.calcLinePoints(); t.beginPath(), n.util.drawDashedLine(t, e.x1, e.y1, e.x2, e.y2, this.strokeDashArray), t.closePath() }, _findCenterFromElement: function () { return { x: (this.x1 + this.x2) / 2, y: (this.y1 + this.y2) / 2 } }, toObject: function (t) { return o(this.callSuper("toObject", t), this.calcLinePoints()) }, _getNonTransformedDimensions: function () { var t = this.callSuper("_getNonTransformedDimensions"); return "butt" === this.strokeLineCap && (0 === this.width && (t.y -= this.strokeWidth), 0 === this.height && (t.x -= this.strokeWidth)), t }, calcLinePoints: function () { var t = this.x1 <= this.x2 ? -1 : 1, e = this.y1 <= this.y2 ? -1 : 1, i = t * this.width * .5, r = e * this.height * .5; return { x1: i, x2: t * this.width * -.5, y1: r, y2: e * this.height * -.5 } }, toSVG: function (t) { var e = this._createBaseSVGMarkup(), i = this.calcLinePoints(); return e.push("<line ", this.getSvgId(), 'x1="', i.x1, '" y1="', i.y1, '" x2="', i.x2, '" y2="', i.y2, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '"/>\n'), t ? t(e.join("")) : e.join("") } }), n.Line.ATTRIBUTE_NAMES = n.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")), n.Line.fromElement = function (t, e, i) { i = i || {}; var t = n.parseAttributes(t, n.Line.ATTRIBUTE_NAMES), r = [t.x1 || 0, t.y1 || 0, t.x2 || 0, t.y2 || 0]; e(new n.Line(r, o(t, i))) }, n.Line.fromObject = function (t, e) { var i = r(t, !0); i.points = [t.x1, t.y1, t.x2, t.y2], n.Object._fromObject("Line", i, function (t) { delete t.points, e && e(t) }, "points") }) }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var a = t.fabric || (t.fabric = {}), h = Math.PI; a.Circle ? a.warn("fabric.Circle is already defined.") : (a.Circle = a.util.createClass(a.Object, { type: "circle", radius: 0, startAngle: 0, endAngle: 2 * h, cacheProperties: a.Object.prototype.cacheProperties.concat("radius", "startAngle", "endAngle"), _set: function (t, e) { return this.callSuper("_set", t, e), "radius" === t && this.setRadius(e), this }, toObject: function (t) { return this.callSuper("toObject", ["radius", "startAngle", "endAngle"].concat(t)) }, toSVG: function (t) { var e, i, r, n, o = this._createBaseSVGMarkup(), s = (this.endAngle - this.startAngle) % (2 * h); return 0 == s ? o.push("<circle ", this.getSvgId(), 'cx="0" cy="0" ', 'r="', this.radius, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), " ", this.getSvgTransformMatrix(), '"', this.addPaintOrder(), "/>\n") : (e = a.util.cos(this.startAngle) * this.radius, i = a.util.sin(this.startAngle) * this.radius, r = a.util.cos(this.endAngle) * this.radius, n = a.util.sin(this.endAngle) * this.radius, o.push('<path d="M ' + e + " " + i, " A " + this.radius + " " + this.radius, " 0 ", +(h < s ? "1" : "0") + " 1", " " + r + " " + n, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), " ", this.getSvgTransformMatrix(), '"', this.addPaintOrder(), '"/>\n')), t ? t(o.join("")) : o.join("") }, _render: function (t) { t.beginPath(), t.arc(0, 0, this.radius, this.startAngle, this.endAngle, !1), this._renderPaintInOrder(t) }, getRadiusX: function () { return this.get("radius") * this.get("scaleX") }, getRadiusY: function () { return this.get("radius") * this.get("scaleY") }, setRadius: function (t) { return this.radius = t, this.set("width", 2 * t).set("height", 2 * t) } }), a.Circle.ATTRIBUTE_NAMES = a.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")), a.Circle.fromElement = function (t, e) { var i, t = a.parseAttributes(t, a.Circle.ATTRIBUTE_NAMES); if (!("radius" in (i = t) && 0 <= i.radius)) throw new Error("value of `r` attribute is required and can not be negative"); t.left = (t.left || 0) - t.radius, t.top = (t.top || 0) - t.radius, e(new a.Circle(t)) }, a.Circle.fromObject = function (t, e) { return a.Object._fromObject("Circle", t, e) }) }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var r = t.fabric || (t.fabric = {}); r.Triangle ? r.warn("fabric.Triangle is already defined") : (r.Triangle = r.util.createClass(r.Object, { type: "triangle", width: 100, height: 100, _render: function (t) { var e = this.width / 2, i = this.height / 2; t.beginPath(), t.moveTo(-e, i), t.lineTo(0, -i), t.lineTo(e, i), t.closePath(), this._renderPaintInOrder(t) }, _renderDashedStroke: function (t) { var e = this.width / 2, i = this.height / 2; t.beginPath(), r.util.drawDashedLine(t, -e, i, 0, -i, this.strokeDashArray), r.util.drawDashedLine(t, 0, -i, e, i, this.strokeDashArray), r.util.drawDashedLine(t, e, i, -e, i, this.strokeDashArray), t.closePath() }, toSVG: function (t) { var e = this._createBaseSVGMarkup(), i = this.width / 2, r = this.height / 2, i = [-i + " " + r, "0 " + -r, i + " " + r].join(","); return e.push("<polygon ", this.getSvgId(), 'points="', i, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), '"', this.addPaintOrder(), "/>"), t ? t(e.join("")) : e.join("") } }), r.Triangle.fromObject = function (t, e) { return r.Object._fromObject("Triangle", t, e) }) }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var i = t.fabric || (t.fabric = {}), e = 2 * Math.PI; i.Ellipse ? i.warn("fabric.Ellipse is already defined.") : (i.Ellipse = i.util.createClass(i.Object, { type: "ellipse", rx: 0, ry: 0, cacheProperties: i.Object.prototype.cacheProperties.concat("rx", "ry"), initialize: function (t) { this.callSuper("initialize", t), this.set("rx", t && t.rx || 0), this.set("ry", t && t.ry || 0) }, _set: function (t, e) { switch (this.callSuper("_set", t, e), t) { case "rx": this.rx = e, this.set("width", 2 * e); break; case "ry": this.ry = e, this.set("height", 2 * e) }return this }, getRx: function () { return this.get("rx") * this.get("scaleX") }, getRy: function () { return this.get("ry") * this.get("scaleY") }, toObject: function (t) { return this.callSuper("toObject", ["rx", "ry"].concat(t)) }, toSVG: function (t) { var e = this._createBaseSVGMarkup(); return e.push("<ellipse ", this.getSvgId(), 'cx="0" cy="0" ', 'rx="', this.rx, '" ry="', this.ry, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '"', this.addPaintOrder(), "/>\n"), t ? t(e.join("")) : e.join("") }, _render: function (t) { t.beginPath(), t.save(), t.transform(1, 0, 0, this.ry / this.rx, 0, 0), t.arc(0, 0, this.rx, 0, e, !1), t.restore(), this._renderPaintInOrder(t) } }), i.Ellipse.ATTRIBUTE_NAMES = i.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")), i.Ellipse.fromElement = function (t, e) { t = i.parseAttributes(t, i.Ellipse.ATTRIBUTE_NAMES); t.left = (t.left || 0) - t.rx, t.top = (t.top || 0) - t.ry, e(new i.Ellipse(t)) }, i.Ellipse.fromObject = function (t, e) { return i.Object._fromObject("Ellipse", t, e) }) }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var o = t.fabric || (t.fabric = {}), r = o.util.object.extend; o.Rect ? o.warn("fabric.Rect is already defined") : (o.Rect = o.util.createClass(o.Object, { stateProperties: o.Object.prototype.stateProperties.concat("rx", "ry"), type: "rect", rx: 0, ry: 0, cacheProperties: o.Object.prototype.cacheProperties.concat("rx", "ry"), initialize: function (t) { this.callSuper("initialize", t), this._initRxRy() }, _initRxRy: function () { this.rx && !this.ry ? this.ry = this.rx : this.ry && !this.rx && (this.rx = this.ry) }, _render: function (t) { var e, i, r, n, o, s, a, h; 1 !== this.width || 1 !== this.height ? (e = this.rx ? Math.min(this.rx, this.width / 2) : 0, i = this.ry ? Math.min(this.ry, this.height / 2) : 0, r = this.width, n = this.height, o = -this.width / 2, s = -this.height / 2, a = 0 !== e || 0 !== i, h = .4477152502, t.beginPath(), t.moveTo(o + e, s), t.lineTo(o + r - e, s), a && t.bezierCurveTo(o + r - h * e, s, o + r, s + h * i, o + r, s + i), t.lineTo(o + r, s + n - i), a && t.bezierCurveTo(o + r, s + n - h * i, o + r - h * e, s + n, o + r - e, s + n), t.lineTo(o + e, s + n), a && t.bezierCurveTo(o + h * e, s + n, o, s + n - h * i, o, s + n - i), t.lineTo(o, s + i), a && t.bezierCurveTo(o, s + h * i, o + h * e, s, o + e, s), t.closePath(), this._renderPaintInOrder(t)) : t.fillRect(-.5, -.5, 1, 1) }, _renderDashedStroke: function (t) { var e = -this.width / 2, i = -this.height / 2, r = this.width, n = this.height; t.beginPath(), o.util.drawDashedLine(t, e, i, e + r, i, this.strokeDashArray), o.util.drawDashedLine(t, e + r, i, e + r, i + n, this.strokeDashArray), o.util.drawDashedLine(t, e + r, i + n, e, i + n, this.strokeDashArray), o.util.drawDashedLine(t, e, i + n, e, i, this.strokeDashArray), t.closePath() }, toObject: function (t) { return this.callSuper("toObject", ["rx", "ry"].concat(t)) }, toSVG: function (t) { var e = this._createBaseSVGMarkup(), i = -this.width / 2, r = -this.height / 2; return e.push("<rect ", this.getSvgId(), 'x="', i, '" y="', r, '" rx="', this.get("rx"), '" ry="', this.get("ry"), '" width="', this.width, '" height="', this.height, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '"', this.addPaintOrder(), "/>\n"), t ? t(e.join("")) : e.join("") } }), o.Rect.ATTRIBUTE_NAMES = o.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")), o.Rect.fromElement = function (t, e, i) { if (!t) return e(null); i = i || {}; t = o.parseAttributes(t, o.Rect.ATTRIBUTE_NAMES), t.left = t.left || 0, t.top = t.top || 0, i = new o.Rect(r(i ? o.util.object.clone(i) : {}, t)); i.visible = i.visible && 0 < i.width && 0 < i.height, e(i) }, o.Rect.fromObject = function (t, e) { return o.Object._fromObject("Rect", t, e) }) }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var h = t.fabric || (t.fabric = {}), e = h.util.object.extend, r = h.util.array.min, n = h.util.array.max, l = h.util.toFixed; h.Polyline ? h.warn("fabric.Polyline is already defined") : (h.Polyline = h.util.createClass(h.Object, { type: "polyline", points: null, cacheProperties: h.Object.prototype.cacheProperties.concat("points"), initialize: function (t, e) { e = e || {}, this.points = t || [], this.callSuper("initialize", e); t = this._calcDimensions(); void 0 === e.left && (this.left = t.left), void 0 === e.top && (this.top = t.top), this.width = t.width, this.height = t.height, this.pathOffset = { x: t.left + this.width / 2, y: t.top + this.height / 2 } }, _calcDimensions: function () { var t = this.points, e = r(t, "x") || 0, i = r(t, "y") || 0; return { left: e, top: i, width: (n(t, "x") || 0) - e, height: (n(t, "y") || 0) - i } }, toObject: function (t) { return e(this.callSuper("toObject", t), { points: this.points.concat() }) }, toSVG: function (t) { for (var e = [], i = this.pathOffset.x, r = this.pathOffset.y, n = this._createBaseSVGMarkup(), o = h.Object.NUM_FRACTION_DIGITS, s = 0, a = this.points.length; s < a; s++)e.push(l(this.points[s].x - i, o), ",", l(this.points[s].y - r, o), " "); return n.push("<", this.type, " ", this.getSvgId(), 'points="', e.join(""), '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), " ", this.getSvgTransformMatrix(), '"', this.addPaintOrder(), "/>\n"), t ? t(n.join("")) : n.join("") }, commonRender: function (t) { var e, i = this.points.length, r = this.pathOffset.x, n = this.pathOffset.y; if (!i || isNaN(this.points[i - 1].y)) return !1; t.beginPath(), t.moveTo(this.points[0].x - r, this.points[0].y - n); for (var o = 0; o < i; o++)e = this.points[o], t.lineTo(e.x - r, e.y - n); return !0 }, _render: function (t) { this.commonRender(t) && this._renderPaintInOrder(t) }, _renderDashedStroke: function (t) { var e, i; t.beginPath(); for (var r = 0, n = this.points.length; r < n; r++)e = this.points[r], i = this.points[r + 1] || e, h.util.drawDashedLine(t, e.x, e.y, i.x, i.y, this.strokeDashArray) }, complexity: function () { return this.get("points").length } }), h.Polyline.ATTRIBUTE_NAMES = h.SHARED_ATTRIBUTES.concat(), h.Polyline.fromElement = function (t, e, i) { if (!t) return e(null); i = i || {}; var r = h.parsePointsAttribute(t.getAttribute("points")), t = h.parseAttributes(t, h.Polyline.ATTRIBUTE_NAMES); e(new h.Polyline(r, h.util.object.extend(t, i))) }, h.Polyline.fromObject = function (t, e) { return h.Object._fromObject("Polyline", t, e, "points") }) }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var n = t.fabric || (t.fabric = {}), o = n.util.object.extend; n.Polygon ? n.warn("fabric.Polygon is already defined") : (n.Polygon = n.util.createClass(n.Polyline, { type: "polygon", _render: function (t) { this.commonRender(t) && (t.closePath(), this._renderPaintInOrder(t)) }, _renderDashedStroke: function (t) { this.callSuper("_renderDashedStroke", t), t.closePath() } }), n.Polygon.ATTRIBUTE_NAMES = n.SHARED_ATTRIBUTES.concat(), n.Polygon.fromElement = function (t, e, i) { if (!t) return e(null); i = i || {}; var r = n.parsePointsAttribute(t.getAttribute("points")), t = n.parseAttributes(t, n.Polygon.ATTRIBUTE_NAMES); e(new n.Polygon(r, o(t, i))) }, n.Polygon.fromObject = function (t, e) { return n.Object._fromObject("Polygon", t, e, "points") }) }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var m = t.fabric || (t.fabric = {}), y = m.util.array.min, _ = m.util.array.max, r = m.util.object.extend, n = Object.prototype.toString, g = m.util.drawArc, b = { m: 2, l: 2, h: 1, v: 1, c: 6, s: 4, q: 4, t: 2, a: 7 }, x = { m: "l", M: "L" }; m.Path ? m.warn("fabric.Path is already defined") : (m.Path = m.util.createClass(m.Object, { type: "path", path: null, cacheProperties: m.Object.prototype.cacheProperties.concat("path", "fillRule"), stateProperties: m.Object.prototype.stateProperties.concat("path"), initialize: function (t, e) { this.callSuper("initialize", e = e || {}); var i = "[object Array]" === n.call(t = t || []); this.path = i ? t : t.match && t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi), this.path && (i || (this.path = this._parsePath()), this._setPositionDimensions(e)) }, _setPositionDimensions: function (t) { var e = this._parseDimensions(); this.width = e.width, this.height = e.height, void 0 === t.left && (this.left = e.left), void 0 === t.top && (this.top = e.top), this.pathOffset = this.pathOffset || { x: e.left + this.width / 2, y: e.top + this.height / 2 } }, _renderPathCommands: function (t) { var e, i, r, u = null, c = 0, f = 0, n = 0, o = 0, s = 0, a = 0, h = -this.pathOffset.x, l = -this.pathOffset.y; t.beginPath(); for (var d = 0, p = this.path.length; d < p; ++d) { switch ((e = this.path[d])[0]) { case "l": n += e[1], o += e[2], t.lineTo(n + h, o + l); break; case "L": n = e[1], o = e[2], t.lineTo(n + h, o + l); break; case "h": n += e[1], t.lineTo(n + h, o + l); break; case "H": n = e[1], t.lineTo(n + h, o + l); break; case "v": o += e[1], t.lineTo(n + h, o + l); break; case "V": o = e[1], t.lineTo(n + h, o + l); break; case "m": c = n += e[1], f = o += e[2], t.moveTo(n + h, o + l); break; case "M": c = n = e[1], f = o = e[2], t.moveTo(n + h, o + l); break; case "c": i = n + e[5], r = o + e[6], s = n + e[3], a = o + e[4], t.bezierCurveTo(n + e[1] + h, o + e[2] + l, s + h, a + l, i + h, r + l), n = i, o = r; break; case "C": n = e[5], o = e[6], s = e[3], a = e[4], t.bezierCurveTo(e[1] + h, e[2] + l, s + h, a + l, n + h, o + l); break; case "s": i = n + e[3], r = o + e[4], a = null === u[0].match(/[CcSs]/) ? (s = n, o) : (s = 2 * n - s, 2 * o - a), t.bezierCurveTo(s + h, a + l, n + e[1] + h, o + e[2] + l, i + h, r + l), s = n + e[1], a = o + e[2], n = i, o = r; break; case "S": i = e[3], r = e[4], a = null === u[0].match(/[CcSs]/) ? (s = n, o) : (s = 2 * n - s, 2 * o - a), t.bezierCurveTo(s + h, a + l, e[1] + h, e[2] + l, i + h, r + l), n = i, o = r, s = e[1], a = e[2]; break; case "q": i = n + e[3], r = o + e[4], s = n + e[1], a = o + e[2], t.quadraticCurveTo(s + h, a + l, i + h, r + l), n = i, o = r; break; case "Q": i = e[3], r = e[4], t.quadraticCurveTo(e[1] + h, e[2] + l, i + h, r + l), n = i, o = r, s = e[1], a = e[2]; break; case "t": i = n + e[1], r = o + e[2], a = null === u[0].match(/[QqTt]/) ? (s = n, o) : (s = 2 * n - s, 2 * o - a), t.quadraticCurveTo(s + h, a + l, i + h, r + l), n = i, o = r; break; case "T": i = e[1], r = e[2], a = null === u[0].match(/[QqTt]/) ? (s = n, o) : (s = 2 * n - s, 2 * o - a), t.quadraticCurveTo(s + h, a + l, i + h, r + l), n = i, o = r; break; case "a": g(t, n + h, o + l, [e[1], e[2], e[3], e[4], e[5], e[6] + n + h, e[7] + o + l]), n += e[6], o += e[7]; break; case "A": g(t, n + h, o + l, [e[1], e[2], e[3], e[4], e[5], e[6] + h, e[7] + l]), n = e[6], o = e[7]; break; case "z": case "Z": n = c, o = f, t.closePath() }u = e } }, _render: function (t) { this._renderPathCommands(t), this._renderPaintInOrder(t) }, toString: function () { return "#<fabric.Path (" + this.complexity() + '): { "top": ' + this.top + ', "left": ' + this.left + " }>" }, toObject: function (t) { return r(this.callSuper("toObject", t), { path: this.path.map(function (t) { return t.slice() }), top: this.top, left: this.left }) }, toDatalessObject: function (t) { t = this.toObject(["sourcePath"].concat(t)); return t.sourcePath && delete t.path, t }, toSVG: function (t) { for (var e = [], i = this._createBaseSVGMarkup(), r = 0, n = this.path.length; r < n; r++)e.push(this.path[r].join(" ")); var o = e.join(" "), s = " translate(" + -this.pathOffset.x + ", " + -this.pathOffset.y + ") "; return i.push("<path ", this.getSvgId(), 'd="', o, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), s, this.getSvgTransformMatrix(), '" stroke-linecap="round" ', this.addPaintOrder(), "/>\n"), t ? t(i.join("")) : i.join("") }, complexity: function () { return this.path.length }, _parsePath: function () { for (var t, e, u, c, i = [], r = [], f = /([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi, n = 0, d = this.path.length; n < d; n++) { for (c = (t = this.path[n]).slice(1).trim(), r.length = 0; u = f.exec(c);)r.push(u[0]); for (var o = [t.charAt(0)], s = 0, p = r.length; s < p; s++)e = parseFloat(r[s]), isNaN(e) || o.push(e); var a = o[0], h = b[a.toLowerCase()], g = x[a] || a; if (o.length - 1 > h) for (var l = 1, v = o.length; l < v; l += h)i.push([a].concat(o.slice(l, l + h))), a = g; else i.push(o) } return i }, _parseDimensions: function () { for (var t, e, i, r, n = [], u = [], o = null, c = 0, f = 0, s = 0, a = 0, h = 0, l = 0, d = 0, p = this.path.length; d < p; ++d) { switch ((t = this.path[d])[0]) { case "l": s += t[1], a += t[2], r = []; break; case "L": s = t[1], a = t[2], r = []; break; case "h": s += t[1], r = []; break; case "H": s = t[1], r = []; break; case "v": a += t[1], r = []; break; case "V": a = t[1], r = []; break; case "m": c = s += t[1], f = a += t[2], r = []; break; case "M": c = s = t[1], f = a = t[2], r = []; break; case "c": e = s + t[5], i = a + t[6], h = s + t[3], l = a + t[4], r = m.util.getBoundsOfCurve(s, a, s + t[1], a + t[2], h, l, e, i), s = e, a = i; break; case "C": h = t[3], l = t[4], r = m.util.getBoundsOfCurve(s, a, t[1], t[2], h, l, t[5], t[6]), s = t[5], a = t[6]; break; case "s": e = s + t[3], i = a + t[4], l = null === o[0].match(/[CcSs]/) ? (h = s, a) : (h = 2 * s - h, 2 * a - l), r = m.util.getBoundsOfCurve(s, a, h, l, s + t[1], a + t[2], e, i), h = s + t[1], l = a + t[2], s = e, a = i; break; case "S": e = t[3], i = t[4], l = null === o[0].match(/[CcSs]/) ? (h = s, a) : (h = 2 * s - h, 2 * a - l), r = m.util.getBoundsOfCurve(s, a, h, l, t[1], t[2], e, i), s = e, a = i, h = t[1], l = t[2]; break; case "q": e = s + t[3], i = a + t[4], h = s + t[1], l = a + t[2], r = m.util.getBoundsOfCurve(s, a, h, l, h, l, e, i), s = e, a = i; break; case "Q": h = t[1], l = t[2], r = m.util.getBoundsOfCurve(s, a, h, l, h, l, t[3], t[4]), s = t[3], a = t[4]; break; case "t": e = s + t[1], i = a + t[2], l = null === o[0].match(/[QqTt]/) ? (h = s, a) : (h = 2 * s - h, 2 * a - l), r = m.util.getBoundsOfCurve(s, a, h, l, h, l, e, i), s = e, a = i; break; case "T": e = t[1], i = t[2], l = null === o[0].match(/[QqTt]/) ? (h = s, a) : (h = 2 * s - h, 2 * a - l), r = m.util.getBoundsOfCurve(s, a, h, l, h, l, e, i), s = e, a = i; break; case "a": r = m.util.getBoundsOfArc(s, a, t[1], t[2], t[3], t[4], t[5], t[6] + s, t[7] + a), s += t[6], a += t[7]; break; case "A": r = m.util.getBoundsOfArc(s, a, t[1], t[2], t[3], t[4], t[5], t[6], t[7]), s = t[6], a = t[7]; break; case "z": case "Z": s = c, a = f }o = t, r.forEach(function (t) { n.push(t.x), u.push(t.y) }), n.push(s), u.push(a) } var g = y(n) || 0, v = y(u) || 0; return { left: g, top: v, width: (_(n) || 0) - g, height: (_(u) || 0) - v } } }), m.Path.fromObject = function (e, i) { var t; "string" == typeof e.sourcePath ? (t = e.sourcePath, m.loadSVGFromURL(t, function (t) { t = t[0]; t.setOptions(e), i && i(t) })) : m.Object._fromObject("Path", e, i, "path") }, m.Path.ATTRIBUTE_NAMES = m.SHARED_ATTRIBUTES.concat(["d"]), m.Path.fromElement = function (t, e, i) { t = m.parseAttributes(t, m.Path.ATTRIBUTE_NAMES); e(new m.Path(t.d, r(t, i))) }) }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var n = t.fabric || (t.fabric = {}), e = n.util.object.extend, o = n.util.array.min, s = n.util.array.max; n.Group || (n.Group = n.util.createClass(n.Object, n.Collection, { type: "group", strokeWidth: 0, subTargetCheck: !1, cacheProperties: [], useSetOnGroup: !1, initialize: function (t, e, i) { e = e || {}, this._objects = [], i && this.callSuper("initialize", e), this._objects = t || []; for (var r = this._objects.length; r--;)this._objects[r].group = this; e.originX && (this.originX = e.originX), e.originY && (this.originY = e.originY), i ? this._updateObjectsACoords() : ((t = e && e.centerPoint) || this._calcBounds(), this._updateObjectsCoords(t), delete e.centerPoint, this.callSuper("initialize", e)), this.setCoords() }, _updateObjectsACoords: function () { for (var t = this._objects.length; t--;)this._objects[t].setCoords(!0, !0) }, _updateObjectsCoords: function (t) { for (var t = t || this.getCenterPoint(), e = this._objects.length; e--;)this._updateObjectCoords(this._objects[e], t) }, _updateObjectCoords: function (t, e) { var i = t.left, r = t.top; t.set({ left: i - e.x, top: r - e.y }), t.group = this, t.setCoords(!0, !0) }, toString: function () { return "#<fabric.Group: (" + this.complexity() + ")>" }, addWithUpdate: function (t) { return this._restoreObjectsState(), n.util.resetObjectTransform(this), t && (this._objects.push(t), t.group = this, t._set("canvas", this.canvas)), this._calcBounds(), this._updateObjectsCoords(), this.setCoords(), this.dirty = !0, this }, removeWithUpdate: function (t) { return this._restoreObjectsState(), n.util.resetObjectTransform(this), this.remove(t), this._calcBounds(), this._updateObjectsCoords(), this.setCoords(), this.dirty = !0, this }, _onObjectAdded: function (t) { this.dirty = !0, t.group = this, t._set("canvas", this.canvas) }, _onObjectRemoved: function (t) { this.dirty = !0, delete t.group }, _set: function (t, e) { var i = this._objects.length; if (this.useSetOnGroup) for (; i--;)this._objects[i].setOnGroup(t, e); if ("canvas" === t) for (i = this._objects.length; i--;)this._objects[i]._set(t, e); this.callSuper("_set", t, e) }, toObject: function (r) { var t = this.getObjects().map(function (t) { var e = t.includeDefaultValues, i = (t.includeDefaultValues = t.group.includeDefaultValues, t.toObject(r)); return t.includeDefaultValues = e, i }); return e(this.callSuper("toObject", r), { objects: t }) }, toDatalessObject: function (r) { var t = this.sourcePath, t = t || this.getObjects().map(function (t) { var e = t.includeDefaultValues, i = (t.includeDefaultValues = t.group.includeDefaultValues, t.toDatalessObject(r)); return t.includeDefaultValues = e, i }); return e(this.callSuper("toDatalessObject", r), { objects: t }) }, render: function (t) { this._transformDone = !0, this.callSuper("render", t), this._transformDone = !1 }, shouldCache: function () { var t = this.objectCaching && (!this.group || this.needsItsOwnCache() || !this.group.isOnACache()); if (this.ownCaching = t) for (var e = 0, i = this._objects.length; e < i; e++)if (this._objects[e].willDrawShadow()) return this.ownCaching = !1; return t }, willDrawShadow: function () { if (this.shadow) return this.callSuper("willDrawShadow"); for (var t = 0, e = this._objects.length; t < e; t++)if (this._objects[t].willDrawShadow()) return !0; return !1 }, isOnACache: function () { return this.ownCaching || this.group && this.group.isOnACache() }, drawObject: function (t) { for (var e = 0, i = this._objects.length; e < i; e++)this._objects[e].render(t) }, isCacheDirty: function () { if (this.callSuper("isCacheDirty")) return !0; if (!this.statefullCache) return !1; for (var t, e, i = 0, r = this._objects.length; i < r; i++)if (this._objects[i].isCacheDirty(!0)) return this._cacheCanvas && (t = this.cacheWidth / this.zoomX, e = this.cacheHeight / this.zoomY, this._cacheContext.clearRect(-t / 2, -e / 2, t, e)), !0; return !1 }, _restoreObjectsState: function () { return this._objects.forEach(this._restoreObjectState, this), this }, realizeTransform: function (t) { var e = t.calcTransformMatrix(), e = n.util.qrDecompose(e), i = new n.Point(e.translateX, e.translateY); return t.flipX = !1, t.flipY = !1, t.set("scaleX", e.scaleX), t.set("scaleY", e.scaleY), t.skewX = e.skewX, t.skewY = e.skewY, t.angle = e.angle, t.setPositionByOrigin(i, "center", "center"), t }, _restoreObjectState: function (t) { return this.realizeTransform(t), t.setCoords(), delete t.group, this }, destroy: function () { return this._objects.forEach(function (t) { t.set("dirty", !0) }), this._restoreObjectsState() }, toActiveSelection: function () { var t, e, i, r; if (this.canvas) return t = this._objects, e = this.canvas, this._objects = [], i = this.toObject(), delete i.objects, r = new n.ActiveSelection([]), r.set(i), r.type = "activeSelection", e.remove(this), t.forEach(function (t) { t.group = r, t.dirty = !0, e.add(t) }), r.canvas = e, r._objects = t, (e._activeObject = r).setCoords(), r }, ungroupOnCanvas: function () { return this._restoreObjectsState() }, setObjectsCoords: function () { return this.forEachObject(function (t) { t.setCoords(!0, !0) }), this }, _calcBounds: function (t) { for (var e, i, r, n = [], o = [], s = ["tr", "br", "bl", "tl"], a = 0, h = this._objects.length, l = s.length; a < h; ++a)for ((e = this._objects[a]).setCoords(!0), r = 0; r < l; r++)n.push(e.oCoords[i = s[r]].x), o.push(e.oCoords[i].y); this.set(this._getBounds(n, o, t)) }, _getBounds: function (t, e, i) { var r = new n.Point(o(t), o(e)), t = new n.Point(s(t), s(e)), e = { width: t.x - r.x || 0, height: t.y - r.y || 0 }; return i || (e.left = r.x || 0, e.top = r.y || 0, "center" === this.originX && (e.left += e.width / 2), "right" === this.originX && (e.left += e.width), "center" === this.originY && (e.top += e.height / 2), "bottom" === this.originY && (e.top += e.height)), e }, toSVG: function (t) { var e = this._createBaseSVGMarkup(); e.push("<g ", this.getSvgId(), 'transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '" style="', this.getSvgFilter(), '">\n'); for (var i = 0, r = this._objects.length; i < r; i++)e.push("\t", this._objects[i].toSVG(t)); return e.push("</g>\n"), t ? t(e.join("")) : e.join("") } }), n.Group.fromObject = function (i, r) { n.util.enlivenObjects(i.objects, function (t) { var e = n.util.object.clone(i, !0); delete e.objects, r && r(new n.Group(t, e, !0)) }) }) }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var r = t.fabric || (t.fabric = {}); r.ActiveSelection || (r.ActiveSelection = r.util.createClass(r.Group, { type: "activeSelection", initialize: function (t, e) { e = e || {}, this._objects = t || []; for (var i = this._objects.length; i--;)this._objects[i].group = this; e.originX && (this.originX = e.originX), e.originY && (this.originY = e.originY), this._calcBounds(), this._updateObjectsCoords(), r.Object.prototype.initialize.call(this, e), this.setCoords() }, toGroup: function () { var t = this._objects, e = (this._objects = [], this.toObject()), i = new r.Group([]); if (delete e.objects, i.set(e), i.type = "group", t.forEach(function (t) { t.group = i, t.canvas.remove(t) }), i._objects = t, !this.canvas) return i; e = this.canvas; return e.add(i), (e._activeObject = i).setCoords(), i }, onDeselect: function () { return this.destroy(), !1 }, toString: function () { return "#<fabric.ActiveSelection: (" + this.complexity() + ")>" }, _set: function (t, e) { var i = this._objects.length; if ("canvas" === t) for (; i--;)this._objects[i].set(t, e); if (this.useSetOnGroup) for (; i--;)this._objects[i].setOnGroup(t, e); r.Object.prototype._set.call(this, t, e) }, shouldCache: function () { return !1 }, willDrawShadow: function () { if (this.shadow) return this.callSuper("willDrawShadow"); for (var t = 0, e = this._objects.length; t < e; t++)if (this._objects[t].willDrawShadow()) return !0; return !1 }, isOnACache: function () { return !1 }, _renderControls: function (t, e, i) { t.save(), t.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1, this.callSuper("_renderControls", t, e), void 0 === (i = i || {}).hasControls && (i.hasControls = !1), void 0 === i.hasRotatingPoint && (i.hasRotatingPoint = !1), i.forActiveSelection = !0; for (var r = 0, n = this._objects.length; r < n; r++)this._objects[r]._renderControls(t, i); t.restore() } }), r.ActiveSelection.fromObject = function (e, i) { r.util.enlivenObjects(e.objects, function (t) { delete e.objects, i && i(new r.ActiveSelection(t, e, !0)) }) }) }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var r = fabric.util.object.extend; t.fabric || (t.fabric = {}), t.fabric.Image ? fabric.warn("fabric.Image is already defined.") : (fabric.Image = fabric.util.createClass(fabric.Object, { type: "image", crossOrigin: "", strokeWidth: 0, _lastScaleX: 1, _lastScaleY: 1, _filterScalingX: 1, _filterScalingY: 1, minimumScaleTrigger: .5, stateProperties: fabric.Object.prototype.stateProperties.concat("cropX", "cropY"), objectCaching: !1, cacheKey: "", cropX: 0, cropY: 0, initialize: function (t, e) { e = e || {}, this.filters = [], this.cacheKey = "texture" + fabric.Object.__uid++, this.callSuper("initialize", e), this._initElement(t, e) }, getElement: function () { return this._element }, setElement: function (t, e) { var i = fabric.filterBackend; return i && i.evictCachesForKey && (i.evictCachesForKey(this.cacheKey), i.evictCachesForKey(this.cacheKey + "_filtered")), this._element = t, this._originalElement = t, this._initConfig(e), this.resizeFilter && this.applyResizeFilters(), 0 !== this.filters.length && this.applyFilters(), this }, dispose: function () { var t = fabric.filterBackend; t && t.evictCachesForKey && (t.evictCachesForKey(this.cacheKey), t.evictCachesForKey(this.cacheKey + "_filtered")), this._originalElement = void 0, this._element = void 0, this._filteredEl = void 0 }, setCrossOrigin: function (t) { return this.crossOrigin = t, this._element.crossOrigin = t, this }, getOriginalSize: function () { var t = this.getElement(); return { width: t.width, height: t.height } }, _stroke: function (t) { var e, i; this.stroke && 0 !== this.strokeWidth && (e = this.width / 2, i = this.height / 2, t.beginPath(), t.moveTo(-e, -i), t.lineTo(e, -i), t.lineTo(e, i), t.lineTo(-e, i), t.lineTo(-e, -i), t.closePath()) }, _renderDashedStroke: function (t) { var e = -this.width / 2, i = -this.height / 2, r = this.width, n = this.height; t.save(), this._setStrokeStyles(t, this), t.beginPath(), fabric.util.drawDashedLine(t, e, i, e + r, i, this.strokeDashArray), fabric.util.drawDashedLine(t, e + r, i, e + r, i + n, this.strokeDashArray), fabric.util.drawDashedLine(t, e + r, i + n, e, i + n, this.strokeDashArray), fabric.util.drawDashedLine(t, e, i + n, e, i, this.strokeDashArray), t.closePath(), t.restore() }, toObject: function (t) { var e = [], t = (this.filters.forEach(function (t) { t && e.push(t.toObject()) }), r(this.callSuper("toObject", ["crossOrigin", "cropX", "cropY"].concat(t)), { src: this.getSrc(), filters: e })); return this.resizeFilter && (t.resizeFilter = this.resizeFilter.toObject()), t }, hasCrop: function () { return this.cropX || this.cropY || this.width < this._element.width || this.height < this._element.height }, toSVG: function (t) { var e = this._createBaseSVGMarkup(), i = -this.width / 2, r = -this.height / 2, n = "", o = (this.hasCrop() && (o = fabric.Object.__uid++, e.push('<clipPath id="imageCrop_' + o + '">\n', '\t<rect x="' + i + '" y="' + r + '" width="' + this.width + '" height="' + this.height + '" />\n', "</clipPath>\n"), n = ' clip-path="url(#imageCrop_' + o + ')" '), e.push('<g transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '">\n'), ["\t<image ", this.getSvgId(), 'xlink:href="', this.getSvgSrc(!0), '" x="', i - this.cropX, '" y="', r - this.cropY, '" style="', this.getSvgStyles(), '" width="', this._element.width || this._element.naturalWidth, '" height="', this._element.height || this._element.height, '"', n, "></image>\n"]); return "fill" === this.paintFirst && Array.prototype.push.apply(e, o), (this.stroke || this.strokeDashArray) && (n = this.fill, this.fill = null, e.push("\t<rect ", 'x="', i, '" y="', r, '" width="', this.width, '" height="', this.height, '" style="', this.getSvgStyles(), '"/>\n'), this.fill = n), "fill" !== this.paintFirst && Array.prototype.push.apply(e, o), e.push("</g>\n"), t ? t(e.join("")) : e.join("") }, getSrc: function (t) { t = t ? this._element : this._originalElement; return t ? t.toDataURL ? t.toDataURL() : t.src : this.src || "" }, setSrc: function (t, e, i) { return fabric.util.loadImage(t, function (t) { this.setElement(t, i), this._setWidthHeight(), e(this) }, this, i && i.crossOrigin), this }, toString: function () { return '#<fabric.Image: { src: "' + this.getSrc() + '" }>' }, applyResizeFilters: function () { var t = this.resizeFilter, e = this.canvas ? this.canvas.getRetinaScaling() : 1, i = this.minimumScaleTrigger, r = this.scaleX * e, e = this.scaleY * e, n = this._filteredEl || this._originalElement; if (this.group && this.set("dirty", !0), !t || i < r && i < e) return this._element = n, this._filterScalingX = 1, void (this._filterScalingY = 1); fabric.filterBackend || (fabric.filterBackend = fabric.initFilterBackend()); var i = fabric.util.createCanvasElement(), o = this._filteredEl ? this.cacheKey : this.cacheKey + "_filtered", s = n.width, a = n.height; i.width = s, i.height = a, this._element = i, t.scaleX = r, t.scaleY = e, fabric.filterBackend.applyFilters([t], n, s, a, this._element, o), this._filterScalingX = i.width / this._originalElement.width, this._filterScalingY = i.height / this._originalElement.height }, applyFilters: function (t) { if (t = (t = t || this.filters || []).filter(function (t) { return t }), this.group && this.set("dirty", !0), 0 === t.length) return this._element = this._originalElement, this._filteredEl = null, this._filterScalingX = 1, this._filterScalingY = 1, this; var e, i = this._originalElement, r = i.naturalWidth || i.width, i = i.naturalHeight || i.height; return this._element === this._originalElement ? ((e = fabric.util.createCanvasElement()).width = r, e.height = i, this._element = e, this._filteredEl = e) : this._element.getContext("2d").clearRect(0, 0, r, i), fabric.filterBackend || (fabric.filterBackend = fabric.initFilterBackend()), fabric.filterBackend.applyFilters(t, this._originalElement, r, i, this._element, this.cacheKey), this._originalElement.width === this._element.width && this._originalElement.height === this._element.height || (this._filterScalingX = this._element.width / this._originalElement.width, this._filterScalingY = this._element.height / this._originalElement.height), this }, _render: function (t) { !1 === this.isMoving && this.resizeFilter && this._needsResize() && (this._lastScaleX = this.scaleX, this._lastScaleY = this.scaleY, this.applyResizeFilters()), this._stroke(t), this._renderPaintInOrder(t) }, _renderFill: function (t) { var e = this.width, i = this.height, r = e * this._filterScalingX, n = i * this._filterScalingY, o = this._element; o && t.drawImage(o, this.cropX * this._filterScalingX, this.cropY * this._filterScalingY, r, n, -e / 2, -i / 2, e, i) }, _needsResize: function () { return this.scaleX !== this._lastScaleX || this.scaleY !== this._lastScaleY }, _resetWidthHeight: function () { var t = this.getElement(); this.set("width", t.width), this.set("height", t.height) }, _initElement: function (t, e) { this.setElement(fabric.util.getById(t), e), fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS) }, _initConfig: function (t) { this.setOptions(t = t || {}), this._setWidthHeight(t), this._element && this.crossOrigin && (this._element.crossOrigin = this.crossOrigin) }, _initFilters: function (t, e) { t && t.length ? fabric.util.enlivenObjects(t, function (t) { e && e(t) }, "fabric.Image.filters") : e && e() }, _setWidthHeight: function (t) { this.width = t && "width" in t ? t.width : this.getElement() && this.getElement().width || 0, this.height = t && "height" in t ? t.height : this.getElement() && this.getElement().height || 0 }, parsePreserveAspectRatioAttribute: function () { var t, e = fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio || ""), i = this._element.width, r = this._element.height, n = 1, o = 1, s = 0, a = 0, u = 0, c = 0, h = this.width, l = this.height, f = { width: h, height: l }; return !e || "none" === e.alignX && "none" === e.alignY ? (n = h / i, o = l / r) : ("meet" === e.meetOrSlice && (t = (h - i * (n = o = fabric.util.findScaleToFit(this._element, f))) / 2, "Min" === e.alignX && (s = -t), "Max" === e.alignX && (s = t), t = (l - r * o) / 2, "Min" === e.alignY && (a = -t), "Max" === e.alignY && (a = t)), "slice" === e.meetOrSlice && (t = i - h / (n = o = fabric.util.findScaleToCover(this._element, f)), "Mid" === e.alignX && (u = t / 2), "Max" === e.alignX && (u = t), t = r - l / o, "Mid" === e.alignY && (c = t / 2), "Max" === e.alignY && (c = t), i = h / n, r = l / o)), { width: i, height: r, scaleX: n, scaleY: o, offsetLeft: s, offsetTop: a, cropX: u, cropY: c } } }), fabric.Image.CSS_CANVAS = "canvas-img", fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc, fabric.Image.fromObject = function (t, i) { var r = fabric.util.object.clone(t); fabric.util.loadImage(r.src, function (e, t) { t ? i && i(null, t) : fabric.Image.prototype._initFilters.call(r, r.filters, function (t) { r.filters = t || [], fabric.Image.prototype._initFilters.call(r, [r.resizeFilter], function (t) { r.resizeFilter = t[0]; t = new fabric.Image(e, r); i(t) }) }) }, null, r.crossOrigin) }, fabric.Image.fromURL = function (t, e, i) { fabric.util.loadImage(t, function (t) { e && e(new fabric.Image(t, i)) }, null, i && i.crossOrigin) }, fabric.Image.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")), fabric.Image.fromElement = function (t, e, i) { t = fabric.parseAttributes(t, fabric.Image.ATTRIBUTE_NAMES); fabric.Image.fromURL(t["xlink:href"], e, r(i ? fabric.util.object.clone(i) : {}, t)) }) }("undefined" != typeof exports ? exports : this), fabric.util.object.extend(fabric.Object.prototype, { _getAngleValueForStraighten: function () { var t = this.angle % 360; return 0 < t ? 90 * Math.round((t - 1) / 90) : 90 * Math.round(t / 90) }, straighten: function () { return this.rotate(this._getAngleValueForStraighten()), this }, fxStraighten: function (t) { function e() { } var i = (t = t || {}).onComplete || e, r = t.onChange || e, n = this; return fabric.util.animate({ startValue: this.get("angle"), endValue: this._getAngleValueForStraighten(), duration: this.FX_DURATION, onChange: function (t) { n.rotate(t), r() }, onComplete: function () { n.setCoords(), i() } }), this } }), fabric.util.object.extend(fabric.StaticCanvas.prototype, { straightenObject: function (t) { return t.straighten(), this.requestRenderAll(), this }, fxStraightenObject: function (t) { return t.fxStraighten({ onChange: this.requestRenderAllBound }), this } }), function () { "use strict"; function t(t) { t && t.tileSize && (this.tileSize = t.tileSize), this.setupGLContext(this.tileSize, this.tileSize), this.captureGPUInfo() } fabric.isWebglSupported = function (t) { if (fabric.isLikelyNode) return !1; t = t || fabric.WebglFilterBackend.prototype.tileSize; var e, i, r, n = document.createElement("canvas"), o = n.getContext("webgl") || n.getContext("experimental-webgl"), n = !1; if (o) { fabric.maxTextureSize = o.getParameter(o.MAX_TEXTURE_SIZE); for (var n = fabric.maxTextureSize >= t, s = ["highp", "mediump", "lowp"], a = 0; a < 3; a++)if (r = void 0, i = "precision " + (i = s[a]) + " float;\nvoid main(){}", r = (e = o).createShader(e.FRAGMENT_SHADER), e.shaderSource(r, i), e.compileShader(r), !!e.getShaderParameter(r, e.COMPILE_STATUS)) { fabric.webGlPrecision = s[a]; break } } return this.isSupported = n }, (fabric.WebglFilterBackend = t).prototype = { tileSize: 2048, resources: {}, setupGLContext: function (t, e) { this.dispose(), this.createWebGLCanvas(t, e), this.aPosition = new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), this.chooseFastestCopyGLTo2DMethod(t, e) }, chooseFastestCopyGLTo2DMethod: function (t, e) { var i = void 0 !== window.performance; try { new ImageData(1, 1), r = !0 } catch (t) { r = !1 } var r, n = "undefined" != typeof ArrayBuffer, o = "undefined" != typeof Uint8ClampedArray; i && r && n && o && (i = fabric.util.createCanvasElement(), n = { imageBuffer: r = new ArrayBuffer(t * e * 4), destinationWidth: t, destinationHeight: e, targetCanvas: i }, i.width = t, i.height = e, o = window.performance.now(), copyGLTo2DDrawImage.call(n, this.gl, n), t = window.performance.now() - o, o = window.performance.now(), copyGLTo2DPutImageData.call(n, this.gl, n), window.performance.now() - o < t ? (this.imageBuffer = r, this.copyGLTo2D = copyGLTo2DPutImageData) : this.copyGLTo2D = copyGLTo2DDrawImage) }, createWebGLCanvas: function (t, e) { var i = fabric.util.createCanvasElement(), t = (i.width = t, i.height = e, { alpha: !0, premultipliedAlpha: !1, depth: !1, stencil: !1, antialias: !1 }), e = i.getContext("webgl", t); (e = e || i.getContext("experimental-webgl", t)) && (e.clearColor(0, 0, 0, 0), this.canvas = i, this.gl = e) }, applyFilters: function (t, e, i, r, n, o) { var s, a = this.gl, h = (o && (s = this.getCachedTexture(o, e)), { originalWidth: e.width || e.originalWidth, originalHeight: e.height || e.originalHeight, sourceWidth: i, sourceHeight: r, destinationWidth: i, destinationHeight: r, context: a, sourceTexture: this.createTexture(a, i, r, !s && e), targetTexture: this.createTexture(a, i, r), originalTexture: s || this.createTexture(a, i, r, !s && e), passes: t.length, webgl: !0, aPosition: this.aPosition, programCache: this.programCache, pass: 0, filterBackend: this, targetCanvas: n }), o = a.createFramebuffer(); return a.bindFramebuffer(a.FRAMEBUFFER, o), t.forEach(function (t) { t && t.applyTo(h) }), resizeCanvasIfNeeded(h), this.copyGLTo2D(a, h), a.bindTexture(a.TEXTURE_2D, null), a.deleteTexture(h.sourceTexture), a.deleteTexture(h.targetTexture), a.deleteFramebuffer(o), n.getContext("2d").setTransform(1, 0, 0, 1, 0, 0), h }, applyFiltersDebug: function (t, e, i, r, n, o) { var s = this.gl, t = this.applyFilters(t, e, i, r, n, o), e = s.getError(); if (e !== s.NO_ERROR) throw i = this.glErrorToString(s, e), (r = new Error("WebGL Error " + i)).glErrorCode = e, r; return t }, glErrorToString: function (t, e) { if (!t) return "Context undefined for error code: " + e; if ("number" != typeof e) return "Error code is not a number"; switch (e) { case t.NO_ERROR: return "NO_ERROR"; case t.INVALID_ENUM: return "INVALID_ENUM"; case t.INVALID_VALUE: return "INVALID_VALUE"; case t.INVALID_OPERATION: return "INVALID_OPERATION"; case t.INVALID_FRAMEBUFFER_OPERATION: return "INVALID_FRAMEBUFFER_OPERATION"; case t.OUT_OF_MEMORY: return "OUT_OF_MEMORY"; case t.CONTEXT_LOST_WEBGL: return "CONTEXT_LOST_WEBGL"; default: return "UNKNOWN_ERROR" } }, dispose: function () { this.canvas && (this.canvas = null, this.gl = null), this.clearWebGLCaches() }, clearWebGLCaches: function () { this.programCache = {}, this.textureCache = {} }, createTexture: function (t, e, i, r) { var n = t.createTexture(); return t.bindTexture(t.TEXTURE_2D, n), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MAG_FILTER, t.NEAREST), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, t.NEAREST), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.CLAMP_TO_EDGE), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.CLAMP_TO_EDGE), r ? t.texImage2D(t.TEXTURE_2D, 0, t.RGBA, t.RGBA, t.UNSIGNED_BYTE, r) : t.texImage2D(t.TEXTURE_2D, 0, t.RGBA, e, i, 0, t.RGBA, t.UNSIGNED_BYTE, null), n }, getCachedTexture: function (t, e) { return this.textureCache[t] || (e = this.createTexture(this.gl, e.width, e.height, e), this.textureCache[t] = e) }, evictCachesForKey: function (t) { this.textureCache[t] && (this.gl.deleteTexture(this.textureCache[t]), delete this.textureCache[t]) }, copyGLTo2D: copyGLTo2DDrawImage, captureGPUInfo: function () { if (this.gpuInfo) return this.gpuInfo; var t, e = this.gl, i = e.getExtension("WEBGL_debug_renderer_info"), r = { renderer: "", vendor: "" }; return i && (t = e.getParameter(i.UNMASKED_RENDERER_WEBGL), e = e.getParameter(i.UNMASKED_VENDOR_WEBGL), t && (r.renderer = t.toLowerCase()), e && (r.vendor = e.toLowerCase())), this.gpuInfo = r } } }(), function () { "use strict"; function t() { } function e() { } (fabric.Canvas2dFilterBackend = e).prototype = { evictCachesForKey: t, dispose: t, clearWebGLCaches: t, resources: {}, applyFilters: function (t, e, i, r, n) { var o = n.getContext("2d"); o.drawImage(e, 0, 0, i, r); var s = { sourceWidth: i, sourceHeight: r, imageData: o.getImageData(0, 0, i, r), originalEl: e, originalImageData: o.getImageData(0, 0, i, r), canvasEl: n, ctx: o, filterBackend: this }; return t.forEach(function (t) { t.applyTo(s) }), s.imageData.width === i && s.imageData.height === r || (n.width = s.imageData.width, n.height = s.imageData.height), o.putImageData(s.imageData, 0, 0), s } } }(), fabric.Image.filters = fabric.Image.filters || {}, fabric.Image.filters.BaseFilter = fabric.util.createClass({ type: "BaseFilter", vertexSource: "attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}", fragmentSource: "precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}", initialize: function (t) { t && this.setOptions(t) }, setOptions: function (t) { for (var e in t) this[e] = t[e] }, createProgram: function (t, e, i) { e = e || this.fragmentSource, i = i || this.vertexSource, "highp" !== fabric.webGlPrecision && (e = e.replace(/precision highp float/g, "precision " + fabric.webGlPrecision + " float")); var r = t.createShader(t.VERTEX_SHADER); if (t.shaderSource(r, i), t.compileShader(r), !t.getShaderParameter(r, t.COMPILE_STATUS)) throw new Error("Vertex shader compile error for " + this.type + ": " + t.getShaderInfoLog(r)); i = t.createShader(t.FRAGMENT_SHADER); if (t.shaderSource(i, e), t.compileShader(i), !t.getShaderParameter(i, t.COMPILE_STATUS)) throw new Error("Fragment shader compile error for " + this.type + ": " + t.getShaderInfoLog(i)); e = t.createProgram(); if (t.attachShader(e, r), t.attachShader(e, i), t.linkProgram(e), !t.getProgramParameter(e, t.LINK_STATUS)) throw new Error('Shader link error for "${this.type}" ' + t.getProgramInfoLog(e)); r = this.getAttributeLocations(t, e), i = this.getUniformLocations(t, e) || {}; return i.uStepW = t.getUniformLocation(e, "uStepW"), i.uStepH = t.getUniformLocation(e, "uStepH"), { program: e, attributeLocations: r, uniformLocations: i } }, getAttributeLocations: function (t, e) { return { aPosition: t.getAttribLocation(e, "aPosition") } }, getUniformLocations: function () { return {} }, sendAttributeData: function (t, e, i) { var e = e.aPosition, r = t.createBuffer(); t.bindBuffer(t.ARRAY_BUFFER, r), t.enableVertexAttribArray(e), t.vertexAttribPointer(e, 2, t.FLOAT, !1, 0, 0), t.bufferData(t.ARRAY_BUFFER, i, t.STATIC_DRAW) }, _setupFrameBuffer: function (t) { var e, i, r = t.context; 1 < t.passes ? (e = t.destinationWidth, i = t.destinationHeight, t.sourceWidth === e && t.sourceHeight === i || (r.deleteTexture(t.targetTexture), t.targetTexture = t.filterBackend.createTexture(r, e, i)), r.framebufferTexture2D(r.FRAMEBUFFER, r.COLOR_ATTACHMENT0, r.TEXTURE_2D, t.targetTexture, 0)) : (r.bindFramebuffer(r.FRAMEBUFFER, null), r.finish()) }, _swapTextures: function (t) { t.passes--, t.pass++; var e = t.targetTexture; t.targetTexture = t.sourceTexture, t.sourceTexture = e }, isNeutralState: function () { return !1 }, applyTo: function (t) { t.webgl ? 1 < t.passes && this.isNeutralState(t) || (this._setupFrameBuffer(t), this.applyToWebGL(t), this._swapTextures(t)) : this.isNeutralState() || this.applyTo2d(t) }, retrieveShader: function (t) { return t.programCache.hasOwnProperty(this.type) || (t.programCache[this.type] = this.createProgram(t.context)), t.programCache[this.type] }, applyToWebGL: function (t) { var e = t.context, i = this.retrieveShader(t); 0 === t.pass && t.originalTexture ? e.bindTexture(e.TEXTURE_2D, t.originalTexture) : e.bindTexture(e.TEXTURE_2D, t.sourceTexture), e.useProgram(i.program), this.sendAttributeData(e, i.attributeLocations, t.aPosition), e.uniform1f(i.uniformLocations.uStepW, 1 / t.sourceWidth), e.uniform1f(i.uniformLocations.uStepH, 1 / t.sourceHeight), this.sendUniformData(e, i.uniformLocations), e.viewport(0, 0, t.destinationWidth, t.destinationHeight), e.drawArrays(e.TRIANGLE_STRIP, 0, 4) }, bindAdditionalTexture: function (t, e, i) { t.activeTexture(i), t.bindTexture(t.TEXTURE_2D, e), t.activeTexture(t.TEXTURE0) }, unbindAdditionalTexture: function (t, e) { t.activeTexture(e), t.bindTexture(t.TEXTURE_2D, null), t.activeTexture(t.TEXTURE0) }, getMainParameter: function () { return this[this.mainParameter] }, setMainParameter: function (t) { this[this.mainParameter] = t }, sendUniformData: function () { }, createHelpLayer: function (t) { var e; t.helpLayer || ((e = document.createElement("canvas")).width = t.sourceWidth, e.height = t.sourceHeight, t.helpLayer = e) }, toObject: function () { var t = { type: this.type }, e = this.mainParameter; return e && (t[e] = this[e]), t }, toJSON: function () { return this.toObject() } }), fabric.Image.filters.BaseFilter.fromObject = function (t, e) { t = new fabric.Image.filters[t.type](t); return e && e(t), t }, function (t) { "use strict"; var t = t.fabric || (t.fabric = {}), i = t.Image.filters, e = t.util.createClass; i.ColorMatrix = e(i.BaseFilter, { type: "ColorMatrix", fragmentSource: "precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}", matrix: [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0], mainParameter: "matrix", colorsOnly: !0, initialize: function (t) { this.callSuper("initialize", t), this.matrix = this.matrix.slice(0) }, isNeutralState: function () { for (var t = i.ColorMatrix, e = 20; e--;)if (this.matrix[e] !== t.prototype.matrix[e]) return !1; return !0 }, applyTo2d: function (t) { for (var e, i, r, n, o = t.imageData.data, s = o.length, a = this.matrix, h = this.colorsOnly, l = 0; l < s; l += 4)e = o[l], i = o[l + 1], r = o[l + 2], h ? (o[l] = e * a[0] + i * a[1] + r * a[2] + 255 * a[4], o[l + 1] = e * a[5] + i * a[6] + r * a[7] + 255 * a[9], o[l + 2] = e * a[10] + i * a[11] + r * a[12] + 255 * a[14]) : (n = o[l + 3], o[l] = e * a[0] + i * a[1] + r * a[2] + n * a[3] + 255 * a[4], o[l + 1] = e * a[5] + i * a[6] + r * a[7] + n * a[8] + 255 * a[9], o[l + 2] = e * a[10] + i * a[11] + r * a[12] + n * a[13] + 255 * a[14], o[l + 3] = e * a[15] + i * a[16] + r * a[17] + n * a[18] + 255 * a[19]) }, getUniformLocations: function (t, e) { return { uColorMatrix: t.getUniformLocation(e, "uColorMatrix"), uConstants: t.getUniformLocation(e, "uConstants") } }, sendUniformData: function (t, e) { var i = this.matrix, r = [i[0], i[1], i[2], i[3], i[5], i[6], i[7], i[8], i[10], i[11], i[12], i[13], i[15], i[16], i[17], i[18]], i = [i[4], i[9], i[14], i[19]]; t.uniformMatrix4fv(e.uColorMatrix, !1, r), t.uniform4fv(e.uConstants, i) } }), t.Image.filters.ColorMatrix.fromObject = t.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var t = t.fabric || (t.fabric = {}), e = t.Image.filters, i = t.util.createClass; e.Brightness = i(e.BaseFilter, { type: "Brightness", fragmentSource: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}", brightness: 0, mainParameter: "brightness", applyTo2d: function (t) { if (0 !== this.brightness) for (var e = t.imageData.data, i = e.length, r = Math.round(255 * this.brightness), n = 0; n < i; n += 4)e[n] = e[n] + r, e[n + 1] = e[n + 1] + r, e[n + 2] = e[n + 2] + r }, getUniformLocations: function (t, e) { return { uBrightness: t.getUniformLocation(e, "uBrightness") } }, sendUniformData: function (t, e) { t.uniform1f(e.uBrightness, this.brightness) } }), t.Image.filters.Brightness.fromObject = t.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var t = t.fabric || (t.fabric = {}), e = t.util.object.extend, i = t.Image.filters, r = t.util.createClass; i.Convolute = r(i.BaseFilter, { type: "Convolute", opaque: !1, matrix: [0, 0, 0, 0, 1, 0, 0, 0, 0], fragmentSource: { Convolute_3_1: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}", Convolute_3_0: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}", Convolute_5_1: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}", Convolute_5_0: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}", Convolute_7_1: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}", Convolute_7_0: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}", Convolute_9_1: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}", Convolute_9_0: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}" }, retrieveShader: function (t) { var e = Math.sqrt(this.matrix.length), e = this.type + "_" + e + "_" + (this.opaque ? 1 : 0), i = this.fragmentSource[e]; return t.programCache.hasOwnProperty(e) || (t.programCache[e] = this.createProgram(t.context, i)), t.programCache[e] }, applyTo2d: function (u) { for (var c, f, d, p, t, e, i, r, n, o, s, a = u.imageData, h = a.data, g = this.matrix, v = Math.round(Math.sqrt(g.length)), m = Math.floor(v / 2), l = a.width, y = a.height, a = u.ctx.createImageData(l, y), _ = a.data, b = this.opaque ? 1 : 0, x = 0; x < y; x++)for (n = 0; n < l; n++) { for (t = 4 * (x * l + n), s = p = d = f = c = 0; s < v; s++)for (o = 0; o < v; o++)e = n + o - m, (i = x + s - m) < 0 || y < i || e < 0 || l < e || (r = g[s * v + o], c += h[i = 4 * (i * l + e)] * r, f += h[1 + i] * r, d += h[2 + i] * r, b || (p += h[3 + i] * r)); _[t] = c, _[1 + t] = f, _[2 + t] = d, _[3 + t] = b ? h[3 + t] : p } u.imageData = a }, getUniformLocations: function (t, e) { return { uMatrix: t.getUniformLocation(e, "uMatrix"), uOpaque: t.getUniformLocation(e, "uOpaque"), uHalfSize: t.getUniformLocation(e, "uHalfSize"), uSize: t.getUniformLocation(e, "uSize") } }, sendUniformData: function (t, e) { t.uniform1fv(e.uMatrix, this.matrix) }, toObject: function () { return e(this.callSuper("toObject"), { opaque: this.opaque, matrix: this.matrix }) } }), t.Image.filters.Convolute.fromObject = t.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var t = t.fabric || (t.fabric = {}), e = t.Image.filters, i = t.util.createClass; e.Grayscale = i(e.BaseFilter, { type: "Grayscale", fragmentSource: { average: "precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}", lightness: "precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}", luminosity: "precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}" }, mode: "average", mainParameter: "mode", applyTo2d: function (t) { for (var e, i = t.imageData.data, r = i.length, n = this.mode, o = 0; o < r; o += 4)"average" === n ? e = (i[o] + i[o + 1] + i[o + 2]) / 3 : "lightness" === n ? e = (Math.min(i[o], i[o + 1], i[o + 2]) + Math.max(i[o], i[o + 1], i[o + 2])) / 2 : "luminosity" === n && (e = .21 * i[o] + .72 * i[o + 1] + .07 * i[o + 2]), i[o] = e, i[o + 1] = e, i[o + 2] = e }, retrieveShader: function (t) { var e, i = this.type + "_" + this.mode; return t.programCache.hasOwnProperty(i) || (e = this.fragmentSource[this.mode], t.programCache[i] = this.createProgram(t.context, e)), t.programCache[i] }, getUniformLocations: function (t, e) { return { uMode: t.getUniformLocation(e, "uMode") } }, sendUniformData: function (t, e) { t.uniform1i(e.uMode, 1) } }), t.Image.filters.Grayscale.fromObject = t.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var t = t.fabric || (t.fabric = {}), e = t.Image.filters, i = t.util.createClass; e.Invert = i(e.BaseFilter, { type: "Invert", fragmentSource: "precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}", invert: !0, mainParameter: "invert", applyTo2d: function (t) { if (this.invert) for (var e = t.imageData.data, i = e.length, r = 0; r < i; r += 4)e[r] = 255 - e[r], e[r + 1] = 255 - e[r + 1], e[r + 2] = 255 - e[r + 2] }, getUniformLocations: function (t, e) { return { uInvert: t.getUniformLocation(e, "uInvert") } }, sendUniformData: function (t, e) { t.uniform1i(e.uInvert, this.invert) } }), t.Image.filters.Invert.fromObject = t.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var t = t.fabric || (t.fabric = {}), e = t.util.object.extend, i = t.Image.filters, r = t.util.createClass; i.Noise = r(i.BaseFilter, { type: "Noise", fragmentSource: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}", mainParameter: "noise", noise: 0, applyTo2d: function (t) { if (0 !== this.noise) for (var e, i = t.imageData.data, r = (i.length, this.noise), n = 0, o = i.length; n < o; n += 4)e = (.5 - Math.random()) * r, i[n] += e, i[n + 1] += e, i[n + 2] += e }, getUniformLocations: function (t, e) { return { uNoise: t.getUniformLocation(e, "uNoise"), uSeed: t.getUniformLocation(e, "uSeed") } }, sendUniformData: function (t, e) { t.uniform1f(e.uNoise, this.noise / 255), t.uniform1f(e.uSeed, Math.random()) }, toObject: function () { return e(this.callSuper("toObject"), { noise: this.noise }) } }), t.Image.filters.Noise.fromObject = t.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var t = t.fabric || (t.fabric = {}), e = t.Image.filters, i = t.util.createClass; e.Pixelate = i(e.BaseFilter, { type: "Pixelate", blocksize: 4, mainParameter: "blocksize", fragmentSource: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}", applyTo2d: function (t) { if (1 !== this.blocksize) for (var e, i, r, n, u, c, o, s, f, d, t = t.imageData, a = t.data, p = t.height, h = t.width, l = 0; l < p; l += this.blocksize)for (i = 0; i < h; i += this.blocksize)for (r = a[e = 4 * l * h + 4 * i], n = a[1 + e], u = a[2 + e], c = a[3 + e], f = Math.min(l + this.blocksize, p), d = Math.min(i + this.blocksize, h), o = l; o < f; o++)for (s = i; s < d; s++)a[e = 4 * o * h + 4 * s] = r, a[1 + e] = n, a[2 + e] = u, a[3 + e] = c }, isNeutralState: function () { return 1 === this.blocksize }, getUniformLocations: function (t, e) { return { uBlocksize: t.getUniformLocation(e, "uBlocksize"), uStepW: t.getUniformLocation(e, "uStepW"), uStepH: t.getUniformLocation(e, "uStepH") } }, sendUniformData: function (t, e) { t.uniform1f(e.uBlocksize, this.blocksize) } }), t.Image.filters.Pixelate.fromObject = t.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var l = t.fabric || (t.fabric = {}), e = l.util.object.extend, t = l.Image.filters, i = l.util.createClass; t.RemoveColor = i(t.BaseFilter, { type: "RemoveColor", color: "#FFFFFF", fragmentSource: "precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}", distance: .02, useAlpha: !1, applyTo2d: function (t) { for (var e, i, r, n = t.imageData.data, t = 255 * this.distance, o = new l.Color(this.color).getSource(), s = [o[0] - t, o[1] - t, o[2] - t], a = [o[0] + t, o[1] + t, o[2] + t], h = 0; h < n.length; h += 4)e = n[h], i = n[h + 1], r = n[h + 2], s[0] < e && s[1] < i && s[2] < r && e < a[0] && i < a[1] && r < a[2] && (n[h + 3] = 0) }, getUniformLocations: function (t, e) { return { uLow: t.getUniformLocation(e, "uLow"), uHigh: t.getUniformLocation(e, "uHigh") } }, sendUniformData: function (t, e) { var i = new l.Color(this.color).getSource(), r = parseFloat(this.distance), n = [0 + i[0] / 255 - r, 0 + i[1] / 255 - r, 0 + i[2] / 255 - r, 1], i = [i[0] / 255 + r, i[1] / 255 + r, i[2] / 255 + r, 1]; t.uniform4fv(e.uLow, n), t.uniform4fv(e.uHigh, i) }, toObject: function () { return e(this.callSuper("toObject"), { color: this.color, distance: this.distance }) } }), l.Image.filters.RemoveColor.fromObject = l.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var e, i = t.fabric || (t.fabric = {}), r = i.Image.filters, n = i.util.createClass, o = { Brownie: [.5997, .34553, -.27082, 0, .186, -.0377, .86095, .15059, 0, -.1449, .24113, -.07441, .44972, 0, -.02965, 0, 0, 0, 1, 0], Vintage: [.62793, .32021, -.03965, 0, .03784, .02578, .64411, .03259, 0, .02926, .0466, -.08512, .52416, 0, .02023, 0, 0, 0, 1, 0], Kodachrome: [1.12855, -.39673, -.03992, 0, .24991, -.16404, 1.08352, -.05498, 0, .09698, -.16786, -.56034, 1.60148, 0, .13972, 0, 0, 0, 1, 0], Technicolor: [1.91252, -.85453, -.09155, 0, .04624, -.30878, 1.76589, -.10601, 0, -.27589, -.2311, -.75018, 1.84759, 0, .12137, 0, 0, 0, 1, 0], Polaroid: [1.438, -.062, -.062, 0, 0, -.122, 1.378, -.122, 0, 0, -.016, -.016, 1.483, 0, 0, 0, 0, 0, 1, 0], Sepia: [.393, .769, .189, 0, 0, .349, .686, .168, 0, 0, .272, .534, .131, 0, 0, 0, 0, 0, 1, 0], BlackWhite: [1.5, 1.5, 1.5, 0, -1, 1.5, 1.5, 1.5, 0, -1, 1.5, 1.5, 1.5, 0, -1, 0, 0, 0, 1, 0] }; for (e in o) r[e] = n(r.ColorMatrix, { type: e, matrix: o[e], mainParameter: !1, colorsOnly: !0 }), i.Image.filters[e].fromObject = i.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var c = t.fabric, t = c.Image.filters, e = c.util.createClass; t.BlendColor = e(t.BaseFilter, { type: "BlendColor", color: "#F95C63", mode: "multiply", alpha: 1, fragmentSource: { multiply: "gl_FragColor.rgb *= uColor.rgb;\n", screen: "gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n", add: "gl_FragColor.rgb += uColor.rgb;\n", diff: "gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n", subtract: "gl_FragColor.rgb -= uColor.rgb;\n", lighten: "gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n", darken: "gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n", exclusion: "gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n", overlay: "if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n", tint: "gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n" }, buildSource: function (t) { return "precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n" + this.fragmentSource[t] + "}\n}" }, retrieveShader: function (t) { var e, i = this.type + "_" + this.mode; return t.programCache.hasOwnProperty(i) || (e = this.buildSource(this.mode), t.programCache[i] = this.createProgram(t.context, e)), t.programCache[i] }, applyTo2d: function (t) { for (var e, i, r, n = t.imageData.data, u = n.length, o = 1 - this.alpha, t = new c.Color(this.color).getSource(), s = t[0] * this.alpha, a = t[1] * this.alpha, h = t[2] * this.alpha, l = 0; l < u; l += 4)switch (e = n[l], i = n[l + 1], r = n[l + 2], this.mode) { case "multiply": n[l] = e * s / 255, n[l + 1] = i * a / 255, n[l + 2] = r * h / 255; break; case "screen": n[l] = 255 - (255 - e) * (255 - s) / 255, n[l + 1] = 255 - (255 - i) * (255 - a) / 255, n[l + 2] = 255 - (255 - r) * (255 - h) / 255; break; case "add": n[l] = e + s, n[l + 1] = i + a, n[l + 2] = r + h; break; case "diff": case "difference": n[l] = Math.abs(e - s), n[l + 1] = Math.abs(i - a), n[l + 2] = Math.abs(r - h); break; case "subtract": n[l] = e - s, n[l + 1] = i - a, n[l + 2] = r - h; break; case "darken": n[l] = Math.min(e, s), n[l + 1] = Math.min(i, a), n[l + 2] = Math.min(r, h); break; case "lighten": n[l] = Math.max(e, s), n[l + 1] = Math.max(i, a), n[l + 2] = Math.max(r, h); break; case "overlay": n[l] = s < 128 ? 2 * e * s / 255 : 255 - 2 * (255 - e) * (255 - s) / 255, n[l + 1] = a < 128 ? 2 * i * a / 255 : 255 - 2 * (255 - i) * (255 - a) / 255, n[l + 2] = h < 128 ? 2 * r * h / 255 : 255 - 2 * (255 - r) * (255 - h) / 255; break; case "exclusion": n[l] = s + e - 2 * s * e / 255, n[l + 1] = a + i - 2 * a * i / 255, n[l + 2] = h + r - 2 * h * r / 255; break; case "tint": n[l] = s + e * o, n[l + 1] = a + i * o, n[l + 2] = h + r * o } }, getUniformLocations: function (t, e) { return { uColor: t.getUniformLocation(e, "uColor") } }, sendUniformData: function (t, e) { var i = new c.Color(this.color).getSource(); i[0] = this.alpha * i[0] / 255, i[1] = this.alpha * i[1] / 255, i[2] = this.alpha * i[2] / 255, i[3] = this.alpha, t.uniform4fv(e.uColor, i) }, toObject: function () { return { type: this.type, color: this.color, mode: this.mode, alpha: this.alpha } } }), c.Image.filters.BlendColor.fromObject = c.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var n = t.fabric, t = n.Image.filters, e = n.util.createClass; t.BlendImage = e(t.BaseFilter, { type: "BlendImage", image: null, mode: "multiply", alpha: 1, vertexSource: "attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}", fragmentSource: { multiply: "precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}", mask: "precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}" }, retrieveShader: function (t) { var e = this.type + "_" + this.mode, i = this.fragmentSource[this.mode]; return t.programCache.hasOwnProperty(e) || (t.programCache[e] = this.createProgram(t.context, i)), t.programCache[e] }, applyToWebGL: function (t) { var e = t.context, i = this.createTexture(t.filterBackend, this.image); this.bindAdditionalTexture(e, i, e.TEXTURE1), this.callSuper("applyToWebGL", t), this.unbindAdditionalTexture(e, e.TEXTURE1) }, createTexture: function (t, e) { return t.getCachedTexture(e.cacheKey, e._element) }, calculateMatrix: function () { var t = this.image, e = t._element.width, i = t._element.height; return [1 / t.scaleX, 0, 0, 0, 1 / t.scaleY, 0, -t.left / e, -t.top / i, 1] }, applyTo2d: function (t) { var e, i, u, r, c, f, d, p, n = t.imageData, o = t.filterBackend.resources, s = n.data, g = s.length, n = t.imageData.width, t = t.imageData.height, a = this.image; o.blendImage || (o.blendImage = document.createElement("canvas")), (o = o.blendImage).width === n && o.height === t || (o.width = n, o.height = t), (o = o.getContext("2d")).setTransform(a.scaleX, 0, 0, a.scaleY, a.left, a.top), o.drawImage(a._element, 0, 0, n, t); for (var h = o.getImageData(0, 0, n, t).data, l = 0; l < g; l += 4)switch (c = s[l], f = s[l + 1], d = s[l + 2], p = s[l + 3], e = h[l], i = h[l + 1], u = h[l + 2], r = h[l + 3], this.mode) { case "multiply": s[l] = c * e / 255, s[l + 1] = f * i / 255, s[l + 2] = d * u / 255, s[l + 3] = p * r / 255; break; case "mask": s[l + 3] = r } }, getUniformLocations: function (t, e) { return { uTransformMatrix: t.getUniformLocation(e, "uTransformMatrix"), uImage: t.getUniformLocation(e, "uImage") } }, sendUniformData: function (t, e) { var i = this.calculateMatrix(); t.uniform1i(e.uImage, 1), t.uniformMatrix3fv(e.uTransformMatrix, !1, i) }, toObject: function () { return { type: this.type, image: this.image && this.image.toObject(), mode: this.mode, alpha: this.alpha } } }), n.Image.filters.BlendImage.fromObject = function (i, r) { n.Image.fromObject(i.image, function (t) { var e = n.util.object.clone(i); e.image = t, r(new n.Image.filters.BlendImage(e)) }) } }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var v = t.fabric || (t.fabric = {}), A = Math.pow, D = Math.floor, R = Math.sqrt, I = Math.abs, s = Math.round, r = Math.sin, k = Math.ceil, t = v.Image.filters, e = v.util.createClass; t.Resize = e(t.BaseFilter, { type: "Resize", resizeType: "hermite", scaleX: 0, scaleY: 0, lanczosLobes: 3, getUniformLocations: function (t, e) { return { uDelta: t.getUniformLocation(e, "uDelta"), uTaps: t.getUniformLocation(e, "uTaps") } }, sendUniformData: function (t, e) { t.uniform2fv(e.uDelta, this.horizontal ? [1 / this.width, 0] : [0, 1 / this.height]), t.uniform1fv(e.uTaps, this.taps) }, retrieveShader: function (t) { var e = this.getFilterWindow(), i = this.type + "_" + e; return t.programCache.hasOwnProperty(i) || (e = this.generateShader(e), t.programCache[i] = this.createProgram(t.context, e)), t.programCache[i] }, getFilterWindow: function () { var t = this.tempScale; return Math.ceil(this.lanczosLobes / t) }, getTaps: function () { for (var t = this.lanczosCreate(this.lanczosLobes), e = this.tempScale, i = this.getFilterWindow(), r = new Array(i), n = 1; n <= i; n++)r[n - 1] = t(n * e); return r }, generateShader: function (t) { for (var e = new Array(t), i = this.fragmentSourceTOP, r = 1; r <= t; r++)e[r - 1] = r + ".0 * uDelta"; return i = (i = i + ("uniform float uTaps[" + t + "];\n") + "void main() {\n") + "  vec4 color = texture2D(uTexture, vTexCoord);\n" + "  float sum = 1.0;\n", e.forEach(function (t, e) { i = (i += "  color += texture2D(uTexture, vTexCoord + " + t + ") * uTaps[" + e + "];\n") + "  color += texture2D(uTexture, vTexCoord - " + t + ") * uTaps[" + e + "];\n  sum += 2.0 * uTaps[" + e + "];\n" }), i = i + "  gl_FragColor = color / sum;\n" + "}" }, fragmentSourceTOP: "precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n", applyTo: function (t) { t.webgl ? 1 < t.passes && this.isNeutralState(t) || (t.passes++, this.width = t.sourceWidth, this.horizontal = !0, this.dW = Math.round(this.width * this.scaleX), this.dH = t.sourceHeight, this.tempScale = this.dW / this.width, this.taps = this.getTaps(), t.destinationWidth = this.dW, this._setupFrameBuffer(t), this.applyToWebGL(t), this._swapTextures(t), t.sourceWidth = t.destinationWidth, this.height = t.sourceHeight, this.horizontal = !1, this.dH = Math.round(this.height * this.scaleY), this.tempScale = this.dH / this.height, this.taps = this.getTaps(), t.destinationHeight = this.dH, this._setupFrameBuffer(t), this.applyToWebGL(t), this._swapTextures(t), t.sourceHeight = t.destinationHeight) : this.isNeutralState(t) || this.applyTo2d(t) }, isNeutralState: function (t) { var e = t.scaleX || this.scaleX, t = t.scaleY || this.scaleY; return 1 === e && 1 === t }, lanczosCreate: function (i) { return function (t) { if (i <= t || t <= -i) return 0; if (t < 1.1920929e-7 && -1.1920929e-7 < t) return 1; var e = (t *= Math.PI) / i; return r(t) / t * r(e) / e } }, applyTo2d: function (t) { var e, i = t.imageData, r = this.scaleX, n = this.scaleY, o = (this.rcpScaleX = 1 / r, this.rcpScaleY = 1 / n, i.width), i = i.height, r = s(o * r), n = s(i * n); "sliceHack" === this.resizeType ? e = this.sliceByTwo(t, o, i, r, n) : "hermite" === this.resizeType ? e = this.hermiteFastResize(t, o, i, r, n) : "bilinear" === this.resizeType ? e = this.bilinearFiltering(t, o, i, r, n) : "lanczos" === this.resizeType && (e = this.lanczosResize(t, o, i, r, n)), t.imageData = e }, sliceByTwo: function (u, t, e, i, r) { var n, o, u = u.imageData, c = !1, f = !1, s = .5 * t, a = .5 * e, h = v.filterBackend.resources, l = 0, d = 0, p = t, g = 0; for (h.sliceByTwo || (h.sliceByTwo = document.createElement("canvas")), ((n = h.sliceByTwo).width < 1.5 * t || n.height < e) && (n.width = 1.5 * t, n.height = e), (o = n.getContext("2d")).clearRect(0, 0, 1.5 * t, e), o.putImageData(u, 0, 0), i = D(i), r = D(r); !c || !f;)e = a, i < D(.5 * (t = s)) ? s = D(.5 * s) : (s = i, c = !0), r < D(.5 * a) ? a = D(.5 * a) : (a = r, f = !0), o.drawImage(n, l, d, t, e, p, g, s, a), l = p, d = g, g += a; return o.getImageData(l, d, i, r) }, lanczosResize: function (t, d, T, p, g) { var v = t.imageData.data, m = t.ctx.createImageData(p, g), y = m.data, w = this.lanczosCreate(this.lanczosLobes), S = this.rcpScaleX, C = this.rcpScaleY, E = 2 / this.rcpScaleX, O = 2 / this.rcpScaleY, P = k(S * this.lanczosLobes / 2), M = k(C * this.lanczosLobes / 2), _ = {}, b = {}, x = {}; return function u(t) { var e, i, r, n, o, s, c, f, a, h; for (b.x = (t + .5) * S, x.x = D(b.x), e = 0; e < g; e++) { for (b.y = (e + .5) * C, x.y = D(b.y), f = c = s = o = n = 0, i = x.x - P; i <= x.x + P; i++)if (!(i < 0 || d <= i)) { a = D(1e3 * I(i - b.x)), _[a] || (_[a] = {}); for (var l = x.y - M; l <= x.y + M; l++)l < 0 || T <= l || (h = D(1e3 * I(l - b.y)), _[a][h] || (_[a][h] = w(R(A(a * E, 2) + A(h * O, 2)) / 1e3)), 0 < (h = _[a][h]) && (n += h, o += h * v[r = 4 * (l * d + i)], s += h * v[r + 1], c += h * v[r + 2], f += h * v[r + 3])) } y[r = 4 * (e * p + t)] = o / n, y[r + 1] = s / n, y[r + 2] = c / n, y[r + 3] = f / n } return ++t < p ? u(t) : m }(0) }, bilinearFiltering: function (t, e, u, i, c) { for (var f, d, p, g, v, m, r, n, o, s, a, y = 0, _ = this.rcpScaleX, b = this.rcpScaleY, x = 4 * (e - 1), h = t.imageData.data, t = t.ctx.createImageData(i, c), T = t.data, l = 0; l < c; l++)for (r = 0; r < i; r++)for (n = _ * r - (v = D(_ * r)), o = b * l - (m = D(b * l)), a = 4 * (m * e + v), s = 0; s < 4; s++)f = h[a + s], d = h[4 + a + s], p = h[a + x + s], g = h[a + x + 4 + s], T[y++] = f * (1 - n) * (1 - o) + d * n * (1 - o) + p * o * (1 - n) + g * n * o; return t }, hermiteFastResize: function (t, u, c, f, d) { for (var e = this.rcpScaleX, i = this.rcpScaleY, p = k(e / 2), g = k(i / 2), r = t.imageData.data, t = t.ctx.createImageData(f, d), n = t.data, o = 0; o < d; o++)for (var s = 0; s < f; s++) { for (var v = 4 * (s + o * f), a = 0, m = 0, y = 0, _ = 0, b = 0, x = 0, T = 0, w = (o + .5) * i, S = D(o * i); S < (o + 1) * i; S++)for (var C = I(w - (S + .5)) / g, E = (s + .5) * e, O = C * C, P = D(s * e); P < (s + 1) * e; P++) { var h = I(E - (P + .5)) / p, l = R(O + h * h); 1 < l && l < -1 || 0 < (a = 2 * l * l * l - 3 * l * l + 1) && (T += a * r[3 + (h = 4 * (P + S * u))], y += a, _ += (a = r[3 + h] < 255 ? a * r[3 + h] / 250 : a) * r[h], b += a * r[1 + h], x += a * r[2 + h], m += a) } n[v] = _ / m, n[1 + v] = b / m, n[2 + v] = x / m, n[3 + v] = T / y } return t }, toObject: function () { return { type: this.type, scaleX: this.scaleX, scaleY: this.scaleY, resizeType: this.resizeType, lanczosLobes: this.lanczosLobes } } }), v.Image.filters.Resize.fromObject = v.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var t = t.fabric || (t.fabric = {}), e = t.Image.filters, i = t.util.createClass; e.Contrast = i(e.BaseFilter, { type: "Contrast", fragmentSource: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}", contrast: 0, mainParameter: "contrast", applyTo2d: function (t) { if (0 !== this.contrast) for (var e = t.imageData.data, i = e.length, t = Math.floor(255 * this.contrast), r = 259 * (t + 255) / (255 * (259 - t)), n = 0; n < i; n += 4)e[n] = r * (e[n] - 128) + 128, e[n + 1] = r * (e[n + 1] - 128) + 128, e[n + 2] = r * (e[n + 2] - 128) + 128 }, getUniformLocations: function (t, e) { return { uContrast: t.getUniformLocation(e, "uContrast") } }, sendUniformData: function (t, e) { t.uniform1f(e.uContrast, this.contrast) } }), t.Image.filters.Contrast.fromObject = t.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var t = t.fabric || (t.fabric = {}), e = t.Image.filters, i = t.util.createClass; e.Saturation = i(e.BaseFilter, { type: "Saturation", fragmentSource: "precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}", saturation: 0, mainParameter: "saturation", applyTo2d: function (t) { if (0 !== this.saturation) for (var e, i = t.imageData.data, r = i.length, n = -this.saturation, o = 0; o < r; o += 4)e = Math.max(i[o], i[o + 1], i[o + 2]), i[o] += e !== i[o] ? (e - i[o]) * n : 0, i[o + 1] += e !== i[o + 1] ? (e - i[o + 1]) * n : 0, i[o + 2] += e !== i[o + 2] ? (e - i[o + 2]) * n : 0 }, getUniformLocations: function (t, e) { return { uSaturation: t.getUniformLocation(e, "uSaturation") } }, sendUniformData: function (t, e) { t.uniform1f(e.uSaturation, -this.saturation) } }), t.Image.filters.Saturation.fromObject = t.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var d = t.fabric || (t.fabric = {}), t = d.Image.filters, e = d.util.createClass; t.Blur = e(t.BaseFilter, { type: "Blur", fragmentSource: "precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}", blur: 0, mainParameter: "blur", applyTo: function (t) { t.webgl ? (this.aspectRatio = t.sourceWidth / t.sourceHeight, t.passes++, this._setupFrameBuffer(t), this.horizontal = !0, this.applyToWebGL(t), this._swapTextures(t), this._setupFrameBuffer(t), this.horizontal = !1, this.applyToWebGL(t), this._swapTextures(t)) : this.applyTo2d(t) }, applyTo2d: function (t) { t.imageData = this.simpleBlur(t) }, simpleBlur: function (t) { var e, i, r, n, o, s, a = t.filterBackend.resources, u = t.imageData.width, c = t.imageData.height, h = (a.blurLayer1 || (a.blurLayer1 = d.util.createCanvasElement(), a.blurLayer2 = d.util.createCanvasElement()), e = a.blurLayer1, i = a.blurLayer2, e.width === u && e.height === c || (i.width = e.width = u, i.height = e.height = c), e.getContext("2d")), l = i.getContext("2d"), f = .06 * this.blur * .5; for (h.putImageData(t.imageData, 0, 0), l.clearRect(0, 0, u, c), s = -15; s <= 15; s++)o = f * (n = s / 15) * u + (r = (Math.random() - .5) / 4), l.globalAlpha = 1 - Math.abs(n), l.drawImage(e, o, r), h.drawImage(i, 0, 0), l.globalAlpha = 1, l.clearRect(0, 0, i.width, i.height); for (s = -15; s <= 15; s++)o = f * (n = s / 15) * c + (r = (Math.random() - .5) / 4), l.globalAlpha = 1 - Math.abs(n), l.drawImage(e, r, o), h.drawImage(i, 0, 0), l.globalAlpha = 1, l.clearRect(0, 0, i.width, i.height); t.ctx.drawImage(e, 0, 0); a = t.ctx.getImageData(0, 0, e.width, e.height); return h.globalAlpha = 1, h.clearRect(0, 0, e.width, e.height), a }, getUniformLocations: function (t, e) { return { delta: t.getUniformLocation(e, "uDelta") } }, sendUniformData: function (t, e) { var i = this.chooseRightDelta(); t.uniform2fv(e.delta, i) }, chooseRightDelta: function () { var t = 1, e = [0, 0]; return this.horizontal ? 1 < this.aspectRatio && (t = 1 / this.aspectRatio) : this.aspectRatio < 1 && (t = this.aspectRatio), t = t * this.blur * .12, this.horizontal ? e[0] = t : e[1] = t, e } }), t.Blur.fromObject = d.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var t = t.fabric || (t.fabric = {}), e = t.Image.filters, i = t.util.createClass; e.Gamma = i(e.BaseFilter, { type: "Gamma", fragmentSource: "precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}", gamma: [1, 1, 1], mainParameter: "gamma", applyTo2d: function (t) { var e, i = t.imageData.data, t = this.gamma, r = i.length, n = 1 / t[0], o = 1 / t[1], s = 1 / t[2]; for (this.rVals || (this.rVals = new Uint8Array(256), this.gVals = new Uint8Array(256), this.bVals = new Uint8Array(256)), e = 0, r = 256; e < r; e++)this.rVals[e] = 255 * Math.pow(e / 255, n), this.gVals[e] = 255 * Math.pow(e / 255, o), this.bVals[e] = 255 * Math.pow(e / 255, s); for (e = 0, r = i.length; e < r; e += 4)i[e] = this.rVals[i[e]], i[e + 1] = this.gVals[i[e + 1]], i[e + 2] = this.bVals[i[e + 2]] }, getUniformLocations: function (t, e) { return { uGamma: t.getUniformLocation(e, "uGamma") } }, sendUniformData: function (t, e) { t.uniform3fv(e.uGamma, this.gamma) } }), t.Image.filters.Gamma.fromObject = t.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var i = t.fabric || (t.fabric = {}), t = i.Image.filters, e = i.util.createClass; t.Composed = e(t.BaseFilter, { type: "Composed", subFilters: [], initialize: function (t) { this.callSuper("initialize", t), this.subFilters = this.subFilters.slice(0) }, applyTo: function (e) { e.passes += this.subFilters.length - 1, this.subFilters.forEach(function (t) { t.applyTo(e) }) }, toObject: function () { return i.util.object.extend(this.callSuper("toObject"), { subFilters: this.subFilters.map(function (t) { return t.toObject() }) }) } }), i.Image.filters.Composed.fromObject = function (t, e) { t = (t.subFilters || []).map(function (t) { return new i.Image.filters[t.type](t) }), t = new i.Image.filters.Composed({ subFilters: t }); return e && e(t), t } }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var r = t.fabric || (t.fabric = {}), t = r.Image.filters, e = r.util.createClass; t.HueRotation = e(t.ColorMatrix, { type: "HueRotation", rotation: 0, mainParameter: "rotation", calculateMatrix: function () { var t = this.rotation * Math.PI, e = r.util.cos(t), t = r.util.sin(t), t = Math.sqrt(1 / 3) * t, i = 1 - e; this.matrix = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0], this.matrix[0] = e + i / 3, this.matrix[1] = 1 / 3 * i - t, this.matrix[2] = 1 / 3 * i + t, this.matrix[5] = 1 / 3 * i + t, this.matrix[6] = e + 1 / 3 * i, this.matrix[7] = 1 / 3 * i - t, this.matrix[10] = 1 / 3 * i - t, this.matrix[11] = 1 / 3 * i + t, this.matrix[12] = e + 1 / 3 * i }, applyTo: function (t) { this.calculateMatrix(), r.Image.filters.BaseFilter.prototype.applyTo.call(this, t) } }), r.Image.filters.HueRotation.fromObject = r.Image.filters.BaseFilter.fromObject }("undefined" != typeof exports ? exports : this), function (t) { "use strict"; var s = t.fabric || (t.fabric = {}), a = s.util.object.clone; s.Text ? s.warn("fabric.Text is already defined") : (s.Text = s.util.createClass(s.Object, { _dimensionAffectingProps: ["fontSize", "fontWeight", "fontFamily", "fontStyle", "lineHeight", "text", "charSpacing", "textAlign", "styles"], _reNewline: /\r?\n/, _reSpacesAndTabs: /[ \t\r]/g, _reSpaceAndTab: /[ \t\r]/, _reWords: /\S+/g, type: "text", fontSize: 40, fontWeight: "normal", fontFamily: "Times New Roman", underline: !1, overline: !1, linethrough: !1, textAlign: "left", fontStyle: "normal", lineHeight: 1.16, superscript: { size: .6, baseline: -.35 }, subscript: { size: .6, baseline: .11 }, textBackgroundColor: "", stateProperties: s.Object.prototype.stateProperties.concat("fontFamily", "fontWeight", "fontSize", "text", "underline", "overline", "linethrough", "textAlign", "fontStyle", "lineHeight", "textBackgroundColor", "charSpacing", "styles"), cacheProperties: s.Object.prototype.cacheProperties.concat("fontFamily", "fontWeight", "fontSize", "text", "underline", "overline", "linethrough", "textAlign", "fontStyle", "lineHeight", "textBackgroundColor", "charSpacing", "styles"), stroke: null, shadow: null, _fontSizeFraction: .222, offsets: { underline: .1, linethrough: -.315, overline: -.88 }, _fontSizeMult: 1.13, charSpacing: 0, styles: null, _measuringContext: null, deltaY: 0, _styleProperties: ["stroke", "strokeWidth", "fill", "fontFamily", "fontSize", "fontWeight", "fontStyle", "underline", "overline", "linethrough", "deltaY", "textBackgroundColor"], __charBounds: [], CACHE_FONT_SIZE: 400, MIN_TEXT_WIDTH: 2, initialize: function (t, e) { this.styles = e && e.styles || {}, this.text = t, this.__skipDimension = !0, this.callSuper("initialize", e), this.__skipDimension = !1, this.initDimensions(), this.setCoords(), this.setupState({ propertySet: "_dimensionAffectingProps" }) }, getMeasuringContext: function () { return s._measuringContext || (s._measuringContext = this.canvas && this.canvas.contextCache || s.util.createCanvasElement().getContext("2d")), s._measuringContext }, _splitText: function () { var t = this._splitTextIntoLines(this.text); return this.textLines = t.lines, this._textLines = t.graphemeLines, this._unwrappedTextLines = t._unwrappedLines, this._text = t.graphemeText, t }, initDimensions: function () { this.__skipDimension || (this._splitText(), this._clearCache(), this.width = this.calcTextWidth() || this.cursorWidth || this.MIN_TEXT_WIDTH, -1 !== this.textAlign.indexOf("justify") && this.enlargeSpaces(), this.height = this.calcTextHeight(), this.saveState({ propertySet: "_dimensionAffectingProps" })) }, enlargeSpaces: function () { for (var t, e, i, r, n, o = 0, s = this._textLines.length; o < s; o++)if (("justify" === this.textAlign || o !== s - 1 && !this.isEndOfWrapping(o)) && (e = 0, i = this._textLines[o], (t = this.getLineWidth(o)) < this.width && (n = this.textLines[o].match(this._reSpacesAndTabs)))) for (var a = n.length, h = (this.width - t) / a, l = 0, u = i.length; l <= u; l++)r = this.__charBounds[o][l], this._reSpaceAndTab.test(i[l]) ? (r.width += h, r.kernedWidth += h, r.left += e, e += h) : r.left += e }, isEndOfWrapping: function (t) { return t === this._textLines.length - 1 }, toString: function () { return "#<fabric.Text (" + this.complexity() + '): { "text": "' + this.text + '", "fontFamily": "' + this.fontFamily + '" }>' }, _getCacheCanvasDimensions: function () { var t = this.callSuper("_getCacheCanvasDimensions"), e = this.fontSize; return t.width += e * t.zoomX, t.height += e * t.zoomY, t }, _render: function (t) { this._setTextStyles(t), this._renderTextLinesBackground(t), this._renderTextDecoration(t, "underline"), this._renderText(t), this._renderTextDecoration(t, "overline"), this._renderTextDecoration(t, "linethrough") }, _renderText: function (t) { "stroke" === this.paintFirst ? (this._renderTextStroke(t), this._renderTextFill(t)) : (this._renderTextFill(t), this._renderTextStroke(t)) }, _setTextStyles: function (t, e, i) { t.textBaseline = "alphabetic", t.font = this._getFontDeclaration(e, i) }, calcTextWidth: function () { for (var t = this.getLineWidth(0), e = 1, i = this._textLines.length; e < i; e++) { var r = this.getLineWidth(e); t < r && (t = r) } return t }, _renderTextLine: function (t, e, i, r, n, o) { this._renderChars(t, e, i, r, n, o) }, _renderTextLinesBackground: function (t) { if (this.textBackgroundColor || this.styleHas("textBackgroundColor")) { for (var e, i, r, n = 0, u = t.fillStyle, c = this._getLeftOffset(), f = this._getTopOffset(), o = 0, s = 0, a = 0, d = this._textLines.length; a < d; a++)if (e = this.getHeightOfLine(a), this.textBackgroundColor || this.styleHas("textBackgroundColor", a)) { for (var p = this._textLines[a], g = this._getLineLeftOffset(a), s = 0, o = 0, h = this.getValueOfPropertyAt(a, 0, "textBackgroundColor"), l = 0, v = p.length; l < v; l++)i = this.__charBounds[a][l], (r = this.getValueOfPropertyAt(a, l, "textBackgroundColor")) !== h ? ((t.fillStyle = h) && t.fillRect(c + g + o, f + n, s, e / this.lineHeight), o = i.left, s = i.width, h = r) : s += i.kernedWidth; r && (t.fillStyle = r, t.fillRect(c + g + o, f + n, s, e / this.lineHeight)), n += e } else n += e; t.fillStyle = u, this._removeShadow(t) } }, getFontCache: function (t) { var e = t.fontFamily.toLowerCase(), e = (s.charWidthsCache[e] || (s.charWidthsCache[e] = {}), s.charWidthsCache[e]), t = t.fontStyle.toLowerCase() + "_" + (t.fontWeight + "").toLowerCase(); return e[t] || (e[t] = {}), e[t] }, _applyCharStyles: function (t, e, i, r, n) { this._setFillStyles(e, n), this._setStrokeStyles(e, n), e.font = this._getFontDeclaration(n) }, _measureChar: function (t, e, i, r) { var n, o, s, a, h, l = this.getFontCache(e), u = i + t, r = this._getFontDeclaration(e) === this._getFontDeclaration(r), c = e.fontSize / this.CACHE_FONT_SIZE; return i && l[i] && (s = l[i]), l[t] && (a = n = l[t]), r && l[u] && (a = (o = l[u]) - s), n && s && o || (h = this.getMeasuringContext(), this._setTextStyles(h, e, !0)), n || (a = n = h.measureText(t).width, l[t] = n), !s && r && i && (s = h.measureText(i).width, l[i] = s), r && !o && (o = h.measureText(u).width, a = (l[u] = o) - s), { width: n * c, kernedWidth: a * c } }, getHeightOfChar: function (t, e) { return this.getValueOfPropertyAt(t, e, "fontSize") }, measureLine: function (t) { t = this._measureLine(t); return 0 !== this.charSpacing && (t.width -= this._getWidthOfCharSpacing()), t.width < 0 && (t.width = 0), t }, _measureLine: function (t) { var e, i, r, n, o = 0, s = this._textLines[t], a = new Array(s.length); for (this.__charBounds[t] = a, e = 0; e < s.length; e++)i = s[e], n = this._getGraphemeBox(i, t, e, r), o += (a[e] = n).kernedWidth, r = i; return a[e] = { left: n ? n.left + n.width : 0, width: 0, kernedWidth: 0, height: this.fontSize }, { width: o, numOfSpaces: 0 } }, _getGraphemeBox: function (t, e, i, r, n) { var o = this.getCompleteStyleDeclaration(e, i), s = r ? this.getCompleteStyleDeclaration(e, i - 1) : {}, t = this._measureChar(t, o, r, s), r = t.kernedWidth, s = t.width, a = (0 !== this.charSpacing && (s += a = this._getWidthOfCharSpacing(), r += a), { width: s, left: 0, height: o.fontSize, kernedWidth: r, deltaY: o.deltaY }); return 0 < i && !n && (s = this.__charBounds[e][i - 1], a.left = s.left + s.width + t.kernedWidth - t.width), a }, getHeightOfLine: function (t) { if (this.__lineHeights[t]) return this.__lineHeights[t]; for (var e = this._textLines[t], i = this.getHeightOfChar(t, 0), r = 1, n = e.length; r < n; r++)i = Math.max(this.getHeightOfChar(t, r), i); return this.__lineHeights[t] = i * this.lineHeight * this._fontSizeMult }, calcTextHeight: function () { for (var t, e = 0, i = 0, r = this._textLines.length; i < r; i++)t = this.getHeightOfLine(i), e += i === r - 1 ? t / this.lineHeight : t; return e }, _getLeftOffset: function () { return -this.width / 2 }, _getTopOffset: function () { return -this.height / 2 }, _renderTextCommon: function (t, e) { t.save(); for (var i = 0, r = this._getLeftOffset(), n = this._getTopOffset(), o = this._applyPatternGradientTransform(t, "fillText" === e ? this.fill : this.stroke), s = 0, a = this._textLines.length; s < a; s++) { var h = this.getHeightOfLine(s), l = h / this.lineHeight, u = this._getLineLeftOffset(s); this._renderTextLine(e, t, this._textLines[s], r + u - o.offsetX, n + i + l - o.offsetY, s), i += h } t.restore() }, _renderTextFill: function (t) { (this.fill || this.styleHas("fill")) && this._renderTextCommon(t, "fillText") }, _renderTextStroke: function (t) { (this.stroke && 0 !== this.strokeWidth || !this.isEmptyStyles()) && (this.shadow && !this.shadow.affectStroke && this._removeShadow(t), t.save(), this._setLineDash(t, this.strokeDashArray), t.beginPath(), this._renderTextCommon(t, "strokeText"), t.closePath(), t.restore()) }, _renderChars: function (u, t, e, i, r, n) { var o, c, s, a, f = this.getHeightOfLine(n), d = -1 !== this.textAlign.indexOf("justify"), p = "", h = 0, g = !d && 0 === this.charSpacing && this.isEmptyStyles(n); if (t.save(), r -= f * this._fontSizeFraction / this.lineHeight, g) return this._renderChar(u, t, n, 0, this.textLines[n], i, r, f), void t.restore(); for (var l = 0, v = e.length - 1; l <= v; l++)a = l === v || this.charSpacing, p += e[l], s = this.__charBounds[n][l], 0 === h ? (i += s.kernedWidth - s.width, h += s.width) : h += s.kernedWidth, (a = d && !a && this._reSpaceAndTab.test(e[l]) ? !0 : a) || (o = o || this.getCompleteStyleDeclaration(n, l), c = this.getCompleteStyleDeclaration(n, l + 1), a = this._hasStyleChanged(o, c)), a && (this._renderChar(u, t, n, l, p, i, r, f), p = "", o = c, i += h, h = 0); t.restore() }, _renderChar: function (t, e, i, r, n, o, s) { var a = this._getStyleDeclaration(i, r), h = this.getCompleteStyleDeclaration(i, r), l = "fillText" === t && h.fill, u = "strokeText" === t && h.stroke && h.strokeWidth; (u || l) && (a && e.save(), this._applyCharStyles(t, e, i, r, h), a && a.textBackgroundColor && this._removeShadow(e), a && a.deltaY && (s += a.deltaY), l && e.fillText(n, o, s), u && e.strokeText(n, o, s), a && e.restore()) }, setSuperscript: function (t, e) { return this._setScript(t, e, this.superscript) }, setSubscript: function (t, e) { return this._setScript(t, e, this.subscript) }, _setScript: function (t, e, i) { var r = this.get2DCursorLocation(t, !0), n = this.getValueOfPropertyAt(r.lineIndex, r.charIndex, "fontSize"), r = this.getValueOfPropertyAt(r.lineIndex, r.charIndex, "deltaY"), r = { fontSize: n * i.size, deltaY: r + n * i.baseline }; return this.setSelectionStyles(r, t, e), this }, _hasStyleChanged: function (t, e) { return t.fill !== e.fill || t.stroke !== e.stroke || t.strokeWidth !== e.strokeWidth || t.fontSize !== e.fontSize || t.fontFamily !== e.fontFamily || t.fontWeight !== e.fontWeight || t.fontStyle !== e.fontStyle || t.deltaY !== e.deltaY }, _hasStyleChangedForSvg: function (t, e) { return this._hasStyleChanged(t, e) || t.overline !== e.overline || t.underline !== e.underline || t.linethrough !== e.linethrough }, _getLineLeftOffset: function (t) { var e = this.getLineWidth(t); return "center" === this.textAlign ? (this.width - e) / 2 : "right" === this.textAlign ? this.width - e : "justify-center" === this.textAlign && this.isEndOfWrapping(t) ? (this.width - e) / 2 : "justify-right" === this.textAlign && this.isEndOfWrapping(t) ? this.width - e : 0 }, _clearCache: function () { this.__lineWidths = [], this.__lineHeights = [], this.__charBounds = [] }, _shouldClearDimensionCache: function () { var t = this._forceClearCache; return (t = t || this.hasStateChanged("_dimensionAffectingProps")) && (this.dirty = !0, this._forceClearCache = !1), t }, getLineWidth: function (t) { if (this.__lineWidths[t]) return this.__lineWidths[t]; var e = "" === this._textLines[t] ? 0 : this.measureLine(t).width; return this.__lineWidths[t] = e }, _getWidthOfCharSpacing: function () { return 0 !== this.charSpacing ? this.fontSize * this.charSpacing / 1e3 : 0 }, getValueOfPropertyAt: function (t, e, i) { t = this._getStyleDeclaration(t, e); return (t && void 0 !== t[i] ? t : this)[i] }, _renderTextDecoration: function (t, e) { if (this[e] || this.styleHas(e)) { for (var i, u, c, r, n, o, f = this._getLeftOffset(), d = this._getTopOffset(), s = 0, p = this._textLines.length; s < p; s++)if (i = this.getHeightOfLine(s), this[e] || this.styleHas(e, s)) { for (var g = this._textLines[s], v = i / this.lineHeight, m = this._getLineLeftOffset(s), y = 0, a = 0, _ = this.getValueOfPropertyAt(s, 0, e), h = this.getValueOfPropertyAt(s, 0, "fill"), b = d + v * (1 - this._fontSizeFraction), x = this.getHeightOfChar(s, 0), T = this.getValueOfPropertyAt(s, 0, "deltaY"), l = 0, w = g.length; l < w; l++)r = this.__charBounds[s][l], n = this.getValueOfPropertyAt(s, l, e), o = this.getValueOfPropertyAt(s, l, "fill"), u = this.getHeightOfChar(s, l), c = this.getValueOfPropertyAt(s, l, "deltaY"), (n !== _ || o !== h || u !== x || c !== T) && 0 < a ? (t.fillStyle = h, _ && h && t.fillRect(f + m + y, b + this.offsets[e] * x + T, a, this.fontSize / 15), y = r.left, a = r.width, _ = n, h = o, x = u, T = c) : a += r.kernedWidth; t.fillStyle = o, n && o && t.fillRect(f + m + y, b + this.offsets[e] * x + T, a, this.fontSize / 15), d += i } else d += i; this._removeShadow(t) } }, _getFontDeclaration: function (t, e) { var t = t || this, i = void 0 === t.fontFamily || -1 < t.fontFamily.indexOf("'") || -1 < t.fontFamily.indexOf('"') ? t.fontFamily : '"' + t.fontFamily + '"'; return [s.isLikelyNode ? t.fontWeight : t.fontStyle, s.isLikelyNode ? t.fontStyle : t.fontWeight, e ? this.CACHE_FONT_SIZE + "px" : t.fontSize + "px", i].join(" ") }, render: function (t) { this.visible && (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen() || (this._shouldClearDimensionCache() && this.initDimensions(), this.callSuper("render", t))) }, _splitTextIntoLines: function (t) { for (var e = t.split(this._reNewline), i = new Array(e.length), r = ["\n"], n = [], o = 0; o < e.length; o++)i[o] = s.util.string.graphemeSplit(e[o]), n = n.concat(i[o], r); return n.pop(), { _unwrappedLines: i, lines: e, graphemeText: n, graphemeLines: i } }, toObject: function (t) { t = ["text", "fontSize", "fontWeight", "fontFamily", "fontStyle", "lineHeight", "underline", "overline", "linethrough", "textAlign", "textBackgroundColor", "charSpacing"].concat(t), t = this.callSuper("toObject", t); return t.styles = a(this.styles, !0), t }, set: function (t, e) { this.callSuper("set", t, e); var i = !1; if ("object" == typeof t) for (var r in t) i = i || -1 !== this._dimensionAffectingProps.indexOf(r); else i = -1 !== this._dimensionAffectingProps.indexOf(t); return i && (this.initDimensions(), this.setCoords()), this }, complexity: function () { return 1 } }), s.Text.ATTRIBUTE_NAMES = s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")), s.Text.DEFAULT_SVG_FONT_SIZE = 16, s.Text.fromElement = function (t, e, i) { if (!t) return e(null); var r = s.parseAttributes(t, s.Text.ATTRIBUTE_NAMES), n = r.textAnchor || "left", o = ((i = s.util.object.extend(i ? a(i) : {}, r)).top = i.top || 0, i.left = i.left || 0, r.textDecoration && (-1 !== (o = r.textDecoration).indexOf("underline") && (i.underline = !0), -1 !== o.indexOf("overline") && (i.overline = !0), -1 !== o.indexOf("line-through") && (i.linethrough = !0), delete i.textDecoration), "dx" in r && (i.left += r.dx), "dy" in r && (i.top += r.dy), "fontSize" in i || (i.fontSize = s.Text.DEFAULT_SVG_FONT_SIZE), ""), r = ("textContent" in t ? o = t.textContent : "firstChild" in t && null !== t.firstChild && "data" in t.firstChild && null !== t.firstChild.data && (o = t.firstChild.data), o = o.replace(/^\s+|\s+$|\n+/g, "").replace(/\s+/g, " "), new s.Text(o, i)), t = r.getScaledHeight() / r.height, o = ((r.height + r.strokeWidth) * r.lineHeight - r.height) * t, i = r.getScaledHeight() + o, t = 0; "center" === n && (t = r.getScaledWidth() / 2), "right" === n && (t = r.getScaledWidth()), r.set({ left: r.left - t, top: r.top - (i - r.fontSize * (.18 + r._fontSizeFraction)) / r.lineHeight }), e(r) }, s.Text.fromObject = function (t, e) { return s.Object._fromObject("Text", t, e, "text") }, s.util.createAccessors && s.util.createAccessors(s.Text)) }("undefined" != typeof exports ? exports : this), fabric.util.object.extend(fabric.Text.prototype, { isEmptyStyles: function (t) { if (!this.styles) return !0; if (void 0 !== t && !this.styles[t]) return !0; var e, i = void 0 === t ? this.styles : { line: this.styles[t] }; for (e in i) for (var r in i[e]) for (var n in i[e][r]) return !1; return !0 }, styleHas: function (t, e) { if (!this.styles || !t || "" === t) return !1; if (void 0 !== e && !this.styles[e]) return !1; var i, r = void 0 === e ? this.styles : { line: this.styles[e] }; for (i in r) for (var n in r[i]) if (void 0 !== r[i][n][t]) return !0; return !1 }, cleanStyle: function (t) { if (!this.styles || !t || "" === t) return !1; var e, i, r, n, o = this.styles, s = 0, a = !0, h = 0; for (r in o) { for (var u in e = 0, o[r]) s++, (n = o[r][u]).hasOwnProperty(t) ? (i ? n[t] !== i && (a = !1) : i = n[t], n[t] === this[t] && delete n[t]) : a = !1, 0 !== Object.keys(n).length ? e++ : delete o[r][u]; 0 === e && delete o[r] } for (var l = 0; l < this._textLines.length; l++)h += this._textLines[l].length; a && s === h && (this[t] = i, this.removeStyle(t)) }, removeStyle: function (t) { if (this.styles && t && "" !== t) { var e, i, r, n = this.styles; for (i in n) { for (r in e = n[i]) delete e[r][t], 0 === Object.keys(e[r]).length && delete e[r]; 0 === Object.keys(e).length && delete n[i] } } }, _extendStyles: function (t, e) { t = this.get2DCursorLocation(t); this._getLineStyle(t.lineIndex) || this._setLineStyle(t.lineIndex, {}), this._getStyleDeclaration(t.lineIndex, t.charIndex) || this._setStyleDeclaration(t.lineIndex, t.charIndex, {}), fabric.util.object.extend(this._getStyleDeclaration(t.lineIndex, t.charIndex), e) }, get2DCursorLocation: function (t, e) { void 0 === t && (t = this.selectionStart); for (var i = e ? this._unwrappedTextLines : this._textLines, r = i.length, n = 0; n < r; n++) { if (t <= i[n].length) return { lineIndex: n, charIndex: t }; t -= i[n].length + 1 } return { lineIndex: n - 1, charIndex: i[n - 1].length < t ? i[n - 1].length : t } }, getSelectionStyles: function (t, e, i) { void 0 === t && (t = this.selectionStart || 0), void 0 === e && (e = this.selectionEnd || t); for (var r = [], n = t; n < e; n++)r.push(this.getStyleAtPosition(n, i)); return r }, getStyleAtPosition: function (t, e) { t = this.get2DCursorLocation(t); return (e ? this.getCompleteStyleDeclaration(t.lineIndex, t.charIndex) : this._getStyleDeclaration(t.lineIndex, t.charIndex)) || {} }, setSelectionStyles: function (t, e, i) { void 0 === e && (e = this.selectionStart || 0), void 0 === i && (i = this.selectionEnd || e); for (var r = e; r < i; r++)this._extendStyles(r, t); return this._forceClearCache = !0, this }, _getStyleDeclaration: function (t, e) { t = this.styles && this.styles[t]; return t ? t[e] : null }, getCompleteStyleDeclaration: function (t, e) { for (var i, r = this._getStyleDeclaration(t, e) || {}, n = {}, o = 0; o < this._styleProperties.length; o++)n[i = this._styleProperties[o]] = (void 0 === r[i] ? this : r)[i]; return n }, _setStyleDeclaration: function (t, e, i) { this.styles[t][e] = i }, _deleteStyleDeclaration: function (t, e) { delete this.styles[t][e] }, _getLineStyle: function (t) { return this.styles[t] }, _setLineStyle: function (t, e) { this.styles[t] = e }, _deleteLineStyle: function (t) { delete this.styles[t] } }), function () { function n(t) { t.textDecoration && (-1 < t.textDecoration.indexOf("underline") && (t.underline = !0), -1 < t.textDecoration.indexOf("line-through") && (t.linethrough = !0), -1 < t.textDecoration.indexOf("overline") && (t.overline = !0), delete t.textDecoration) } fabric.IText = fabric.util.createClass(fabric.Text, fabric.Observable, { type: "i-text", selectionStart: 0, selectionEnd: 0, selectionColor: "rgba(17,119,255,0.3)", isEditing: !1, editable: !0, editingBorderColor: "rgba(102,153,255,0.25)", cursorWidth: 2, cursorColor: "#333", cursorDelay: 1e3, cursorDuration: 600, caching: !0, _reSpace: /\s|\n/, _currentCursorOpacity: 0, _selectionDirection: null, _abortCursorAnimation: !1, __widthOfSpace: [], inCompositionMode: !1, initialize: function (t, e) { this.callSuper("initialize", t, e), this.initBehavior() }, setSelectionStart: function (t) { t = Math.max(t, 0), this._updateAndFire("selectionStart", t) }, setSelectionEnd: function (t) { t = Math.min(t, this.text.length), this._updateAndFire("selectionEnd", t) }, _updateAndFire: function (t, e) { this[t] !== e && (this._fireSelectionChanged(), this[t] = e), this._updateTextarea() }, _fireSelectionChanged: function () { this.fire("selection:changed"), this.canvas && this.canvas.fire("text:selection:changed", { target: this }) }, initDimensions: function () { this.isEditing && this.initDelayedCursor(), this.clearContextTop(), this.callSuper("initDimensions") }, render: function (t) { this.clearContextTop(), this.callSuper("render", t), this.cursorOffsetCache = {}, this.renderCursorOrSelection() }, _render: function (t) { this.callSuper("_render", t) }, clearContextTop: function (t) { var e, i; this.isEditing && this.canvas && this.canvas.contextTop && (e = this.canvas.contextTop, i = this.canvas.viewportTransform, e.save(), e.transform(i[0], i[1], i[2], i[3], i[4], i[5]), this.transform(e), this.transformMatrix && e.transform.apply(e, this.transformMatrix), this._clearTextArea(e), t || e.restore()) }, renderCursorOrSelection: function () { var t, e; this.isEditing && this.canvas && (t = this._getCursorBoundaries(), this.canvas && this.canvas.contextTop ? (e = this.canvas.contextTop, this.clearContextTop(!0)) : (e = this.canvas.contextContainer).save(), this.selectionStart === this.selectionEnd ? this.renderCursor(t, e) : this.renderSelection(t, e), e.restore()) }, _clearTextArea: function (t) { var e = this.width + 4, i = this.height + 4; t.clearRect(-e / 2, -i / 2, e, i) }, _getCursorBoundaries: function (t) { void 0 === t && (t = this.selectionStart); var e = this._getLeftOffset(), i = this._getTopOffset(), t = this._getCursorBoundariesOffsets(t); return { left: e, top: i, leftOffset: t.left, topOffset: t.top } }, _getCursorBoundariesOffsets: function (t) { if (this.cursorOffsetCache && "top" in this.cursorOffsetCache) return this.cursorOffsetCache; for (var e = 0, i = 0, r = this.get2DCursorLocation(t), n = 0; n < r.lineIndex; n++)e += this.getHeightOfLine(n); var t = this._getLineLeftOffset(r.lineIndex), o = this.__charBounds[r.lineIndex][r.charIndex]; return o && (i = o.left), 0 !== this.charSpacing && 0 === this._textLines[0].length && (i -= this._getWidthOfCharSpacing()), this.cursorOffsetCache = { top: e, left: t + (0 < i ? i : 0) }, this.cursorOffsetCache }, renderCursor: function (t, e) { var i = this.get2DCursorLocation(), r = i.lineIndex, i = 0 < i.charIndex ? i.charIndex - 1 : 0, n = this.getValueOfPropertyAt(r, i, "fontSize"), o = this.scaleX * this.canvas.getZoom(), o = this.cursorWidth / o, s = t.topOffset, i = this.getValueOfPropertyAt(r, i, "deltaY"); s += (1 - this._fontSizeFraction) * this.getHeightOfLine(r) / this.lineHeight - n * (1 - this._fontSizeFraction), this.inCompositionMode && this.renderSelection(t, e), e.fillStyle = "#333", e.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity, e.fillRect(t.left + t.leftOffset - o / 2, s + t.top + i, o, n) }, renderSelection: function (t, e) { for (var i = (this.inCompositionMode ? this.hiddenTextarea : this).selectionStart, r = (this.inCompositionMode ? this.hiddenTextarea : this).selectionEnd, u = -1 !== this.textAlign.indexOf("justify"), i = this.get2DCursorLocation(i), r = this.get2DCursorLocation(r), n = i.lineIndex, o = r.lineIndex, c = i.charIndex < 0 ? 0 : i.charIndex, s = r.charIndex < 0 ? 0 : r.charIndex, a = n; a <= o; a++) { var f, d = this._getLineLeftOffset(a) || 0, h = this.getHeightOfLine(a), l = 0, p = 0; a === n && (l = this.__charBounds[n][c].left), n <= a && a < o ? p = u && !this.isEndOfWrapping(a) ? this.width : this.getLineWidth(a) + this._getWidthOfCharSpacing() || 5 : a === o && (p = 0 === s ? this.__charBounds[o][s].left : this.__charBounds[o][s - 1].left + this.__charBounds[o][s - 1].width), f = h, (this.lineHeight < 1 || a === o && 1 < this.lineHeight) && (h /= this.lineHeight), this.inCompositionMode ? (e.fillStyle = this.compositionColor || "black", e.fillRect(t.left + d + l, t.top + t.topOffset + h, p - l, 1)) : (e.fillStyle = this.selectionColor, e.fillRect(t.left + d + l, t.top + t.topOffset, p - l, h)), t.topOffset += f } }, getCurrentCharFontSize: function () { var t = this._getCurrentCharIndex(); return this.getValueOfPropertyAt(t.l, t.c, "fontSize") }, getCurrentCharColor: function () { var t = this._getCurrentCharIndex(); return this.getValueOfPropertyAt(t.l, t.c, "fill") }, _getCurrentCharIndex: function () { var t = this.get2DCursorLocation(this.selectionStart, !0), e = 0 < t.charIndex ? t.charIndex - 1 : 0; return { l: t.lineIndex, c: e } } }), fabric.IText.fromObject = function (t, e) { if (n(t), t.styles) for (var i in t.styles) for (var r in t.styles[i]) n(t.styles[i][r]); fabric.Object._fromObject("IText", t, e, "text") } }(), function () { var l = fabric.util.object.clone; fabric.util.object.extend(fabric.IText.prototype, { initBehavior: function () { this.initAddedHandler(), this.initRemovedHandler(), this.initCursorSelectionHandlers(), this.initDoubleClickSimulation(), this.mouseMoveHandler = this.mouseMoveHandler.bind(this) }, onDeselect: function (t) { this.isEditing && this.exitEditing(), this.selected = !1, fabric.Object.prototype.onDeselect.call(this, t) }, initAddedHandler: function () { var e = this; this.on("added", function () { var t = e.canvas; t && (t._hasITextHandlers || (t._hasITextHandlers = !0, e._initCanvasHandlers(t)), t._iTextInstances = t._iTextInstances || [], t._iTextInstances.push(e)) }) }, initRemovedHandler: function () { var e = this; this.on("removed", function () { var t = e.canvas; t && (t._iTextInstances = t._iTextInstances || [], fabric.util.removeFromArray(t._iTextInstances, e), 0 === t._iTextInstances.length && (t._hasITextHandlers = !1, e._removeCanvasHandlers(t))) }) }, _initCanvasHandlers: function (t) { t._mouseUpITextHandler = function () { t._iTextInstances && t._iTextInstances.forEach(function (t) { t.__isMousedown = !1 }) }.bind(this), t.on("mouse:up", t._mouseUpITextHandler) }, _removeCanvasHandlers: function (t) { t.off("mouse:up", t._mouseUpITextHandler) }, _tick: function () { this._currentTickState = this._animateCursor(this, 1, this.cursorDuration, "_onTickComplete") }, _animateCursor: function (t, e, i, r) { var n = { isAborted: !1, abort: function () { this.isAborted = !0 } }; return t.animate("_currentCursorOpacity", e, { duration: i, onComplete: function () { n.isAborted || t[r]() }, onChange: function () { t.canvas && t.selectionStart === t.selectionEnd && t.renderCursorOrSelection() }, abort: function () { return n.isAborted } }), n }, _onTickComplete: function () { var t = this; this._cursorTimeout1 && clearTimeout(this._cursorTimeout1), this._cursorTimeout1 = setTimeout(function () { t._currentTickCompleteState = t._animateCursor(t, 0, this.cursorDuration / 2, "_tick") }, 100) }, initDelayedCursor: function (t) { var e = this, t = t ? 0 : this.cursorDelay; this.abortCursorAnimation(), this._currentCursorOpacity = 1, this._cursorTimeout2 = setTimeout(function () { e._tick() }, t) }, abortCursorAnimation: function () { var t = this._currentTickState || this._currentTickCompleteState, e = this.canvas; this._currentTickState && this._currentTickState.abort(), this._currentTickCompleteState && this._currentTickCompleteState.abort(), clearTimeout(this._cursorTimeout1), clearTimeout(this._cursorTimeout2), this._currentCursorOpacity = 0, t && e && e.clearContext(e.contextTop || e.contextContainer) }, selectAll: function () { return this.selectionStart = 0, this.selectionEnd = this.textLength || this._text.length, this._fireSelectionChanged(), this._updateTextarea(), this }, getSelectedText: function () { return this._text.slice(this.selectionStart, this.selectionEnd).join("") }, findWordBoundaryLeft: function (t) { var e = 0, i = t - 1; if (this._reSpace.test(this._text[i])) for (; this._reSpace.test(this._text[i]);)e++, i--; for (; /\S/.test(this._text[i]) && -1 < i;)e++, i--; return t - e }, findWordBoundaryRight: function (t) { var e = 0, i = t; if (this._reSpace.test(this._text[i])) for (; this._reSpace.test(this._text[i]);)e++, i++; for (; /\S/.test(this._text[i]) && i < this.text.length;)e++, i++; return t + e }, findLineBoundaryLeft: function (t) { for (var e = 0, i = t - 1; !/\n/.test(this._text[i]) && -1 < i;)e++, i--; return t - e }, findLineBoundaryRight: function (t) { for (var e = 0, i = t; !/\n/.test(this._text[i]) && i < (this.textLength || this.text.length);)e++, i++; return t + e }, searchWordBoundary: function (t, e) { for (var i = this._reSpace.test(this.text.charAt(t)) ? t - 1 : t, r = this.text.charAt(i), n = /[ \n\.,;!\?\-]/; !n.test(r) && 0 < i && i < this.text.length;)r = this.text.charAt(i += e); return n.test(r) && "\n" !== r && (i += 1 === e ? 0 : 1), i }, selectWord: function (t) { t = t || this.selectionStart; var e = this.searchWordBoundary(t, -1), t = this.searchWordBoundary(t, 1); this.selectionStart = e, this.selectionEnd = t, this._fireSelectionChanged(), this._updateTextarea(), this.renderCursorOrSelection() }, selectLine: function (t) { t = t || this.selectionStart; var e = this.findLineBoundaryLeft(t), t = this.findLineBoundaryRight(t); return this.selectionStart = e, this.selectionEnd = t, this._fireSelectionChanged(), this._updateTextarea(), this }, enterEditing: function (t) { if (!this.isEditing && this.editable) return this.canvas && (this.canvas.calcOffset(), this.exitEditingOnOthers(this.canvas)), this.isEditing = !0, this.initHiddenTextarea(t), this.hiddenTextarea.focus(), this.hiddenTextarea.value = this.text, this._updateTextarea(), this._saveEditingProps(), this._setEditingProps(), this._textBeforeEdit = this.text, this._tick(), this.fire("editing:entered"), this._fireSelectionChanged(), this.canvas && (this.canvas.fire("text:editing:entered", { target: this }), this.initMouseMoveHandler(), this.canvas.requestRenderAll()), this }, exitEditingOnOthers: function (t) { t._iTextInstances && t._iTextInstances.forEach(function (t) { t.selected = !1, t.isEditing && t.exitEditing() }) }, initMouseMoveHandler: function () { this.canvas.on("mouse:move", this.mouseMoveHandler) }, mouseMoveHandler: function (t) { var e, i; this.__isMousedown && this.isEditing && (t = this.getSelectionStartFromPointer(t.e), e = this.selectionStart, i = this.selectionEnd, (t === this.__selectionStartOnMouseDown && e !== i || e !== t && i !== t) && (t > this.__selectionStartOnMouseDown ? (this.selectionStart = this.__selectionStartOnMouseDown, this.selectionEnd = t) : (this.selectionStart = t, this.selectionEnd = this.__selectionStartOnMouseDown), this.selectionStart === e && this.selectionEnd === i || (this.restartCursorIfNeeded(), this._fireSelectionChanged(), this._updateTextarea(), this.renderCursorOrSelection()))) }, _setEditingProps: function () { this.hoverCursor = "text", this.canvas && (this.canvas.defaultCursor = this.canvas.moveCursor = "text"), this.borderColor = this.editingBorderColor, this.hasControls = this.selectable = !1, this.lockMovementX = this.lockMovementY = !0 }, fromStringToGraphemeSelection: function (t, e, i) { var r = i.slice(0, t), r = fabric.util.string.graphemeSplit(r).length; if (t === e) return { selectionStart: r, selectionEnd: r }; i = i.slice(t, e); return { selectionStart: r, selectionEnd: r + fabric.util.string.graphemeSplit(i).length } }, fromGraphemeToStringSelection: function (t, e, i) { var r = i.slice(0, t).join("").length; return t === e ? { selectionStart: r, selectionEnd: r } : { selectionStart: r, selectionEnd: r + i.slice(t, e).join("").length } }, _updateTextarea: function () { var t; this.cursorOffsetCache = {}, this.hiddenTextarea && (this.inCompositionMode || (t = this.fromGraphemeToStringSelection(this.selectionStart, this.selectionEnd, this._text), this.hiddenTextarea.selectionStart = t.selectionStart, this.hiddenTextarea.selectionEnd = t.selectionEnd), this.updateTextareaPosition()) }, updateFromTextArea: function () { var t; this.hiddenTextarea && (this.cursorOffsetCache = {}, this.text = this.hiddenTextarea.value, this._shouldClearDimensionCache() && (this.initDimensions(), this.setCoords()), t = this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart, this.hiddenTextarea.selectionEnd, this.hiddenTextarea.value), this.selectionEnd = this.selectionStart = t.selectionEnd, this.inCompositionMode || (this.selectionStart = t.selectionStart), this.updateTextareaPosition()) }, updateTextareaPosition: function () { var t; this.selectionStart === this.selectionEnd && (t = this._calcTextareaPosition(), this.hiddenTextarea.style.left = t.left, this.hiddenTextarea.style.top = t.top) }, _calcTextareaPosition: function () { if (!this.canvas) return { x: 1, y: 1 }; var t = this.inCompositionMode ? this.compositionStart : this.selectionStart, e = this._getCursorBoundaries(t), t = this.get2DCursorLocation(t), i = t.lineIndex, t = t.charIndex, i = this.getValueOfPropertyAt(i, t, "fontSize") * this.lineHeight, t = e.leftOffset, r = this.calcTransformMatrix(), t = { x: e.left + t, y: e.top + e.topOffset + i }, e = this.canvas.upperCanvasEl, n = e.width, o = e.height, s = n - i, a = o - i, n = e.clientWidth / n, e = e.clientHeight / o, t = fabric.util.transformPoint(t, r); return (t = fabric.util.transformPoint(t, this.canvas.viewportTransform)).x *= n, t.y *= e, t.x < 0 && (t.x = 0), t.x > s && (t.x = s), t.y < 0 && (t.y = 0), t.y > a && (t.y = a), t.x += this.canvas._offset.left, t.y += this.canvas._offset.top, { left: t.x + "px", top: t.y + "px", fontSize: i + "px", charHeight: i } }, _saveEditingProps: function () { this._savedProps = { hasControls: this.hasControls, borderColor: this.borderColor, lockMovementX: this.lockMovementX, lockMovementY: this.lockMovementY, hoverCursor: this.hoverCursor, defaultCursor: this.canvas && this.canvas.defaultCursor, moveCursor: this.canvas && this.canvas.moveCursor } }, _restoreEditingProps: function () { this._savedProps && (this.hoverCursor = this._savedProps.hoverCursor, this.hasControls = this._savedProps.hasControls, this.borderColor = this._savedProps.borderColor, this.lockMovementX = this._savedProps.lockMovementX, this.lockMovementY = this._savedProps.lockMovementY, this.canvas && (this.canvas.defaultCursor = this._savedProps.defaultCursor, this.canvas.moveCursor = this._savedProps.moveCursor)) }, exitEditing: function () { var t = this._textBeforeEdit !== this.text; return this.selected = !1, this.isEditing = !1, this.selectable = !0, this.selectionEnd = this.selectionStart, this.hiddenTextarea && (this.hiddenTextarea.blur && this.hiddenTextarea.blur(), this.canvas && this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea), this.hiddenTextarea = null), this.abortCursorAnimation(), this._restoreEditingProps(), this._currentCursorOpacity = 0, this._shouldClearDimensionCache() && (this.initDimensions(), this.setCoords()), this.fire("editing:exited"), t && this.fire("modified"), this.canvas && (this.canvas.off("mouse:move", this.mouseMoveHandler), this.canvas.fire("text:editing:exited", { target: this }), t && this.canvas.fire("object:modified", { target: this })), this }, _removeExtraneousStyles: function () { for (var t in this.styles) this._textLines[t] || delete this.styles[t] }, removeStyleFromTo: function (t, e) { var t = this.get2DCursorLocation(t, !0), e = this.get2DCursorLocation(e, !0), i = t.lineIndex, r = t.charIndex, n = e.lineIndex, o = e.charIndex; if (i !== n) { if (this.styles[i]) for (l = r; l < this._unwrappedTextLines[i].length; l++)delete this.styles[i][l]; if (this.styles[n]) for (l = o; l < this._unwrappedTextLines[n].length; l++)(h = this.styles[n][l]) && (this.styles[i] || (this.styles[i] = {}), this.styles[i][r + l - o] = h); for (l = i + 1; l <= n; l++)delete this.styles[l]; this.shiftLineStyles(n, i - n) } else if (this.styles[i]) { for (var s, a, h = this.styles[i], u = o - r, l = r; l < o; l++)delete h[l]; for (a in this.styles[i]) o <= (s = parseInt(a, 10)) && (h[s - u] = h[a], delete h[a]) } }, shiftLineStyles: function (t, e) { var i, r = l(this.styles); for (i in this.styles) { var n = parseInt(i, 10); t < n && (this.styles[n + e] = r[n], r[n - e] || delete this.styles[n]) } }, restartCursorIfNeeded: function () { this._currentTickState && !this._currentTickState.isAborted && this._currentTickCompleteState && !this._currentTickCompleteState.isAborted || this.initDelayedCursor() }, insertNewlineStyleObject: function (t, e, i, r) { var n, o, s = {}, a = !1; for (o in this.shiftLineStyles(t, i = i || 1), this.styles[t] && (n = this.styles[t][0 === e ? e : e - 1]), this.styles[t]) { var h = parseInt(o, 10); e <= h && (a = !0, s[h - e] = this.styles[t][o], delete this.styles[t][o]) } for (a ? this.styles[t + i] = s : delete this.styles[t + i]; 1 < i;)i--, r && r[i] ? this.styles[t + i] = { 0: l(r[i]) } : n ? this.styles[t + i] = { 0: l(n) } : delete this.styles[t + i]; this._forceClearCache = !0 }, insertCharStyleObject: function (t, e, i, r) { this.styles || (this.styles = {}); var n, o = this.styles[t], s = o ? l(o) : {}; for (n in i = i || 1, s) { var a = parseInt(n, 10); e <= a && (o[a + i] = s[a], s[a - i] || delete o[a]) } if (this._forceClearCache = !0, r) for (; i--;)Object.keys(r[i]).length && (this.styles[t] || (this.styles[t] = {}), this.styles[t][e + i] = l(r[i])); else if (o) for (var h = o[e ? e - 1 : 1]; h && i--;)this.styles[t][e + i] = l(h) }, insertNewStyleBlock: function (t, e, i) { for (var r = this.get2DCursorLocation(e, !0), n = [0], o = 0, s = 0; s < t.length; s++)"\n" === t[s] ? n[++o] = 0 : n[o]++; 0 < n[0] && (this.insertCharStyleObject(r.lineIndex, r.charIndex, n[0], i), i = i && i.slice(n[0] + 1)), o && this.insertNewlineStyleObject(r.lineIndex, r.charIndex + n[0], o); for (s = 1; s < o; s++)0 < n[s] ? this.insertCharStyleObject(r.lineIndex + s, 0, n[s], i) : i && (this.styles[r.lineIndex + s][0] = i[0]), i = i && i.slice(n[s] + 1); 0 < n[s] && this.insertCharStyleObject(r.lineIndex + s, 0, n[s], i) }, setSelectionStartEndWithShift: function (t, e, i) { i <= t ? (e === t ? this._selectionDirection = "left" : "right" === this._selectionDirection && (this._selectionDirection = "left", this.selectionEnd = t), this.selectionStart = i) : t < i && i < e ? "right" === this._selectionDirection ? this.selectionEnd = i : this.selectionStart = i : (e === t ? this._selectionDirection = "right" : "left" === this._selectionDirection && (this._selectionDirection = "right", this.selectionStart = e), this.selectionEnd = i) }, setSelectionInBoundaries: function () { var t = this.textLength || this.text.length; this.selectionStart > t ? this.selectionStart = t : this.selectionStart < 0 && (this.selectionStart = 0), this.selectionEnd > t ? this.selectionEnd = t : this.selectionEnd < 0 && (this.selectionEnd = 0) } }) }(), fabric.util.object.extend(fabric.IText.prototype, { initDoubleClickSimulation: function () { this.__lastClickTime = +new Date, this.__lastLastClickTime = +new Date, this.__lastPointer = {}, this.on("mousedown", this.onMouseDown.bind(this)) }, onMouseDown: function (t) { var e; this.canvas && (this.__newClickTime = +new Date, e = this.canvas.getPointer(t.e), this.isTripleClick(e) && (this.fire("tripleclick", t), this._stopEvent(t.e)), this.__lastLastClickTime = this.__lastClickTime, this.__lastClickTime = this.__newClickTime, this.__lastPointer = e, this.__lastIsEditing = this.isEditing, this.__lastSelected = this.selected) }, isTripleClick: function (t) { return this.__newClickTime - this.__lastClickTime < 500 && this.__lastClickTime - this.__lastLastClickTime < 500 && this.__lastPointer.x === t.x && this.__lastPointer.y === t.y }, _stopEvent: function (t) { t.preventDefault && t.preventDefault(), t.stopPropagation && t.stopPropagation() }, initCursorSelectionHandlers: function () { this.initMousedownHandler(), this.initMouseupHandler(), this.initClicks() }, initClicks: function () { this.on("mousedblclick", function (t) { this.selectWord(this.getSelectionStartFromPointer(t.e)) }), this.on("tripleclick", function (t) { this.selectLine(this.getSelectionStartFromPointer(t.e)) }) }, _mouseDownHandler: function (t) { var e; !this.canvas || !this.editable || t.e.button && 1 !== t.e.button || (e = this.canvas.getPointer(t.e), this.__mousedownX = e.x, this.__mousedownY = e.y, this.__isMousedown = !0, this.selected && this.setCursorByClick(t.e), this.isEditing && (this.__selectionStartOnMouseDown = this.selectionStart, this.selectionStart === this.selectionEnd && this.abortCursorAnimation(), this.renderCursorOrSelection())) }, initMousedownHandler: function () { this.on("mousedown", this._mouseDownHandler) }, _isObjectMoved: function (t) { if (!this.canvas) return !1; t = this.canvas.getPointer(t); return this.__mousedownX !== t.x || this.__mousedownY !== t.y }, initMouseupHandler: function () { this.on("mouseup", this.mouseUpHandler) }, mouseUpHandler: function (t) { this.__isMousedown = !1, !this.editable || this._isObjectMoved(t.e) || t.e.button && 1 !== t.e.button || (this.__lastSelected && !this.__corner && (this.enterEditing(t.e), this.selectionStart === this.selectionEnd ? this.initDelayedCursor(!0) : this.renderCursorOrSelection()), this.selected = !0) }, setCursorByClick: function (t) { var e = this.getSelectionStartFromPointer(t), i = this.selectionStart, r = this.selectionEnd; t.shiftKey ? this.setSelectionStartEndWithShift(i, r, e) : (this.selectionStart = e, this.selectionEnd = e), this.isEditing && (this._fireSelectionChanged(), this._updateTextarea()) }, getSelectionStartFromPointer: function (t) { for (var e = this.getLocalPointer(t), i = 0, r = 0, n = 0, o = 0, s = 0, a = 0, u = this._textLines.length; a < u && n <= e.y; a++)n += this.getHeightOfLine(a) * this.scaleY, 0 < (s = a) && (o += this._textLines[a - 1].length + 1); for (var r = this._getLineLeftOffset(s) * this.scaleX, h = 0, l = this._textLines[s].length; h < l && (i = r, (r += this.__charBounds[s][h].kernedWidth * this.scaleX) <= e.x); h++)o++; return this._getNewSelectionStartFromOffset(e, i, r, o, l) }, _getNewSelectionStartFromOffset: function (t, e, i, r, n) { e = t.x - e, i -= t.x, t = r + (e < i || i < 0 ? 0 : 1); return t = (t = this.flipX ? n - t : t) > (this.textLength || this._text.length) ? this.textLength || this._text.length : t } }), fabric.util.object.extend(fabric.IText.prototype, { initHiddenTextarea: function () { this.hiddenTextarea = fabric.document.createElement("textarea"), this.hiddenTextarea.setAttribute("autocapitalize", "off"), this.hiddenTextarea.setAttribute("autocorrect", "off"), this.hiddenTextarea.setAttribute("autocomplete", "off"), this.hiddenTextarea.setAttribute("spellcheck", "false"), this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea", ""), this.hiddenTextarea.setAttribute("wrap", "off"); var t = this._calcTextareaPosition(); this.hiddenTextarea.style.cssText = "position: absolute; top: " + t.top + "; left: " + t.left + "; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; line-height: 1px; paddingtop: " + t.fontSize + ";", fabric.document.body.appendChild(this.hiddenTextarea), fabric.util.addListener(this.hiddenTextarea, "keydown", this.onKeyDown.bind(this)), fabric.util.addListener(this.hiddenTextarea, "keyup", this.onKeyUp.bind(this)), fabric.util.addListener(this.hiddenTextarea, "input", this.onInput.bind(this)), fabric.util.addListener(this.hiddenTextarea, "copy", this.copy.bind(this)), fabric.util.addListener(this.hiddenTextarea, "cut", this.copy.bind(this)), fabric.util.addListener(this.hiddenTextarea, "paste", this.paste.bind(this)), fabric.util.addListener(this.hiddenTextarea, "compositionstart", this.onCompositionStart.bind(this)), fabric.util.addListener(this.hiddenTextarea, "compositionupdate", this.onCompositionUpdate.bind(this)), fabric.util.addListener(this.hiddenTextarea, "compositionend", this.onCompositionEnd.bind(this)), !this._clickHandlerInitialized && this.canvas && (fabric.util.addListener(this.canvas.upperCanvasEl, "click", this.onClick.bind(this)), this._clickHandlerInitialized = !0) }, keysMap: { 9: "exitEditing", 27: "exitEditing", 33: "moveCursorUp", 34: "moveCursorDown", 35: "moveCursorRight", 36: "moveCursorLeft", 37: "moveCursorLeft", 38: "moveCursorUp", 39: "moveCursorRight", 40: "moveCursorDown" }, ctrlKeysMapUp: { 67: "copy", 88: "cut" }, ctrlKeysMapDown: { 65: "selectAll" }, onClick: function () { this.hiddenTextarea && this.hiddenTextarea.focus() }, onKeyDown: function (t) { if (this.isEditing && !this.inCompositionMode) { if (t.keyCode in this.keysMap) this[this.keysMap[t.keyCode]](t); else { if (!(t.keyCode in this.ctrlKeysMapDown && (t.ctrlKey || t.metaKey))) return; this[this.ctrlKeysMapDown[t.keyCode]](t) } t.stopImmediatePropagation(), t.preventDefault(), 33 <= t.keyCode && t.keyCode <= 40 ? (this.clearContextTop(), this.renderCursorOrSelection()) : this.canvas && this.canvas.requestRenderAll() } }, onKeyUp: function (t) { !this.isEditing || this._copyDone || this.inCompositionMode ? this._copyDone = !1 : t.keyCode in this.ctrlKeysMapUp && (t.ctrlKey || t.metaKey) && (this[this.ctrlKeysMapUp[t.keyCode]](t), t.stopImmediatePropagation(), t.preventDefault(), this.canvas && this.canvas.requestRenderAll()) }, onInput: function (t) { var e = this.fromPaste; if (this.fromPaste = !1, t && t.stopPropagation(), this.isEditing) { var i, t = this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText, r = this._text.length, n = t.length, o = n - r; if ("" === this.hiddenTextarea.value) return this.styles = {}, this.updateFromTextArea(), this.fire("changed"), void (this.canvas && (this.canvas.fire("text:changed", { target: this }), this.canvas.requestRenderAll())); var s = this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart, this.hiddenTextarea.selectionEnd, this.hiddenTextarea.value), a = this.selectionStart > s.selectionStart; this.selectionStart !== this.selectionEnd ? (i = this._text.slice(this.selectionStart, this.selectionEnd), o += this.selectionEnd - this.selectionStart) : n < r && (i = a ? this._text.slice(this.selectionEnd + o, this.selectionEnd) : this._text.slice(this.selectionStart, this.selectionStart - o)), n = t.slice(s.selectionEnd - o, s.selectionEnd), i && i.length && (this.selectionStart !== this.selectionEnd ? this.removeStyleFromTo(this.selectionStart, this.selectionEnd) : a ? this.removeStyleFromTo(this.selectionEnd - i.length, this.selectionEnd) : this.removeStyleFromTo(this.selectionEnd, this.selectionEnd + i.length)), n.length && (e && n.join("") === fabric.copiedText ? this.insertNewStyleBlock(n, this.selectionStart, fabric.copiedTextStyle) : this.insertNewStyleBlock(n, this.selectionStart)), this.updateFromTextArea(), this.fire("changed"), this.canvas && (this.canvas.fire("text:changed", { target: this }), this.canvas.requestRenderAll()) } }, onCompositionStart: function () { this.inCompositionMode = !0 }, onCompositionEnd: function () { this.inCompositionMode = !1 }, onCompositionUpdate: function (t) { this.compositionStart = t.target.selectionStart, this.compositionEnd = t.target.selectionEnd, this.updateTextareaPosition() }, copy: function () { this.selectionStart !== this.selectionEnd && (fabric.copiedText = this.getSelectedText(), fabric.copiedTextStyle = this.getSelectionStyles(this.selectionStart, this.selectionEnd, !0), this._copyDone = !0) }, paste: function () { this.fromPaste = !0 }, _getClipboardData: function (t) { return t && t.clipboardData || fabric.window.clipboardData }, _getWidthBeforeCursor: function (t, e) { var i = this._getLineLeftOffset(t); return 0 < e && (i += (t = this.__charBounds[t][e - 1]).left + t.width), i }, getDownCursorOffset: function (t, e) { var e = this._getSelectionForOffset(t, e), i = this.get2DCursorLocation(e), r = i.lineIndex; if (r === this._textLines.length - 1 || t.metaKey || 34 === t.keyCode) return (this.textLength || this._text.length) - e; t = i.charIndex, e = this._getWidthBeforeCursor(r, t), i = this._getIndexOnLine(r + 1, e); return this._textLines[r].slice(t).length + i + 2 }, _getSelectionForOffset: function (t, e) { return t.shiftKey && this.selectionStart !== this.selectionEnd && e ? this.selectionEnd : this.selectionStart }, getUpCursorOffset: function (t, e) { var e = this._getSelectionForOffset(t, e), i = this.get2DCursorLocation(e), r = i.lineIndex; if (0 === r || t.metaKey || 33 === t.keyCode) return -e; t = i.charIndex, e = this._getWidthBeforeCursor(r, t), i = this._getIndexOnLine(r - 1, e), e = this._textLines[r].slice(0, t); return -this._textLines[r - 1].length + i - e.length }, _getIndexOnLine: function (t, e) { for (var i = this._textLines[t], r = this._getLineLeftOffset(t), n = 0, o = 0, s = i.length; o < s; o++)if (e < (r += l = this.__charBounds[t][o].width)) { var a = !0, h = r, l = Math.abs(r - l - e), n = Math.abs(h - e) < l ? o : o - 1; break } return n = a ? n : i.length - 1 }, moveCursorDown: function (t) { this.selectionStart >= (this.textLength || this._text.length) && this.selectionEnd >= (this.textLength || this._text.length) || this._moveCursorUpOrDown("Down", t) }, moveCursorUp: function (t) { 0 === this.selectionStart && 0 === this.selectionEnd || this._moveCursorUpOrDown("Up", t) }, _moveCursorUpOrDown: function (t, e) { t = this["get" + t + "CursorOffset"](e, "right" === this._selectionDirection); e.shiftKey ? this.moveCursorWithShift(t) : this.moveCursorWithoutShift(t), 0 !== t && (this.setSelectionInBoundaries(), this.abortCursorAnimation(), this._currentCursorOpacity = 1, this.initDelayedCursor(), this._fireSelectionChanged(), this._updateTextarea()) }, moveCursorWithShift: function (t) { var e = "left" === this._selectionDirection ? this.selectionStart + t : this.selectionEnd + t; return this.setSelectionStartEndWithShift(this.selectionStart, this.selectionEnd, e), 0 !== t }, moveCursorWithoutShift: function (t) { return t < 0 ? (this.selectionStart += t, this.selectionEnd = this.selectionStart) : (this.selectionEnd += t, this.selectionStart = this.selectionEnd), 0 !== t }, moveCursorLeft: function (t) { 0 === this.selectionStart && 0 === this.selectionEnd || this._moveCursorLeftOrRight("Left", t) }, _move: function (t, e, i) { var r; if (t.altKey) r = this["findWordBoundary" + i](this[e]); else { if (!t.metaKey && 35 !== t.keyCode && 36 !== t.keyCode) return this[e] += "Left" === i ? -1 : 1, !0; r = this["findLineBoundary" + i](this[e]) } if (this[e] !== r) return this[e] = r, !0 }, _moveLeft: function (t, e) { return this._move(t, e, "Left") }, _moveRight: function (t, e) { return this._move(t, e, "Right") }, moveCursorLeftWithoutShift: function (t) { var e = !0; return this._selectionDirection = "left", this.selectionEnd === this.selectionStart && 0 !== this.selectionStart && (e = this._moveLeft(t, "selectionStart")), this.selectionEnd = this.selectionStart, e }, moveCursorLeftWithShift: function (t) { return "right" === this._selectionDirection && this.selectionStart !== this.selectionEnd ? this._moveLeft(t, "selectionEnd") : 0 !== this.selectionStart ? (this._selectionDirection = "left", this._moveLeft(t, "selectionStart")) : void 0 }, moveCursorRight: function (t) { this.selectionStart >= (this.textLength || this._text.length) && this.selectionEnd >= (this.textLength || this._text.length) || this._moveCursorLeftOrRight("Right", t) }, _moveCursorLeftOrRight: function (t, e) { t = "moveCursor" + t + "With"; this._currentCursorOpacity = 1, e.shiftKey ? t += "Shift" : t += "outShift", this[t](e) && (this.abortCursorAnimation(), this.initDelayedCursor(), this._fireSelectionChanged(), this._updateTextarea()) }, moveCursorRightWithShift: function (t) { return "left" === this._selectionDirection && this.selectionStart !== this.selectionEnd ? this._moveRight(t, "selectionStart") : this.selectionEnd !== (this.textLength || this._text.length) ? (this._selectionDirection = "right", this._moveRight(t, "selectionEnd")) : void 0 }, moveCursorRightWithoutShift: function (t) { var e = !0; return this._selectionDirection = "right", this.selectionStart === this.selectionEnd ? (e = this._moveRight(t, "selectionStart"), this.selectionEnd = this.selectionStart) : this.selectionStart = this.selectionEnd, e }, removeChars: function (t, e) { this.removeStyleFromTo(t, e = void 0 === e ? t + 1 : e), this._text.splice(t, e - t), this.text = this._text.join(""), this.set("dirty", !0), this._shouldClearDimensionCache() && (this.initDimensions(), this.setCoords()), this._removeExtraneousStyles() }, insertChars: function (t, e, i, r) { i < (r = void 0 === r ? i : r) && this.removeStyleFromTo(i, r); t = fabric.util.string.graphemeSplit(t); this.insertNewStyleBlock(t, i, e), this._text = [].concat(this._text.slice(0, i), t, this._text.slice(r)), this.text = this._text.join(""), this.set("dirty", !0), this._shouldClearDimensionCache() && (this.initDimensions(), this.setCoords()), this._removeExtraneousStyles() } }), function () { var a = fabric.util.toFixed, h = /  +/g; fabric.util.object.extend(fabric.Text.prototype, { toSVG: function (t) { var e = this._createBaseSVGMarkup(), i = this._getSVGLeftTopOffsets(), i = this._getSVGTextAndBg(i.textTop, i.textLeft); return this._wrapSVGTextAndBg(e, i), t ? t(e.join("")) : e.join("") }, _getSVGLeftTopOffsets: function () { return { textLeft: -this.width / 2, textTop: -this.height / 2, lineTop: this.getHeightOfLine(0) } }, _wrapSVGTextAndBg: function (t, e) { var i = this.getSvgFilter(), i = "" === i ? "" : ' style="' + i + '"', r = this.getSvgTextDecoration(this); t.push("\t<g ", this.getSvgId(), 'transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '"', i, ">\n", e.textBgRects.join(""), '\t\t<text xml:space="preserve" ', this.fontFamily ? 'font-family="' + this.fontFamily.replace(/"/g, "'") + '" ' : "", this.fontSize ? 'font-size="' + this.fontSize + '" ' : "", this.fontStyle ? 'font-style="' + this.fontStyle + '" ' : "", this.fontWeight ? 'font-weight="' + this.fontWeight + '" ' : "", r ? 'text-decoration="' + r + '" ' : "", 'style="', this.getSvgStyles(!0), '"', this.addPaintOrder(), " >", e.textSpans.join(""), "</text>\n", "\t</g>\n") }, _getSVGTextAndBg: function (t, e) { var i, r = [], n = [], o = t; this._setSVGBg(n); for (var s = 0, a = this._textLines.length; s < a; s++)i = this._getLineLeftOffset(s), (this.textBackgroundColor || this.styleHas("textBackgroundColor", s)) && this._setSVGTextLineBg(n, s, e + i, o), this._setSVGTextLineText(r, s, e + i, o), o += this.getHeightOfLine(s); return { textSpans: r, textBgRects: n } }, _createTextCharSpan: function (t, e, i, r) { var n = t !== t.trim() || t.match(h), n = this.getSvgSpanStyles(e, n), n = n ? 'style="' + n + '"' : "", e = e.deltaY, o = "", s = fabric.Object.NUM_FRACTION_DIGITS; return e && (o = ' dy="' + a(e, s) + '" '), ['<tspan x="', a(i, s), '" y="', a(r, s), '" ', o, n, ">", fabric.util.string.escapeXml(t), "</tspan>"].join("") }, _setSVGTextLineText: function (u, t, e, c) { var i, r, n, o, f = this.getHeightOfLine(t), d = -1 !== this.textAlign.indexOf("justify"), s = "", a = 0, h = this._textLines[t]; c += f * (1 - this._fontSizeFraction) / this.lineHeight; for (var l = 0, p = h.length - 1; l <= p; l++)o = l === p || this.charSpacing, s += h[l], n = this.__charBounds[t][l], 0 === a ? (e += n.kernedWidth - n.width, a += n.width) : a += n.kernedWidth, (o = d && !o && this._reSpaceAndTab.test(h[l]) ? !0 : o) || (i = i || this.getCompleteStyleDeclaration(t, l), r = this.getCompleteStyleDeclaration(t, l + 1), o = this._hasStyleChangedForSvg(i, r)), o && (n = this._getStyleDeclaration(t, l) || {}, u.push(this._createTextCharSpan(s, n, e, c)), s = "", i = r, e += a, a = 0) }, _pushTextBgRect: function (t, e, i, r, n, o) { var s = fabric.Object.NUM_FRACTION_DIGITS; t.push("\t\t<rect ", this._getFillAttributes(e), ' x="', a(i, s), '" y="', a(r, s), '" width="', a(n, s), '" height="', a(o, s), '"></rect>\n') }, _setSVGTextLineBg: function (t, e, i, r) { for (var n, o, u = this._textLines[e], c = this.getHeightOfLine(e) / this.lineHeight, s = 0, a = 0, h = this.getValueOfPropertyAt(e, 0, "textBackgroundColor"), l = 0, f = u.length; l < f; l++)n = this.__charBounds[e][l], (o = this.getValueOfPropertyAt(e, l, "textBackgroundColor")) !== h ? (h && this._pushTextBgRect(t, h, i + a, r, s, c), a = n.left, s = n.width, h = o) : s += n.kernedWidth; o && this._pushTextBgRect(t, o, i + a, r, s, c) }, _getFillAttributes: function (t) { var e = t && "string" == typeof t ? new fabric.Color(t) : ""; return e && e.getSource() && 1 !== e.getAlpha() ? 'opacity="' + e.getAlpha() + '" fill="' + e.setAlpha(1).toRgb() + '"' : 'fill="' + t + '"' }, _getSVGLineTopOffset: function (t) { for (var e, i = 0, r = 0; r < t; r++)i += this.getHeightOfLine(r); return e = this.getHeightOfLine(r), { lineTop: i, offset: (this._fontSizeMult - this._fontSizeFraction) * e / (this.lineHeight * this._fontSizeMult) } }, getSvgStyles: function (t) { return fabric.Object.prototype.getSvgStyles.call(this, t) + " white-space: pre;" } }) }(), function (t) { "use strict"; var v = t.fabric || (t.fabric = {}); v.Textbox = v.util.createClass(v.IText, v.Observable, { type: "textbox", minWidth: 20, dynamicMinWidth: 2, __cachedLines: null, lockScalingFlip: !0, noScaleCache: !1, _dimensionAffectingProps: v.Text.prototype._dimensionAffectingProps.concat("width"), initDimensions: function () { this.__skipDimension || (this.isEditing && this.initDelayedCursor(), this.clearContextTop(), this._clearCache(), this.dynamicMinWidth = 0, this._styleMap = this._generateStyleMap(this._splitText()), this.dynamicMinWidth > this.width && this._set("width", this.dynamicMinWidth), -1 !== this.textAlign.indexOf("justify") && this.enlargeSpaces(), this.height = this.calcTextHeight(), this.saveState({ propertySet: "_dimensionAffectingProps" })) }, _generateStyleMap: function (t) { for (var e = 0, i = 0, r = 0, n = {}, o = 0; o < t.graphemeLines.length; o++)"\n" === t.graphemeText[r] && 0 < o ? (i = 0, r++, e++) : this._reSpaceAndTab.test(t.graphemeText[r]) && 0 < o && (i++, r++), n[o] = { line: e, offset: i }, r += t.graphemeLines[o].length, i += t.graphemeLines[o].length; return n }, styleHas: function (t, e) { var i; return !this._styleMap || this.isWrapping || (i = this._styleMap[e]) && (e = i.line), v.Text.prototype.styleHas.call(this, t, e) }, isEmptyStyles: function (t) { var e, i, r, n = 0, o = !1, s = this._styleMap[t], a = this._styleMap[t + 1]; for (r in s && (t = s.line, n = s.offset), a && (o = a.line === t, e = a.offset), i = void 0 === t ? this.styles : { line: this.styles[t] }) for (var h in i[r]) if (n <= h && (!o || h < e)) for (var l in i[r][h]) return !1; return !0 }, _getStyleDeclaration: function (t, e) { if (this._styleMap && !this.isWrapping) { var i = this._styleMap[t]; if (!i) return null; t = i.line, e = i.offset + e } return this.callSuper("_getStyleDeclaration", t, e) }, _setStyleDeclaration: function (t, e, i) { var r = this._styleMap[t]; t = r.line, e = r.offset + e, this.styles[t][e] = i }, _deleteStyleDeclaration: function (t, e) { var i = this._styleMap[t]; t = i.line, e = i.offset + e, delete this.styles[t][e] }, _getLineStyle: function (t) { t = this._styleMap[t]; return this.styles[t.line] }, _setLineStyle: function (t, e) { t = this._styleMap[t]; this.styles[t.line] = e }, _deleteLineStyle: function (t) { t = this._styleMap[t]; delete this.styles[t.line] }, _wrapText: function (t, e) { var i, r = []; for (this.isWrapping = !0, i = 0; i < t.length; i++)r = r.concat(this._wrapLine(t[i], i, e)); return this.isWrapping = !1, r }, _measureWord: function (t, e, i) { var r, n = 0; i = i || 0; for (var o = 0, s = t.length; o < s; o++)n += this._getGraphemeBox(t[o], e, o + i, r, !0).kernedWidth, r = t[o]; return n }, _wrapLine: function (u, c, f, t) { var e, i, r = 0, n = [], o = [], d = u.split(this._reSpaceAndTab), s = 0, p = 0, a = 0, h = !0, g = this._getWidthOfCharSpacing(); f -= t = t || 0; for (var l = 0; l < d.length; l++)e = v.util.string.graphemeSplit(d[l]), i = this._measureWord(e, c, s), s += e.length, f <= (r += p + i - g) && !h ? (n.push(o), o = [], r = i, h = !0) : r += g, h || o.push(" "), o = o.concat(e), p = this._measureWord([" "], c, s), s++, h = !1, a < i && (a = i); return l && n.push(o), a + t > this.dynamicMinWidth && (this.dynamicMinWidth = a - g + t), n }, isEndOfWrapping: function (t) { return !this._styleMap[t + 1] || this._styleMap[t + 1].line !== this._styleMap[t].line }, _splitTextIntoLines: function (t) { for (var t = v.Text.prototype._splitTextIntoLines.call(this, t), e = this._wrapText(t.lines, this.width), i = new Array(e.length), r = 0; r < e.length; r++)i[r] = e[r].join(""); return t.lines = i, t.graphemeLines = e, t }, getMinWidth: function () { return Math.max(this.minWidth, this.dynamicMinWidth) }, toObject: function (t) { return this.callSuper("toObject", ["minWidth"].concat(t)) } }), v.Textbox.fromObject = function (t, e) { return v.Object._fromObject("Textbox", t, e, "text") } }("undefined" != typeof exports ? exports : this), function () { var h = fabric.Canvas.prototype._setObjectScale; fabric.Canvas.prototype._setObjectScale = function (t, e, i, r, n, o, s) { var a = e.target; if (!("x" === n && a instanceof fabric.Textbox)) return h.call(fabric.Canvas.prototype, t, e, i, r, n, o, s); e = a._getTransformedDimensions().x, i = a.width * (t.x / e); return i >= a.getMinWidth() ? (a.set("width", i), !0) : void 0 }, fabric.util.object.extend(fabric.Textbox.prototype, { _removeExtraneousStyles: function () { for (var t in this._styleMap) this._textLines[t] || delete this.styles[this._styleMap[t].line] } }) }(); var saveAs = saveAs || function (a) { "use strict"; var h, l, u, g, c, f, v, e, d, p, r, t; if (!(void 0 === a || "undefined" != typeof navigator && /MSIE [1-9]\./.test(navigator.userAgent))) return t = a.document, h = function () { return a.URL || a.webkitURL || a }, l = t.createElementNS("http://www.w3.org/1999/xhtml", "a"), u = "download" in l, g = /constructor/i.test(a.HTMLElement) || a.safari, c = /CriOS\/[\d]+/.test(navigator.userAgent), f = a.setImmediate || a.setTimeout, v = function (t) { f(function () { throw t }, 0) }, e = 4e4, d = function (t) { setTimeout(function () { "string" == typeof t ? h().revokeObjectURL(t) : t.remove() }, e) }, p = function (t) { return /^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type) ? new Blob([String.fromCharCode(65279), t], { type: t.type }) : t }, r = function (t, i, e) { e || (t = p(t)); var r, n, o = this, e = "application/octet-stream" === t.type, s = function () { for (var t = o, e = "writestart progress write writeend".split(" "), i = void 0, r = (e = [].concat(e)).length; r--;) { var n = t["on" + e[r]]; if ("function" == typeof n) try { n.call(t, i || t) } catch (t) { v(t) } } }; if (o.readyState = o.INIT, u) return r = h().createObjectURL(t), void f(function () { var t, e; l.href = r, l.download = i, t = l, e = new MouseEvent("click"), t.dispatchEvent(e), s(), d(r), o.readyState = o.DONE }, 0); (c || e && g) && a.FileReader ? ((n = new FileReader).onloadend = function () { var t = c ? n.result : n.result.replace(/^data:[^;]*;/, "data:attachment/file;"); a.open(t, "_blank") || (a.location.href = t), t = void 0, o.readyState = o.DONE, s() }, n.readAsDataURL(t), o.readyState = o.INIT) : (r = r || h().createObjectURL(t), !e && a.open(r, "_blank") || (a.location.href = r), o.readyState = o.DONE, s(), d(r)) }, t = r.prototype, "undefined" != typeof navigator && navigator.msSaveOrOpenBlob ? function (t, e, i) { return e = e || t.name || "download", i || (t = p(t)), navigator.msSaveOrOpenBlob(t, e) } : (t.abort = function () { }, t.readyState = t.INIT = 0, t.WRITING = 1, t.DONE = 2, t.error = t.onwritestart = t.onprogress = t.onwrite = t.onabort = t.onerror = t.onwriteend = null, function (t, e, i) { return new r(t, e || t.name || "download", i) }) }("undefined" != typeof self && self || "undefined" != typeof window && window || this); !function (t) { "function" == typeof define && define.amd ? define([], t) : "object" == typeof exports ? module.exports = t() : window.noUiSlider = t() }(function () { "use strict"; var ct = "14.6.3"; function vt(t) { t.parentElement.removeChild(t) } function s(t) { return null != t } function mt(t) { t.preventDefault() } function c(t) { return "number" == typeof t && !isNaN(t) && isFinite(t) } function yt(t, e, i) { 0 < i && (dt(t, e), setTimeout(function () { pt(t, e) }, i)) } function _t(t) { return Math.max(Math.min(t, 100), 0) } function ft(t) { return Array.isArray(t) ? t : [t] } function e(t) { t = (t = String(t)).split("."); return 1 < t.length ? t[1].length : 0 } function dt(t, e) { t.classList && !/\s/.test(e) ? t.classList.add(e) : t.className += " " + e } function pt(t, e) { t.classList && !/\s/.test(e) ? t.classList.remove(e) : t.className = t.className.replace(new RegExp("(^|\\b)" + e.split(" ").join("|") + "(\\b|$)", "gi"), " ") } function bt(t) { var e = void 0 !== window.pageXOffset, i = "CSS1Compat" === (t.compatMode || ""); return { x: e ? window.pageXOffset : (i ? t.documentElement : t.body).scrollLeft, y: e ? window.pageYOffset : (i ? t.documentElement : t.body).scrollTop } } function f(t, e) { return 100 / (e - t) } function d(t, e, i) { return 100 * e / (t[i + 1] - t[i]) } function a(t, e) { for (var i = 1; t >= e[i];)i += 1; return i } function r(t, e, i) { if (i >= t.slice(-1)[0]) return 100; var r = a(i, t), n = t[r - 1], t = t[r], o = e[r - 1], e = e[r]; return o + (r = i, d(i = [n, t], i[0] < 0 ? r + Math.abs(i[0]) : r - i[0], 0) / f(o, e)) } function n(t, e, i, r) { if (100 === r) return r; var n = a(r, t), o = t[n - 1], s = t[n]; return i ? (s - o) / 2 < r - o ? s : o : e[n - 1] ? t[n - 1] + (i = r - t[n - 1], s = e[n - 1], Math.round(i / s) * s) : r } function i(t, e, u) { this.xPct = [], this.xVal = [], this.xSteps = [u || !1], this.xNumSteps = [!1], this.xHighestCompleteStep = [], this.snap = e; var i, r, n, o, s = []; for (i in t) t.hasOwnProperty(i) && s.push([t[i], i]); for (s.length && "object" == typeof s[0][0] ? s.sort(function (t, e) { return t[0][0] - e[0][0] }) : s.sort(function (t, e) { return t[0] - e[0] }), i = 0; i < s.length; i++) { a = l = h = a = void 0; var a = s[i][1], h = s[i][0], l = this; if ("number" == typeof h && (h = [h]), !Array.isArray(h)) throw new Error("noUiSlider (" + ct + "): 'range' contains invalid value."); if (!c(a = "min" === a ? 0 : "max" === a ? 100 : parseFloat(a)) || !c(h[0])) throw new Error("noUiSlider (" + ct + "): 'range' value isn't numeric."); l.xPct.push(a), l.xVal.push(h[0]), a ? l.xSteps.push(!isNaN(h[1]) && h[1]) : isNaN(h[1]) || (l.xSteps[0] = h[1]), l.xHighestCompleteStep.push(0) } for (this.xNumSteps = this.xSteps.slice(0), i = 0; i < this.xNumSteps.length; i++)r = i, n = this.xNumSteps[i], o = this, n && (o.xVal[r] !== o.xVal[r + 1] ? (o.xSteps[r] = d([o.xVal[r], o.xVal[r + 1]], n, 0) / f(o.xPct[r], o.xPct[r + 1]), n = (o.xVal[r + 1] - o.xVal[r]) / o.xNumSteps[r], n = Math.ceil(Number(n.toFixed(3)) - 1), n = o.xVal[r] + o.xNumSteps[r] * n, o.xHighestCompleteStep[r] = n) : o.xSteps[r] = o.xHighestCompleteStep[r] = o.xVal[r]) } i.prototype.getDistance = function (t) { for (var e = [], i = 0; i < this.xNumSteps.length - 1; i++) { var r = this.xNumSteps[i]; if (r && t / r % 1 != 0) throw new Error("noUiSlider (" + ct + "): 'limit', 'margin' and 'padding' of " + this.xPct[i] + "% range must be divisible by step."); e[i] = d(this.xVal, t, i) } return e }, i.prototype.getAbsoluteDistance = function (t, e, i) { var r = 0; if (t < this.xPct[this.xPct.length - 1]) for (; t > this.xPct[r + 1];)r++; else t === this.xPct[this.xPct.length - 1] && (r = this.xPct.length - 2); i || t !== this.xPct[r + 1] || r++; for (var n, o = 1, s = e[r], a = 0, u = 0, h = 0, l = i ? (t - this.xPct[r]) / (this.xPct[r + 1] - this.xPct[r]) : (this.xPct[r + 1] - t) / (this.xPct[r + 1] - this.xPct[r]); 0 < s;)n = this.xPct[r + 1 + h] - this.xPct[r + h], 100 < e[r + h] * o + 100 - 100 * l ? (a = n * l, o = (s - 100 * l) / e[r + h], l = 1) : (a = e[r + h] * n / 100 * o, o = 0), i ? (u -= a, 1 <= this.xPct.length + h && h--) : (u += a, 1 <= this.xPct.length - h && h++), s = e[r + h] * o; return t + u }, i.prototype.toStepping = function (t) { return t = r(this.xVal, this.xPct, t) }, i.prototype.fromStepping = function (t) { var e = this.xVal, i = this.xPct; if (100 <= t) return e.slice(-1)[0]; var r = a(t, i), n = e[r - 1], e = e[r], o = i[r - 1], i = i[r]; return (t - o) * f(o, i) * ((r = [n, e])[1] - r[0]) / 100 + r[0] }, i.prototype.getStep = function (t) { return t = n(this.xPct, this.xSteps, this.snap, t) }, i.prototype.getDefaultStep = function (t, e, i) { var r = a(t, this.xPct); return (100 === t || e && t === this.xPct[r - 1]) && (r = Math.max(r - 1, 1)), (this.xVal[r] - this.xVal[r - 1]) / i }, i.prototype.getNearbySteps = function (t) { t = a(t, this.xPct); return { stepBefore: { startValue: this.xVal[t - 2], step: this.xNumSteps[t - 2], highestStep: this.xHighestCompleteStep[t - 2] }, thisStep: { startValue: this.xVal[t - 1], step: this.xNumSteps[t - 1], highestStep: this.xHighestCompleteStep[t - 1] }, stepAfter: { startValue: this.xVal[t], step: this.xNumSteps[t], highestStep: this.xHighestCompleteStep[t] } } }, i.prototype.countStepDecimals = function () { var t = this.xNumSteps.map(e); return Math.max.apply(null, t) }, i.prototype.convert = function (t) { return this.getStep(this.toStepping(t)) }; var h = { to: function (t) { return void 0 !== t && t.toFixed(2) }, from: Number }, l = { target: "target", base: "base", origin: "origin", handle: "handle", handleLower: "handle-lower", handleUpper: "handle-upper", touchArea: "touch-area", horizontal: "horizontal", vertical: "vertical", background: "background", connect: "connect", connects: "connects", ltr: "ltr", rtl: "rtl", textDirectionLtr: "txt-dir-ltr", textDirectionRtl: "txt-dir-rtl", draggable: "draggable", drag: "state-drag", tap: "state-tap", active: "active", tooltip: "tooltip", pips: "pips", pipsHorizontal: "pips-horizontal", pipsVertical: "pips-vertical", marker: "marker", markerHorizontal: "marker-horizontal", markerVertical: "marker-vertical", markerNormal: "marker-normal", markerLarge: "marker-large", markerSub: "marker-sub", value: "value", valueHorizontal: "value-horizontal", valueVertical: "value-vertical", valueNormal: "value-normal", valueLarge: "value-large", valueSub: "value-sub" }, gt = { tooltips: ".__tooltips", aria: ".__aria" }; function o(t) { if ("object" == typeof (t = t) && "function" == typeof t.to && "function" == typeof t.from) return 1; throw new Error("noUiSlider (" + ct + "): 'format' requires 'to' and 'from' methods.") } function u(t, e) { if (!c(e)) throw new Error("noUiSlider (" + ct + "): 'step' is not numeric."); t.singleStep = e } function p(t, e) { if (!c(e)) throw new Error("noUiSlider (" + ct + "): 'keyboardPageMultiplier' is not numeric."); t.keyboardPageMultiplier = e } function g(t, e) { if (!c(e)) throw new Error("noUiSlider (" + ct + "): 'keyboardDefaultStep' is not numeric."); t.keyboardDefaultStep = e } function v(t, e) { if ("object" != typeof e || Array.isArray(e)) throw new Error("noUiSlider (" + ct + "): 'range' is not an object."); if (void 0 === e.min || void 0 === e.max) throw new Error("noUiSlider (" + ct + "): Missing 'min' or 'max' in 'range'."); if (e.min === e.max) throw new Error("noUiSlider (" + ct + "): 'range' 'min' and 'max' cannot be equal."); t.spectrum = new i(e, t.snap, t.singleStep) } function m(t, e) { if (e = ft(e), !Array.isArray(e) || !e.length) throw new Error("noUiSlider (" + ct + "): 'start' option is incorrect."); t.handles = e.length, t.start = e } function y(t, e) { if ("boolean" != typeof (t.snap = e)) throw new Error("noUiSlider (" + ct + "): 'snap' option must be a boolean.") } function _(t, e) { if ("boolean" != typeof (t.animate = e)) throw new Error("noUiSlider (" + ct + "): 'animate' option must be a boolean.") } function b(t, e) { if ("number" != typeof (t.animationDuration = e)) throw new Error("noUiSlider (" + ct + "): 'animationDuration' option must be a number.") } function x(t, e) { var i, r = [!1]; if ("lower" === e ? e = [!0, !1] : "upper" === e && (e = [!1, !0]), !0 === e || !1 === e) { for (i = 1; i < t.handles; i++)r.push(e); r.push(!1) } else { if (!Array.isArray(e) || !e.length || e.length !== t.handles + 1) throw new Error("noUiSlider (" + ct + "): 'connect' option doesn't match handle count."); r = e } t.connect = r } function T(t, e) { switch (e) { case "horizontal": t.ort = 0; break; case "vertical": t.ort = 1; break; default: throw new Error("noUiSlider (" + ct + "): 'orientation' option is invalid.") } } function w(t, e) { if (!c(e)) throw new Error("noUiSlider (" + ct + "): 'margin' option must be numeric."); 0 !== e && (t.margin = t.spectrum.getDistance(e)) } function S(t, e) { if (!c(e)) throw new Error("noUiSlider (" + ct + "): 'limit' option must be numeric."); if (t.limit = t.spectrum.getDistance(e), !t.limit || t.handles < 2) throw new Error("noUiSlider (" + ct + "): 'limit' option is only supported on linear sliders with 2 or more handles.") } function C(t, e) { var i; if (!c(e) && !Array.isArray(e)) throw new Error("noUiSlider (" + ct + "): 'padding' option must be numeric or array of exactly 2 numbers."); if (Array.isArray(e) && 2 !== e.length && !c(e[0]) && !c(e[1])) throw new Error("noUiSlider (" + ct + "): 'padding' option must be numeric or array of exactly 2 numbers."); if (0 !== e) { for (Array.isArray(e) || (e = [e, e]), t.padding = [t.spectrum.getDistance(e[0]), t.spectrum.getDistance(e[1])], i = 0; i < t.spectrum.xNumSteps.length - 1; i++)if (t.padding[0][i] < 0 || t.padding[1][i] < 0) throw new Error("noUiSlider (" + ct + "): 'padding' option must be a positive number(s)."); var e = e[0] + e[1], r = t.spectrum.xVal[0]; if (1 < e / (t.spectrum.xVal[t.spectrum.xVal.length - 1] - r)) throw new Error("noUiSlider (" + ct + "): 'padding' option must not exceed 100% of the range.") } } function E(t, e) { switch (e) { case "ltr": t.dir = 0; break; case "rtl": t.dir = 1; break; default: throw new Error("noUiSlider (" + ct + "): 'direction' option was not recognized.") } } function O(t, e) { if ("string" != typeof e) throw new Error("noUiSlider (" + ct + "): 'behaviour' must be a string containing options."); var i = 0 <= e.indexOf("tap"), r = 0 <= e.indexOf("drag"), n = 0 <= e.indexOf("fixed"), o = 0 <= e.indexOf("snap"), s = 0 <= e.indexOf("hover"), e = 0 <= e.indexOf("unconstrained"); if (n) { if (2 !== t.handles) throw new Error("noUiSlider (" + ct + "): 'fixed' behaviour must be used with 2 handles"); w(t, t.start[1] - t.start[0]) } if (e && (t.margin || t.limit)) throw new Error("noUiSlider (" + ct + "): 'unconstrained' behaviour cannot be used with margin or limit"); t.events = { tap: i || o, drag: r, fixed: n, snap: o, hover: s, unconstrained: e } } function P(t, e) { if (!1 !== e) if (!0 === e) { t.tooltips = []; for (var i = 0; i < t.handles; i++)t.tooltips.push(!0) } else { if (t.tooltips = ft(e), t.tooltips.length !== t.handles) throw new Error("noUiSlider (" + ct + "): must pass a formatter for all handles."); t.tooltips.forEach(function (t) { if ("boolean" != typeof t && ("object" != typeof t || "function" != typeof t.to)) throw new Error("noUiSlider (" + ct + "): 'tooltips' must be passed a formatter or 'false'.") }) } } function M(t, e) { o(t.ariaFormat = e) } function A(t, e) { o(t.format = e) } function D(t, e) { if ("boolean" != typeof (t.keyboardSupport = e)) throw new Error("noUiSlider (" + ct + "): 'keyboardSupport' option must be a boolean.") } function R(t, e) { t.documentElement = e } function I(t, e) { if ("string" != typeof e && !1 !== e) throw new Error("noUiSlider (" + ct + "): 'cssPrefix' must be a string or `false`."); t.cssPrefix = e } function k(t, e) { if ("object" != typeof e) throw new Error("noUiSlider (" + ct + "): 'cssClasses' must be an object."); if ("string" == typeof t.cssPrefix) for (var i in t.cssClasses = {}, e) e.hasOwnProperty(i) && (t.cssClasses[i] = t.cssPrefix + e[i]); else t.cssClasses = e } function xt(e) { var i = { margin: 0, limit: 0, padding: 0, animate: !0, animationDuration: 300, ariaFormat: h, format: h }, r = { step: { r: !1, t: u }, keyboardPageMultiplier: { r: !1, t: p }, keyboardDefaultStep: { r: !1, t: g }, start: { r: !0, t: m }, connect: { r: !0, t: x }, direction: { r: !0, t: E }, snap: { r: !1, t: y }, animate: { r: !1, t: _ }, animationDuration: { r: !1, t: b }, range: { r: !0, t: v }, orientation: { r: !1, t: T }, margin: { r: !1, t: w }, limit: { r: !1, t: S }, padding: { r: !1, t: C }, behaviour: { r: !0, t: O }, ariaFormat: { r: !1, t: M }, format: { r: !1, t: A }, tooltips: { r: !1, t: P }, keyboardSupport: { r: !0, t: D }, documentElement: { r: !1, t: R }, cssPrefix: { r: !0, t: I }, cssClasses: { r: !0, t: k } }, n = { connect: !1, direction: "ltr", behaviour: "tap", orientation: "horizontal", keyboardSupport: !0, cssPrefix: "noUi-", cssClasses: l, keyboardPageMultiplier: 5, keyboardDefaultStep: 10 }, t = (e.format && !e.ariaFormat && (e.ariaFormat = e.format), Object.keys(r).forEach(function (t) { if (!s(e[t]) && void 0 === n[t]) { if (r[t].r) throw new Error("noUiSlider (" + ct + "): '" + t + "' is required."); return !0 } r[t].t(i, (s(e[t]) ? e : n)[t]) }), i.pips = e.pips, document.createElement("div")), o = void 0 !== t.style.msTransform, t = void 0 !== t.style.transform; i.transformRule = t ? "transform" : o ? "msTransform" : "webkitTransform"; return i.style = [["left", "top"], ["right", "bottom"]][i.dir][i.ort], i } function L(t, f, s) { var n, a, u, b, r, g, v = window.navigator.pointerEnabled ? { start: "pointerdown", move: "pointermove", end: "pointerup" } : window.navigator.msPointerEnabled ? { start: "MSPointerDown", move: "MSPointerMove", end: "MSPointerUp" } : { start: "mousedown touchstart", move: "mousemove touchmove", end: "mouseup touchend" }, m = window.CSS && CSS.supports && CSS.supports("touch-action", "none") && function () { var t = !1; try { var e = Object.defineProperty({}, "passive", { get: function () { t = !0 } }); window.addEventListener("test", null, e) } catch (t) { } return t }(), h = t, _ = f.spectrum, y = [], c = [], l = [], x = 0, o = {}, T = t.ownerDocument, w = f.documentElement || T.documentElement, S = T.body, C = -1, E = 0, O = 1, P = 2, M = "rtl" === T.dir || 1 === f.ort ? 0 : 100; function d(t, e) { var i = T.createElement("div"); return e && dt(i, e), t.appendChild(i), i } function e(t, u) { var t = d(t, f.cssClasses.origin), e = d(t, f.cssClasses.handle); return d(e, f.cssClasses.touchArea), e.setAttribute("data-handle", u), f.keyboardSupport && (e.setAttribute("tabindex", "0"), e.addEventListener("keydown", function (t) { var e = u; if (D() || R(e)) return !1; var i = ["Left", "Right"], r = ["Down", "Up"], n = ["PageDown", "PageUp"], o = ["Home", "End"]; f.dir && !f.ort ? i.reverse() : f.ort && !f.dir && (r.reverse(), n.reverse()); var s, a = (l = t.key.replace("Arrow", "")) === n[0], n = l === n[1], h = l === r[0] || l === i[0] || a, r = l === r[1] || l === i[1] || n, i = l === o[0], l = l === o[1]; if (!(h || r || i || l)) return !0; if (t.preventDefault(), r || h) { o = f.keyboardPageMultiplier, i = h ? 0 : 1, t = ot(e)[i]; if (null === t) return !1; !1 === t && (t = _.getDefaultStep(c[e], h, f.keyboardDefaultStep)), (n || a) && (t *= o), t = Math.max(t, 1e-7), t *= h ? -1 : 1, s = y[e] + t } else s = l ? f.spectrum.xVal[f.spectrum.xVal.length - 1] : f.spectrum.xVal[0]; return tt(e, _.toStepping(s), !0, !0), p("slide", e), p("update", e), p("change", e), p("set", e), !1 })), e.setAttribute("role", "slider"), e.setAttribute("aria-orientation", f.ort ? "vertical" : "horizontal"), 0 === u ? dt(e, f.cssClasses.handleLower) : u === f.handles - 1 && dt(e, f.cssClasses.handleUpper), t } function i(t, e) { return !!e && d(t, f.cssClasses.connect) } function A(t, e) { return !!f.tooltips[e] && d(t.firstChild, f.cssClasses.tooltip) } function D() { return h.hasAttribute("disabled") } function R(t) { return a[t].hasAttribute("disabled") } function I() { r && (q("update" + gt.tooltips), r.forEach(function (t) { t && vt(t) }), r = null) } function k() { I(), r = a.map(A), z("update" + gt.tooltips, function (t, e, i) { r[e] && (t = t[e], !0 !== f.tooltips[e] && (t = f.tooltips[e].to(i[e])), r[e].innerHTML = t) }) } function L(n, o, s) { var a = T.createElement("div"), r = [], h = (r[E] = f.cssClasses.valueNormal, r[O] = f.cssClasses.valueLarge, r[P] = f.cssClasses.valueSub, []), l = (h[E] = f.cssClasses.markerNormal, h[O] = f.cssClasses.markerLarge, h[P] = f.cssClasses.markerSub, [f.cssClasses.valueHorizontal, f.cssClasses.valueVertical]), u = [f.cssClasses.markerHorizontal, f.cssClasses.markerVertical]; function c(t, e) { var i = e === f.cssClasses.value; return e + " " + (i ? l : u)[f.ort] + " " + (i ? r : h)[t] } return dt(a, f.cssClasses.pips), dt(a, 0 === f.ort ? f.cssClasses.pipsHorizontal : f.cssClasses.pipsVertical), Object.keys(n).forEach(function (t) { var e, i, r; i = n[e = t][0], t = n[t][1], (t = o ? o(i, t) : t) !== C && ((r = d(a, !1)).className = c(t, f.cssClasses.marker), r.style[f.style] = e + "%", E < t && ((r = d(a, !1)).className = c(t, f.cssClasses.value), r.setAttribute("data-value", i), r.style[f.style] = e + "%", r.innerHTML = s.to(i))) }), a } function j() { b && (vt(b), b = null) } function F(t) { j(); var f, d, p, g, v, m, y, e = t.mode, i = t.density || 1, r = t.filter || !1, n = function (t, e, i) { if ("range" === t || "steps" === t) return _.xVal; if ("count" === t) { if (e < 2) throw new Error("noUiSlider (" + ct + "): 'values' (>= 2) required for mode 'count'."); var r = e - 1, n = 100 / r; for (e = []; r--;)e[r] = r * n; e.push(100), t = "positions" } return "positions" === t ? e.map(function (t) { return _.fromStepping(i ? _.getStep(t) : t) }) : "values" === t ? i ? e.map(function (t) { return _.fromStepping(_.getStep(_.toStepping(t))) }) : e : void 0 }(e, t.values || !1, t.stepped || !1), n = (f = i, d = e, p = n, g = {}, i = _.xVal[0], e = _.xVal[_.xVal.length - 1], m = v = !1, y = 0, (p = p.slice().sort(function (t, e) { return t - e }).filter(function (t) { return !this[t] && (this[t] = !0) }, {}))[0] !== i && (p.unshift(i), v = !0), p[p.length - 1] !== e && (p.push(e), m = !0), p.forEach(function (t, e) { var i, r, n, o, s, a, u, h = p[e + 1], c = "steps" === d, l = (l = c ? _.xNumSteps[e] : l) || h - t; if (!1 !== t) for (void 0 === h && (h = t), l = Math.max(l, 1e-7), i = t; i <= h; i = +(i + l).toFixed(7)) { for (u = (s = (n = _.toStepping(i)) - y) / (a = Math.round(s / f)), r = 1; r <= a; r += 1)g[(o = y + r * u).toFixed(5)] = [_.fromStepping(o), 0]; s = -1 < p.indexOf(i) ? O : c ? P : E, !e && v && i !== h && (s = 0), i === h && m || (g[n.toFixed(5)] = [i, s]), y = n } }), g), i = t.format || { to: Math.round }; return b = h.appendChild(L(n, r, i)) } function B() { var t = n.getBoundingClientRect(), e = "offset" + ["Width", "Height"][f.ort]; return 0 === f.ort ? t.width || n[e] : t.height || n[e] } function N(r, n, o, s) { function e(t) { return !!(t = function (t, e, i) { var r, n = 0 === t.type.indexOf("touch"), o = 0 === t.type.indexOf("mouse"), s = 0 === t.type.indexOf("pointer"); 0 === t.type.indexOf("MSPointer") && (s = !0); if ("mousedown" === t.type && !t.buttons && !t.touches) return !1; if (n) { n = function (t) { return t.target === i || i.contains(t.target) || t.target.shadowRoot && t.target.shadowRoot.contains(i) }; if ("touchstart" === t.type) { var a = Array.prototype.filter.call(t.touches, n); if (1 < a.length) return !1; r = a[0].pageX, a = a[0].pageY } else { n = Array.prototype.find.call(t.changedTouches, n); if (!n) return !1; r = n.pageX, a = n.pageY } } e = e || bt(T), (o || s) && (r = t.clientX + e.x, a = t.clientY + e.y); return t.pageOffset = e, t.points = [r, a], t.cursor = o || s, t }(t, s.pageOffset, s.target || n)) && (!(D() && !s.doNotReject) && (e = h, i = f.cssClasses.tap, !((e.classList ? e.classList.contains(i) : new RegExp("\\b" + i + "\\b").test(e.className)) && !s.doNotReject) && (!(r === v.start && void 0 !== t.buttons && 1 < t.buttons) && ((!s.hover || !t.buttons) && (m || t.preventDefault(), t.calcPoint = t.points[f.ort], void o(t, s)))))); var e, i } var i = []; return r.split(" ").forEach(function (t) { n.addEventListener(t, e, !!m && { passive: !0 }), i.push([t, e]) }), i } function U(t) { var e, i, r = _t(100 * (t - (t = n, r = f.ort, e = t.getBoundingClientRect(), i = (t = t.ownerDocument).documentElement, t = bt(t), /webkit.*Chrome.*Mobile/i.test(navigator.userAgent) && (t.x = 0), r ? e.top + t.y - i.clientTop : e.left + t.x - i.clientLeft)) / B()); return f.dir ? 100 - r : r } function X(t, e) { "mouseout" === t.type && "HTML" === t.target.nodeName && null === t.relatedTarget && G(t, e) } function W(t, e) { if (-1 === navigator.appVersion.indexOf("MSIE 9") && 0 === t.buttons && 0 !== e.buttonsProperty) return G(t, e); t = (f.dir ? -1 : 1) * (t.calcPoint - e.startCalcPoint); J(0 < t, 100 * t / e.baseSize, e.locations, e.handleNumbers) } function G(t, e) { e.handle && (pt(e.handle, f.cssClasses.active), --x), e.listeners.forEach(function (t) { w.removeEventListener(t[0], t[1]) }), 0 === x && (pt(h, f.cssClasses.drag), $(), t.cursor && (S.style.cursor = "", S.removeEventListener("selectstart", mt))), e.handleNumbers.forEach(function (t) { p("change", t), p("set", t), p("end", t) }) } function H(t, e) { if (e.handleNumbers.some(R)) return !1; 1 === e.handleNumbers.length && (o = a[e.handleNumbers[0]].children[0], x += 1, dt(o, f.cssClasses.active)), t.stopPropagation(); var i = [], r = N(v.move, w, W, { target: t.target, handle: o, listeners: i, startCalcPoint: t.calcPoint, baseSize: B(), pageOffset: t.pageOffset, handleNumbers: e.handleNumbers, buttonsProperty: t.buttons, locations: c.slice() }), n = N(v.end, w, G, { target: t.target, handle: o, listeners: i, doNotReject: !0, handleNumbers: e.handleNumbers }), o = N("mouseout", w, X, { target: t.target, handle: o, listeners: i, doNotReject: !0, handleNumbers: e.handleNumbers }); i.push.apply(i, r.concat(n, o)), t.cursor && (S.style.cursor = getComputedStyle(t.target).cursor, 1 < a.length && dt(h, f.cssClasses.drag), S.addEventListener("selectstart", mt, !1)), e.handleNumbers.forEach(function (t) { p("start", t) }) } function Y(t) { t.stopPropagation(); var n, o, s, e = U(t.calcPoint), i = (n = e, s = !(o = 100), a.forEach(function (t, e) { var i, r; R(e) || (i = c[e], ((r = Math.abs(i - n)) < o || r <= o && i < n || 100 === r && 100 === o) && (s = e, o = r)) }), s); if (!1 === i) return !1; f.events.snap || yt(h, f.cssClasses.tap, f.animationDuration), tt(i, e, !0, !0), $(), p("slide", i, !0), p("update", i, !0), p("change", i, !0), p("set", i, !0), f.events.snap && H(t, { handleNumbers: [i] }) } function V(t) { var t = U(t.calcPoint), t = _.getStep(t), e = _.fromStepping(t); Object.keys(o).forEach(function (t) { "hover" === t.split(".")[0] && o[t].forEach(function (t) { t.call(g, e) }) }) } function z(t, e) { o[t] = o[t] || [], o[t].push(e), "update" === t.split(".")[0] && a.forEach(function (t, e) { p("update", e) }) } function q(t) { var r = t && t.split(".")[0], n = r ? t.substring(r.length) : t; Object.keys(o).forEach(function (t) { var e = t.split(".")[0], i = t.substring(e.length); r && r !== e || n && n !== i || ((e = i) !== gt.aria && e !== gt.tooltips || n === i) && delete o[t] }) } function p(i, r, n) { Object.keys(o).forEach(function (t) { var e = t.split(".")[0]; i === e && o[t].forEach(function (t) { t.call(g, y.map(f.format.to), r, y.slice(), n || !1, c.slice(), g) }) }) } function K(t, e, i, r, n, o) { var s; return 1 < a.length && !f.events.unconstrained && (r && 0 < e && (s = _.getAbsoluteDistance(t[e - 1], f.margin, 0), i = Math.max(i, s)), n && e < a.length - 1 && (s = _.getAbsoluteDistance(t[e + 1], f.margin, 1), i = Math.min(i, s))), 1 < a.length && f.limit && (r && 0 < e && (s = _.getAbsoluteDistance(t[e - 1], f.limit, 0), i = Math.min(i, s)), n && e < a.length - 1 && (s = _.getAbsoluteDistance(t[e + 1], f.limit, 1), i = Math.max(i, s))), f.padding && (0 === e && (s = _.getAbsoluteDistance(0, f.padding[0], 0), i = Math.max(i, s)), e === a.length - 1 && (s = _.getAbsoluteDistance(100, f.padding[1], 1), i = Math.min(i, s))), !((i = _t(i = _.getStep(i))) === t[e] && !o) && i } function Z(t, e) { var i = f.ort; return (i ? e : t) + ", " + (i ? t : e) } function J(t, i, r, e) { var n = r.slice(), o = [!t, t], s = [t, !t], a = (e = e.slice(), t && e.reverse(), 1 < e.length ? e.forEach(function (t, e) { e = K(n, t, n[t] + i, o[e], s[e], !1); !1 === e ? i = 0 : (i = e - n[t], n[t] = e) }) : o = s = [!0], !1); e.forEach(function (t, e) { a = tt(t, r[t] + i, o[e], s[e]) || a }), a && e.forEach(function (t) { p("update", t), p("slide", t) }) } function Q(t, e) { return f.dir ? 100 - t - e : t } function $() { l.forEach(function (t) { var e = 50 < c[t] ? -1 : 1, e = 3 + (a.length + e * t); a[t].style.zIndex = e }) } function tt(t, e, i, r, n) { return !1 !== (e = n ? e : K(c, t, e, i, r, !1)) && (n = e, c[i = t] = n, y[i] = _.fromStepping(n), n = "translate(" + Z(10 * (Q(n, 0) - M) + "%", "0") + ")", a[i].style[f.transformRule] = n, et(i), et(i + 1), !0) } function et(t) { var e, i; u[t] && (i = 100, e = "translate(" + Z(Q(e = (e = 0) !== t ? c[t - 1] : e, i = (i = t !== u.length - 1 ? c[t] : i) - e) + "%", "0") + ")", i = "scale(" + Z(i / 100, "1") + ")", u[t].style[f.transformRule] = e + " " + i) } function it(t, e) { return null === t || !1 === t || void 0 === t ? c[e] : ("number" == typeof t && (t = String(t)), t = f.format.from(t), !1 === (t = _.toStepping(t)) || isNaN(t) ? c[e] : t) } function rt(t, e, i) { for (var r = ft(t), t = void 0 === c[0], n = (e = void 0 === e || !!e, f.animate && !t && yt(h, f.cssClasses.tap, f.animationDuration), l.forEach(function (t) { tt(t, it(r[t], t), !0, !1, i) }), 1 === l.length ? 0 : 1); n < l.length; ++n)l.forEach(function (t) { tt(t, c[t], !0, !0, i) }); $(), l.forEach(function (t) { p("update", t), null !== r[t] && e && p("set", t) }) } function nt() { var t = y.map(f.format.to); return 1 === t.length ? t[0] : t } function ot(t) { var e = c[t], i = _.getNearbySteps(e), t = y[t], r = i.thisStep.step, n = null; if (f.snap) return [t - i.stepBefore.startValue || null, i.stepAfter.startValue - t || null]; !1 !== r && t + r > i.stepAfter.startValue && (r = i.stepAfter.startValue - t), n = t > i.thisStep.startValue ? i.thisStep.step : !1 !== i.stepBefore.step && t - i.stepBefore.highestStep, 100 === e ? r = null : 0 === e && (n = null); t = _.countStepDecimals(); return null !== r && !1 !== r && (r = Number(r.toFixed(t))), [n = null !== n && !1 !== n ? Number(n.toFixed(t)) : n, r] } dt(t = h, f.cssClasses.target), 0 === f.dir ? dt(t, f.cssClasses.ltr) : dt(t, f.cssClasses.rtl), 0 === f.ort ? dt(t, f.cssClasses.horizontal) : dt(t, f.cssClasses.vertical), dt(t, "rtl" === getComputedStyle(t).direction ? f.cssClasses.textDirectionRtl : f.cssClasses.textDirectionLtr), n = d(t, f.cssClasses.base); var st, at = f.connect, ht = n, lt = d(ht, f.cssClasses.connects); a = [], (u = []).push(i(lt, at[0])); for (var ut = 0; ut < f.handles; ut++)a.push(e(ht, ut)), l[ut] = ut, u.push(i(lt, at[ut + 1])); return (st = f.events).fixed || a.forEach(function (t, e) { N(v.start, t.children[0], H, { handleNumbers: [e] }) }), st.tap && N(v.start, n, Y, {}), st.hover && N(v.move, n, V, { hover: !0 }), st.drag && u.forEach(function (t, e) { var i, r, n; !1 !== t && 0 !== e && e !== u.length - 1 && (i = a[e - 1], r = a[e], n = [t], dt(t, f.cssClasses.draggable), st.fixed && (n.push(i.children[0]), n.push(r.children[0])), n.forEach(function (t) { N(v.start, t, H, { handles: [i, r], handleNumbers: [e - 1, e] }) })) }), rt(f.start), f.pips && F(f.pips), f.tooltips && k(), q("update" + gt.aria), z("update" + gt.aria, function (t, e, o, i, s) { l.forEach(function (t) { var e = a[t], i = K(c, t, 0, !0, !0, !0), r = K(c, t, 100, !0, !0, !0), n = s[t], t = f.ariaFormat.to(o[t]), i = _.fromStepping(i).toFixed(1), r = _.fromStepping(r).toFixed(1), n = _.fromStepping(n).toFixed(1); e.children[0].setAttribute("aria-valuemin", i), e.children[0].setAttribute("aria-valuemax", r), e.children[0].setAttribute("aria-valuenow", n), e.children[0].setAttribute("aria-valuetext", t) }) }), g = { destroy: function () { for (var t in q(gt.aria), q(gt.tooltips), f.cssClasses) f.cssClasses.hasOwnProperty(t) && pt(h, f.cssClasses[t]); for (; h.firstChild;)h.removeChild(h.firstChild); delete h.noUiSlider }, steps: function () { return l.map(ot) }, on: z, off: q, get: nt, set: rt, setHandle: function (t, e, i, r) { if (!(0 <= (t = Number(t)) && t < l.length)) throw new Error("noUiSlider (" + ct + "): invalid handle number, got: " + t); tt(t, it(e, t), !0, !0, r), p("update", t), i && p("set", t) }, reset: function (t) { rt(f.start, t) }, __moveHandles: function (t, e, i) { J(t, e, c, i) }, options: s, updateOptions: function (e, t) { var i = nt(), r = ["margin", "limit", "padding", "range", "animate", "snap", "step", "format", "pips", "tooltips"], n = (r.forEach(function (t) { void 0 !== e[t] && (s[t] = e[t]) }), xt(s)); r.forEach(function (t) { void 0 !== e[t] && (f[t] = n[t]) }), _ = n.spectrum, f.margin = n.margin, f.limit = n.limit, f.padding = n.padding, f.pips ? F(f.pips) : j(), (f.tooltips ? k : I)(), c = [], rt(e.start || i, t) }, target: h, removePips: j, removeTooltips: I, getTooltips: function () { return r }, getOrigins: function () { return a }, pips: F } } return { __spectrum: i, version: ct, cssClasses: l, create: function (t, e) { if (!t || !t.nodeName) throw new Error("noUiSlider (" + ct + "): create requires a single element, got: " + t); if (t.noUiSlider) throw new Error("noUiSlider (" + ct + "): Slider was already initialized."); return e = L(t, xt(e), e), t.noUiSlider = e } } }), function () { "use strict"; var h = {}; function g(t, e, i, r) { if (e.x > i || i >= e.x + e.width || e.y > r || r >= e.y + e.height) return t.outsideImportance; i = (i - e.x) / e.width, r = (r - e.y) / e.height; var e = 2 * o(.5 - i), i = 2 * o(.5 - r), r = Math.max(e - 1 + t.edgeRadius, 0), n = Math.max(i - 1 + t.edgeRadius, 0), r = (r * r + n * n) * t.edgeWeight, n = 1.41 - v(e * e + i * i); return t.ruleOfThirds && (n += 1.2 * Math.max(0, n + r + .5) * (s(e) + s(i))), n + r } function b(t, e, i) { this.width = t, this.height = e, this.data = i ? new Uint8ClampedArray(i) : new Uint8ClampedArray(t * e * 4) } function c(t, e) { for (var i = t.data, u = t.width, r = Math.floor(t.width / e), c = Math.floor(t.height / e), t = new b(r, c), n = t.data, o = 1 / (e * e), s = 0; s < c; s++)for (var a = 0; a < r; a++) { for (var h = 4 * (s * r + a), f = 0, d = 0, p = 0, g = 0, v = 0, m = 0, y = 0; y < e; y++)for (var _ = 0; _ < e; _++) { var l = 4 * ((s * e + y) * u + (a * e + _)); f += i[l], d += i[1 + l], p += i[2 + l], g += i[3 + l], v = Math.max(v, i[l]), m = Math.max(m, i[1 + l]) } n[h] = f * o * .5 + .5 * v, n[1 + h] = d * o * .7 + .3 * m, n[2 + h] = p * o, n[3 + h] = g * o } return t } function e(t, e) { var i = document.createElement("canvas"); return i.width = t, i.height = e, i } function n(n) { return { open: function (t) { var e = t.naturalWidth || t.width, i = t.naturalHeight || t.height, e = n(e, i), i = e.getContext("2d"); return !t.naturalWidth || t.naturalWidth == t.width && t.naturalHeight == t.height ? (e.width = t.width, e.height = t.height) : (e.width = t.naturalWidth, e.height = t.naturalHeight), i.drawImage(t, 0, 0), h.Promise.resolve(e) }, resample: function (t, i, r) { return Promise.resolve(t).then(function (t) { var e = n(~~i, ~~r); return e.getContext("2d").drawImage(t, 0, 0, t.width, t.height, 0, 0, e.width, e.height), h.Promise.resolve(e) }) }, getData: function (t) { return Promise.resolve(t).then(function (t) { var e = t.getContext("2d").getImageData(0, 0, t.width, t.height); return new b(t.width, t.height, e.data) }) } } } h.Promise = "undefined" != typeof Promise ? Promise : function () { throw new Error("No native promises and smartcrop.Promise not set.") }, h.DEFAULTS = { width: 0, height: 0, aspect: 0, cropWidth: 0, cropHeight: 0, detailWeight: .2, skinColor: [.78, .57, .44], skinBias: .01, skinBrightnessMin: .2, skinBrightnessMax: 1, skinThreshold: .8, skinWeight: 1.8, saturationBrightnessMin: .05, saturationBrightnessMax: .9, saturationThreshold: .4, saturationBias: .2, saturationWeight: .1, scoreDownSample: 8, step: 8, scaleStep: .1, minScale: 1, maxScale: 1, edgeRadius: .4, edgeWeight: -20, outsideImportance: -.5, boostWeight: 100, ruleOfThirds: !0, prescale: !0, imageOperations: null, canvasFactory: e, debug: !1 }, h.crop = function (t, e, o) { var i, s = y({}, h.DEFAULTS, e), r = (s.aspect && (s.width = s.aspect, s.height = 1), null === s.imageOperations && (s.imageOperations = n(s.canvasFactory)), s.imageOperations), a = 1; return r.open(t, s.input).then(function (t) { return s.width && s.height && (i = d(t.width / s.width, t.height / s.height), s.cropWidth = ~~(s.width * i), s.cropHeight = ~~(s.height * i), s.minScale = d(s.maxScale, p(1 / i, s.minScale)), !1 !== s.prescale && ((a = d(p(256 / t.width, 256 / t.height), 1)) < 1 ? (t = r.resample(t, t.width * a, t.height * a), s.cropWidth = ~~(s.cropWidth * a), s.cropHeight = ~~(s.cropHeight * a), s.boost && (s.boost = s.boost.map(function (t) { return { x: ~~(t.x * a), y: ~~(t.y * a), width: ~~(t.width * a), height: ~~(t.height * a), weight: t.weight } }))) : a = 1)), t }).then(function (t) { return r.getData(t).then(function (t) { for (var t = function (t, e) { for (var i = {}, r = new b(e.width, e.height), n = (function (t, e) { for (var i, r = t.data, n = e.data, o = t.width, s = t.height, a = 0; a < s; a++)for (var h = 0; h < o; h++) { var l = 4 * (a * o + h); i = 0 === h || o - 1 <= h || 0 === a || s - 1 <= a ? f(r, l) : 4 * f(r, l) - f(r, l - 4 * o) - f(r, l - 4) - f(r, 4 + l) - f(r, l + 4 * o), n[1 + l] = i } }(e, r), function (t, e, i) { for (var r = e.data, u = i.data, n = e.width, c = e.height, o = 0; o < c; o++)for (var s = 0; s < n; s++) { var a = 4 * (o * n + s), h = m(r[a], r[1 + a], r[2 + a]) / 255, l = function (t, e, i, r) { var n = v(e * e + i * i + r * r), e = e / n - t.skinColor[0], i = i / n - t.skinColor[1], r = r / n - t.skinColor[2]; return 1 - v(e * e + i * i + r * r) }(t, r[a], r[1 + a], r[2 + a]), f = l > t.skinThreshold, h = h >= t.skinBrightnessMin && h <= t.skinBrightnessMax; u[a] = f && h ? (l - t.skinThreshold) * (255 / (1 - t.skinThreshold)) : 0 } }(t, e, r), function (t, e, i) { for (var r = e.data, u = i.data, n = e.width, c = e.height, o = 0; o < c; o++)for (var s = 0; s < n; s++) { var a = 4 * (o * n + s), h = m(r[a], r[1 + a], r[2 + a]) / 255, l = function (t, e, i) { var r = p(t / 255, e / 255, i / 255), t = d(t / 255, e / 255, i / 255); if (r === t) return 0; e = r - t; return .5 < (r + t) / 2 ? e / (2 - r - t) : e / (r + t) }(r[a], r[1 + a], r[2 + a]), f = l > t.saturationThreshold, h = h >= t.saturationBrightnessMin && h <= t.saturationBrightnessMax; u[2 + a] = h && f ? (l - t.saturationThreshold) * (255 / (1 - t.saturationThreshold)) : 0 } }(t, e, r), function (t, e) { if (t.boost) { for (var i = e.data, r = 0; r < e.width; r += 4)i[r + 3] = 0; for (r = 0; r < t.boost.length; r++)!function (t, e) { for (var i = e.data, r = e.width, n = ~~t.x, o = ~~(t.x + t.width), e = ~~t.y, s = ~~(t.y + t.height), a = 255 * t.weight, h = e; h < s; h++)for (var l = n; l < o; l++)i[3 + 4 * (h * r + l)] += a }(t.boost[r], e) } }(t, r), c(r, t.scoreDownSample)), o = -1 / 0, s = null, a = function (t, e, i) { for (var r = [], n = d(e, i), o = t.cropWidth || n, s = t.cropHeight || n, a = t.maxScale; a >= t.minScale; a -= t.scaleStep)for (var h = 0; h + s * a <= i; h += t.step)for (var l = 0; l + o * a <= e; l += t.step)r.push({ x: l, y: h, width: o * a, height: s * a }); return r }(t, e.width, e.height), h = 0, u = a.length; h < u; h++) { var l = a[h]; l.score = function (t, e, i) { for (var r = { detail: 0, saturation: 0, skin: 0, boost: 0, total: 0 }, n = e.data, o = t.scoreDownSample, u = 1 / o, c = e.height * o, f = e.width * o, d = e.width, s = 0; s < c; s += o)for (var a = 0; a < f; a += o) { var h = 4 * (~~(s * u) * d + ~~(a * u)), l = g(t, i, a, s), p = n[1 + h] / 255; r.skin += n[h] / 255 * (p + t.skinBias) * l, r.detail += p * l, r.saturation += n[2 + h] / 255 * (p + t.saturationBias) * l, r.boost += n[3 + h] / 255 * l } return r.total = (r.detail * t.detailWeight + r.skin * t.skinWeight + r.saturation * t.saturationWeight + r.boost * t.boostWeight) / (i.width * i.height), r }(t, n, l), l.score.total > o && (o = (s = l).score.total) } i.topCrop = s, t.debug && s && (i.crops = a, i.debugOutput = r, i.debugOptions = t, i.debugTopCrop = y({}, i.topCrop)); return i }(s, t), e = t.crops || [t.topCrop], i = 0, r = e.length; i < r; i++) { var n = e[i]; n.x = ~~(n.x / a), n.y = ~~(n.y / a), n.width = ~~(n.width / a), n.height = ~~(n.height / a) } return o && o(t), t }) }) }, h.isAvailable = function (t) { if (!h.Promise) return !1; t = t ? t.canvasFactory : e; if (t === e && !document.createElement("canvas").getContext("2d")) return !1; return !0 }, h.importance = g, h.ImgData = b, h._downSample = c, h._canvasImageOperations = n; var d = Math.min, p = Math.max, o = Math.abs, v = Math.sqrt; function y(t) { for (var e = 1, i = arguments.length; e < i; e++) { var r = arguments[e]; if (r) for (var n in r) t[n] = r[n] } return t } function s(t) { return t = 16 * ((t - 1 / 3 + 1) % 2 * .5 - .5), Math.max(1 - t * t, 0) } function m(t, e, i) { return .5126 * i + .7152 * e + .0722 * t } function f(t, e) { return m(t[e], t[e + 1], t[e + 2]) } "undefined" != typeof define && define.amd && define(function () { return h }), "undefined" != typeof exports ? exports.smartcrop = h : "undefined" != typeof navigator && (window.SmartCrop = window.smartcrop = h), "undefined" != typeof module && (module.exports = h) }();
//# sourceMappingURL=scripts.js.map
